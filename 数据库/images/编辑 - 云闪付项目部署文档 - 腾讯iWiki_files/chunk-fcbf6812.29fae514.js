(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fcbf6812"],{"033a":function(e,t,i){},"1ced":function(e,t,i){"use strict";var a=i("ec70"),n=i.n(a);t["default"]=n.a},3051:function(e,t,i){},"5a08":function(e,t,i){"use strict";i("fce4")},"73cf":function(e,t,i){"use strict";i("c786")},afbb:function(e,t,i){"use strict";i("3051")},b845:function(e,t,i){"use strict";i("033a")},c786:function(e,t,i){},d161:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"page-edit":!0,"is-full":e.isFull}},[i("div",{staticClass:"header"},[i("div",{staticClass:"crumbs"},[i("Crumbs",{ref:"crumbs",attrs:{parentId:e.isCreate?e.parentId:""}})],1),i("ten-tooltip",{attrs:{dark:"",message:e.$t("move")}},[e.isSpaceHome||e.isCreate?e._e():i("div",{staticClass:"icon-tag",on:{click:e.toggleMove}})]),i("ten-tooltip",{attrs:{dark:"",message:e.$t("permissions")}},[e.showBtnPermission?i("Icon",{staticClass:"icon-permission",attrs:{icon:e.permissionIcon,size:"20"},on:{click:e.togglePermission}}):e._e()],1),e.showBtnPermission?i("div",{staticClass:"permission-tip"},[e._v(e._s(e.$t("permissionTip")))]):e._e(),i("div",{staticClass:"save-info"},[e.saveFail?i("span",{staticClass:"save-fail"},[e._v(e._s(e.$t("saveFail")))]):e._e(),!e.saveFail&&e.saveTime?i("span",[e._v(e._s(e.$t("saveInfo"))+e._s(e.saveTime))]):e._e()]),i("Collaborate"),i("ten-button",{staticClass:"btn-cancel",attrs:{size:"small"},on:{click:e.handleCancel}},[e._v(e._s(e.$t(e.previewVisible?"backEdit":"cancel")))]),i("ten-button",{staticClass:"btn-save",attrs:{size:"small",type:"primary",loading:e.btnLoading||e.submitting},on:{click:function(t){return e.handleSubmit(!1)}}},[e._v(" "+e._s(e.btnTxt)+" ")]),i("ten-popup",{attrs:{popupClass:"edit-more-popup",triggerType:"click",offset:{y:10}},scopedSlots:e._u([{key:"trigger",fn:function(){return[i("Icon",{staticClass:"icon-more",attrs:{icon:"pageMore"}})]},proxy:!0}])},[i("div",{staticClass:"popup"},[i("div",{staticClass:"popup-item",on:{click:e.toPreview}},[e._v(e._s(e.$t("preview")))]),i("div",{staticClass:"popup-item",on:{click:e.restore}},[e._v(e._s(e.$t(e.isCreate?"deleteDraft":"restoreDraft")))])])])],1),i("Confluence",{key:e.url,attrs:{url:e.url,injectedScript:[e.backByCancel,e.listenMacro,e.changeDOM],injectedStyleBeforeLoaded:e.changeStyle},on:{ready:e.ready,load:e.load,navigate:e.navigate}}),i("ten-modal",{attrs:{value:e.permissionVisible,destroy:"",wrapperClass:"modal-permission-iframe",width:"calc(100% - 232px)",title:e.$t("permissionSetting"),confirmText:e.$t("confirm"),cancelHidden:!0},on:{close:e.togglePermission}},[i("iframe",{staticClass:"permission-iframe",attrs:{src:e.permissionAdminUrl}})]),i("ten-modal",{attrs:{value:e.sensitiveVisible,type:"warning",width:"520",title:e.$t("sensitiveTitle"),"mask-closable":!1,confirmText:e.$t("confirm"),cancelHidden:!0},on:{close:function(){e.sensitiveVisible=!1,e.submitting=!1},confirm:function(t){return e.handleSubmit(!0)}}},[i("p",{staticClass:"p"},[e._v("根据"),i("a",{attrs:{href:"https://iwiki.woa.com/policy.woa.com/document/preview?documentId=806b79e6005141888699183344b4d136",target:"_blank"}},[e._v("《腾讯阳光行为准则》")]),e._v("，保护公司信息安全人人有责。")]),i("p",{staticClass:"p"},[e._v("当前文档可能存有敏感信息（包括但不限于密码、Token、票据、证书、数据库连接字符串），"),i("span",{staticClass:"red"},[e._v("请妥善设置文档权限")]),e._v("，以避免未经授权的人员访问文档。")]),i("p",{staticClass:"p"},[e._v("如已设置权限或确认不存在敏感信息，请忽略。")])]),i("ten-modal",{attrs:{value:e.crackVisible,type:"warning",width:"520",title:e.$t("crackTitle"),"mask-closable":!1,confirmText:e.$t("confirm"),cancelHidden:!0},on:{close:function(){e.crackVisible=!1,e.submitting=!1},confirm:function(t){return e.handleSubmit(!0)}}},[i("p",{staticClass:"p"},[e._v("当前文档可能存在未经授权的软件信息（包括但不限于破解版本下载地址、破解教程、或破解激活码等），根据"),i("a",{attrs:{href:"https://iwiki.woa.com/policy.woa.com/document/preview?documentId=806b79e6005141888699183344b4d136",target:"_blank"}},[e._v("《腾讯阳光行为准则》")]),e._v("，这属于违规行为，如工作上有需要使用软件，请"),i("a",{attrs:{href:"https://8000.woa.com/v3/Software",target:"_blank"}},[e._v("查看软件申请流程和软件采购流程")]),e._v("。")]),i("p",{staticClass:"p"},[e._v("如确认不存在相关信息，请忽略。")]),i("p",{staticClass:"p2"},[e._v("附《腾讯阳关行为准则》中关于严重违规行为的定义节选：")]),i("p",{staticClass:"p2"},[e._v("3.4.6.10 擅自泄露、使用第三方的商业秘密信息，或实施侵犯第三方知识产权的行为，给公司造成损失，或造成内外部舆论或其他不良影响，导致公司声誉、形象、价值观收到损害的行为")])]),i("ten-modal",{attrs:{value:e.sameNameVisible,width:"520",title:e.$t("sameNameTitle"),"mask-closable":!1,cancelText:e.$t("backEdit"),confirmText:e.$t(e.isCreate?"continueCreate":"continueSave")},on:{close:function(){e.sameNameVisible=!1,e.submitting=!1},confirm:function(t){return e.handleSubmit(!0)}}},[i("p",[e._v("空间内已有同名文档，为方便用户查看，建议使用其他标题后保存")])]),i("ten-modal",{attrs:{value:e.approvalVisible,width:"520",title:e.$t("approvalTitle"),"mask-closable":!1,confirmText:e.$t("quitEdit"),cancelHidden:!0},on:{close:e.handleCancel,confirm:e.handleCancel}},[i("p",{staticClass:"p"},[e._v(e._s(e.$t("approvalTip1")))]),i("i18n",{staticClass:"p",attrs:{path:"approvalTip2",tag:"p"},scopedSlots:e._u([{key:"a",fn:function(){return[i("a",{on:{click:e.toApproval}},[e._v(e._s(e.$t("approvalTip2-a")))])]},proxy:!0}])})],1),e.moveVisible?i("PageOperation",{attrs:{operation:e.moveOperation},on:{close:e.toggleMove}}):e._e()],1)},n=[],r=i("1da1"),s=i("5530"),o=(i("96cf"),i("caad"),i("159b"),i("b0c0"),i("a15b"),i("2532"),i("99af"),i("ac1f"),i("5319"),i("841c"),i("d3b7"),i("2f62")),c=i("72bf"),l=i.n(c),u=i("5a0c"),p=i.n(u),d=i("9f13"),m=i("0afd"),v=i("fc4a"),f=i("1757"),h=i("6243"),b=i("de4d"),g=i("a2c7"),y=i("48b8"),I=i("de80"),k=i("b7c7"),w=i("f977"),T=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ten-popup",{attrs:{"trigger-type":"hover",disabled:""},scopedSlots:e._u([{key:"trigger",fn:function(){return[i("ten-breadcrumb",{staticClass:"edit-crumb",attrs:{separator:"/"}},e._l(e.crumbList,(function(t){return i("ten-breadcrumb-item",{key:t.page_id,on:{click:function(i){return e.handleClick(t)}}},[e._v(" "+e._s(t.title)+" ")])})),1)]},proxy:!0}])},[i("div",{staticClass:"popup"},[i("ten-breadcrumb",{staticClass:"edit-crumb expaned",attrs:{separator:"/"}},e._l(e.fullList,(function(t){return i("ten-breadcrumb-item",{key:t.page_id,on:{click:function(i){return e.handleClick(t)}}},[e._v(" "+e._s(t.title)+" ")])})),1)],1)])},_=[],C=i("2909"),O=(i("fb6a"),i("d81d"),i("a434"),{props:["parentId"],data:function(){return{}},computed:Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(o["d"])("page",["pageInfo"])),Object(o["d"])("pageTree",["pageTree"])),Object(o["d"])("space",["spaceInfo"])),{},{pageId:function(){return this.parentId||this.pageInfo.pageId||this.$route.query.pageId},pagePath:function(){var e=this,t=!1,i=[],a=function a(n){n.some((function(n){return i.push(n),t=n.id===e.pageId,!t&&Array.isArray(n.children)&&a(n.children),t||i.pop(),t}))};return a(this.pageTree||[]),i.length>1&&this.hideLast?i.slice(0,-1):i},crumbList:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return e.length>t?"".concat(e.slice(0,t),"..."):e},t={type:"space",spaceKey:this.spaceInfo.spaceKey,title:this.spaceInfo.spaceName},i=[t].concat(Object(C["a"])(this.pagePath)),a=i.map((function(e){return e.title})).join("").length>30;if(!a||this.isExpanded)return i;if(1===i.length)return[Object(s["a"])(Object(s["a"])({},t),{},{title:e(t.title,30)})];var n=i[i.length-1],r=[Object(s["a"])(Object(s["a"])({},t),{},{title:e(t.title,14)}),Object(s["a"])(Object(s["a"])({},n),{},{title:e(n.title,14)})];return i.length>2&&r.splice(1,0,{type:"expand",title:"..."}),r},fullList:function(){var e={type:"space",spaceKey:this.spaceInfo.spaceKey,title:this.spaceInfo.spaceName};return[e].concat(Object(C["a"])(this.pagePath))}}),methods:{handleClick:function(e){if("expand"!==e.type){var t="space"===e.type?"/space/".concat(e.spaceKey):"/pages/viewpage.action?pageId=".concat(e.id);window.open(t)}}},mounted:function(){this.pageTree.length||I["a"].$emit(d["c"].INIT_SIDEBAR,!0)}}),S=O,j=(i("afbb"),i("2877")),$=Object(j["a"])(S,T,_,!1,null,"299cfded",null),x=$.exports,L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.list.length?i("div",{staticClass:"collaborate-list"},[e._l(e.list.slice(0,5),(function(e){return i("UserCard",{key:e.username,attrs:{userInfo:e}},[i("Avatar",{staticClass:"collaborate-item",attrs:{src:e.avatar,size:"24"}})],1)})),i("ten-popup",{attrs:{triggerType:"click",direction:"bottom right",disabled:e.list.length<=5,offset:{y:10}},scopedSlots:e._u([{key:"trigger",fn:function(){return[e.list.length>5?i("ten-icon",{attrs:{icon:"carret_down"}}):e._e()]},proxy:!0}],null,!1,2144097876)},[i("div",{staticClass:"popup"},e._l(e.list,(function(t){return i("UserCard",{key:t.username,attrs:{userInfo:t,direction:"left bottom"}},[i("div",{staticClass:"popup-item"},[i("Avatar",{attrs:{src:t.avatar,size:"24"}}),i("div",{staticClass:"popup-name"},[e._v(e._s(t.displayName))])],1)])})),1)])],2):e._e()},A=[],E=(i("4de4"),i("7db0"),i("fd5a")),P=i("4c28"),q=i("06a0"),F={components:{Avatar:E["a"],UserCard:P["a"]},data:function(){return{list:[],timer:null}},methods:{check:function(){var e=this,t=Object(h["d"])(),i=(null===t||void 0===t?void 0:t.querySelectorAll("#avatar-list li span"))||[];if(i.length){var a=Object(C["a"])(i).map((function(e){var t;return{username:e.getAttribute("data-username"),avatar:null===(t=e.querySelector("img"))||void 0===t?void 0:t.getAttribute("src")}})).filter((function(e){return e.username&&"null"!==e.username})),n=a.filter((function(t){return!e.list.find((function(e){return e.username===t.username}))}));n.length&&(clearInterval(this.timer),q["d"](n.map((function(e){return e.username}))).then((function(t){e.list=a.map((function(i){var a=e.list.find((function(e){return e.username===i.username}))||t.find((function(e){return e.username===i.username}));return a||Object(s["a"])(Object(s["a"])({},i),{},{displayName:i.username})}))})).finally((function(){e.timer=setInterval(e.check,500)})))}}},mounted:function(){this.timer=setInterval(this.check,500),this.$once("hook:beforeDestroy",(function(){clearInterval(this.timer)}))}},D=F,N=(i("73cf"),Object(j["a"])(D,L,A,!1,null,"e7d2b34e",null)),M=N.exports,V=function(){var e=document.querySelector("#rte-button-cancel");if(e){var t=e.parentNode;e.setAttribute("type","button"),e.setAttribute("id","");var i=e.outerHTML;e.outerHTML=i,t.addEventListener("click",(function(){try{window.parent.postMessage({action:"back"},"*")}catch(e){}}))}},K=function(){var e=function(e){for(var t=0;t<e.length;t++){var i,a,n=e[t].classList;if(n&&(n.contains("cherry-iframe-editor")||n.contains("md-iframe-editor")||n.contains("md-iframe-loading")||n.contains("iwiki-editor-edit-root")))return!0;var r=null===(i=(a=e[t]).getAttribute)||void 0===i?void 0:i.call(a,"id");if(["tencent-docs-newOnline","iwiki-mindmap-iframe","drawioEditor"].includes(r))return!0}return!1},t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(t){var i=new t((function(t){t.forEach((function(t){try{if("childList"===t.type){var i=!!t.addedNodes.length&&e(t.addedNodes),a=!!t.removedNodes.length&&e(t.removedNodes);if(i||a)return void window.parent.postMessage({action:"toggleFullScreen",payload:i},"*")}if("attributes"===t.type){var n=document.body,r=n.style.overflow,s=n.classList,o="hidden"===r||s.contains("no-scroll");window.parent.postMessage({action:"toggleFullScreen",payload:o},"*")}}catch(c){console.error(c)}}))}));i.observe(document.body,{childList:!0,attributes:!0})}},B=function(){},R=["#inviteToEditLink {display: none!important}","#avatar-list {display: none!important}","#breadcrumbs {display: none!important}","#breadcrumbs + .aui-toolbar2 {display: none!important}","#content-title-div {margin-top: 20px !important}","#savebar-container {height: 0!important; overflow: hidden!important}","#rte-savebar {height: 0!important; overflow: hidden!important}","#rte-toolbar {background: #F7F8F9 !important}","#confluence-roadmap-dialog {width: 100vw!important; height: 100vh!important; top: 0!important}","#confluence-roadmap-dialog .aui-dialog2-content {min-height: calc(100vh - 114px)!important}"],H={components:{Confluence:v["a"],Icon:m["a"],Crumbs:x,Collaborate:M,PageOperation:f["a"]},metaInfo:function(){return{title:this.title}},data:function(){var e=["createPage","createBlog"].includes(this.$route.name);return{backByCancel:V,listenMacro:K,changeDOM:B,changeStyle:R.join(""),title:e?this.$t(this.$route.name):this.$t("editPage"),intervalTimer:null,timer:null,checkTimer:null,checkPermissionTimer:null,url:"",permissionVisible:!1,isFull:!1,permissionIcon:"permission",contentId:"",parentId:"",saving:!1,saveTime:"",saveFail:!1,sensitiveVisible:!1,crackVisible:!1,previewVisible:!1,observerTimer:null,moveVisible:!1,isBlog:!1,lastTitle:"",sameNameVisible:!1,submitting:!1,isRestore:!1,isApproval:!1,approvalId:"",approvalVisible:!1,btnLoading:!0,draftId:""}},computed:Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(o["d"])("space",["spaceInfo"])),Object(o["d"])("pageTree",["pageTree"])),Object(o["c"])("space",["isGraySpace"])),{},{isEdit:function(){return"editPage"===this.$route.name},isCreate:function(){return["createPage","createBlog"].includes(this.$route.name)},pageId:function(){return this.$route.query.pageId||this.contentId},permissionAdminUrl:function(){return"/pageadmin/".concat(this.pageId,"/permission?fromEdit=1")},isSpaceHome:function(){return this.spaceInfo.homePageId===this.pageId},showBtnPermission:function(){return!(this.isGraySpace&&this.isCreate||this.isSpaceHome)},moveOperation:function(){return{id:this.pageId,type:"move",show:this.moveVisible,spaceKey:this.spaceInfo.spaceKey,isBlog:this.isBlog,history:!0}},btnTxt:function(){return this.btnLoading?"":this.isApproval?this.$t("approval"):this.$t(this.isCreate?"publish":"save")}}),methods:Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(o["b"])("space",["getSpaceInfo","updateSpaceInfo"])),Object(o["b"])("pageTree",["setPageTreeType","getPageTreeByPage"])),{},{init:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i,a,n,r,s,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=Object(h["d"])(),n=null===a||void 0===a||null===(i=a.querySelector('meta[name="ajs-space-key"]'))||void 0===i?void 0:i.content,n||!e.pageId){t.next=7;break}return t.next=5,b["e"](e.pageId).catch((function(){return{spaceKey:""}}));case 5:r=t.sent,n=r.spaceKey;case 7:if(!n){t.next=17;break}return t.next=10,e.getSpaceInfo({spaceKey:n}).catch((function(e){return e}));case 10:if(s=t.sent,s.spaceKey){t.next=16;break}return t.next=14,g["i"](n).catch((function(){return{}}));case 14:o=t.sent,e.updateSpaceInfo(o);case 16:e.pageTree.length||(e.setPageTreeType(e.isBlog?"blogpost":"page"),e.getPageTreeByPage({pageId:e.isCreate?e.parentId:e.pageId,spaceKey:n}).catch((function(){})));case 17:if(e.isCreate){t.next=43;break}if(!e.isGraySpace){t.next=34;break}return t.prev=19,t.next=22,b["f"](e.pageId);case 22:if(c=t.sent,c.includes("edit")){t.next=26;break}return I["a"].$emit(d["c"].LOAD_FAIL,{statusCode:d["a"].NOT_PERMISSION}),t.abrupt("return");case 26:t.next=32;break;case 28:return t.prev=28,t.t0=t["catch"](19),"invalid content id"===t.t0.message&&I["a"].$emit(d["c"].LOAD_FAIL,{statusCode:d["a"].NOT_FOUND}),t.abrupt("return");case 32:t.next=43;break;case 34:return t.next=36,b["e"](e.pageId).catch((function(){return{}}));case 36:if(l=t.sent,!l.isDelete){t.next=40;break}return I["a"].$emit(d["c"].LOAD_FAIL,{statusCode:d["a"].NOT_FOUND}),t.abrupt("return");case 40:if(l.canEdit){t.next=43;break}return I["a"].$emit(d["c"].LOAD_FAIL,{statusCode:d["a"].NOT_PERMISSION}),t.abrupt("return");case 43:e.isCreate&&e.pageId&&window.history.replaceState(null,null,"/pages/resumedraft.action?draftId=".concat(e.pageId)),e.getPermissionIcon(),e.getApproval(),e.observerTimer=setInterval((function(){var t=Object(h["d"])(),i=t.querySelector("#pluggable-status");i&&(clearInterval(e.observerTimer),e.observerTimer=null,e.observeSave())}),200),e.$once("hook:beforeDestroy",(function(){this.observerTimer&&clearInterval(this.observerTimer)}));case 48:case"end":return t.stop()}}),t,null,[[19,28]])})))()},ready:function(){var e,t,i,a,n=this,r=Object(h["d"])();if(this.contentId=null===r||void 0===r||null===(e=r.querySelector('meta[name="ajs-content-id"]'))||void 0===e?void 0:e.content,this.parentId=null===r||void 0===r||null===(t=r.querySelector('meta[name="ajs-parent-page-id"]'))||void 0===t?void 0:t.content,this.draftId=null===r||void 0===r||null===(i=r.querySelector('meta[name="ajs-draft-id"]'))||void 0===i?void 0:i.content,this.isBlog="blogpost"===(null===r||void 0===r||null===(a=r.querySelector('meta[name="ajs-content-type"]'))||void 0===a?void 0:a.content),this.isEdit){var s,o=null===r||void 0===r||null===(s=r.querySelector('meta[name="ajs-page-title"]'))||void 0===s?void 0:s.content;o&&(this.lastTitle=o,this.title="".concat(this.$t("editPage")," - ").concat(Object(y["c"])(o,this.pageId))),this.intervalTimer=setInterval((function(){var e,t,i,a=r.querySelector("#wysiwygTextarea_ifr");null!==a&&void 0!==a&&null!==(e=a.contentDocument)&&void 0!==e&&null!==(t=e.body)&&void 0!==t&&null!==(i=t.childNodes)&&void 0!==i&&i.length&&(n.timer=setTimeout((function(){var e,t;(null===(e=window[d["d"].PAGE_SCROLL])||void 0===e?void 0:e.pageId)===n.pageId&&(a.contentDocument.documentElement.scrollTop=(null===(t=window[d["d"].PAGE_SCROLL])||void 0===t?void 0:t.scrollTop)||0,window[d["d"].PAGE_SCROLL]={},n.timer=null);for(var i=a.contentDocument.querySelectorAll(".wrapped.fixed-table.confluenceTable"),r=0;r<i.length;r++){var s=i[r],o=s.querySelector("colgroup"),c=o&&o.querySelector("col"),l=!!c&&/px/.test(c.style&&c.style.width),u=s.querySelector("tbody");if(o&&o.parentNode===s&&l&&u&&u.parentNode===s)for(var p=0;p<u.children.length;p++)for(var m=u.children[p],v=0;v<m.children.length;v++){var f=m.children[v];f.style.width=/%/.test(f.style.width)?"":f.style.width}}a.contentDocument.addEventListener("click",(function(e){try{window.document.querySelector(".edit-more-popup")&&window.document.body.click()}catch(e){}})),n.timer=null}),750),clearInterval(n.intervalTimer),n.intervalTimer=null)}),100),this.titleTimer=setInterval((function(){var e=r.querySelector("#content-title");e&&(e.value=Object(y["c"])(e.value,n.pageId),clearInterval(n.titleTimer),n.titleTimer=null)}),100),this.$once("hook:beforeDestroy",(function(){this.intervalTimer&&clearInterval(this.intervalTimer),this.titleTimer&&clearInterval(this.titleTimer),this.timer&&clearTimeout(this.timer)}))}this.init()},navigate:function(e){var t=l.a.parseUrl(e.url),i=l.a.parseUrl(e.prevUrl);if("copy"!==i.query.fromAction||"/pages/viewpage.action"!==t.url)if("/dashboard.action#recently-worked"!==e.url)"/pages/viewpage.action"===t.url&&t.query.pageId===this.pageId&&this.isRestore&&(location.href="/pages/editpage.action?pageId=".concat(this.pageId));else{var a=this.$refs.crumbs.fullList;if(a.length<=2)this.$router.replace({name:"space",params:{spaceKey:this.spaceInfo.spaceKey}});else{var n=this.isCreate?a[a.length-1]:a[a.length-2];"space"===n.type?this.$router.replace({name:"space",params:{spaceKey:n.spaceKey}}):this.$router.replace({name:"page",query:{pageId:n.id}})}}else this.$once("hook:beforeDestroy",(function(){setTimeout((function(){location.reload()}),0)}))},load:function(){var e=Object(h["e"])(),t=null===e||void 0===e?void 0:e.location,i=t?"".concat(t.pathname).concat(t.search).concat(t.hash):"",a=l.a.parseUrl(i);"copy"!==this.$route.query.fromAction||this.url||a.query[d["h"].IFRAME_EMBED_PARAM]||(this.url=i)},togglePermission:function(){this.isGraySpace?(this.permissionVisible=!this.permissionVisible,this.permissionVisible||this.getPermissionIcon()):Object(h["g"])("#my-permissions-button")},toggleMove:function(){this.moveVisible=!this.moveVisible},toggleFullScreen:function(e){this.isFull=e,this.isRestore=!1},checkPermissionIcon:function(){var e=Object(h["d"])(),t=e.querySelector("#rte-button-restrictions .aui-icon");if(t){var i=t.classList.contains("aui-iconfont-locked"),a=t.classList.contains("icon-red"),n=t.classList.contains("aui-iconfont-unlocked");this.permissionIcon=i&&a?"permissionBlockClose":n?"permissionBlock":"permission"}},getPermissionIcon:function(){var e=this;this.isGraySpace?b["h"](this.pageId).then((function(t){var i={inherit:"permissionInherit",extend:"permissionExtend",isolate:"permissionIsolate"};e.permissionIcon=i[t.mode]||i.inherit})):(this.checkPermissionTimer=setInterval(this.checkPermissionIcon,500),this.$once("hook:beforeDestroy",(function(){clearInterval(this.checkPermissionTimer)})))},observeSave:function(){var e=this;if("function"===typeof MutationObserver){var t=Object(h["d"])(),i=t.querySelector("#pluggable-status"),a=new MutationObserver((function(i){i.forEach((function(i){var a,n,r,s,o,c;if("childList"===i.type){var l=t.querySelector("#pluggable-status .status-indicator-message"),u=["Ready to go","Connectting...","即将开始~","连接中..."];if(!l||!u.includes(l.textContent)){var d=i.addedNodes[0].childNodes[0];null!==d&&void 0!==d&&null!==(a=d.classList)&&void 0!==a&&null!==(n=a.contains)&&void 0!==n&&n.call(a,"aui-iconfont-approve")&&(e.saving=!1,e.saveFail=!1,e.saveTime=p()().format("HH:mm:ss")),null!==d&&void 0!==d&&null!==(r=d.classList)&&void 0!==r&&null!==(s=r.contains)&&void 0!==s&&s.call(r,"aui-iconfont-warning")&&(e.saving=!1,e.saveFail=!0),null!==d&&void 0!==d&&null!==(o=d.classList)&&void 0!==o&&null!==(c=o.contains)&&void 0!==c&&c.call(o,"aui-iconfont-devtools-task-in-progress")&&(e.saveFail=!1,e.saving=!0)}}}))}));a.observe(i,{childList:!0})}else console.error("不支持 MutationObserver")},handleCancel:function(){if(this.previewVisible)return this.previewVisible=!1,void Object(h["g"])("#rte-button-edit");if(!this.saving&&!this.saveFail||window.confirm("当前页面有未保存内容，是否确定离开？"))if(Object(y["a"])(this.$router,this.$route))this.$router.back();else{var e=this.$refs.crumbs.fullList;if(e.length<=2)this.$router.push({name:"space",params:{spaceKey:this.spaceInfo.spaceKey}});else{var t=this.isCreate?e[e.length-2]:e[e.length-1];"space"===t.type?this.$router.push({name:"space",params:{spaceKey:t.spaceKey}}):this.$router.push({name:"page",query:{pageId:t.id}})}}},handleSubmit:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,n,r,s,o,c,l,u,p,d,m,v,f,b,g,I,T,_,C;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!t.submitting||e){i.next=2;break}return i.abrupt("return");case 2:if(t.submitting=!0,n=Object(h["d"])(),r=n.querySelector("#wysiwygTextarea_ifr"),s=null===r||void 0===r||null===(a=r.contentDocument)||void 0===a?void 0:a.body,o=(null===s||void 0===s?void 0:s.textContent)||"",c=(new Date).getTime()-864e6,l=["password","passwd","admin","cookies","access_Key","accessKey","secret_Key","secretKey","PRIVATE KEY"],u=(k["a"].getItem("edit-sensitive-".concat(t.pageId))||0)>=c,e||u||!l.some((function(e){return o.includes(e)}))){i.next=14;break}return k["a"].setItem("edit-sensitive-".concat(t.pageId),(new Date).getTime()),t.sensitiveVisible=!0,i.abrupt("return");case 14:if(p=["注册机","keygen","激活器","0day","激活码","crack","免激活","特别版","激活版","注册码"],d=(k["a"].getItem("edit-crack-".concat(t.pageId))||0)>=c,e||d||!p.some((function(e){return o.includes(e)}))){i.next=20;break}return t.crackVisible=!0,k["a"].setItem("edit-crack-".concat(t.pageId),(new Date).getTime()),i.abrupt("return");case 20:if(m=/[\u200B-\u200D\uFEFF]/g,m.test(o)&&(s.innerHTML=s.innerHTML.replace(m,"")),e||Object(y["c"])(t.lastTitle,t.pageId)!==t.lastTitle){i.next=31;break}return v=n.querySelector("#content-title").value,f={spaceKey:t.spaceInfo.spaceKey,title:v},i.next=27,Object(w["a"])({url:"/rest/new-api/contents/judgmentName/".concat(t.pageId),data:f}).catch((function(){return!1}));case 27:if(b=i.sent,!b){i.next=31;break}return t.sameNameVisible=!0,i.abrupt("return");case 31:if(g=n.createElement("temp"),g.innerHTML=s.innerHTML,I=g.getElementsByClassName("mce-visual-caret"),T=g.getElementsByClassName("synchrony-container"),I.forEach((function(e){g.removeChild(e)})),T.forEach((function(e){g.removeChild(e)})),!t.isApproval){i.next=48;break}return _={draftId:t.draftId,pageId:t.pageId,type:t.isBlog?"blogpost":"page",title:n.querySelector("#content-title").value,spaceKey:t.spaceInfo.spaceKey,content:g.innerHTML},Object(w["a"])({url:"/rest/tinymce/1/drafts",method:"post",data:_}).catch((function(){})),C=new FormData,C.append("contentid",t.pageId),C.append("action",t.isCreate?"publish":"update"),C.append("title",n.querySelector("#content-title").value),C.append("body",g.innerHTML),i.next=47,Object(w["a"])({url:"/tencent/api/approval/content",method:"post",data:C}).then((function(e){t.$message.success(t.$t(t.isCreate?"publishApprovalSuccess":"updateApprovalSuccess")),t.$router.push("/tencent/app/approval/flow/".concat(e.id))})).catch((function(e){e.result.id?(t.approvalId=e.result.id,t.approvalVisible=!0):(t.$message.error(t.$t("approvalFail")),t.submitting=!1)}));case 47:return i.abrupt("return");case 48:Object(h["g"])("#rte-button-publish");case 49:case"end":return i.stop()}}),i)})))()},toPreview:function(){this.previewVisible=!0,Object(h["g"])("#rte-button-preview")},restore:function(){var e=this;this.isCreate||setTimeout((function(){var t=Object(h["d"])();e.isRestore=!!t.querySelector("#quit-editor-dialog")}),500),Object(h["g"])("#rte-show-revert")},getApproval:function(){var e=this;Object(w["a"])({url:"/tencent/api/approval/content/check?contentid=".concat(this.pageId)}).then((function(t){e.isApproval=t,e.isApproval&&Object(w["a"])({url:"/tencent/api/approval/content/ticket?contentid=".concat(e.pageId)}).then((function(t){t.exist&&(e.approvalId=t.id,e.approvalVisible=!0)}))})).finally((function(){e.btnLoading=!1}))},toApproval:function(){this.$router.push("/tencent/app/approval/flow/".concat(this.approvalId))}}),mounted:function(){I["a"].$on(d["c"].TOGGLE_FULL_SCREEN,this.toggleFullScreen),this.$once("hook:beforeDestroy",(function(){I["a"].$off(d["c"].TOGGLE_FULL_SCREEN,this.toggleFullScreen)})),document.body.style.overscrollBehaviorX="none",this.$once("hook:beforeDestroy",(function(){document.body.style.overscrollBehaviorX="initial"}))}},U=H,G=(i("5a08"),i("b845"),i("1ced")),z=Object(j["a"])(U,a,n,!1,null,"78a985e4",null);"function"===typeof G["default"]&&Object(G["default"])(z);t["default"]=z.exports},ec70:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"createPage":"Add page","createBlog":"Add blog","editPage":"Edit","permissionTip":"Before publishing the content, please confirm that the permissions have been properly set","permissionSetting":"Permission Setting","saveInfo":"Auto-save ","saveFail":"Failed to save (please do not refresh the page to avoid content loss)","publish":"Publish","save":"Save","preview":"Preview","deleteDraft":"Delete unpublished version","restoreDraft":"Revert to the latest version released","backEdit":"Back to Edit","sensitiveTitle":"Sensitive information prompt","crackTitle":"Infringement reminder","sameNameTitle":"Document name prompt","continueCreate":"Create","continueSave":"Update","approval":"Submit for approval","publishApprovalSuccess":"Publish request submitted successfully","updateApprovalSuccess":"Update request submitted successfully","approvalFail":"Submission failed, please try again","approvalTitle":"Approval submission reminder","approvalTip1":"The content is under approval and does not need to be submitted repeatedly.","approvalTip2":"You can check the {a} and understand the approval progress.","approvalTip2-a":"approval details","quitEdit":"Exit editing","confirm":"Confirm","move":"Move","permissions":"Permissions"},"zh":{"createPage":"新增文档","createBlog":"新增博文","editPage":"编辑","permissionTip":"内容发布前，请确认已合理设置权限","permissionSetting":"权限设置","saveInfo":"保存于 ","saveFail":"保存失败(请勿刷新页面，以免内容丢失)","publish":"发 布","save":"更 新","cancel":"取 消","preview":"预览","deleteDraft":"删除未发布草稿","restoreDraft":"恢复到已发布最新版","backEdit":"返回编辑","sensitiveTitle":"敏感信息提示","crackTitle":"侵权行为提示","sameNameTitle":"文档重名提示","continueCreate":"继续发布","continueSave":"继续更新","approval":"提交审批","publishApprovalSuccess":"发布申请提交成功","updateApprovalSuccess":"更新申请提交成功","approvalFail":"提交失败，请重试","approvalTitle":"审批提交提醒","approvalTip1":"该内容正在审批中，无需重复提交。","approvalTip2":"您可查看{a}，了解审批进度。","approvalTip2-a":"审批详情","quitEdit":"退出编辑","confirm":"确定","move":"移动文档","permissions":"权限设置"}}'),delete e.options._Ctor}},fce4:function(e,t,i){}}]);