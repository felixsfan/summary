(function(t){function e(e){for(var o,s,r=e[0],c=e[1],l=e[2],u=0,h=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&h.push(n[s][0]),n[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);d&&d(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],o=!0,r=1;r<i.length;r++){var c=i[r];0!==n[c]&&(o=!1)}o&&(a.splice(e--,1),t=s(s.s=i[0]))}return t}var o={},n={index:0},a=[];function s(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=o,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var d=c;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("1112")},"0013":function(t,e,i){"use strict";i("f22a")},"012b":function(t,e,i){"use strict";i("7008")},"031b":function(t,e,i){"use strict";i("1571")},"0878":function(t,e,i){"use strict";i("b0ce")},"0ef2":function(t,e,i){},"0f64":function(t,e,i){},"0fc8":function(t,e,i){},1112:function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var o=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},a=[],s={name:"App",data:function(){return{}},mounted:function(){window.contextMenu=this.$contextmenu}},r=s,c=(i("fffb"),i("2877")),l=Object(c["a"])(r,n,a,!1,null,null,null),d=l.exports,u=i("8c4f"),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"100%"}},["seq"===t.showType?i("SeqDiagram",{attrs:{showType:t.showType,renderData:t.renderData,subType:t.subType}}):t._e(),"class"===t.showType?i("ClassDiagram",{attrs:{showType:t.showType,renderData:t.renderData}}):t._e(),"state"===t.showType?i("StateDiagram",{attrs:{showType:t.showType,renderData:t.renderData}}):t._e(),"uc"===t.showType?i("UcDiagram",{attrs:{showType:t.showType,renderData:t.renderData,subType:t.subType}}):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"choose"===t.showType,expression:"showType === 'choose'"}],staticClass:"choose_layer"}),i("div",{directives:[{name:"show",rawName:"v-show",value:"choose"===t.showType,expression:"showType === 'choose'"}],staticClass:"choose"},[i("div",{staticClass:"choose-title"},[i("i",{staticClass:"wechart-pay-logo"},[i("svg",{attrs:{version:"1.1",id:"图形",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 3963.855 1000.678","enable-background":"new 0 0 3963.855 1000.678","xml:space":"preserve"}},[i("g",[i("g",{attrs:{transform:"scale(0.1953125, 0.1953125)"}},[i("path",{attrs:{fill:"#1AAD19",d:"M1866.339,3161.012c-23.2,11.705-49.19,18.375-76.875,18.375c-64.025,0-119.71-35.195-148.985-87.435\n\t\t\tl-11.19-24.415l-466.469-1023.59c-5.08-11.215-8.125-23.687-8.125-35.965c0-47.157,38.24-85.417,85.4-85.417\n\t\t\tc19.14,0,36.825,6.335,51.13,16.978l550.384,391.887c40.185,26.315,88.295,41.73,139.935,41.73c30.8,0,60.165-5.7,87.585-15.765\n\t\t\tl2588.553-1152.082c-464.054-546.789-1228.207-904.213-2092.875-904.213c-1415.082,0-2562.199,955.918-2562.199,2135.135\n\t\t\tc0,643.363,345.169,1222.422,885.293,1613.826c43.36,30.915,71.755,81.87,71.755,139.094c0,19.03-4.085,36.47-9.03,54.535\n\t\t\tc-43.14,160.899-112.225,418.734-115.45,430.833c-5.32,20-13.75,41.195-13.75,62.22c0,47.375,38.24,85.615,85.44,85.615\n\t\t\tc18.545,0,33.605-6.93,49.255-15.855l560.834-324.02c42.215-24.37,86.905-39.475,136.07-39.475c26.14,0,51.44,4.02,75.285,11.305\n\t\t\tc261.694,75.335,544.004,117.145,836.368,117.145c1414.966,0,2562.134-955.983,2562.134-2135.225\n\t\t\tc0-357.114-105.87-693.518-291.829-989.388L1884.869,3150.162L1866.339,3161.012z"}})])]),i("g",[i("g",{attrs:{transform:"scale(0.1953125, 0.1953125)"}},[i("path",{attrs:{fill:"#231815",d:"M11296.176,1819.326h1921.854v172.3h-1921.854V1819.326z M11296.176,2357.659h1921.854v185.765h-1921.854\n\t\t\tV2357.659z M13169.48,3949.78V2909.488h-1824.565V3949.78H13169.48z M11530.779,3081.757h1452.807v695.598h-1452.807V3081.757z\n\t\t\t M10768.597,4057.88V1664.446c109.04-234.839,205.3-487.924,284.27-744.143l-171.875-99.307\n\t\t\tc-169.669,597.701-418.384,1141.09-730.498,1595.924l102.555,176.159c108.11-159.935,222.255-347.994,329.754-545.286V4057.79\n\t\t\th185.795V4057.88L10768.597,4057.88z M17751.834,4057.88V1664.446c108.994-234.839,205.375-487.924,284.385-744.143\n\t\t\tl-172.006-99.307c-169.604,597.701-418.318,1141.09-730.457,1595.924l102.66,176.159\n\t\t\tc107.984-159.935,222.373-347.994,329.764-545.286V4057.79h185.629v0.09H17751.834z M13419.96,1267.397h-1129.188l119.93-68.842\n\t\t\tl4.13-2.427l-1.97-4.44c-13.91-32.095-49.739-107.495-87.81-187.355c-35.47-74.42-72.12-151.3-89.76-190.69l-2.37-5.52\n\t\t\tl-171.209,98.842l2.579,4.617c61.221,115.337,113.92,221.047,161.09,323.224c6.71,13.865,10.93,24.86,12.271,32.5H11107.69v185.9\n\t\t\th2312.27V1267.397L13419.96,1267.397z M8460.393,1126.402h-172.33v605.719h-325.583V870.673h-172.405v861.448h-339.039v-605.719\n\t\t\tH7278.67v778.033h1181.782v-778.033H8460.393z M7332.521,2243.405h1047.162v172.41H7332.521V2243.405z M7558.76,3083.347v-156\n\t\t\th527.514v384.594c-6.535,134.055-13.2,175.125-59.26,239.194l-2.05,2.92l105.799,183.375l4.92-3.84\n\t\t\tc92.729-74.54,251.1-210.179,470.488-403.319l3.261-2.96l-83.146-144.085l-3.354-5.61l-264.335,226.75v-649.318h-885.732v261.519\n\t\t\tc25.01,358.219-64.295,614.448-265.739,761.318l-3.91,2.845l95.91,166.28l3.265,5.535l4.905-3.95\n\t\t\tC7458.39,3741.806,7576.645,3450.592,7558.76,3083.347z M6427.238,1685.071l104.13,180.245\n\t\t\tc267.374-267.872,495.878-589.486,665.418-937.218l-160.884-92.857C6869.832,1174.27,6661.347,1465.482,6427.238,1685.071z\n\t\t\t M6380.178,2767.893l95.54,165.544l3.81,6.67l5-5.85c101.78-118.935,201.35-244.169,296.169-372.684V4057.79h172.395V2277.179\n\t\t\tc77.865-138.602,153.26-293.592,224.024-460.634l1.765-4.48l-166.76-95.91l-2.295,5.853\n\t\t\tc-159.379,398.534-370.469,749.401-627.193,1042.885L6380.178,2767.893z M9724.869,1634.996v-172.407h-765.138l0.045-0.087\n\t\t\tc66.319-199.965,142.38-432.799,168.01-632.298l-179.955-0.29c-111.829,524.381-282.674,979.587-502.573,1338.779l108.8,188.482\n\t\t\tl79.8-159.625c30.024-52.725,54.42-97.012,72.739-132.405c53.896,464.594,147.905,838.598,279.8,1111.942\n\t\t\tc-126.485,218.794-321.239,446.094-578.844,675.593l-3.271,2.98l99.29,172.04l3.38,5.915l5.08-4.55\n\t\t\tc272.614-255.644,461.514-479.384,561.354-665.503c113.765,202.764,306.43,448.119,530.014,675.193l4.985,4.995l102.005-176.604\n\t\t\tl2.25-3.775l-3.186-2.765c-239.895-229.28-430.144-466.904-535.943-669.823c195.479-357.004,317.374-880.503,362.324-1555.964\n\t\t\th188.77v0.177H9724.869L9724.869,1634.996z M9087.166,2975.078c-113.444-292.824-197.689-690.808-250.544-1183.412\n\t\t\tc17.215-51.665,39.119-104.342,65.079-156.67h461.949C9327.966,2196.932,9235.086,2647.589,9087.166,2975.078z\n\t\t\t M16914.137,1452.499V1268.81h-1468.812V802.691h-188.085v466.119h-1455.566v183.687h1455.566v612.253h-29.915h-913.978\n\t\t\tl0.23,167.969c0,0,144.829,327.064,437.919,681.413c117.719,142.28,257.249,291.124,435.648,437.154\n\t\t\tc-331.399,203.94-745.144,397.339-1319.457,508.944l108.58,187.865c0,0,681.309-145.295,1358.467-583.854\n\t\t\tc91.539,58.085,509.698,392.414,1292.476,578.908c0.842,0.2,1.455,0.375,2.057,0.6l3.154,0.57l76.279-144.855\n\t\t\tc0,0-201.969-53.12-508.128-171.035c-212.655-82.045-479.179-205.884-733.858-378.514\n\t\t\tc379.509-280.239,717.979-680.493,921.697-1196.922l-152.6-88.312h-788.697h-1.811v-612.184H16914.137L16914.137,1452.499z\n\t\t\t M16169.293,2225.962c0,0-189.079,542.021-837.938,1004.82c-308.935-235.219-627.619-580.698-831.729-1004.82H16169.293\n\t\t\tL16169.293,2225.962z M19273.635,3819.391c-38.084,0-73.32-0.22-107.59-0.535v185.815c73.721,0,127.221-0.58,162.279-0.58\n\t\t\tc182.346,0,281.83-38.985,359.68-116.92c75.721-75.73,112-191.33,107.43-343.669V1816.918h499.408v-185.41h-499.408V835.193\n\t\t\th-186.299v796.318h-1533.018v185.41h1533.018v1727.021C19609.135,3731.471,19492.809,3819.391,19273.635,3819.391z\n\t\t\t M18857.836,3204.642l184.549-107.61c-98.703-201.17-230.889-468.014-394.578-795.763l-168.26,98.205\n\t\t\tC18592.701,2620.809,18719.342,2890.363,18857.836,3204.642z"}})])])])]),i("span",{staticClass:"detail-title"},[t._v("瓦特建模工具集")]),i("i",{staticClass:"el-icon-close",on:{click:t.onCancel}})]),i("el-row",{attrs:{gutter:25}},t._l(t.diagrams,(function(e){return i("el-col",{key:e.name,attrs:{offset:0,span:6}},[i("el-card",{staticClass:"el-card",attrs:{"body-style":{padding:"0px"}}},[i("img",{staticClass:"image",attrs:{src:e.thumbnail},on:{click:function(i){return t.showOptions(e.options)}}}),i("div",{staticClass:"bottom-group"},[i("span",{staticClass:"bottom-title"},[t._v(t._s(e.name))]),"seq"===e.type?i("div",{staticClass:"bottom clearfix"},[i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type,0)}}},[t._v("业务")]),i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type,1)}}},[t._v("分析")]),i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type,2)}}},[t._v("设计")])],1):"uc"===e.type?i("div",{staticClass:"bottom clearfix"},[i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type,3)}}},[t._v("系统用例")]),i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type,4)}}},[t._v("业务用例")])],1):"state"===e.type?i("div",{staticClass:"bottom clearfix"},[i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type)}}},[t._v("状态图")])],1):i("div",{staticClass:"bottom clearfix"},[i("el-button",{staticClass:"button",attrs:{icon:"el-icon-circle-plus-outline",type:"text"},nativeOn:{click:function(i){return t.create(e.type)}}},[t._v("类图")])],1)])])],1)})),1)],1)],1)},f=[],g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"seq_container"},[i("Toolbar",{ref:"toolbar",attrs:{diagramName:t.diagramName}}),i("div",{staticClass:"seq-main"},[i("div",{staticClass:"seq-main-graph"},[i("div",{staticClass:"top-title-bar"},[i("ul",t._l(t.state.topTitleList,(function(e){return i("li",{key:e.id,style:"left:"+(e.x-t.state.diagScrollLeft)+"px"},[t._v("\n            "+t._s(e.text)+"\n          ")])})),0),i("div",{staticClass:"save-msg"},[t._v(t._s(t.saveMsg))])]),i("div",{ref:"svingRoot",staticClass:"sving-root",style:"height:"+t.contentHeight+"px",on:{scroll:t.onScroll}})]),i("PropsPanel",{staticClass:"seq-main-props-panel"})],1),i("el-dialog",{attrs:{title:t.guide.title,visible:t.guide.dialogVisible,width:t.guide.width},on:{"update:visible":function(e){return t.$set(t.guide,"dialogVisible",e)}}},[i("img",{attrs:{src:t.guide.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.guide.dialogVisible=!1}}},[t._v("学会了")])],1)])],1)},p=[],m=(i("8e6e"),i("456d"),i("bd86")),y=(i("c5f6"),i("7514"),i("6762"),i("2fdb"),i("ac6a"),i("5c96")),v=i.n(y),w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-toolbar"},[i("el-tooltip",{attrs:{content:"撤销 Ctrl/⌘+Z",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isUndoDisabled},on:{click:t.undo}},[i("svg",{staticClass:"toolbar_undo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M8 8.25h6c2.761 0 5 1.989 5 4.75a5 5 0 01-5 5H7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M9 5.372V10.9a.2.2 0 01-.301.173L4.276 8.474a.2.2 0 01-.009-.339l4.423-2.93a.2.2 0 01.31.167z",fill:"currentColor"}})])])])]),i("el-tooltip",{attrs:{content:"重做 Ctrl/⌘+Y",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isRedoDisabled},on:{click:t.redo}},[i("svg",{staticClass:"toolbar_redo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M16 8.25h-6c-2.761 0-5 1.989-5 4.75a5 5 0 005 5h7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M15 5.372V10.9a.2.2 0 00.301.173l4.423-2.599a.2.2 0 00.009-.339l-4.423-2.93a.2.2 0 00-.31.167z",fill:"currentColor"}})])])])]),i("div",{staticClass:"diagram-toolbar-split"}),1===t.state.currentSeqType||2===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Actor",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Actor")},mousedown:function(e){return t.dragStart(e,"Actor")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(14,0,0,14,500,200)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"7.5",ry:"7.5",stroke:"black","stroke-width":"3.5"}}),i("path",{attrs:{d:"M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343",stroke:"black","stroke-width":"3.5",transform:"matrix(1,0,0,1,-873,-1290)"}})])])])]):t._e(),2===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Object",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Object")},mousedown:function(e){return t.dragStart(e,"Object")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(9,0,0,9,330,200)"}},[i("rect",{attrs:{fill:"rgb(250, 236, 216)",height:"60",rx:"10",ry:"10",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,-23,8)",width:"90"}})])])])]):t._e(),1===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Boundary",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Boundary Object")},mousedown:function(e){return t.dragStart(e,"Boundary Object")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,560,530)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"35",ry:"35",stroke:"black","stroke-width":"4"}}),i("path",{attrs:{d:"M 744 1276 L 744 1310 M 744 1293 L 755.67 1293",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,-790,-1291)"}})])])])]):t._e(),1===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Control",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Control Object")},mousedown:function(e){return t.dragStart(e,"Control Object")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,520,530)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"35",ry:"35",stroke:"black","stroke-width":"4"}}),i("path",{attrs:{d:"M 405.25 124 L 422.75 133 M 405.25 124 L 422.75 113",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,-415,-158)"}})])])])]):t._e(),1===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Entity",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Entity Object")},mousedown:function(e){return t.dragStart(e,"Entity Object")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,520,530)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"35",ry:"35",stroke:"black","stroke-width":"4"}}),i("path",{attrs:{d:"M -25 35 L 25 35",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,0,4)"}})])])])]):t._e(),0===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Business Actor",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Business Actor")},mousedown:function(e){return t.dragStart(e,"Business Actor")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(14,0,0,14,500,200)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"7.5",ry:"7.5",stroke:"black","stroke-width":"3.5"}}),i("path",{attrs:{d:"M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343",stroke:"black","stroke-width":"3.5",transform:"matrix(1,0,0,1,-873,-1290)"}}),i("line",{attrs:{stroke:"black","stroke-width":"2",x1:"-3",x2:"7",y1:"7",y2:"-3"}})])])])]):t._e(),0===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Business Worker",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Business Worker")},mousedown:function(e){return t.dragStart(e,"Business Worker")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,520,560)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"35",ry:"35",stroke:"black","stroke-width":"4"}}),i("path",{attrs:{d:"M 405.25 124 L 422.75 133 M 405.25 124 L 422.75 113",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,-415,-158)"}}),i("path",{attrs:{d:"M 0 35 L 35 0",stroke:"black","stroke-width":"4"}}),i("g",{attrs:{transform:"matrix(0.74,0,0,0.74,0,0)"}},[i("ellipse",{attrs:{fill:"white",rx:"7.5",ry:"7.5",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,0,-23)"}}),i("path",{attrs:{d:"M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,-873,-1313)"}})])])])])]):t._e(),0===t.state.currentSeqType?i("el-tooltip",{attrs:{content:"Business Entity",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Business Entity")},mousedown:function(e){return t.dragStart(e,"Business Entity")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,520,530)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"35",ry:"35",stroke:"black","stroke-width":"4"}}),i("path",{attrs:{d:"M 0 35 L 35 0",stroke:"black","stroke-width":"4"}}),i("path",{attrs:{d:"M -25 35 L 25 35",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,0,4)"}})])])])]):t._e(),i("el-tooltip",{attrs:{content:"Fragment",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Fragment")},mousedown:function(e){return t.dragStart(e,"Fragment")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(1,0,0,1,50,50)"}},[i("rect",{attrs:{fill:"white",height:"750",stroke:"black","stroke-linejoin":"round","stroke-width":"28",transform:"matrix(1,0,0,1,89,90)",width:"750"}}),i("path",{attrs:{d:"M 89 240 L 400 240  L 430 90 L89 90 z",fill:"#F8ECDA",stroke:"black","stroke-linejoin":"round","stroke-width":"18"}})])])])]),i("el-tooltip",{staticClass:"item",attrs:{content:"备注",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("Note")},mousedown:function(e){return t.dragStart(e,"Note")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(1,0,0,1,50,50)"}},[i("path",{attrs:{d:"M 100 100 L 700 100 L 820 220 L 820 820 L 100 820 Z ",fill:"#F7F4F5",stroke:"black","stroke-linejoin":"round","stroke-width":"30"}}),i("path",{attrs:{d:" M 700 100 L 820 220 L 700 220   Z ",fill:"#CBCBCB",stroke:"black","stroke-linejoin":"round","stroke-width":"30"}})])])])]),i("div",{staticClass:"diagram-toolbar-split"}),i("el-tooltip",{staticClass:"item",attrs:{content:"下载PNG",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-download el-ui-icon",on:{click:t.downLoadPng}})]),i("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"item",attrs:{slot:"reference",content:"上传到 XWatt",effect:"light",placement:"bottom"},slot:"reference"},[i("i",{staticClass:"el-ui-icon el-icon-upload",on:{click:t.openMessageBox}})]),i("el-tooltip",{staticClass:"item",attrs:{content:"问题反馈",effect:"light",placement:"bottom"}},[i("el-link",{staticStyle:{position:"relative",top:"-2px","font-size":"1.2em"},attrs:{icon:"el-icon-question",href:"https://git.woa.com/td/xwatt-web/issues/new",target:"_blank"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"confluence_btn_group"},[i("el-button",{attrs:{plain:"",size:"mini",type:"info"},on:{click:t.onCancel}},[t._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)},x=[],C=(i("7f7f"),i("96cf"),i("3b8d")),b=(i("a481"),i("ec26")),I=i("75fc"),M=i("d225"),k=i("b0b4"),S={ADD_LIFELINE:"add lifeline",MODIFY_LIFELINE_NAME:"modify lifeline name",CHANGE_LIFELINE_TYPE:"change lifeline type",DELETE_LIFELINE:"delete lifeline",MOVE_LIFELINE:"move lifeline",ADD_MSG:"add msg",DELETE_MSG:"delete msg",MODIFY_MSG_NAME:"modify msg name",MOVE_MSG:"move msg",ADD_FRAGMENT:"add fragment",DELETE_FRAGMENT:"delete fragment",MODIFY_FRAGMENT_RECT:"modify fragment rect",ADD_NOTE:"add note",DELETE_NOTE:"delete note",MODIFY_NOTE_CONTENT:"modify note content",MOVE_NOTE:"move note",ADD_NOTE_CONN:"add note conn",DELETE_NOTE_CONN:"delete note conn"},D=function(){function t(){Object(M["a"])(this,t),this.undoStack=[],this.redoStack=[],this.undoIndex=0,this.redoIndex=0}return Object(k["a"])(t,[{key:"reset",value:function(){this.undoStack.length=0,this.redoStack.length=0,this.undoIndex=0,this.redoIndex=0}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}]),t}(),N=i("b190"),A=i.n(N),L=(i("6b54"),i("28a5"),i("9af9"),i("6c7b"),i("2397"),i("4e2b")),T=i("308d"),E=i("6bb5");function O(t){var e=j();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function j(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var P=document.createElement("input");P.setAttribute("type","text"),P.style.position="absolute",P.style.display="none",P.className="seq-input",document.body.appendChild(P);var z={onEnter:function(){},onBlur:function(){},text:""};P.addEventListener("keyup",(function(t){"Enter"===t.key?(P.style.display="none",z.onEnter&&z.onEnter(P.value)):"Escape"===t.key&&(P.style.display="none",P.value=z.text),t.stopPropagation()})),P.addEventListener("blur",(function(t){P.style.display="none",z.onBlur&&z.onBlur(P.value)}));var R=function(t){Object(L["a"])(i,t);var e=O(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=new sving.Text(t.text,t);return n.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize||"14px"}),n.x=t.paddingH/2,n.y=t.paddingV/2+13-t.text.split(/[\r\n]/).length/2*10,n.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",n.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation()})),o.add(n),n.cursor="pointer",o.text=n,o.options=t,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;z.text=t.text,z.onEnter=t.onEnter,z.onBlur=t.onBlur,setTimeout((function(){P.focus(),P.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);P.style.width=e.width+40+"px",P.value=this.options.text,P.style.display="block",P.style.left=e.left-20+"px",P.style.top=e.top+"px"}}]),i}(sving.Group);function B(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(i),i.setAttribute("width",0),i.setAttribute("height",0),i.style.position="fixed",i.style.bottom=0,i.style.right=0,i.style.pointerEvents="none";var o=document.createElementNS("http://www.w3.org/2000/svg","text");o.style.fontSize=e,i.appendChild(o),o.textContent=t;var n=o.getBBox().width;return document.body.removeChild(i),n}function G(t){var e=_();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function _(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var F=function(t){Object(L["a"])(i,t);var e=G(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=20,a=10;o.id=t.id,o.on("click",(function(e){diagramStore.selectFragmentById(t.id)})),o.rect=new sving.Rect(t.width,t.height),o.rect.setAttrs({fill:"transparent",stroke:config.stroke,rx:4,ry:4}),o.add(o.rect),o.eventRect=new sving.Rect(t.width,t.height),o.eventRect.setAttrs({fill:"none",stroke:"black","stroke-width":9,visibility:"hidden","pointer-events":"stroke"}),o.add(o.eventRect),o.rect.el.style.pointerEvents="none";var s=new sving.Text(t.type);s.setAttrs({fill:t.textColor||config.stroke,"font-weight":"bold","font-size":t.fontSize||"12px",stroke:t.textColor||config.stroke}),s.x=n/2,s.y=a/2+15,s.cursor="move",s.el.style.pointerEvents="none";var r=new R({text:t.text?t.text:"",font:"13px Helvetica",fill:t.textColor||config.stroke,paddingH:10,paddingV:25,fontSize:t.fontSize||"12px",textAnchor:"start",onBlur:function(e){e!==t.text&&diagramStore.updateFragmentText(t.id,e)},onEnter:function(e){e!==t.text&&diagramStore.updateFragmentText(t.id,e)}});o.path=new sving.Path("M 0 34 L 90 34  L 90 34  L 100 23  L 100 0  L 0 0 Z  "),o.path.setAttrs({fill:t.fillColor||config.fill,stroke:config.stroke}),o.width=t.width,o.height=t.height,o.bindDragEvent(o.eventRect),o.bindDragEvent(r),o.bindDragEvent(o.path),o.add(o.path),o.add(r),o.add(s),o.selectBorder=new sving.Rect(t.width,t.height),o.selectBorder.setAttrs({fill:"transparent",stroke:"#ccc","stroke-width":2,"stroke-dasharray":"5,5"}),o.selectBorder.opacity=0,o.selectBorder.el.style.pointerEvents="none",o.add(o.selectBorder);var c="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";if(o.controlPointA=new sving.Img(c),o.controlPointB=new sving.Img(c),o.controlPointC=new sving.Img(c),o.controlPointD=new sving.Img(c),o.controlPointA.cursor="move",o.controlPointB.cursor="move",o.controlPointC.cursor="nwse-resize",o.controlPointD.cursor="move",o.controlPointA.originX=9,o.controlPointA.originY=9,o.controlPointB.originX=9,o.controlPointB.originY=9,o.controlPointC.originX=9,o.controlPointC.originY=9,o.controlPointD.originX=9,o.controlPointD.originY=9,o.controlPointA.opacity=0,o.controlPointB.opacity=0,o.controlPointC.opacity=0,o.controlPointD.opacity=0,o.add(o.controlPointA),o.add(o.controlPointB),o.add(o.controlPointC),o.add(o.controlPointD),o.controlPointC.onDrag((function(t,e,i){i.preventDefault(),o.controlPointC.x<o.controlPointA.x+150?o.controlPointC.x=o.controlPointA.x+150:o.controlPointC.y<o.controlPointA.y+100?o.controlPointC.y=o.controlPointA.y+100:(o.controlPointC.x+=t,o.controlPointC.y+=e),o.controlPointB.x=o.controlPointC.x,o.controlPointD.y=o.controlPointC.y,o.updateBox(o.controlPointA.x,o.controlPointA.y,o.controlPointC.x-o.controlPointA.x,o.controlPointC.y-o.controlPointA.y)})),o.controlPointC.onDragEnd((function(){o.options.boxChanged(o.x,o.y,o.width,o.height)})),o.text=r,r.onAddedToStage((function(){var e=r.el.getBBox();0===e.width&&(e.width=B(r.el.textContent,t.fontSize),console.error("bbox.width",e.width,r.el.textContent),0===e.width&&(e.width=7*U(r.el.textContent)),console.log("bbox.width",e.width,r.el.textContent));var i=s.el.getBBox();0===i.width&&(i.width=B(s.el.textContent,t.fontSize),console.error("typeTextBbox.width",i.width,s.el.textContent),0===i.width&&(i.width=7*s.el.textContent.length));var n=e.width+i.width;r.x=i.width+10,o.path.setAttrs({d:"M 0 34 L ".concat(n+10," 34  L ").concat(n+10," 34  L ").concat(n+20," 23  L ").concat(n+20," 0  L 0 0 Z ")}),o.controlPointB.x=t.width,o.controlPointC.x=t.width,o.controlPointC.y=t.height,o.controlPointD.y=t.height})),o.lineList=[],t.conditions){var l=t.conditions.length;t.conditions.forEach((function(e,i){var n=new sving.Group,a=t.height/l*i;if(0!==i){var s=new sving.Line(0,0,t.width,0);n.add(s),o.lineList.push(s),s.setAttrs({fill:"white",stroke:config.stroke}),s.setAttrs({"stroke-dasharray":"5,5"});var r=new sving.Line(0,0,t.width,0);r.setAttrs({fill:"none",stroke:"black","stroke-width":9,visibility:"hidden","pointer-events":"stroke"}),e.hasOwnProperty("absY")||(e.absY=a),n.add(r)}var c=new sving.Text("[".concat(e.text,"]"),"12px sans-serif");c.y=0===i?50:20,c.x=5,n.add(c),o.add(n),n.y=e.absY||0,i>0&&(n.cursor="move",n.onDrag((function(t,e,i){n.y+=e,i.preventDefault()})),n.onDragEnd((function(e,o){diagramStore.changeFragmentConditionY(t.id,i,n.y)})))}))}return o.options=t,o}return Object(k["a"])(i,[{key:"bindDragEvent",value:function(t){var e=this;t.cursor="move",t.onDragStart((function(){e._prevX=e.x,e._prevY=e.y})),t.onDrag((function(t,i,o){e.x+=t,e.y+=i,o.preventDefault()})),t.onDragEnd((function(t,i){setTimeout((function(){e._prevX===e.x&&e._prevY===e.y||e.options.boxChanged(e.x,e.y,e.width,e.height)}),300)}))}},{key:"updateBox",value:function(t,e,i,o){this.rect.setAttrs({width:i,height:o}),this.selectBorder.setAttrs({width:i,height:o}),this.lineList.forEach((function(t){t.setAttrs({x2:i})})),this.rect.x=t,this.rect.y=e,this.selectBorder.x=t,this.selectBorder.y=e,this.width=i,this.height=o}},{key:"select",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"transparent",stroke:"#5AB3EC"}),this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=1,this.controlPointD.opacity=0}},{key:"unSelect",value:function(){this.selectBorder.opacity=0,this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=0,this.controlPointD.opacity=0}}]),i}(sving.Group);function U(t){for(var e=0,i=0;i<t.length;i++){var o=t.charCodeAt(i);o>=1&&o<=126||65376<=o&&o<=65439?e++:e+=2}return e}var Z=i("a8db"),Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-quickBar-3rbxS",style:"left:"+t.x+"px;top:"+t.y+"px;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"字体颜色",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",{on:{click:t.changeFontColor}},[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT7mlrBpY29uL+Wtl+iJskAzeDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSLmlrBpY29uL+Wtl+iJsiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZD0iTTEzLjA3NSw1LjUgTDE4LDE5IEwxNi41MDgsMTkgTDExLjk5OTk4NTYsNi42NDAxMjc2MSBMNy40OTEsMTkgTDYsMTkgTDEwLjkyMyw1LjUgTDEzLjA3NSw1LjUgWiIgaWQ9IuW9oueKtue7k+WQiCIgZmlsbD0iIzQ2NEQ1QSI+PC9wYXRoPgogICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUiIGZpbGw9IiM0NjRENUEiIHg9IjcuOTY2MDA2MjgiIHk9IjEzLjciIHdpZHRoPSI4IiBoZWlnaHQ9IjEuMyI+PC9yZWN0PgogICAgPC9nPgo8L3N2Zz4="}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.latestColor+";"})]),i("img",{ref:"fontArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleFontColorPicker}})])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"图形填充色",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",{on:{click:t.changeShapeColor}},[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT50b29sYmFyX2ZpbGwgY29sb3I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0idG9vbGJhcl9maWxsLWNvbG9yIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAiPgogICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlIiBzdHJva2U9IiM5Nzk3OTciIGZpbGw9IiNEOEQ4RDgiIG9wYWNpdHk9IjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTkuNzUsMTMgTDIwLjgzNDU0MDgsMTUgQzIxLjA1NTcyMzgsMTUuNDEwMzEwMSAyMS4wNTUxMTQ1LDE1LjkxMjE1NiAyMC44MzI5MzYsMTYuMzIxODc1MiBDMjAuNjEwNzU3NCwxNi43MzE1OTQzIDIwLjE5OTYyNCwxNi45ODkwNDI0IDE5Ljc1LDE3IEMxOS4zMDAzNzYsMTYuOTg5MDQyNCAxOC44ODkyNDI2LDE2LjczMTU5NDMgMTguNjY3MDY0LDE2LjMyMTg3NTIgQzE4LjQ0NDg4NTUsMTUuOTEyMTU2IDE4LjQ0NDI3NjIsMTUuNDEwMzEwMSAxOC42NjU0NTkyLDE1IEwxOS43NSwxMyBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNDY0RDVBIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xOC44NTc5NjY5LDExLjMxNDIwMzMgQzE5LjA0NzM0NDQsMTEuNTAzNTgwOCAxOS4wNDczNDQ0LDExLjgxMDYyMjUgMTguODU3OTY2OSwxMiBMMTIsMTguODU3OTY2OSBDMTEuODEwNjIyNSwxOS4wNDczNDQ0IDExLjUwMzU4MDgsMTkuMDQ3MzQ0NCAxMS4zMTQyMDMzLDE4Ljg1Nzk2NjkgTDUuMTQyMDMzMTQsMTIuNjg1Nzk2NyBDNC45NTI2NTU2MiwxMi40OTY0MTkyIDQuOTUyNjU1NjIsMTIuMTg5Mzc3NSA1LjE0MjAzMzE0LDEyIEwxMiw1LjE0MjAzMzE0IEMxMi4xODkzNzc1LDQuOTUyNjU1NjIgMTIuNDk2NDE5Miw0Ljk1MjY1NTYyIDEyLjY4NTc5NjcsNS4xNDIwMzMxNCBMMTguODU3OTY2OSwxMS4zMTQyMDMzIFogTTE3LjQxNzc5MzgsMTEuNjU3MTAxNyBMMTIuMzQyODk4Myw2LjU4MjIwNjE4IEw2LjU4MjIwNjE4LDEyLjM0Mjg5ODMgTDExLjY1NzEwMTcsMTcuNDE3NzkzOCBMMTcuNDE3NzkzOCwxMS42NTcxMDE3IFoiIGlkPSLlvaLnirYiIGZpbGw9IiM0NjRENUEiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgICAgICA8cG9seWdvbiBpZD0i6Lev5b6ELTMiIGZpbGw9IiM0NjRENUEiIHBvaW50cz0iNiAxMyAxMS42NTkwMDMgMTcuOTcxNDU4MyAxNy4xMTU2MzQ4IDEzIj48L3BvbHlnb24+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.latestColor+";"})]),i("img",{ref:"shapeArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleShapeColorPicker}})])])],1)])]),i("div",{staticClass:"dui-divider dui-divider-vertical",staticStyle:{"vertical-align":"middle","background-color":"rgba(0, 0, 0, 0.08)",margin:"0px 10px"}}),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"增大字号",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|up"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5Yqg5aSnQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPliqDlpKciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUuMDAwMDAwLCA0LjAwMDAwMCkiIGZpbGw9IiM0NjRENUEiPgogICAgICAgICAgICA8cGF0aCBkPSJNNi42MDAxMDQyNiwwLjM2IEwxMiwxNC4zNiBMMTAuNjAxOTMzMSwxNC4zNiBMOS4wOTMsMTAuMzQ5IEwyLjg3MSwxMC4zNDkgTDEuMzUyNTgyNDcsMTQuMzYgTDAsMTQuMzYgTDUuMjgwNDc5NDcsMC4zNiBMNi42MDAxMDQyNiwwLjM2IFogTTUuOTkzMTg0ODMsMi4xMDYxODExNyBMMy4zNDUsOS4wOTkgTDguNjIzLDkuMDk5IEw1Ljk5MzE4NDgzLDIuMTA2MTgxMTcgWiIgaWQ9IlBhdGgtOOWkjeWItiI+PC9wYXRoPgogICAgICAgICAgICA8ZyBpZD0i57yW57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMS4wMDAwMDAsIDAuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIwIiB5PSIyIiB3aWR0aD0iNSIgaGVpZ2h0PSIxLjI1Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIxLjg2OTMyMzczIiB5PSIwLjEzMDM3MTA5NCIgd2lkdGg9IjEuMjUiIGhlaWdodD0iNSI+PC9yZWN0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}})])])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(-1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"减小字号",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|down"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5YeP5bCPQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPlh4/lsI8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtOCI+CiAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGXlpIfku70tNSIgb3BhY2l0eT0iMC4yNDY3NjgwNDMiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTEuNjAwMTA0Myw0LjM2IEwxNywxOC4zNiBMMTUuNjAxOTMzMSwxOC4zNiBMMTQuMDkzLDE0LjM0OSBMNy44NzEsMTQuMzQ5IEw2LjM1MjU4MjQ3LDE4LjM2IEw1LDE4LjM2IEwxMC4yODA0Nzk1LDQuMzYgTDExLjYwMDEwNDMsNC4zNiBaIE0xMC45OTMxODQ4LDYuMTA2MTgxMTcgTDguMzQ1LDEzLjA5OSBMMTMuNjIzLDEzLjA5OSBMMTAuOTkzMTg0OCw2LjEwNjE4MTE3IFoiIGlkPSJQYXRoLTjlpI3liLblpIfku70iIGZpbGw9IiM0NjRENUEiPjwvcGF0aD4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iIzQ2NEQ1QSIgeD0iMTYiIHk9IjYiIHdpZHRoPSI1IiBoZWlnaHQ9IjEuMjUiPjwvcmVjdD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="}})])])])],1)])])])},H=[],V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-palette-panel-3DIVh",style:"display: flex;left:"+t.x+"px;top:"+t.y+"px;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"palette"},[i("div",{staticStyle:{"padding-left":"2px"}},[i("div",{staticClass:"palette-color-grid"},[i("div",t._l(t.standardColors,(function(e){return i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box inner-box-border",style:"background-color:"+e.color+" ;"})])})),0)]),i("div",{staticStyle:{height:"8px"}}),i("div",{staticClass:"palette-color-grid"},t._l(t.presetColors,(function(e){return i("div",t._l(e,(function(e){return i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e.color+" ;"})])})),0)})),0),i("span",{staticClass:"palette-text-font",staticStyle:{"margin-top":"10px","padding-left":"12px","padding-bottom":"10px"}},[t._v("最近使用")]),i("div",{staticClass:"palette-color-grid"},[i("div",[t._l(t.historyColors,(function(e){return t.historyColors.length>0?i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e+" ;"})]):t._e()})),t._l([1,1,1,1,1,1,1,1,1],(function(e){return 0===t.historyColors.length?i("div",{staticClass:"color-box-no-hover",staticStyle:{"margin-left":"-2px","margin-top":"-1px"}},[i("div",{staticClass:"inner-box inner-box-border",staticStyle:{"background-color":"transparent"}})]):t._e()}))],2)])]),t._m(0),i("ul",{staticClass:"palette-list"},[i("li",{staticClass:"list-item list-item-sub",on:{mouseenter:t.showPicker,mouseleave:t.hidePicker}},[i("img",{staticClass:"list-item-img",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUzLjEgKDcyNjMxKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT7oh6rlrprkuYnpopzoibJpY29uPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IuiHquWumuS5ieminOiJsmljb24iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxyZWN0IGlkPSLnn6nlvaItY29weS0xMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ij48L3JlY3Q+CiAgICAgICAgPHBhdGggZD0iTTExLjYsOCBDMTEuMDY2ODQ2Myw4IDEwLjYsNy41MzI2NzQzMiAxMC42LDcuMDAwMzEyNjcgQzEwLjYsNi40NjY2ODQzIDExLjA2NjgzMDMsNiAxMS42LDYgQzEyLjEzMzE2OTcsNiAxMi42LDYuNDY3MzI1NjggMTIuNiw3LjAwMDMxMjY3IEMxMi42LDcuNTMyMDQ4OTcgMTIuMTMzMTY5Nyw4IDExLjYsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOS44MDAzMTI2Nyw1LjQgQzkuMjY2Njg0Myw1LjQgOC44LDQuOTMzMTY5NzMgOC44LDQuNCBDOC44LDMuODY2ODMwMjcgOS4yNjczMjU2OCwzLjQgOS44MDAzMTI2NywzLjQgQzEwLjMzMzMxNTcsMy40IDEwLjgsMy44NjY4MzAyNyAxMC44LDQuNCBDMTAuOCw0LjkzMzE2OTczIDEwLjMzMjY5MDMsNS40IDkuODAwMzEyNjcsNS40IFoiIGlkPSLot6/lvoQiIGZpbGw9IiM1QzVDNUMiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgIDxwYXRoIGQ9Ik02LjM5OTk5MTk4LDUuNCBDNS44NjU1NjY4OCw1LjQgNS40LDQuOTMzMTY5NzMgNS40LDQuNCBDNS40LDMuODY2ODMwMjcgNS44NjU1NjY4OCwzLjQgNi4zOTk5OTE5OCwzLjQgQzYuOTMzMTY1OTksMy40IDcuNCwzLjg2NjgzMDI3IDcuNCw0LjQgQzcuNCw0LjkzMzE2OTczIDYuOTMzMTY1OTksNS40IDYuMzk5OTkxOTgsNS40IEw2LjM5OTk5MTk4LDUuNCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNNC4zOTk2OTUzNSw4IEMzLjg2NjA3MTI2LDggMy40LDcuNTMyNjc0MzIgMy40LDcuMDAwMzEyNjcgQzMuNCw2LjQ2NjY4NDMgMy44NjYwNTUyMiw2IDQuMzk5Njc5MzEsNiBDNC45MzMzMDM0LDYgNS40LDYuNDY3MzI1NjggNS40LDcuMDAwMzEyNjcgQzUuNCw3LjUzMjA0ODk3IDQuOTMyNjc4MDYsOCA0LjM5OTY3OTMxLDggTDQuMzk5Njk1MzUsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOCwxLjUxNTc5MiBMNy45OTc5MzQ2NCwxLjUxNTc4NzczIEM2LjI3NjU5MjQ1LDEuNTA4Njc3MyA0LjYyMzY5ODUsMi4xODkzMzIyNiAzLjQwNjUxNTM4LDMuNDA2NTE1MzggQzIuMTg5MzMyMjYsNC42MjM2OTg1IDEuNTA4Njc3Myw2LjI3NjU5MjQ1IDEuNTE1NzkyLDggQzEuNTE1NzkyLDExLjYwMzQwNyA0LjM5NjU5MzA0LDE0LjQ4NDIwOCA4LDE0LjQ4NDIwOCBDOC4zNDQ5MjgzMiwxNC40ODQyMDggOC42NjM3OTIsMTQuMTY0OTI5IDguNjYzNzkyLDEzLjgyMDQxNiBDOC42NjM3OTIsMTMuNjIxMTM1IDguNjI1OTEzOTcsMTMuNTIyMDgyMSA4LjQ0MDU5MzI4LDEzLjMyMzgyIEM4LjE1NjA5Njg4LDEyLjkwMjM3NTEgOC4wNDMyOTMzMywxMi42NTgyNjg2IDguMDQzMjkzMzMsMTIuMjY4NDY5MyBDOC4wNDMyOTMzMywxMS4zNzA5NjM4IDguODEwNTc5NjUsMTAuNjA0NjU4NyA5LjcwNzA4NTMzLDEwLjYwNDY1ODcgTDExLjEwMzkxMiwxMC42MDQ2NTg3IEMxMy4wMDEyNjc3LDEwLjYwNDY1ODcgMTQuNDg0MjA4LDkuMTIxMTQzNjQgMTQuNDg0MjA4LDcuMjIzNjUzMzMgQzE0LjQ4NDIwOCw0LjA4NjM3MTgzIDExLjYwMzI5OTcsMS41MTU3OTIgOCwxLjUxNTc5MiBaIE04LjAwMTAzMjY4LDAuNTE1NzkyMDcxIEM4LjAwMTM3NjksMC41MTU3OTM0NDYgOC4wMDE3MjExMywwLjUxNTc5NDg0NCA4LjAwMjA2NTM2LDAuNTE1Nzk2MjY2IEw4LDAuNTE1NzkyIEM4LjAwMDM0NDI0LDAuNTE1NzkyIDguMDAwNjg4NDcsMC41MTU3OTIwMjEgOC4wMDEwMzI3LDAuNTE1NzkyMDYyIFoiIGlkPSLot6/lvoQiIHN0cm9rZT0iIzVDNUM1QyIgZmlsbC1ydWxlPSJub256ZXJvIj48L3BhdGg+CiAgICA8L2c+Cjwvc3ZnPg=="}}),i("span",{staticClass:"palette-text-font list-item-text"},[t._v("自定义颜色")]),i("img",{staticClass:"list-item-arrow",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNHB4IiBoZWlnaHQ9IjZweCIgdmlld0JveD0iMCAwIDQgNiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTIuNSAoNjc0NjkpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPgogICAgPHRpdGxlPueureWktDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSJQYWdlLTMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIG9wYWNpdHk9IjAuNDAwMDAwMDA2Ij4KICAgICAgICA8cGF0aCBkPSJNMy45MzU4Mzk2NSwzLjEyMjkwMzMxIEwwLjM3Mzk1MzkzNiw1Ljk0OTA5MTc4IEMwLjI4ODQwNjgsNi4wMTY5Njk0MSAwLjE0OTcwNzQ4OCw2LjAxNjk2OTQxIDAuMDY0MTYwMzUyLDUuOTQ5MDkxNzggQzAuMDIzMDc5MTY4NSw1LjkxNjQ5NTggMCw1Ljg3MjI4NjE2IDAsNS44MjYxODg0OCBMMCwwLjE3MzgxMTUyMiBDMCwwLjA3NzgxODA2OSAwLjA5ODA3NTIyNCwwIDAuMjE5MDU3MTQ0LDAgQzAuMjc3MTU0NzExLDAgMC4zMzI4NzI3NTIsMC4wMTgzMTIyMzI4IDAuMzczOTUzOTM2LDAuMDUwOTA4MjE2MSBMMy45MzU4Mzk2NSwyLjg3NzA5NjY5IEM0LjAyMTM4Njc4LDIuOTQ0OTc0MzIgNC4wMjEzODY3OCwzLjA1NTAyNTY4IDMuOTM1ODM5NjUsMy4xMjI5MDMzMSBaIiBpZD0i566t5aS0IiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgIDwvZz4KPC9zdmc+"}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:t.showColorPicker,expression:"showColorPicker"}],staticClass:"chrome-picker",attrs:{value:t.color},on:{input:t.updateValue}},[t._v(">")])],1)])])])},Q=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"line"})])}],W=i("c345"),X={methods:{updateValue:function(t){this.$emit("custom-color-change",t.hex)},onColorChange:function(t){this.$emit("color-change",t)},showPicker:function(){this.showColorPicker=!0},hidePicker:function(){this.showColorPicker=!1}},props:{historyColors:Array,color:String,x:{type:Number,default:0},y:{type:Number,default:0}},data:function(){return{standardColors:[{color:"#FFFFFF"},{color:"#000000"},{color:"#FF0000"},{color:"#FF9900"},{color:"#FFFF00"},{color:"#98FA1C"},{color:"#6CDEFF"},{color:"#403ED6"},{color:"#ED41FD"}],presetColors:[[{color:"#E9E9E9"},{color:"#7B7B7B"},{color:"#FFC8B8"},{color:"#FFE1B2"},{color:"#FFF2CC"},{color:"#D9EAD3"},{color:"#DFF8FF"},{color:"#CFC7F4"},{color:"#FEE4FF"}],[{color:"#D9D9D9"},{color:"#5c5c5c"},{color:"#E99899"},{color:"#FFB84D"},{color:"#FFE59A"},{color:"#ACDB7E"},{color:"#85D4E6"},{color:"#8C7BE8"},{color:"#EE93F6"}],[{color:"#C4C4C4"},{color:"#333333"},{color:"#E06666"},{color:"#FB8D00"},{color:"#FFD966"},{color:"#87C120"},{color:"#4CC2EE"},{color:"#3F49B9"},{color:"#D041E1"}],[{color:"#9D9D9D"},{color:"#262626"},{color:"#CC0000"},{color:"#E75200"},{color:"#FFB700"},{color:"#678F00"},{color:"#0188FB"},{color:"#2741B1"},{color:"#A419D3"}]],showColorPicker:!1}},components:{"chrome-picker":W["Chrome"]}},J=X,$=(i("751f"),Object(c["a"])(J,V,Q,!1,null,"613afb4b",null)),K=$.exports,q=["onColorChange","onCustomColorChange"];function tt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function et(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):tt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var it,ot=o["default"].extend(K),nt=function(t,e){var i;return function(){var o=this,n=arguments;clearTimeout(i),i=setTimeout((function(){return t.apply(o,n)}),e)}};function at(t){var e=t.onColorChange,i=t.onCustomColorChange,o=Object(Z["a"])(t,q);it=new ot({propsData:et({},o)}),it.$on("color-change",(function(t){e(t),st()})),it.$on("custom-color-change",nt(i,600)),it.$mount(),document.body.appendChild(it.$el)}function st(){it&&it.$el&&it.$el.parentNode&&it.$el.parentNode.removeChild(it.$el)}document.addEventListener("mousedown",(function(){st()}));var rt={props:{x:{type:Number,default:0},y:{type:Number,default:0},fontSizePx:{type:Number,default:14},latestColor:{type:String}},methods:{changeShapeColor:function(){this.$emit("shape-color-change",this.latestColor)},changeFontColor:function(){this.$emit("font-color-change",this.latestColor)},onFontSizeChange:function(t){this.fontSizePx+=t,this.$emit("font-size-change",this.fontSizePx)},toggleFontColorPicker:function(t){var e=this;this.isShowShapeColorPicker=!1;var i=this.$refs.fontArrow.getBoundingClientRect();st(),this.isShowFontColorPicker?st():at({color:"red",historyColors:Oe.state.historyColors,onColorChange:function(t){console.error(t),e.isShowFontColorPicker=!1,e.$emit("font-color-change",t)},onCustomColorChange:function(t){e.$emit("font-color-change",t)},x:i.left-40,y:i.top+32}),t.stopPropagation(),this.isShowFontColorPicker=!this.isShowFontColorPicker},toggleShapeColorPicker:function(t){var e=this;this.isShowFontColorPicker=!1;var i=this.$refs.shapeArrow.getBoundingClientRect();st(),this.isShowShapeColorPicker?st():at({color:"red",historyColors:Oe.state.historyColors,onColorChange:function(t){console.error(t),e.isShowShapeColorPicker=!1,e.$emit("shape-color-change",t)},onCustomColorChange:function(t){console.log(t),e.$emit("shape-color-change",t)},x:i.left-40,y:i.top+32}),t.stopPropagation(),this.isShowShapeColorPicker=!this.isShowShapeColorPicker}},mounted:function(){this.isShowFontColorPicker=!1,this.isShowShapeColorPicker=!1}},ct=rt,lt=(i("9f3a"),Object(c["a"])(ct,Y,H,!1,null,"56c59d14",null)),dt=lt.exports,ut=["onFontColorChange","onShapeColorChange","onFontSizeChange"];function ht(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function ft(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ht(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ht(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var gt,pt=o["default"].extend(dt);function mt(t){yt();var e=t.onFontColorChange,i=t.onShapeColorChange,o=t.onFontSizeChange,n=Object(Z["a"])(t,ut);gt=new pt({propsData:ft({},n)}),gt.$on("font-color-change",e),gt.$on("shape-color-change",i),gt.$on("font-size-change",o),gt.$mount(),document.body.appendChild(gt.$el)}function yt(){gt&&gt.$el&&gt.$el.parentNode&&gt.$el.parentNode.removeChild(gt.$el)}document.addEventListener("mousedown",(function(){yt()}));var vt=i("013f");function wt(t){var e=xt();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function xt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ct=document.createElement("textarea");function bt(t){if(document.selection){var e=document.body.createTextRange();e.moveToElementText(t),e.select()}else if(window.getSelection){e=document.createRange();e.selectNodeContents(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)}}Ct.style.cssText="\n  outline: none;\n  border: 1px solid rgb(204, 204, 204);\n\nword-break:break-all;\n\n  background: white;\n  position: absolute;\n  background:white;",Ct.setAttribute("contenteditable","true"),Ct.addEventListener("focus",(function(){bt(Ct)})),document.body.appendChild(Ct),Ct.style.position="absolute",Ct.style.display="none";var It={onEnter:function(){},onBlur:function(){},text:""};Ct.addEventListener("keyup",(function(t){})),Ct.addEventListener("blur",(function(t){Ct.style.display="none",It.onBlur&&It.onBlur(Ct.value)}));var Mt=function(t){Object(L["a"])(i,t);var e=wt(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=t.width-t.padding.h-10,a=kt(t.text,"13px",n,2),s=new sving.MultilineText(a.map((function(t){return{text:t}})),t);return s.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize||"14px"}),s.x=t.padding.h/2,s.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",s.y=t.padding.v/2+10,s.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation(),It.onDblClick&&It.onDblClick()})),o.add(s),s.cursor="pointer",o.options=t,o.text=s,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;It.text=t.text,It.onEnter=t.onEnter,It.onBlur=t.onBlur,It.onDblClick=t.onDblClick,setTimeout((function(){Ct.focus(),Ct.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);Ct.style.width=t.width+"px",Ct.style.height=t.height+"px",Ct.value=this.options.text,Ct.style.display="block",Ct.style.left=e.left-10+"px",Ct.style.top=e.top-18+"px"}},{key:"modifyText",value:function(t){var e=this.options.width-this.options.padding.h-10;this.options.text=t;var i=kt(t,"13px",e,2);this.text.update(i.map((function(t){return{text:t}}))),this.text.y=this.options.padding.v/2+10}}]),i}(sving.Group);function kt(t,e,i,o){var n=t.split(/[\r\n]/),a=[];return n.forEach((function(t){if(""===t.trim())a.push("");else{var n=St(t,e,i,o);n.forEach((function(t){a.push(t)}))}})),a}function St(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;for(var s,r=t.split(""),c="",l="",d=[],u=0;u<r.length;u++)l=c+r[u],a.textContent=l,s=a.getBBox().width,s+2*o>i?(d.push(l),l="",c=""):c=l,u===r.length-1&&d.push(l);return document.body.removeChild(n),d}function Dt(t){var e=Nt();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Nt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var At=function(t){Object(L["a"])(i,t);var e=Dt(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.width=t.width,o.height=t.height,o.id=t.id,o.frontPlane=new sving.Path("M0 0 L".concat(o.width-15," 0  L").concat(o.width," 15  L ").concat(o.width," ").concat(o.height," L 0 ").concat(o.height," Z")),o.frontIcon=new sving.Path("M".concat(o.width-15," 0  L").concat(o.width," 15  L ").concat(o.width-15," 15 Z")),o.frontIcon.setAttrs({stroke:"#303D4E",fill:"#eee","stroke-width":1,"stroke-linejoin":"round"}),o.frontPlane.setAttrs({stroke:"#303D4E",fill:"white","stroke-width":1,"stroke-linejoin":"round"}),o.selectGroup=new sving.Group,o.selectBorder=new sving.Rect(o.width,o.height),o.selectBorder.setAttrs({stroke:"#5AB3EC",fill:"transparent","stroke-width":2,"stroke-dasharray":"4,4"}),o.cursor="move",o.selectGroup.add(o.selectBorder);var n=new sving.Group;""===t.text.trim()&&(t.text="　　　　　");var a,s,r=new Mt({text:t.text,font:"13px Helvetica",fill:"black",padding:{h:10,v:10},width:o.width,height:o.height,textAnchor:"start",lineHeight:15,onBlur:function(e){t.onTextChange&&t.onTextChange(e),o.modifyText(e)},onDblClick:function(){Se.unSelectAll()}});o.textContent=t.text,r.onDragStart((function(e){a=e.clientX,s=e.clientY,e.stopPropagation(),t.onDragStart&&t.onDragStart()})),r.onDrag((function(e,i,n){o.x+=e,o.y+=i,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,t.onDrag&&t.onDrag(e,i,Object(vt["a"])(o))})),r.onDragEnd((function(e){(Math.abs(e.clientX-a)>10||Math.abs(e.clientY-s)>10)&&t.onDragEnd&&t.onDragEnd()})),r.x=5,r.y=15;var c="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";return o.controlPoint=new sving.Img(c),o.controlPoint.setAttrs({width:18,height:18}),o.controlPoint.x=o.width-10,o.controlPoint.y=o.height-10,o.controlPoint.cursor="nwse-resize",o.controlPoint.onDrag((function(e,i){o.controlPoint.x+=e,o.controlPoint.y+=i,o.width+=e,o.height+=i,o.width<30&&(o.width=30),o.height<30&&(o.height=30),t.onResize&&t.onResize(o.width,o.height),o.resize(o.width,o.height)})),o.controlPoint.onDragEnd((function(){t.onResizeEnd&&t.onResizeEnd()})),o.selectGroup.add(o.controlPoint),o.cube=new sving.Group,o.cube.add(o.frontPlane),o.cube.add(o.frontIcon),n.add(o.cube),n.add(o.selectGroup),o.add(n),o.selectBorder.setAttrs({"pointer-events":"none"}),o.cube.onDrag((function(e,i){o.x+=e,o.y+=i,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,t.onDrag&&t.onDrag(e,i,Object(vt["a"])(o))})),o.cube.onDragStart((function(e){a=e.clientX,s=e.clientY,e.stopPropagation(),t.onDragStart&&t.onDragStart()})),o.cube.onDragEnd((function(e){(Math.abs(e.clientX-a)>10||Math.abs(e.clientY-s)>10)&&t.onDragEnd&&t.onDragEnd()})),o.cube.on("click",(function(e){t.onClick&&t.onClick(e),o.select(),e.stopPropagation()})),o.on("mousedown",(function(t){t.stopPropagation()})),o.cube.on("mousedown",(function(e){t.onMouseDown&&t.onMouseDown(e),e.stopPropagation()})),n.on("mouseover",(function(){t.onMouseOver&&t.onMouseOver()})),n.on("mouseout",(function(){t.onMouseOut&&t.onMouseOut()})),n.on("mouseup",(function(e){t.onMouseUp&&t.onMouseUp(e)})),n.add(r),o.x=t.x,o.y=t.y,o.selectGroup.opacity=0,o.editableText=r,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,o.on("contextmenu",(function(e){Se.selectNoteById(o.id),e.preventDefault(),t.onContextMenu&&t.onContextMenu(Object(vt["a"])(o)),window.contextMenu({items:[{label:"删除",onClick:function(){t.onRemove&&t.onRemove(Object(vt["a"])(o))}}],event:event,zIndex:1e3,minWidth:200})})),o}return Object(k["a"])(i,[{key:"modifyText",value:function(t){this.textContent!==t&&(this.textContent=t,this.editableText.modifyText(t))}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.controlPoint.x=this.width-10,this.controlPoint.y=this.height-10,this.centerX=this.x+this.width/2,this.centerY=this.y+this.height/2,this.selectBorder.setAttrs({width:this.width,height:this.height}),this.frontIcon.setAttrs({d:"M".concat(this.width-15," 0  L").concat(this.width," 15  L ").concat(this.width-15," 15 Z")}),this.frontPlane.setAttrs({d:"M0 0 L".concat(this.width-15," 0  L").concat(this.width," 15  L ").concat(this.width," ").concat(this.height," L 0 ").concat(this.height," Z")})}},{key:"select",value:function(){this.isSelected=!0,this.selectGroup.opacity=1}},{key:"toggleSelect",value:function(){0===this.selectGroup.opacity?this.select():this.unselect()}},{key:"unSelect",value:function(){this.isSelected=!1,this.selectGroup.opacity=0}}]),i}(sving.Group);i("55dd");var Lt=void 0;function Tt(t){var e=Et();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Et(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ot=document.createElement("textarea");Ot.setAttribute("rows",4),Ot.style.position="absolute",Ot.style.display="none",Ot.className="seq-mult-textarea",document.body.appendChild(Ot),Ot.addEventListener("keydown",(function(t){"Enter"==t.key&&t.preventDefault()}));var jt={onEnter:function(){},onBlur:function(){},text:""};Ot.addEventListener("keyup",(function(t){var e=t.ctrlKey||t.metaKey||t.altKey;if("Enter"==t.key&&e)return Ot.value=Ot.value+"\r\n",void t.preventDefault();"Enter"===t.key&&(Ot.style.display="none",Lt.text.textContent=Ot.value,jt.onEnter&&jt.onEnter(Ot.value),t.preventDefault()),"Escape"===t.key&&(Ot.style.display="none",Ot.value=jt.text),t.stopPropagation()})),Ot.addEventListener("blur",(function(t){Ot.style.display="none",jt.onBlur&&jt.onBlur(Ot.value)}));var Pt=function(t){Object(L["a"])(i,t);var e=Tt(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=new sving.MultilineText(t.text.split(/[\r\n]/).map((function(t){return{text:t}})),t);return n.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize||"14px"}),n.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",n.x=t.paddingH/2,t.y?n.y=t.y:(n.y=t.paddingV/2+13,t.text.trim().split(/[\r\n]/).length>1&&(n.y-=t.text.trim().split(/[\r\n]/).length/2*10)),n.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation()})),o.add(n),n.cursor="pointer",o.options=t,o.text=n,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;jt.text=t.text,jt.onEnter=t.onEnter,jt.onBlur=t.onBlur,setTimeout((function(){Ot.focus(),Ot.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);Ot.style.width=e.width+40+"px",Ot.value=this.options.text,Ot.style.display="block",Ot.style.left=e.left-20+"px",Ot.style.top=e.top+"px"}},{key:"modifyText",value:function(t){this.options.text=t,this.text.update(t.split(/[\r\n]/).map((function(t){return{text:t}}))),this.text.y=this.options.paddingV/2+13,this.options.text.trim().split(/[\r\n]/).length>1&&(this.text.y-=this.options.text.trim().split(/[\r\n]/).length/2*10)}}]),i}(sving.Group);function zt(t){var e=Rt();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Rt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Bt=function(t){Object(L["a"])(i,t);var e=zt(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(7.5,7.5),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343"),o.body.x=-873,o.body.y=-1290,o.body.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.line=new sving.Line(-3,7,7,-3),o.line.setAttrs({stroke:config.stroke}),o.add(o.line),o.scale=.9,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group);function Gt(t){var e=_t();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function _t(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ft=function(t){Object(L["a"])(i,t);var e=Gt(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(7.5,7.5),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343"),o.body.x=-873,o.body.y=-1290,o.body.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.scale=.9,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group),Ut=Ft;function Zt(t){var e=Yt();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Yt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ht=function(t){Object(L["a"])(i,t);var e=Zt(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(35,35),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M 744 1276 L 744 1310 M 744 1293 L 755.67 1293"),o.body.x=-790,o.body.y=-1291,o.body.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.scale=.8,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group),Vt=Ht;function Qt(t){var e=Wt();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Wt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Xt=function(t){Object(L["a"])(i,t);var e=Qt(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(35,35),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M 405.25 124 L 422.75 133 M 405.25 124 L 422.75 113"),o.body.x=-415,o.body.y=-158,o.body.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.scale=.8,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group),Jt=Xt;function $t(t){var e=Kt();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Kt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var qt=function(t){Object(L["a"])(i,t);var e=$t(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(35,35),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M -25 35 L 25 35"),o.body.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.scale=.8,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group),te=qt;function ee(t){var e=ie();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function ie(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var oe=function(t){Object(L["a"])(i,t);var e=ee(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(35,35),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M 405.25 124 L 422.75 133 M 405.25 124 L 422.75 113"),o.body.x=-415,o.body.y=-158,o.body.setAttrs({stroke:config.stroke}),o.extendLine=new sving.Path("M 0 35 L 35 0"),o.extendLine.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.add(o.extendLine),o.actorHead=new sving.Ellipse(7.5,7.5),o.actorHead.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.actor=new sving.Group,o.actorHead.y=-23,o.actorBody=new sving.Path("M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343"),o.actorBody.x=-873,o.actorBody.y=-1313,o.actorBody.setAttrs({stroke:config.stroke}),o.actor.add(o.actorHead),o.actor.add(o.actorBody),o.actor.scale=.74,o.add(o.actor),o.scale=.8,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group),ne=oe;function ae(t){var e=se();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function se(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var re=function(t){Object(L["a"])(i,t);var e=ae(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(35,35),o.head.setAttrs({stroke:config.stroke,fill:t.color||config.fill}),o.body=new sving.Path("M -25 35 L 25 35"),o.body.setAttrs({stroke:config.stroke}),o.extendLine=new sving.Path("M 0 35 L 35 0"),o.extendLine.setAttrs({stroke:config.stroke}),o.add(o.head),o.add(o.body),o.add(o.extendLine),o.scale=.8,o.selectHandlerList=[],o.unSelectHandlerList=[],o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group),ce=re;function le(t){var e=de();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function de(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ue=function(t){Object(L["a"])(i,t);var e=le(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.id=t.id,o.on("mouseover",(function(){diagramStore.mouseOverGroup=Object(vt["a"])(o)})),o.on("mouseout",(function(){diagramStore.mouseOverGroup=null})),o.height=t.lifelineHeight,o.selectBorder=new sving.Rect(100,o.height+30),o.selectBorder.setAttrs({fill:"white",stroke:"white","stroke-width":2,"stroke-dasharray":"5,5"}),o.boxWidth=140,o.on("click",(function(e){diagramStore.selectLifelineById(t.id,e)})),o.add(o.selectBorder);t.paddingH;var n=t.paddingV||6;"Actor"===t.type?(o.actor=new Ut(t),o.actor.y=-50,o.add(o.actor)):"Control Object"===t.type?(o.actor=new Jt(t),o.actor.y=-40,o.add(o.actor)):"Entity Object"===t.type?(o.actor=new te(t),o.actor.y=-40,o.add(o.actor)):"Boundary Object"===t.type?(o.actor=new Vt(t),o.actor.y=-40,o.add(o.actor)):"Business Actor"===t.type?(o.actor=new Bt(t),o.actor.y=-50,o.add(o.actor)):"Business Entity"===t.type?(o.actor=new ce(t),o.actor.y=-40,o.add(o.actor)):"Business Worker"===t.type?(o.actor=new ne(t),o.actor.y=-40,o.add(o.actor)):(o.rect=new sving.Rect(0,0),o.rect.setAttrs({fill:t.color||config.fill,stroke:config.stroke,rx:4,ry:4,height:80,width:o.boxWidth}),o.add(o.rect),o.rect.y=-55,o.rect.cursor="move"),o.actor&&(o.actor.setAttr("pointer-events","bounding-box"),o.actor.cursor="move"),t.text=t.text.replace(/[\b]/g,""),""===t.text.trim()&&(t.text="　　　　　");var a=new Pt({text:t.text,font:t.font,fill:t.textColor||config.stroke,fontSize:t.fontSize||"14px",paddingH:0,paddingV:n,onBlur:function(e){t.text!==e&&Pe.emit(S.MODIFY_LIFELINE_NAME,t.id,e)},onEnter:function(e){t.text!==e&&Pe.emit(S.MODIFY_LIFELINE_NAME,t.id,e)}});o.add(a),o.text=a,"Object"===t.type&&(a.y=n/2-30);var s=new sving.Line(0,0,0,o.height);return s.setAttrs({stroke:config.stroke,"stroke-dasharray":"5,5"}),s.setAttrs({"stroke-width":"1"}),o.add(s),o.activationList=[],t.time.sort((function(t,e){return t.level||(t.level=0),e.level||(e.level=0),t.level-e.level})),t.time.forEach((function(e){var i=new sving.Rect(config.activationWidth,config.durationLength*e.duration+10);o.add(i),i.setAttrs({stroke:config.stroke,rx:2,ry:2,fill:t.color||config.fill}),i.customData=e,o.activationList.push(i)})),a.onAddedToStage((function(){var e=a.text.el.getBBox();o.width=o.boxWidth;var i=140,n=fe(t.text.replace(/[\r\n]/g,""),"14px",i,12);a.modifyText(n.join("\n")),a.topTitle=n[0],a.topTitleX=o.boxWidth/2-Math.min(e.width?e.width:7*he(t.text),140)/2-3,a.x=o.boxWidth/2,o.selectBorder.setAttrs({width:o.boxWidth/2}),o.selectBorder.x=o.boxWidth/4,s.x=o.boxWidth/2,s.y=25,o.actor&&(o.actor.x=o.width/2),o.activationList.forEach((function(t){t.x=o.boxWidth/2-config.activationWidth/2+(t.customData.level?5*t.customData.level:0),t.y=t.customData.start*config.durationLength}))})),o}return Object(k["a"])(i,[{key:"selectByOthers",value:function(){}},{key:"select",value:function(){this.isSelected=!0,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unSelect",value:function(){this.isSelected=!1,this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}},{key:"targetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}}]),i}(sving.Group);function he(t){return null==t?0:("string"!=typeof t&&(t+=""),t.replace(/[^\x00-\xff]/g,"01").length)}function fe(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;for(var s,r=t.split(""),c="",l="",d=[],u=0;u<r.length;u++)l=c+r[u],a.textContent=l,s=a.getBBox().width,s+2*o>i?(d.push(l),l="",c=""):c=l,u===r.length-1&&d.push(l);return document.body.removeChild(n),d}function ge(t){var e=pe();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function pe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var me=function(t){Object(L["a"])(i,t);var e=ge(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=t.id,a=t.x1,s=t.y1,r=t.x2,c=t.y2,l=t.textContent,d=t.type,u=t.color,h=t.isReturn,f=t.textColor,g=t.isBack,p=t.targetLifelineColor,m=t.groupNumber;o.id=n,o.line=new sving.Line(a,s,r,c),o.arrow=new sving.Polygon("0 0, 10 3.5, 0 7"),o.asyncArrow=new sving.Path("M 0 0 L 10 3.5 L 0 7"),o.selectBorder=new sving.Rect(Math.abs(r-a),30),o.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC","stroke-width":2,"stroke-dasharray":"5,5"}),o.on("mouseenter",(function(){t.onMouseOver&&t.onMouseOver()})),o.on("mouseleave",(function(){t.onMouseOut&&t.onMouseOut()})),o.selectBorder.x=a>r?r:a,o.selectBorder.y=s-20,o.selectBorder.opacity=0,o.add(o.selectBorder),o.arrow.x=r>a?r-10:r,o.arrow.y=c-3.5,o.line.setAttrs({stroke:u||config.stroke}),o.add(o.line),o.asyncArrow.x=o.arrow.x,o.asyncArrow.y=o.arrow.y,h?(o.add(o.asyncArrow),o.asyncArrow.setAttrs({fill:"none",stroke:u||config.stroke}),o.line.setAttrs({"stroke-dasharray":"5,5"})):"async"===d?(o.asyncArrow.setAttrs({fill:"none",stroke:u||config.stroke}),o.add(o.asyncArrow)):(o.add(o.arrow),o.arrow.setAttrs({fill:"white",stroke:u||config.stroke}));var y=new sving.Text(m);y.setAttrs({fontSize:t.fontSize||"14px","font-weight":"bold"}),o.numText=y,o.add(y);var v=new R({text:l?l.replace(/[\b]/g,""):"",font:"13px Helvetica",fill:f||config.stroke,paddingH:0,paddingV:0,fontSize:t.fontSize||"14px",textAnchor:"start",onBlur:function(e){t.textContent!==e&&Pe.emit(S.MODIFY_MSG_NAME,n,e)},onEnter:function(e){t.textContent!==e&&Pe.emit(S.MODIFY_MSG_NAME,n,e)}});return o.add(v),o.x1=a,o.x2=r,o.y1=s,o.y2=c,o.text=v,v.onAddedToStage((function(){var t=v.el.getBBox(),e=t.width;o.width=e,a>r?(v.x=a-e/2-(a-r)/2,v.y=s-15,o.arrow.x+=10,o.arrow.rotation=180,o.arrow.y+=7,o.asyncArrow.x=o.arrow.x,o.asyncArrow.y=o.arrow.y,o.asyncArrow.rotation=o.arrow.rotation,y.x=v.x-29,y.y=v.y+8):(v.x=a-e/2-(a-r)/2,v.y=s-15,y.x=v.x-29,y.y=v.y+8),g&&!h&&(o.activationRect=new sving.Rect(config.activationWidth,10),o.activationRect.setAttrs({stroke:config.stroke,rx:2,ry:2,fill:p||config.fill}),o.activationRect.x=a<r?o.arrow.x+10:o.arrow.x-20,o.activationRect.y=a<r?o.arrow.y+3:o.arrow.y-4)})),o.selectHandlerList=[],o.unSelectHandlerList=[],o.selected=!1,o.on("click",(function(){o.selected=!0,o.select()})),o.options=t,o}return Object(k["a"])(i,[{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(t){var e=this;this.selected=!0,t||this.selectHandlerList.forEach((function(t){t.call(e)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"targetIt",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.opacity=0,this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2;this.x1=e,this.x2=i;var o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-15,this.arrow.x=i+10,this.numText.x=o.x-29,this.numText.y=o.y+8):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-15,this.numText.x=o.x-29,this.numText.y=o.y+8),this.asyncArrow.x=this.arrow.x,this.asyncArrow.y=this.arrow.y,this.asyncArrow.rotation=this.arrow.rotation,this.selectBorder.setAttrs({width:Math.abs(i-e)}),this.selectBorder.x=e>i?i:e,this.options.isBack&&!this.options.isReturn&&(this.activationRect.x=e<i?this.arrow.x+10:this.arrow.x-20,this.activationRect.y=e<i?this.arrow.y+3:this.arrow.y-4)}}]),i}(sving.Group),ye=me;function ve(t){var e=we();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function we(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var xe=function(t){Object(L["a"])(i,t);var e=ve(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=t.id,a=t.x,s=t.y,r=t.textContent,c=t.color,l=t.isAsync,d=t.textColor,u=t.targetLifelineColor,h=t.groupNumber,f=t.isReturn;o.id=n,o.isSelfArrow=!0,o.x1=a,o.x2=a,o.y1=s,o.y2=s,o.selectBorder=new sving.Rect(80,40),o.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC","stroke-width":2,"stroke-dasharray":"5,5"}),o.on("mouseenter",(function(){t.onMouseOver&&t.onMouseOver()})),o.on("mouseleave",(function(){t.onMouseOut&&t.onMouseOut()})),o.selectBorder.x=10,o.selectBorder.y=-10,o.selectBorder.opacity=0,o.add(o.selectBorder),l||f?(o.line=new sving.Path("M 171.38 60 L 231 60 L 231 83 L177.12 83"),o.arrow=new sving.Path(" M 184.12 97.52 L 177.12 101.02 L 184.12 104.52 "),o.arrow.setAttrs({fill:"none",stroke:c||config.stroke})):(o.line=new sving.Path("M 171.38 60 L 231 60 L 231 83 L177.12 83"),o.arrow=new sving.Path("M 177.12 101.02 L 184.12 97.52 L 184.12 104.52 Z"),o.arrow.setAttrs({fill:"white",stroke:c||config.stroke})),o.line.x=-160,o.arrow.x=-160,o.line.y=-60,o.arrow.y=-78,o.line.setAttrs({fill:"none",stroke:c||config.stroke}),f&&(o.line.setAttrs({"stroke-dasharray":"5,5"}),o.arrow.x=-167),o.add(o.line),o.add(o.arrow);var g=new sving.Text(h);g.setAttrs({fontSize:t.fontSize||"14px","font-weight":"bold"}),o.numText=g,o.add(g);var p=new R({text:r?r.replace(/[\b]/g,""):"",font:"13px Helvetica",fill:d||config.stroke,paddingH:0,paddingV:0,fontSize:t.fontSize||"14px",textAnchor:"start",onBlur:function(e){t.textContent!==e&&Pe.emit(S.MODIFY_MSG_NAME,n,e)},onEnter:function(e){t.textContent!==e&&Pe.emit(S.MODIFY_MSG_NAME,n,e)}});return o.add(p),o.text=p,p.x=50,p.y=10,o.x=a,o.y=s,g.x=22,g.y=18,o.selectHandlerList=[],o.unSelectHandlerList=[],o.selected=!1,o.on("click",(function(){o.selected=!0,o.select()})),o.activationRect=new sving.Rect(config.activationWidth,10),o.activationRect.setAttrs({stroke:config.stroke,rx:2,ry:2,fill:u||config.fill}),o.activationRect.x=o.arrow.x+165,o.activationRect.y=o.arrow.y+100,o}return Object(k["a"])(i,[{key:"updateXY",value:function(t){this.x=t.x1,this.activationRect.x=this.arrow.x+165,this.activationRect.y=this.arrow.y+100}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(t){var e=this;this.selected=!0,t||this.selectHandlerList.forEach((function(t){t.call(e)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"targetIt",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.opacity=0,this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}}]),i}(sving.Group),Ce=xe,be=function(){function t(e,i,o,n){Object(M["a"])(this,t),this.data=e,this.options=i,this.group=new sving.Group,n?o.add(this.group):o.prepend(this.group),this.renderLifeline(),this.renderMsg(),this.fixMsgPosition(),this.renderFragment(),this.renderNote(),this.group.on("click",(function(t){t.stopPropagation()}))}return Object(k["a"])(t,[{key:"renderNote",value:function(){Se.noteGroupList=[],Se.noteGroup&&Se.noteGroup.clear(),Se.noteConnGroup&&Se.noteConnGroup.clear();var t=new sving.Group;Se.noteGroup=t,Se.noteConnGroup=new sving.Group,Se.stage.add(Se.noteConnGroup),Se.noteGroup.on("click",(function(t){t.stopPropagation()})),Se.stage.add(t);var e=this.data;e.noteList&&e.noteList.forEach((function(e){var i=new At({id:e.id,x:e.x||100,y:e.y||100,width:e.width||100,height:e.height||100,text:e.text||"　　　　　",onClick:function(){Se.selectNoteById(e.id)},onTextChange:function(t){Se.unSelectNote(),setTimeout((function(){Pe.emit(S.MODIFY_NOTE_CONTENT,e.id,t)}))},onRemove:function(){Se.removeSelectedObject()},onResizeEnd:function(){Se.updateNoteSize(e.id,i.width,i.height)},onDragStart:function(){Se.noteArrow.x=i.x+i.width+30,Se.noteArrow.y=i.y+20},onDrag:function(t,e){Se.noteArrow.x+=t,Se.noteArrow.y+=e},onDragEnd:function(){Pe.emit(S.MOVE_NOTE,e.id,i.x,i.y)}});e.connectList&&e.connectList.forEach((function(t){var e=new sving.Line(0,0,0,0);e.setAttrs({stroke:"black","stroke-dasharray":"4,4","stroke-width":1});var o=Se.getSvingElementById(t.targetId);o&&(o.isSelfArrow?e.setAttrs({x1:i.centerX,y1:i.centerY,x2:(o.x1+o.x2)/2+100,y2:(o.y1+o.y2)/2+110}):e.setAttrs({x1:i.centerX,y1:i.centerY,x2:(o.x1+o.x2)/2+40,y2:(o.y1+o.y2)/2+100})),Se.noteConnGroup.add(e)})),i.noteData=e,t.add(i),Se.noteGroupList.push(i)}))}},{key:"renderMsg",value:function(){var t=this,e=this.data;e.msgList.forEach((function(i){var o=e.lifelineList.find((function(t){return t.key===i.from})),n=e.lifelineList.find((function(t){return t.key===i.to}));if(o&&n){var a=o.lifeline.x+o.lifeline.width/2,s=n.lifeline.x+n.lifeline.width/2;if(s>a?(a+=config.activationWidth/2,s-=config.activationWidth-config.activationWidth/2):(a-=config.activationWidth/2,s+=config.activationWidth-config.activationWidth/2),i.svingArrow)i.svingArrow.updateXY({x1:a,x2:s}),t.fixOneMsgPosition(i.svingArrow);else{var r;i.classMethodId&&Oe.methodMap[i.classMethodId]&&(i.text=Oe.methodMap[i.classMethodId].Name);var c,l=Se.getLifelineById(i.to),d=l?l.color:config.fill,u=i.args?i.text+"("+i.args+")":i.text;r=i.from!==i.to?new ye({groupNumber:Oe.state.diagramInfo.hasMsgNumber?i.groupNumber:"",id:i.id,x1:a,y1:i.time*config.durationLength,x2:s,y2:i.time*config.durationLength,textContent:u,type:i.type,color:i.arrowColor,isReturn:i.isReturn,textColor:i.textColor,fontSize:i.fontSize,fromLevel:i.fromLevel,toLevel:i.toLevel,onMouseOver:function(){Se.overMsg=r},onMouseOut:function(){Se.overMsg=null},isBack:i.isBack,targetLifelineColor:d}):new Ce({groupNumber:Oe.state.diagramInfo.hasMsgNumber?i.groupNumber:"",id:i.id,x:a,y:i.time*config.durationLength,textContent:u,color:i.arrowColor,isAsync:"async"===i.type,isReturn:i.isReturn,textColor:i.textColor,fontSize:i.fontSize,onMouseOver:function(){Se.overMsg=r},onMouseOut:function(){Se.overMsg=null},targetLifelineColor:d}),r.linkData=i,r.cursor="pointer",r.onDragStart((function(t){c=r.y})),r.onDrag((function(t,e){r.y+=e})),r.onDragEnd((function(t){Math.abs(r.y-c)>5&&Pe.emit(S.MOVE_MSG,r.linkData.id,r.linkData.time+(r.y-c)/config.durationLength)}));var h=function(){Se.selectMsgById(i.id)};r.on("click",(function(t){h()})),r.on("dblclick",(function(){Oe.openRightPanel()})),r.on("contextmenu",(function(t){h(),Se.selectMsgById(i.id),t.preventDefault(),mt({x:t.clientX,y:t.clientY-40,fontSizePx:i.fontSize?parseInt(i.fontSize):14,fontColor:i.textColor,shapeColor:i.color,latestColor:Oe.state.historyColors[0],onFontSizeChange:function(t){Se.updateMsgFontSize(i.id,t+"px")},onFontColorChange:function(t){Se.updateMsgFontColor(i.id,t),Oe.mergeHistoryColor(t)},onShapeColorChange:function(t){Se.updateMsgShapeColor(i.id,t),Oe.mergeHistoryColor(t)}}),window.contextMenu({items:[{icon:"sync"===i.type?"el-icon-check":"",label:"同步消息",onClick:function(){Se.updateMsgType(i.id,"sync")}},{icon:"async"===i.type?"el-icon-check":"",label:"异步消息",onClick:function(){Se.updateMsgType(i.id,"async")},divided:!0},{icon:i.isReturn?"el-icon-check":"",label:"Is Return",onClick:function(){Se.updateMsgIsReturn(i.id,!i.isReturn)},divided:!0},{icon:i.isNewMessageGroup?"el-icon-check":"",label:"新消息组",onClick:function(){Se.updateMsgIsNewMessageGroup(i.id,!i.isNewMessageGroup)},divided:!0},{label:"删除",onClick:function(){Se.removeSelectedObject()}}],x:t.clientX,y:t.clientY,minWidth:214})})),r.onSelect((function(){Se.selectMsgById(i.id)})),r.onUnSelect((function(){Se.selectedArrow=null})),t.group.add(r),i.svingArrow=r,Se.svingArrowMap[i.id]=r}}}))}},{key:"fixOneMsgPosition",value:function(t){if(t.isSelfArrow)t.x+=5*t.linkData.level;else{var e=this.getActivationLevel(t.linkData.time,t.linkData.from),i=this.getActivationLevel(t.linkData.time,t.linkData.to);t.updateXY({x1:t.x1+5*e,x2:t.x2+5*i})}}},{key:"fixMsgPosition",value:function(){for(var t in Se.svingArrowMap)this.fixOneMsgPosition(Se.svingArrowMap[t])}},{key:"getActivationLevel",value:function(t,e){for(var i=Se.baseData.activationList,o=i.filter((function(t){return t.group===e})),n=0,a=0;a<o.length;a++){var s=o[a];Number(t.toFixed(2))>=Number(s.start.toFixed(2))&&Number(t.toFixed(2))<=Number((s.start+s.duration).toFixed(2))&&(n=Math.max(n,s.level?s.level:0))}return n}},{key:"renderFragment",value:function(){var t=this.data;Se.fragmentGroup&&Se.fragmentGroup.clear();var e=new sving.Group;Se.fragmentGroup=e,Se.fragmentGroup.on("click",(function(t){t.stopPropagation()})),Se.stage.add(e),Se.fragmentGroupList=[],t.fragmentList&&t.fragmentList.forEach((function(t,i){var o=new F({id:t.id,text:t.text,type:t.type,width:t.width,height:t.height,fontSize:t.fontSize,textColor:t.textColor,fillColor:t.color,boxChanged:function(e,i,o,n){Pe.emit(S.MODIFY_FRAGMENT_RECT,t.id,e,i,o,n)},conditions:t.conditions}),n=function(){Oe.state.addFragmentForm.id=t.id,Oe.state.addFragmentForm.type=t.type,Oe.state.addFragmentForm.conditions=t.conditions,Oe.state.addFragmentForm.conditionValue=t.conditions.map((function(t){return t.text})),Oe.state.addFragmentForm.name=t.text};o.on("click",(function(){n()})),o.on("dblclick",(function(){Oe.openRightPanel()})),o.on("contextmenu",(function(e){n(),mt({x:e.clientX,y:e.clientY-40,fontSizePx:t.fontSize?parseInt(t.fontSize):14,fontColor:t.textColor,shapeColor:t.color,latestColor:Oe.state.historyColors[0],onFontSizeChange:function(e){Se.updateFragmentFontSize(t.id,e+"px")},onFontColorChange:function(e){Se.updateFragmentFontColor(t.id,e),Oe.mergeHistoryColor(e)},onShapeColorChange:function(e){Se.updateFragmentShapeColor(t.id,e),Oe.mergeHistoryColor(e)}}),Se.selectFragmentById(t.id),e.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){Se.removeSelectedObject()}}],x:e.clientX,y:e.clientY,minWidth:214})})),o.x=t.x,o.y=t.y,o.fragmentData=t,e.add(o),Se.fragmentGroupList.push(o)}))}},{key:"renderLifeline",value:function(){var t=this,e=this.data,i=600;e.activationList.forEach((function(t){i=Math.max(i,t.start*config.durationLength+config.durationLength*t.duration)})),e.fragmentList&&e.fragmentList.forEach((function(t){i=Math.max(i,t.y+t.height-100)}));var o=1,n=[];e.lifelineList.forEach((function(a,s){var r="";if(a.classId){var c=Oe.state.addObjectForm.classList.find((function(t){return t.ClassUUId===a.classId}));c&&(r=c.Name)}var l,d=a.text+(r?":".concat(r):""),u=new ue({id:a.id,text:d,type:a.type,fontSize:a.fontSize,time:e.activationList.filter((function(t){return t.group===a.key})),lifelineHeight:i+40,color:a.color,textColor:a.textColor}),h=function(){Oe.state.addObjectForm.id=a.id,Oe.state.addObjectForm.type=a.type,Oe.state.addObjectForm.name=a.text,Oe.state.addObjectForm.classId=a.classId};u.on("click",(function(t){h()})),u.on("dblclick",(function(){Oe.openRightPanel()})),u.on("contextmenu",(function(t){h(),Se.selectLifelineById(a.id),t.preventDefault(),mt({x:t.clientX,y:t.clientY-40,fontSizePx:a.fontSize?parseInt(a.fontSize):14,fontColor:a.textColor,shapeColor:a.color,latestColor:Oe.state.historyColors[0],onFontSizeChange:function(t){Se.updateLifelineFontSize(a.id,t+"px")},onFontColorChange:function(t){Se.updateLifelineFontColor(a.id,t),Oe.mergeHistoryColor(t)},onShapeColorChange:function(t){Se.updateLifelineShapeColor(a.id,t),Oe.mergeHistoryColor(t)}}),window.contextMenu({items:[{label:"删除",onClick:function(){Se.removeSelectedObject()}}],x:t.clientX,y:t.clientY,minWidth:214})})),u.baseData=a,a.hasOwnProperty("x")?(u.x=a.x,o=u.x):s?(u.x+=o+config.interval,o=u.x,a.x=u.x):(u.x=1,o=1),a.lifeline=u,t.group.add(u),n.push({text:u.text.topTitle,x:u.x+u.text.topTitleX+40}),u.onDragStart((function(t){l=u.x})),u.onDrag((function(e,i){u.x+=e;var o=Se.stage.el.getAttribute("width")-160;u.x<-80?u.x=-80:u.x>o&&(u.x=o),t.renderMsg()})),u.onDragEnd((function(t,e){Math.abs(u.x-l)>5&&(Pe.emit(S.MOVE_LIFELINE,u.baseData.id,u.x),n[s].x=u.x+u.text.topTitleX+40,Oe.state.topTitleList=Array.prototype.slice.call(n,0),Se.updateDiagramSize())})),Se.lifelineGroupList.push(u)})),Oe.state.topTitleList=n;var a=600,s=i;e.noteList&&e.noteList.forEach((function(t){s=Math.max(s,t.y+t.height),a=Math.max(a,t.x+t.width)})),Se.updateDiagramSize(a,s)}}]),t}();function Ie(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Me(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ie(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ie(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var ke={initProps:function(){this.lifelineGroupList=[],this.selectedIndex=null,this.targetIndex=null,this.isDraggingArrow=!1,this.linkline=null,this.stage=null,this.sd=null,this.mouseOverGroup=null,this.clientRect=null,this.selectedArrow=null,this.baseData={lifelineList:[],msgList:[],fragmentList:[]},this.fragmentGroupList=[],this.fragmentGroup=null,this.svingArrowMap={},this.selectedLifeline=null,this.noteGroupList=[]},updateFragmentFontColor:function(t,e){var i=this.getFragmentById(t);i.textColor=e,this.refreshData()},updateFragmentShapeColor:function(t,e){var i=this.getFragmentById(t);i.color=e,this.refreshData()},updateArrowTime:function(t,e){var i=this;if(e<.52)this.refreshData();else{for(var o=this.getMsgById(t),n=o.time,a=e-n,s=0,r=this.baseData.msgList.length;s<r;s++){var c=this.baseData.msgList[s];if(c.time<n&&n+a<c.time)return void this.refreshData()}ke.fragmentGroupList.forEach((function(t){if(n*config.durationLength+100<t.y){t.y+=a*config.durationLength,t.fragmentData.y=t.y;var e=i.baseData.fragmentList.find((function(e){return e.id===t.fragmentData.id}));e.y=t.y}})),this.baseData.msgList.forEach((function(t){t.time>=n&&(t.time+=a)})),this.refreshData()}},updateLifelineX:function(t,e){this.baseData.lifelineList.find((function(e){return e.id===t})).x=e,this.refreshData()},updateDiagramSize:function(t,e){var i=0;this.lifelineGroupList.forEach((function(t){i=Math.max(i,t.x)})),i+=600,t&&(i=Math.max(i,t+200)),this.stage.el.setAttribute("width",Math.max(1e3,i,window.innerWidth)),e&&this.stage.el.setAttribute("height",e+300)},updateMsg:function(t){for(var e=this,i=this.selectedArrow.linkData,o=function(o,n){var a=e.baseData.msgList[o];if(a.id===i.id){a.text=t.name,a.classMethodId=t.classMethodId,a.args=t.args,a.type=t.type,a.textColor=t.textColor,a.level=t.level,a.arrowColor=t.arrowColor,a.isReturn=t.isReturn,a.isNewMessageGroup=t.isNewMessageGroup;var s=e.baseData.lifelineList.find((function(t){return t.id===a.to}));return s&&s.classId&&(Oe.methodMap[a.classMethodId].Name=a.text,updateClassMethod(a.classMethodId,{Name:a.text})),"break"}},n=0,a=this.baseData.msgList.length;n<a;n++){var s=o(n,a);if("break"===s)break}this.refreshData()},getMsgById:function(t){return this.baseData.msgList.find((function(e){return e.id===t}))},getLifelineById:function(t){return this.baseData.lifelineList.find((function(e){return e.id===t}))},updateLifelineFontSize:function(t,e){this.getLifelineById(t).fontSize=e,this.refreshData()},updateLifelineFontColor:function(t,e){this.getLifelineById(t).textColor=e,this.refreshData()},updateMsgFontColor:function(t,e){this.getMsgById(t).textColor=e,this.refreshData()},updateLifelineShapeColor:function(t,e){this.getLifelineById(t).color=e,this.refreshData()},updateMsgShapeColor:function(t,e){this.getMsgById(t).arrowColor=e,this.refreshData()},getFragmentById:function(t){return this.baseData.fragmentList.find((function(e){return e.id===t}))},updateFragmentFontSize:function(t,e){this.getFragmentById(t).fontSize=e,this.refreshData()},updateMsgFontSize:function(t,e){this.getMsgById(t).fontSize=e,this.refreshData()},updateMsgIsNewMessageGroup:function(t,e){var i=this.baseData.msgList.find((function(e){return e.id===t}));i.isNewMessageGroup=e,this.refreshData()},updateMsgIsReturn:function(t,e){var i=this.baseData.msgList.find((function(e){return e.id===t}));i.isReturn=e,this.refreshData()},updateNoteContent:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));i.text=e,this.refreshData()},initConnectLine:function(){this.connectLine=new sving.Line(0,0,0,0),this.connectLine.opacity=0,this.connectLine.setAttrs({stroke:"black","stroke-dasharray":"4,4","stroke-width":1,"pointer-events":"none"}),this.stage.add(this.connectLine)},initNoteArrow:function(){var t=this,e=new sving.Path("M479.046,283.925c-1.664-3.989-5.547-6.592-9.856-6.592H352.305V10.667C352.305,4.779,347.526,0,341.638,0H170.971 c-5.888,0-10.667,4.779-10.667,10.667v266.667H42.971c-4.309,0-8.192,2.603-9.856,6.571c-1.643,3.989-0.747,8.576,2.304,11.627 l212.8,213.504c2.005,2.005,4.715,3.136,7.552,3.136s5.547-1.131,7.552-3.115l213.419-213.504 C479.793,292.501,480.71,287.915,479.046,283.925z");e.scale=.03,e.rotation=180,e.setAttrs({fill:"white",stroke:"black","stroke-width":"15","pointer-events":"bounding-box"}),e.opacity=0,e.cursor="pointer",e.on("mousedown",(function(i){t.isMouseDownOnNoteArrow=!0,e.opacity=0,t.clientRect=t.stage.el.getBoundingClientRect(),t._mouseMove=t.mouseMove.bind(t),t._mouseUp=t.mouseUp.bind(t),t.connectLine.opacity=1,document.addEventListener("mousemove",t._mouseMove),document.addEventListener("mouseup",t._mouseUp),i.stopPropagation()})),this.noteArrow=e,this.stage.add(this.noteArrow)},mouseMove:function(t){if(this.isMouseDownOnNoteArrow){for(var e in this.connectLine.setAttrs({x1:this.selectedNote.centerX,y1:this.selectedNote.centerY,x2:t.clientX-this.clientRect.left,y2:t.clientY-this.clientRect.top}),ke.svingArrowMap)ke.svingArrowMap[e].unTargetIt();ke.overMsg&&ke.overMsg.targetIt(),this.sourceNote=this.selectedNote}t.preventDefault()},mouseUp:function(t){this.isMouseDownOnNoteArrow&&this.sourceNote&&this.overMsg&&(Pe.emit(S.ADD_NOTE_CONN,this.sourceNote.id,this.overMsg.id),document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mousemove",this._mouseUp)),this.connectLine.opacity=0,this.isMouseDownOnNoteArrow=!1},addNoteConn:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));i.connectList||(i.connectList=[]),i.connectList.push({targetId:e}),this.refreshData()},deleteNoteConn:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));if(i.connectList)for(var o=0,n=i.connectList.length;o<n;o++)i.connectList[o].targetId===e&&(i.connectList.splice(o,1),o--,n--);this.refreshData()},updateNotePosition:function(t,e,i){var o=this.baseData.noteList.find((function(e){return e.id===t}));o.x=e,o.y=i,this.refreshData()},updateNoteSize:function(t,e,i){var o=this.baseData.noteList.find((function(e){return e.id===t}));o.width=e,o.height=i,this.refreshData()},updateMsgType:function(t,e){var i=this.baseData.msgList.find((function(e){return e.id===t}));i.type=e,this.refreshData()},selectMsgById:function(t){this.unSelectAll(),ke.svingArrowMap[t].select(!0),this.selectedArrow=ke.svingArrowMap[t],Oe.state.selectedElementType="msg";var e=this.selectedArrow.linkData;Oe.state.addMsgForm.id=e.id,Oe.state.addMsgForm.type=e.type,Oe.state.addMsgForm.isNewMessageGroup=e.isNewMessageGroup,Oe.state.addMsgForm.name=e.text,Oe.state.addMsgForm.args=e.args,Oe.state.addMsgForm.isReturn=e.isReturn,Oe.state.addMsgForm.classMethodId=e.classMethodId,Oe.state.addMsgForm.level=e.level||0},getMsgMaxLevel:function(t){var e=this.baseData.activationList.filter((function(e){return e.group===t.from})),i=0;return e.forEach((function(e){t.time>=e.start+e.duration&&(i=Math.max(i,e.level))})),console.error(i),i},findGroupNearUpToMsg:function(t,e){for(var i,o,n=1/0,a=0,s=e.length;a<s;a++){var r=e[a];o=r.time-t.time,o<0&&Math.abs(o)<n&&(r.to===t.from||r.from===t.from)&&(n=Math.abs(o),i=r)}return i},getSvingElementById:function(t){for(var e in ke.svingArrowMap)if(e===t)return ke.svingArrowMap[e]},selectLifelineById:function(t,e,i){this.unSelectAll();var o=this.lifelineGroupList.find((function(e){return e.baseData.id===t}));o.select(),this.selectedLifeline=o,this.arrow.opacity=1,this.selectedIndex=this.lifelineGroupList.indexOf(o),e?(this.arrow.x=o.x+o.width+30,this.arrow.y=e.stageY+20):(this.arrow.x=o.x+o.width+30,this.arrow.y=120),Oe.state.selectedElementType="lifeline",Oe.state.addObjectForm.id=o.baseData.id,Oe.state.addObjectForm.type=o.baseData.type,Oe.state.addObjectForm.name=o.baseData.text,Oe.state.addObjectForm.classId=o.baseData.classId},selectFragmentById:function(t){this.unSelectAll();var e=this.fragmentGroupList.find((function(e){return e.fragmentData.id===t}));e.select(),this.selectedFragment=e;var i=e.fragmentData;Oe.state.addFragmentForm.id=i.id,Oe.state.addFragmentForm.type=i.type,Oe.state.addFragmentForm.conditions=i.conditions,Oe.state.addFragmentForm.conditionValue=i.conditions.map((function(t){return t.text})),Oe.state.addFragmentForm.name=i.text,Oe.state.selectedElementType="fragment"},selectNoteById:function(t){this.unSelectAll();var e=this.noteGroupList.find((function(e){return e.noteData.id===t}));e.select(),this.selectedNote=e,Oe.state.selectedElementType="diagram",this.noteArrow.opacity=1,this.noteArrow.x=e.x+e.width+30,this.noteArrow.y=e.y+20},unSelectNote:function(){var t=this;this.selectedNote&&(this.selectedNote=this.noteGroupList.find((function(e){return e.id===t.selectedNote.id})),this.selectedNote.unSelect(),this.selectedNote=null),this.noteArrow.opacity=0},unSelectAll:function(){this.unSelectMsg(),this.unSelectLifeline(),this.unSelectFragment(),this.unSelectNote(),Oe.state.selectedElementType=""},getStageContentSize:function(){var t=document.querySelector(".sving-root").scrollLeft,e=document.querySelector(".sving-root").scrollTop,i=100,o=100;return this.stage.children.forEach((function(n){var a=n.el.getBoundingClientRect();i=Math.max(i,t+a.x+a.width),o=Math.max(o,e+a.y+a.height),n.children&&n.children.forEach((function(a){var s=a.el.getBoundingClientRect();i=Math.max(i,t+n.x+s.x+s.width),o=Math.max(o,e+n.y+s.y+s.height)}))})),{width:i,height:o}},getBound:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={top:1/0,left:1/0,bottom:-1/0,right:-1/0},i=this.baseData,o=i.lifelineList,n=void 0===o?[]:o,a=i.fragmentList,s=void 0===a?[]:a,r=i.noteList,c=void 0===r?[]:r,l=[].concat(Object(I["a"])(s),Object(I["a"])(c)),d=document.querySelector(".sving-root").scrollLeft;return n.forEach((function(t){t.y=t.y||0;var i=t.lifeline&&t.lifeline.el;if(i){var o=i.getBoundingClientRect(),n=o.x,a=(o.y,o.width),s=o.height;e.top=Math.min(e.top,t.y),e.left=Math.min(e.left,n+d),e.bottom=Math.max(e.bottom,t.y+s),e.right=Math.max(e.right,n+d+a)}})),l.forEach((function(t){console.log(t),t.y=t.y||0,e.top=Math.min(e.top,t.y),e.left=Math.min(e.left,t.x),e.bottom=Math.max(e.bottom,t.y+t.height),e.right=Math.max(e.right,t.x+t.width)})),e.top===1/0&&(e.top=0),e.left===1/0&&(e.left=0),e.bottom===-1/0&&(e.bottom=0),e.right===-1/0&&(e.right=0),e.width=e.right-e.left,e.height=e.bottom-e.top,t&&(e.left=Math.max(0,e.left),e.top=Math.max(0,e.top),e.right=e.left+e.width,e.bottom=e.top+e.height),console.log(e),e},unSelectLifeline:function(){var t=this;this.selectedLifeline&&(this.selectedLifeline=this.lifelineGroupList.find((function(e){return e.id===t.selectedLifeline.id})),this.selectedLifeline.unSelect(),this.selectedLifeline=null),this.arrow.opacity=0},unSelectFragment:function(){var t=this;this.selectedFragment&&(this.selectedFragment=this.fragmentGroupList.find((function(e){return e.id===t.selectedFragment.id})),this.selectedFragment.unSelect(),this.selectedFragment=null)},unSelectMsg:function(){this.selectedArrow&&(this.selectedArrow=this.svingArrowMap[this.selectedArrow.id],this.selectedArrow.unSelect())},deleteMsg:function(t){for(var e=0,i=this.baseData.msgList.length;e<i;e++){var o=this.baseData.msgList[e];if(o.id===t){this.baseData.msgList.splice(e,1),delete this.svingArrowMap[t],this.selectedArrow=null;break}}this.refreshData(),Oe.state.selectedElementType="diagram"},deleteFragment:function(t){for(var e=0,i=this.baseData.fragmentList.length;e<i;e++){var o=this.baseData.fragmentList[e];if(o.id===t){this.baseData.fragmentList.splice(e,1),this.fragmentGroupList.splice(this.fragmentGroupList.indexOf(this.selectedFragment),1),this.selectedFragment=null;break}}this.refreshData(),Oe.state.selectedElementType="diagram"},removeSelectedObject:function(){this.selectedLifeline?Pe.emit(S.DELETE_LIFELINE,this.selectedLifeline.baseData.id):this.selectedArrow?Pe.emit(S.DELETE_MSG,this.selectedArrow.linkData.id):this.selectedFragment?Pe.emit(S.DELETE_FRAGMENT,this.selectedFragment.fragmentData.id):this.selectedNote&&Pe.emit(S.DELETE_NOTE,this.selectedNote.noteData.id)},changeFragmentConditionY:function(t,e,i){this.baseData.fragmentList.find((function(e){return e.id===t})).conditions[e].absY=i,this.refreshData()},addLifeline:function(t,e){this.baseData.lifelineList.push(t),this.refreshData(null,e),this.updateDiagramSize();var i=document.querySelector(".sving-root").getBoundingClientRect();ke.lifelineGroupList[ke.lifelineGroupList.length-1].x>i.width-150&&(document.querySelector(".sving-root").scrollLeft=1e5)},deleteLifeline:function(t,e){for(var i=0,o=this.baseData.lifelineList.length;i<o;i++){var n=this.baseData.lifelineList[i];if(n.id===t){this.baseData.lifelineList.splice(i,1);break}}this.selectedLifeline=null,this.refreshData(null,e),Oe.state.selectedElementType="diagram"},clear:function(){this.baseData={lifelineList:[],msgList:[]},this.stage&&this.refreshData(null,!0)},clearBaseData:function(){delete this.baseData.activationList,this.baseData.msgList.forEach((function(t){delete t.prevMsgId,delete t.nextMsgId,delete t.svingArrow,delete t.used,delete t.isRoot,delete t.msgId,delete t.isBack,delete t.nextMsgList,delete t.nextMsg,delete t.prevMsg,delete t.isAutoNewMessageGroup})),this.baseData.lifelineList.forEach((function(t){delete t.lifeline}))},refreshData:function(t,e,i){t&&(this.baseData=t),this.clearBaseData(),this.lifelineGroupList.length=0,this.stage.remove(this.stage.children[0]),this.stage.remove(this.stage.children[this.stage.children.length-1]);var o=new be(__ac.gen(this.baseData),{},this.stage,!1);o.group.x=40,o.group.y=100,ke.sd=o,this.arrow.opacity=0,e||Oe.save(i)},selectPrevElement:function(){this.selectedArrow?this.selectMsgById(this.selectedArrow.id):this.selectedNote?this.selectNoteById(this.selectedNote.id):this.selectedLifeline?this.selectLifelineById(this.selectedLifeline.id):this.selectedFragment&&this.selectFragmentById(this.selectedFragment.id)},changeLifelineType:function(t,e){var i=this.baseData.lifelineList.find((function(e){return e.id===t}));i.type=e,this.refreshData()},updateLifeline:function(t,e){var i=this.baseData.lifelineList.find((function(e){return e.id===t.id}));i&&(i.text=t.name,i.type=t.type,i.color=t.color,i.classId=t.classId,this.refreshData(null,e,(function(){updateElementName(t.id,t.name).then((function(t){}))})))},getMsgClassUUId:function(t){var e=this.baseData.msgList.find((function(e){return e.id===t})),i=this.baseData.lifelineList.find((function(t){return t.id===e.to}));return i.classId},updateLifelineText:function(t,e,i){var o=this.baseData.lifelineList.find((function(e){return e.id===t}));o&&o.text!==e&&(o.classId&&(e=e.split(":")[0]),o.text=e,this.refreshData(null,i,(function(){updateElementName(t,e).then((function(t){}))})))},updateFragmentText:function(t,e){var i=this.baseData.fragmentList.find((function(e){return e.id===t}));i.text=e,this.refreshData()},updateMsgContentAndArgs:function(t,e){var i=this.baseData.msgList.find((function(e){return e.id===t})),o=e.split("(");i.text=o[0],o.length>1?i.args=o[1].replace(")",""):i.args="";var n=this.baseData.lifelineList.find((function(t){return t.id===i.to}));n.classId&&(Oe.methodMap[i.classMethodId].Name=i.text,updateClassMethod(i.classMethodId,{Name:i.text})),Oe.state.addMsgForm.name=i.text,Oe.state.addMsgForm.args=i.args,this.refreshData()},selectLifelineByOther:function(t){},addMsg:function(t){t.time<.52&&(t.time=.52),this.baseData.msgList.push(t),this.refreshData(),this.selectMsgById(t.id)},addMsgByDragAction:function(t){this.lifelineGroupList[this.selectedIndex].selectBorder.setAttrs({stroke:"#ccc"});var e,i=this.baseData.lifelineList[this.targetIndex];i.classId&&(e=Object(b["a"])(),this.addClassMethod(i.classId,e));var o=Object(b["a"])();return Pe.emit(S.ADD_MSG,{id:o,from:this.baseData.lifelineList[this.selectedIndex].key,to:i.key,text:"输入消息名",time:t,type:"sync",classMethodId:e}),o},addClassMethod:function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var i={ClassUUId:t,ModelId:Oe.currentSeq.ModelId,Name:"输入消息名",ExtendJSONData:"",IsStatic:0,Scope:1,ParameterType:"",ParameterName:"",ReturnType:"void",MethodUUId:e};addClassMethod(i),Oe.methodMap[i.MethodUUId]=i})),mouseOverLifeline:function(t,e){var i=this;if(!t)return this.targetIndex=null,void this.lifelineGroupList.forEach((function(t,e){t.isSelected||t.unTargetIt()}));this.targetIndex=this.lifelineGroupList.indexOf(t),this.lifelineGroupList.forEach((function(t,o){t.isSelected||(o===i.targetIndex?t.targetIt(e):t.unTargetIt())}))},updateFragment:function(t){this.baseData.fragmentList.forEach((function(e){if(t.id===e.id){e.text=t.name,e.type=t.type;var i=[];t.conditionValue.forEach((function(e){var o=t.conditions.find((function(t){return t.text===e}));i.push(o||{text:e})})),e.conditions=JSON.parse(JSON.stringify(i))}})),this.refreshData()},addNote:function(t){this.baseData.noteList||(this.baseData.noteList=[]),this.baseData.noteList.push(t),this.refreshData()},deleteNote:function(t){for(var e=0,i=this.baseData.noteList.length;e<i;e++){var o=this.baseData.noteList[e];if(o.id===t){this.baseData.noteList.splice(e,1);break}}this.selectedNote=null,this.refreshData(),Oe.state.selectedElementType="diagram"},addFragment:function(t){var e=this,i=Me({id:t.id,x:150+Oe.state.diagScrollLeft+100*Math.random(),y:150+Oe.state.diagScrollTop+100*Math.random(),width:400,height:250},t);i.conditions=i.conditionValue.map((function(t){return{text:t}}));var o=new F({id:t.id,text:t.text,type:t.type,width:400,height:250,boxChanged:function(t,o,n,a){var s=e.baseData.fragmentList.find((function(t){return t.id===i.id}));s.x=t,s.y=o,s.width=n,s.height=a,Oe.save()},conditions:t.conditionValue.map((function(t){return{text:t}}))});o.x=240,o.y=240,this.baseData.fragmentList=this.baseData.fragmentList||[],this.baseData.fragmentList.push(i),this.fragmentGroup.add(o),this.fragmentGroupList.push(o),this.refreshData()},editLifelineName:function(t){var e=ke.lifelineGroupList.find((function(e){return e.baseData.id===t}));this.selectLifelineById(t),e.text.focusAndSelect()},editFragmentName:function(t){var e=ke.fragmentGroupList.find((function(e){return e.id===t}));this.selectFragmentById(t),e.text.focusAndSelect()},editMsgName:function(t){var e=ke.svingArrowMap[t];this.selectMsgById(t),e.text.focusAndSelect()},init:function(){var t=this;window.addEventListener("mousemove",(function(e){if(t.clientRect=t.stage.el.getBoundingClientRect(),t.isDraggingArrow){var i=t.lifelineGroupList[t.selectedIndex];t.linkline.opacity=1,t.linkline.setAttrs({x1:i.x+i.width/2+ke.sd.group.x,y1:e.pageY-t.clientRect.top,x2:e.pageX-t.clientRect.left,y2:e.pageY-t.clientRect.top}),t.mouseOverLifeline(t.mouseOverGroup),e.preventDefault()}}))},updateFragmentRect:function(t,e,i,o,n){var a=ke.baseData.fragmentList.find((function(e){return e.id===t}));a.x=e,a.y=i,a.width=o,a.height=n,this.refreshData()},getJSONData:function(){var t={msgList:[],lifelineList:[],fragmentList:[],noteList:[]};return this.baseData.msgList&&this.baseData.msgList.forEach((function(e){var i={};Object.assign(i,e),delete i.prevMsgId,delete i.nextMsgId,delete i.svingArrow,delete i.used,delete i.isRoot,delete i.msgId,delete i.isBack,delete i.nextMsgList,delete i.nextMsg,delete i.prevMsg,t.msgList.push(i)})),this.baseData.lifelineList&&this.baseData.lifelineList.forEach((function(e){var i={};Object.assign(i,e),t.lifelineList.push(i),delete i.lifeline})),this.baseData.fragmentList&&this.baseData.fragmentList.forEach((function(e){var i={};Object.assign(i,e),t.fragmentList.push(i)})),this.baseData.noteList&&this.baseData.noteList.forEach((function(e){var i={};Object.assign(i,e),t.noteList.push(i)})),t.isImport=this.baseData.isImport,t.hasMsgNumber=Oe.state.diagramInfo.hasMsgNumber,t},getPngBase64Data:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){var e,i,o,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.unSelectAll(),e=this.getStageContentSize(),i=document.createElement("canvas"),o=i.getContext("2d"),n=this.stage.el.cloneNode(!0),n.setAttribute("width",e.width+80),n.setAttribute("width",2*n.getAttribute("width")),n.setAttribute("height",2*n.getAttribute("height")),a=canvg.Canvg.fromString(o,n.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="100%" height="100%" fill="white"/>'),{scaleWidth:2*n.getAttribute("width"),scaleHeight:2*n.getAttribute("height")}),t.next=11,a.render();case 11:return t.abrupt("return",i.toDataURL("image/png"));case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()};ke.initProps(),window.diagramStore=ke;var Se=ke;function De(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Ne(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?De(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):De(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Ae={durationLength:50,activationWidth:10,interval:250,fill:"#faecd8",stroke:"black",msgArrowColorList:[]};window.config=Ae;var Le=function(){function t(){Object(M["a"])(this,t),this.state=Ne(Ne({},config),{},{showChooseDialogClose:!1,showMainContentDialog:!1,leftPanelTabActiveName:"x-ide-main-tree",mainContentDialogTitle:"",rightPanelTabActiveName:"proj",seqConfig:Ae,addObjectDialogTitle:"新增对象",addObjectDialogShow:!1,addObjectForm:{name:"",type:"",color:Ae.fill,id:null,classId:"",classList:[]},shareId:null,selectedElementType:"",addMsgDialogTitle:"新增消息",addMsgDialogShow:!1,addMsgForm:{id:null,name:"",classMethodId:"",args:"",type:"sync",isReturn:!1,isNewMessageGroup:null,textColor:Ae.stroke,arrowColor:Ae.stroke,level:0,maxLevel:1},addFragmentDialogTitle:"新增 Fragment",addFragmentForm:{name:"",type:"",conditions:[],conditionValue:[]},addFragmentDialogShow:!1,currentSeqType:0,topTitleList:[],diagScrollLeft:0,diagScrollTop:0,editable:!0,historyColors:["#faecd8","black"],sharedElementList:[],seqDetail:"",diagramInfo:{name:"",type:"",createTime:"",modifyTime:"",creater:"",modifier:"",hasMsgNumber:!0},cloneDiagramDialogShow:!1,cloneDiagramForm:{name:"",cloneMode:"deep"},isShowImportEADialog:!1,eaXMIType:1,isUndoDisabled:!0,isRedoDisabled:!0})}return Object(k["a"])(t,[{key:"save",value:function(){var t={msgList:[],lifelineList:[],fragmentList:[],noteList:[]};Se.baseData.msgList&&Se.baseData.msgList.forEach((function(e){var i={};Object.assign(i,e),delete i.prevMsgId,delete i.nextMsgId,delete i.svingArrow,delete i.used,delete i.isRoot,delete i.msgId,delete i.isBack,delete i.nextMsgList,delete i.nextMsg,delete i.prevMsg,t.msgList.push(i)})),Se.baseData.lifelineList&&Se.baseData.lifelineList.forEach((function(e){var i={};Object.assign(i,e),t.lifelineList.push(i),delete i.lifeline})),Se.baseData.fragmentList&&Se.baseData.fragmentList.forEach((function(e){var i={};Object.assign(i,e),t.fragmentList.push(i)})),Se.baseData.noteList&&Se.baseData.noteList.forEach((function(e){var i={};Object.assign(i,e),t.noteList.push(i)})),t.diagramUUId=Se.baseData.diagramUUId,t.isImport=Se.baseData.isImport,t.hasMsgNumber=Te.state.diagramInfo.hasMsgNumber,localStorage.setItem("xwatt-seq-json",JSON.stringify(t))}},{key:"mergeHistoryColor",value:function(t){var e=this.state.historyColors;-1===e.indexOf(t)&&e.unshift(t),e.length>9&&(e.length=9)}}]),t}(),Te=new Le,Ee=null;Te.showLoading=function(t){return Ee=y["Loading"].service({text:t})},Te.hideLoading=function(){return Ee.close()};var Oe=Te,je=function(){function t(){var e=this;Object(M["a"])(this,t),this.undoRedo=new D,this.lockUndoRodoStack=!1,window.addEventListener("keyup",(function(t){8!==t.keyCode&&46!==t.keyCode||Oe.lockDeleteElement||(diagramStore.selectedLifeline?e.emit(S.DELETE_LIFELINE,diagramStore.selectedLifeline.baseData.id):diagramStore.selectedArrow?e.emit(S.DELETE_MSG,diagramStore.selectedArrow.linkData.id):diagramStore.selectedFragment?e.emit(S.DELETE_FRAGMENT,diagramStore.selectedFragment.fragmentData.id):diagramStore.selectedNote&&e.emit(S.DELETE_NOTE,diagramStore.selectedNote.noteData.id),document.querySelector(".seq-mult-textarea").style.display="none",document.querySelector(".seq-input").style.display="none")})),keyboardJS.bind(["command > z","ctrl > z"],(function(t){document.querySelector(".seq-mult-textarea").style.display="none",document.querySelector(".seq-input").style.display="none",e.undo(),t.preventDefault()})),keyboardJS.bind(["ctrl + shift > z","command + shift > z","command > y","ctrl > y"],(function(t){document.querySelector(".seq-mult-textarea").style.display="none",document.querySelector(".seq-input").style.display="none",e.redo(),t.preventDefault()})),keyboardJS.bind(["command > s","ctrl > s"],(function(t){t.preventDefault()}))}return Object(k["a"])(t,[{key:"emit",value:function(t){for(var e,i,o,n,a,s,r,c,l,d,u,h,f,g,p,m,y,v,w=arguments.length,x=new Array(w>1?w-1:0),C=1;C<w;C++)x[C-1]=arguments[C];switch(t){case S.ADD_LIFELINE:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:S.DELETE_LIFELINE,payload:[x[0].id,x[1]]}),this.updateUndoRedo(t,x)),(e=diagramStore).addLifeline.apply(e,x);break;case S.DELETE_LIFELINE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var b=diagramStore.baseData.lifelineList.find((function(t){return t.id===x[0]}));b.x=b.lifeline.x,this.undoRedo.undoStack.push({actionType:S.ADD_LIFELINE,payload:[b,x[1]]}),this.updateUndoRedo(t,x)}(i=diagramStore).deleteLifeline.apply(i,x);break;case S.MODIFY_LIFELINE_NAME:if(!this.lockUndoRodoStack){this.resetUndoRedo();var I=diagramStore.baseData.lifelineList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MODIFY_LIFELINE_NAME,payload:[x[0],I.text,x[2]]}),this.updateUndoRedo(t,x)}(o=diagramStore).updateLifelineText.apply(o,x);break;case S.ADD_MSG:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:S.DELETE_MSG,payload:[x[0].id]}),this.updateUndoRedo(t,x)),(n=diagramStore).addMsg.apply(n,x);break;case S.DELETE_MSG:if(!this.lockUndoRodoStack){this.resetUndoRedo();var M=diagramStore.baseData.msgList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.ADD_MSG,payload:[M]}),this.updateUndoRedo(t,x)}(a=diagramStore).deleteMsg.apply(a,x);break;case S.MODIFY_MSG_NAME:if(!this.lockUndoRodoStack){this.resetUndoRedo();var k=diagramStore.baseData.msgList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MODIFY_MSG_NAME,payload:[k.id,k.text]}),this.updateUndoRedo(t,x)}(s=diagramStore).updateMsgContentAndArgs.apply(s,x);break;case S.MOVE_LIFELINE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var D=diagramStore.baseData.lifelineList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MOVE_LIFELINE,payload:[D.id,D.x]}),this.updateUndoRedo(t,x)}(r=diagramStore).updateLifelineX.apply(r,x);break;case S.MOVE_MSG:if(!this.lockUndoRodoStack){this.resetUndoRedo();var N=diagramStore.baseData.msgList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MOVE_MSG,payload:[N.id,N.time]}),this.updateUndoRedo(t,x)}(c=diagramStore).updateArrowTime.apply(c,x);break;case S.ADD_FRAGMENT:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:S.DELETE_FRAGMENT,payload:[x[0].id,x[1]]}),this.updateUndoRedo(t,x)),(l=diagramStore).addFragment.apply(l,x);break;case S.DELETE_FRAGMENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var A=diagramStore.baseData.fragmentList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.ADD_FRAGMENT,payload:[A]}),this.updateUndoRedo(t,x)}(d=diagramStore).deleteFragment.apply(d,x);break;case S.MODIFY_FRAGMENT_RECT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var L=diagramStore.baseData.fragmentList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MODIFY_FRAGMENT_RECT,payload:[L.id,L.x,L.y,L.width,L.height]}),this.updateUndoRedo(t,x)}(u=diagramStore).updateFragmentRect.apply(u,x);break;case S.CHANGE_LIFELINE_TYPE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var T=diagramStore.baseData.lifelineList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.CHANGE_LIFELINE_TYPE,payload:[T.id,T.type]}),this.updateUndoRedo(t,x)}(h=diagramStore).changeLifelineType.apply(h,x);break;case S.ADD_NOTE:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:S.DELETE_NOTE,payload:[x[0].id]}),this.updateUndoRedo(t,x)),(f=diagramStore).addNote.apply(f,x);break;case S.DELETE_NOTE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var E=diagramStore.baseData.noteList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.ADD_NOTE,payload:[E,x[1]]}),this.updateUndoRedo(t,x)}(g=diagramStore).deleteNote.apply(g,x);break;case S.MOVE_NOTE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var O=diagramStore.baseData.noteList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MOVE_NOTE,payload:[O.id,O.x,O.y]}),this.updateUndoRedo(t,x)}(p=diagramStore).updateNotePosition.apply(p,x);break;case S.MODIFY_NOTE_CONTENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var j=diagramStore.baseData.noteList.find((function(t){return t.id===x[0]}));this.undoRedo.undoStack.push({actionType:S.MODIFY_NOTE_CONTENT,payload:[j.id,j.text]}),this.updateUndoRedo(t,x)}(m=diagramStore).updateNoteContent.apply(m,x);break;case S.ADD_NOTE_CONN:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:S.DELETE_NOTE_CONN,payload:x}),this.updateUndoRedo(t,x)),(y=diagramStore).addNoteConn.apply(y,x);break;case S.DELETE_NOTE_CONN:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:S.ADD_NOTE_CONN,payload:x}),this.updateUndoRedo(t,x)),(v=diagramStore).deleteNoteConn.apply(v,x);break}}},{key:"clearUndoRedo",value:function(){this.undoRedo.reset(),this.updateButton()}},{key:"resetUndoRedo",value:function(){this.undoRedo.undoIndex+1<this.undoRedo.undoStack.length&&(this.undoRedo.undoStack.length=this.undoRedo.undoIndex+1,this.undoRedo.redoStack.length=this.undoRedo.undoStack.length)}},{key:"updateUndoRedo",value:function(t,e){this.undoRedo.redoStack.push({actionType:t,payload:e}),this.undoRedo.undoIndex=this.undoRedo.undoStack.length-1,this.undoRedo.redoStack.length=this.undoRedo.undoStack.length,this.undoRedo.redoIndex=this.undoRedo.undoIndex+1,this.updateButton()}},{key:"updateButton",value:function(){this.undoRedo.undoStack.length>0&&this.undoRedo.undoIndex>-1?Oe.state.isUndoDisabled=!1:Oe.state.isUndoDisabled=!0,this.undoRedo.redoStack.length>0&&this.undoRedo.redoIndex>-1&&this.undoRedo.redoIndex<this.undoRedo.redoStack.length?Oe.state.isRedoDisabled=!1:Oe.state.isRedoDisabled=!0}},{key:"undo",value:function(){if(!Oe.state.isUndoDisabled){var t=this.undoRedo.undoStack[this.undoRedo.undoIndex];this.undoRedo.redoIndex=this.undoRedo.undoIndex,this.undoRedo.undoIndex--,this.lockUndoRodoStack=!0,this.emit.apply(this,[t.actionType].concat(Object(I["a"])(t.payload))),this.lockUndoRodoStack=!1,this.updateButton()}}},{key:"redo",value:function(){if(!Oe.state.isRedoDisabled){var t=this.undoRedo.redoStack[this.undoRedo.redoIndex];this.undoRedo.redoIndex++,this.undoRedo.undoIndex++,this.lockUndoRodoStack=!0,this.emit.apply(this,[t.actionType].concat(Object(I["a"])(t.payload))),this.lockUndoRodoStack=!1,this.updateButton()}}}]),t}(),Pe=new je;i("3b2b");function ze(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=i.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}var Re=i("bc3a"),Be=i.n(Re),Ge={props:{diagramName:String,menus:Array},data:function(){var t=ze("tag");return{visible:!1,nameForm:{name:this.diagramName},isConfluence:t&&t.includes("iwiki"),layoutType:0,name:"XIDE",state:Oe.state,mapping:{8:"Actor",9:"Object",10:"Boundary Object",11:"Entity Object",12:"Control Object",13:"Business Worker",14:"Business Entity",19:"Business Actor"},xwattBaseUrl:"//xwatt.wxp.oa.com/node/ad-tools",saving:!1}},mounted:function(){var t=this;window.addEventListener("message",(function(e){var i=e.data.type,o=e.data.diagramType;"seq"===o&&"xwatt_iframe:save_done"===i&&(t.saving=!1,Oe.hideLoading(),t.$refs["nameForm"]&&t.$refs["nameForm"].resetFields())}))},computed:{allowSharedElementList:function(){var t,e={13:1,14:1,19:1},i={8:1,10:1,11:1,12:1},o={9:1};0===Oe.state.currentSeqType?t=this.state.sharedElementList.filter((function(t){return e[t.Type]})):1===Oe.state.currentSeqType?t=this.state.sharedElementList.filter((function(t){return i[t.Type]})):2===Oe.state.currentSeqType&&(t=this.state.sharedElementList.filter((function(t){return o[t.Type]})));var n=[],a={};return t.forEach((function(t){a[t.UUId]||(n.push(t),a[t.UUId]=1)})),n}},methods:{undo:function(){this.state.isUndoDisabled||Pe.undo()},redo:function(){this.state.isRedoDisabled||Pe.redo()},help:function(){Oe.state.selectedElementType="help",Oe.openRightPanel()},downLoadPng:function(){Se.unSelectAll();var t=30,e=Se.getBound();e.width+=2*t,e.height+=2*t,Oe.closeRightPanel(),Oe.showLoading("下载中..");var i=document.createElement("canvas"),o=i.getContext("2d"),n=Se.stage.el.cloneNode(!0);n.setAttribute("width",2*e.width),n.setAttribute("height",2*e.height),n.setAttribute("width",n.getAttribute("width")),n.setAttribute("height",n.getAttribute("height"));var a=canvg.Canvg.fromString(o,n.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(t,'" y="-').concat(t,'" width="').concat(e.left+e.width,'" height="').concat(e.top+e.height,'" fill="white"/>')),{scaleWidth:2*n.getAttribute("width"),scaleHeight:2*n.getAttribute("height"),offsetX:-e.left+t,offsetY:-e.top+t});a.start(),setTimeout((function(){var t=document.createElement("a");t.href=i.toDataURL("image/png"),t.download="seq.png",t.click(),Oe.hideLoading()}),1e3)},dragStart:function(t,e,i){var o=this;this._isMouseDown=!0,this.dupNode=t.currentTarget.cloneNode(!0),this.dupNode.style.position="fixed",this._preType=e,this._preTarget=t.currentTarget,this.dupNode.style.pointerEvents="none",document.body.appendChild(this.dupNode),document.addEventListener("mousemove",this._mouseMove),this._mouseUpWp=function(t){o._mouseUp(t,i)},document.addEventListener("mouseup",this._mouseUpWp),this._preX=t.clientX,this._preY=t.clientY},_mouseMove:function(t){this._isMouseDown&&(this._preTarget.style.cursor="move",this.dupNode.style.left=t.pageX+"px",this.dupNode.style.top=t.pageY+"px")},_mouseUp:function(t,e){this._isMouseDown&&(Math.abs(t.clientX-this._preX)>10||Math.abs(t.clientY-this._preY)>10)&&(document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUpWp),this._preTarget.style.cursor="pointer",this._isInSVG(t.srcElement)&&(Oe.state.diagScrollLeft=document.querySelector(".sving-root").scrollLeft,this.addObj(this._preType,t.pageX+Oe.state.diagScrollLeft,t.pageY-110+Oe.state.diagScrollTop,e))),this._isMouseDown=!1,this.dupNode&&(document.body.removeChild(this.dupNode),this.dupNode=null)},addObj:function(t,e,i,o,n){this.addNewObj(t,e,i,n)},addNewObj:function(t,e,i,o){if(Oe.state.currentX=e,Oe.state.currentY=i,"Fragment"===t){var n={id:Object(b["a"])(),text:"输入片段名",type:"alt",conditions:[],conditionValue:[]};"number"===typeof e&&(n.x=e,n.y=i),Pe.emit(S.ADD_FRAGMENT,n),setTimeout((function(){Se.editFragmentName(n.id)}),20)}else if("Note"===t){var a={id:Object(b["a"])(),text:"备注内容",width:100,height:100};"number"===typeof e&&(a.x=e,a.y=i),Pe.emit(S.ADD_NOTE,a)}else{var s=Object(b["a"])(),r={id:s,key:s,text:t,type:t,duration:20};"number"===typeof e&&(r.x=e-100),Pe.emit(S.ADD_LIFELINE,r,o),setTimeout((function(){Se.editLifelineName(s)}),20)}},_isInSVG:function(t){return!!t&&("svg"===t.nodeName||this._isInSVG(t.parentNode))},onCancel:function(){window.parent.postMessage({type:"xwatt_iframe:close"},"*")},onSave:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){var e,i,o,n,a,s,r,c,l=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return Se.unSelectAll(),e=30,i=Se.getBound(),i.width+=2*e,i.height+=2*e,Oe.closeRightPanel(),Oe.showLoading("保存中.."),o=document.createElement("canvas"),n=o.getContext("2d"),a=Se.stage.el.cloneNode(!0),a.setAttribute("width",2*i.width),a.setAttribute("height",2*i.height),a.setAttribute("width",a.getAttribute("width")),a.setAttribute("height",a.getAttribute("height")),s=canvg.Canvg.fromString(n,a.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(e,'" y="-').concat(e,'" width="').concat(i.left+i.width,'" height="').concat(i.top+i.height,'" fill="white"/>')),{scaleWidth:2*a.getAttribute("width"),scaleHeight:2*a.getAttribute("height"),offsetX:-i.left+e,offsetY:-i.top+e}),t.next=17,s.render();case 17:r=Se.getJSONData(),r.diagramName=this.nameForm.name||this.diagramName,r.fromIwiki=!0,r.subType=this.state.currentSeqType,window.parent.postMessage({type:"xwatt_iframe:save",renderData:r,picData:o.toDataURL("image/png"),diagramType:"seq",width:i.width},"*"),this.visible=!1,this.saving=!0,setTimeout((function(){l.saving&&(l.saving=!1,Oe.hideLoading(),l.$message({type:"warning",message:"保存超时，请重试！"}))}),3e4),c=["业务时序图","分析时序图","设计时序图"],aegis.reportEvent({name:"序列图保存",ext1:c[this.state.currentSeqType],ext2:this.nameForm.name||this.diagramName}),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-save-seq"});case 28:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleShow:function(){this.$refs["nameForm"].resetFields(),this.$refs["diagramNameInput"].focus()},upload2Xwatt:function(t){var e=this,i=Se.getJSONData();i.diagramName=t,i.fromIwiki=!0,i.subType=this.state.currentSeqType;var o={XWModelDiagramPo:{InstanceId:0,ModelId:0,Name:t,ExtendJSONData:JSON.stringify(i),DiagramUUId:Object(b["a"])(),Subtype:this.state.currentSeqType}};Oe.showLoading(),Be()({url:"".concat(this.xwattBaseUrl,"/createSeqDiagram"),method:"POST",data:o,withCredentials:!0}).then((function(t){var i=t.status,o=t.data;if(200!==i||0!==o.code)throw Error("[XWATT] Response With Code ".concat(o.code));console.log("[XWATT] Send to XWatt Success, ret:",o),e.$message({type:"success",message:"上传成功"})})).catch((function(t){console.error("[XWATT] Request XWATT Failed, err:",t),e.$message({type:"error",message:"上传失败，错误：".concat(t.message)})})).finally((function(){Oe.hideLoading()}))},openMessageBox:function(){var t=this;this.$prompt("请输入序列图名称","序列图上传至 XWATT",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){return null!==t&&""!==t},inputErrorMessage:"命名不能为空"}).then((function(e){var i=e.value;Oe.showLoading("上传中.."),t.upload2Xwatt(i),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-upload-seq"})})).catch((function(t){console.log(t)}))}}},_e=Ge,Fe=(i("ce53"),Object(c["a"])(_e,w,x,!1,null,"442c2038",null)),Ue=Fe.exports,Ze=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"props-panel",style:"width:"+(t.isClosed?0:300)+"px"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isClosed,expression:"!isClosed"}],staticClass:"props-panel-content"},["lifeline"===t.state.selectedElementType?i("LifelinePropsPanel"):t._e(),"msg"===t.state.selectedElementType?i("MsgPropsPanel"):t._e(),"fragment"===t.state.selectedElementType?i("FragmentPropsPanel"):i("HelpPanel")],1),i("div",{class:{"menu-unfoldbox":!0,closed:this.isClosed},on:{click:t.toggle}},[i("svg",{attrs:{"aria-hidden":"true","data-icon":"left","data-v-35e7d322":"",fill:"white",focusable:"false",height:"1em",viewBox:"64 64 896 896",width:"1em"}},[i("path",{attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z","data-v-35e7d322":""}})])])])},Ye=[],He=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"生命线信息"}},[i("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"80px"}},[i("el-form-item",{attrs:{label:"对象名称"}},[i("el-input",{ref:"nameInput",attrs:{rows:3,type:"textarea"},on:{blur:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addObjectForm.name,callback:function(e){t.$set(t.storeState.addObjectForm,"name",e)},expression:"storeState.addObjectForm.name"}})],1),i("el-form-item",{attrs:{label:"对象类型"}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeLifelineType},model:{value:t.storeState.addObjectForm.type,callback:function(e){t.$set(t.storeState.addObjectForm,"type",e)},expression:"storeState.addObjectForm.type"}},[i("el-option",{attrs:{label:"Actor",value:"Actor"}}),i("el-option",{attrs:{label:"Business Actor",value:"Business Actor"}}),i("el-option",{attrs:{label:"Object",value:"Object"}}),i("el-option",{attrs:{label:"Boundary Object",value:"Boundary Object"}}),i("el-option",{attrs:{label:"Control Object",value:"Control Object"}}),i("el-option",{attrs:{label:"Entity Object",value:"Entity Object"}}),i("el-option",{attrs:{label:"Business Worker",value:"Business Worker"}}),i("el-option",{attrs:{label:"Business Entity",value:"Business Entity"}})],1)],1),t.storeState.addObjectForm.classList.length>0?i("el-form-item",{attrs:{label:"对象的类"}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.ok},model:{value:t.storeState.addObjectForm.classId,callback:function(e){t.$set(t.storeState.addObjectForm,"classId",e)},expression:"storeState.addObjectForm.classId"}},t._l(t.storeState.addObjectForm.classList,(function(t){return i("el-option",{key:t.ClassUUId,attrs:{label:t.Name,value:t.ClassUUId}})})),1)],1):t._e()],1)],1)],1)],1)},Ve=[],Qe={components:{ColorPicker:K},mounted:function(){var t=this;document.addEventListener("click",(function(){t.showColorPicker=!1}))},methods:{toggleColorPicker:function(t){this.showColorPicker=!this.showColorPicker,t.stopPropagation()},colorChange:function(t,e){Oe.state.addObjectForm.color=t,this.colors.hex=t,this.showColorPicker=!1},customColorChange:function(){Oe.state.addObjectForm.color=color,this.colors.hex=color},updateHistoryColor:function(){Oe.mergeHistoryColor(Oe.state.addObjectForm.color)},onInputKeyUp:function(t){t.stopPropagation()},handleClose:function(){this.showColorPicker=!1,this.storeState.addObjectDialogShow=!1},cancel:function(){this.showColorPicker=!1,this.storeState.addObjectDialogShow=!1},changeLifelineType:function(){Pe.emit(S.CHANGE_LIFELINE_TYPE,this.storeState.addObjectForm.id,this.storeState.addObjectForm.type)},ok:function(){Se.updateLifeline(this.storeState.addObjectForm)},classChange:function(t){}},data:function(){return{showColorPicker:!1,historyColors:Oe.state.historyColors,colors:{hex:Oe.state.addObjectForm.color},storeState:Oe.state,options:[],value:""}},updated:function(){},watch:{"storeState.addObjectDialogShow":function(t){t||(this.storeState.addObjectForm.color=config.fill)}}},We=Qe,Xe=(i("13ad"),Object(c["a"])(We,He,Ve,!1,null,"01a34b8d",null)),Je=Xe.exports,$e=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"消息名称"}},[i("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"80px"}},[i("el-form-item",{attrs:{label:"消息名称"}},[i("el-input",{ref:"nameInput",on:{blur:t.ok},nativeOn:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$store.saveMsg.apply(null,arguments)}]},model:{value:t.storeState.addMsgForm.name,callback:function(e){t.$set(t.storeState.addMsgForm,"name",e)},expression:"storeState.addMsgForm.name"}})],1),i("el-form-item",{attrs:{label:"消息参数"}},[i("el-input",{on:{blur:t.ok},nativeOn:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$store.saveMsg.apply(null,arguments)}]},model:{value:t.storeState.addMsgForm.args,callback:function(e){t.$set(t.storeState.addMsgForm,"args",e)},expression:"storeState.addMsgForm.args"}})],1),i("el-form-item",{attrs:{label:"消息类型"}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.ok},model:{value:t.storeState.addMsgForm.type,callback:function(e){t.$set(t.storeState.addMsgForm,"type",e)},expression:"storeState.addMsgForm.type"}},[i("el-option",{attrs:{label:"同步",value:"sync"}}),i("el-option",{attrs:{label:"异步",value:"async"}})],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"Is Return"}},[i("el-switch",{on:{change:t.ok},model:{value:t.storeState.addMsgForm.isReturn,callback:function(e){t.$set(t.storeState.addMsgForm,"isReturn",e)},expression:"storeState.addMsgForm.isReturn"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"新消息组"}},[i("el-switch",{on:{change:t.ok},model:{value:t.storeState.addMsgForm.isNewMessageGroup,callback:function(e){t.$set(t.storeState.addMsgForm,"isNewMessageGroup",e)},expression:"storeState.addMsgForm.isNewMessageGroup"}})],1)],1)],1),i("el-form-item",{attrs:{label:"消息Level"}},[i("el-input-number",{ref:"inputNumber",attrs:{max:t.storeState.addMsgForm.maxLevel,min:0},on:{change:t.ok},model:{value:t.storeState.addMsgForm.level,callback:function(e){t.$set(t.storeState.addMsgForm,"level",e)},expression:"storeState.addMsgForm.level"}})],1)],1)],1)],1)],1)},Ke=[],qe=[{value:"string"},{value:"int"},{value:"boolean"},{value:"byte"},{value:"char"},{value:"float"},{value:"double"},{value:"long"},{value:"short"}],ti=([{value:"void"}].concat(qe),["private","public","protected"]),ei={private:0,public:1,protected:2},ii={components:{ColorPicker:K},mounted:function(){var t=this;document.addEventListener("click",(function(){t.showColorPicker2=!1,t.showColorPicker=!1}));var e=this.$refs.inputNumber.$el.querySelector("input");e.addEventListener("keyup",(function(t){t.stopPropagation()})),e.setAttribute("readonly","readonly")},methods:{chooseOperation:function(t){this.$refs["popover-oper"].doClose(),this.storeState.addMsgForm.name=t.Name,this.storeState.addMsgForm.classMethodId=t.MethodUUId},addOperation:function(){},deleteOperation:function(){},updateOperation:function(t){var e=t.MethodUUId,i=t.Name,o=t.ReturnType,n=t.Scope;updateClassMethod(e,{Name:i,ReturnType:o,Scope:ei[n]})},findClassMethodByClassUUId:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){var t=this,e=Se.getMsgClassUUId(this.storeState.addMsgForm.id);findClassMethodByClassUUId(e).then((function(e){e.XWModelClassMethodPoList.forEach((function(t){t.Scope=["pirvate","public","protected"][t.Scope]})),t.classMethodList=e.XWModelClassMethodPoList}))})),toggleColorPicker:function(t){this.colors.hex=this.storeState.addMsgForm.textColor,this.showColorPicker=!this.showColorPicker,this.showColorPicker2=!1,t.stopPropagation()},toggleColorPicker2:function(t){this.colors.hex=this.storeState.addMsgForm.arrowColor,this.showColorPicker=!1,this.showColorPicker2=!this.showColorPicker2,t.stopPropagation()},colorChange:function(t){Oe.state.addMsgForm.textColor=t,this.colors.hex=t,this.showColorPicker=!1},customColorChange:function(t){Oe.state.addMsgForm.textColor=t,this.colors.hex=t},arrowColorChange:function(t,e){Oe.state.addMsgForm.arrowColor=t,this.colors.hex=t,this.showColorPicker2=!1},arrowCustomColorChange:function(t,e){Oe.state.addMsgForm.arrowColor=t,this.colors.hex=t},updateHistoryColor:function(){Oe.mergeHistoryColor(Oe.state.addMsgForm.arrowColor),Oe.mergeHistoryColor(Oe.state.addMsgForm.textColor)},onInputKeyUp:function(t){t.stopPropagation()},handleClose:function(){this.showColorPicker=!1,this.showColorPicker2=!1,this.storeState.addMsgDialogShow=!1},cancel:function(){this.showColorPicker=!1,this.showColorPicker2=!1,this.storeState.addMsgDialogShow=!1},addCondition:function(){},ok:function(){this.updateHistoryColor(),Se.updateMsg(this.storeState.addMsgForm),this.showColorPicker=!1,this.showColorPicker2=!1,this.storeState.addMsgDialogShow=!1}},data:function(){return{MODIFIER_LIST:ti,showColorPicker2:!1,showColorPicker:!1,historyColors:Oe.state.historyColors,colors:{hex:Oe.state.addMsgForm.textColor},storeState:Oe.state,options:[],value:"",classMethodList:[]}},watch:{"storeState.addMsgDialogShow":function(t){var e=this;t||(this.storeState.addMsgForm.textColor=config.stroke),this.$nextTick((function(){e.$refs.nameInput.focus()}))}}},oi=ii,ni=(i("c8d6"),Object(c["a"])(oi,$e,Ke,!1,null,"254b7fbe",null)),ai=ni.exports,si=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"Fragment信息"}},[i("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"40px"}},[i("el-form-item",{attrs:{label:"名称"}},[i("el-input",{on:{blur:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addFragmentForm.name,callback:function(e){t.$set(t.storeState.addFragmentForm,"name",e)},expression:"storeState.addFragmentForm.name"}})],1),i("el-form-item",{attrs:{label:"类型"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"请选择"},on:{change:t.ok},model:{value:t.storeState.addFragmentForm.type,callback:function(e){t.$set(t.storeState.addFragmentForm,"type",e)},expression:"storeState.addFragmentForm.type"}},[i("el-option",{attrs:{label:"alt",value:"alt"}}),i("el-option",{attrs:{label:"opt",value:"opt"}}),i("el-option",{attrs:{label:"break",value:"break"}}),i("el-option",{attrs:{label:"par",value:"par"}}),i("el-option",{attrs:{label:"loop",value:"loop"}}),i("el-option",{attrs:{label:"critical",value:"critical"}}),i("el-option",{attrs:{label:"neg",value:"neg"}}),i("el-option",{attrs:{label:"assert",value:"assert"}}),i("el-option",{attrs:{label:"strict",value:"strict"}}),i("el-option",{attrs:{label:"seq",value:"seq"}}),i("el-option",{attrs:{label:"ignore",value:"ignore"}}),i("el-option",{attrs:{label:"consider",value:"consider"}})],1)],1),i("el-form-item",{attrs:{label:"分支"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{"allow-create":"","default-first-option":"",filterable:"",multiple:"",placeholder:"请选择或创建分支"},on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addFragmentForm.conditionValue,callback:function(e){t.$set(t.storeState.addFragmentForm,"conditionValue",e)},expression:"storeState.addFragmentForm.conditionValue"}},t._l(t.options,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1)],1)],1)},ri=[],ci={name:"add-fragment-dialog",use:["addFragmentDialogShow","addFragmentForm"],methods:{onInputKeyUp:function(t){t.stopPropagation()},handleClose:function(){this.reset(),this.storeState.addFragmentDialogShow=!1},reset:function(){this.storeState.addFragmentForm.id=null,this.storeState.addFragmentForm.name="",this.storeState.addFragmentForm.type="",this.storeState.addFragmentForm.conditions=[],this.storeState.addFragmentForm.conditionValue=[]},cancel:function(){this.reset(),this.storeState.addFragmentDialogShow=!1},addCondition:function(){},ok:function(){this.storeState.addFragmentDialogShow=!1,this.storeState.addFragmentForm.id?diagramStore.updateFragment(this.storeState.addFragmentForm):(diagramStore.addFragment({id:Object(b["a"])(),text:this.storeState.addFragmentForm.name,type:this.storeState.addFragmentForm.type,conditions:this.storeState.addFragmentForm.conditions,conditionValue:this.storeState.addFragmentForm.conditionValue}),this.reset())}},data:function(){return{storeState:Oe.state,options:[{value:"成功",label:"成功"},{value:"失败",label:"失败"}]}}},li=ci,di=(i("3db3"),Object(c["a"])(li,si,ri,!1,null,"1dbe18c9",null)),ui=di.exports,hi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-info"},[i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{staticStyle:{padding:"10px"},attrs:{label:"基本信息"}},[i("div",{staticClass:"diagram-info-base"},[i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布宽度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v("1000")])]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布高度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v("1000")])]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("消息序号")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-switch",{on:{change:t.save},model:{value:t.state.diagramInfo.hasMsgNumber,callback:function(e){t.$set(t.state.diagramInfo,"hasMsgNumber",e)},expression:"state.diagramInfo.hasMsgNumber"}})],1)]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("主题色")]),i("div",{staticClass:"diagram-info-base-item-value-color"},[i("div",{staticClass:"section-content"},[i("div",{staticClass:"color_picker"},[i("div",{staticClass:"msg-text-color",style:"background:"+t.color,on:{click:t.toggleColorPicker}}),i("ColorPicker",{directives:[{name:"show",rawName:"v-show",value:t.isShowColorPicker,expression:"isShowColorPicker"}],staticClass:"sketch-picker-obj",attrs:{color:t.color,historyColors:t.historyColors},on:{"color-change":t.colorChange,"custom-color-change":t.customColorChange,mousedown:function(t){return t.stopPropagation()}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowColorPicker,expression:"isShowColorPicker"}],staticClass:"color_layer",on:{click:t.toggleColorPicker}})])])])])])],1)],1)])},fi=[],gi={data:function(){return{state:Oe.state,historyColors:Oe.state.historyColors,isShowColorPicker:!1,color:Oe.state.seqConfig.fill}},components:{ColorPicker:K},methods:{save:function(){Se.refreshData()},toggleColorPicker:function(){this.isShowColorPicker=!this.isShowColorPicker},customColorChange:function(t){this.color=t,Oe.state.seqConfig.fill=t,Se.refreshData(),clearTimeout(this.inDebounce),this.inDebounce=setTimeout((function(){Oe.mergeHistoryColor(t)}),600)},colorChange:function(t){this.isShowColorPicker=!1,this.color=t,Oe.state.seqConfig.fill=t,Oe.mergeHistoryColor(t),Se.refreshData()},onDocMouseDown:function(){this.isShowColorPicker=!1}},mounted:function(){this._onDocMouseDown=this.onDocMouseDown.bind(this),document.addEventListener("mousedown",this._onDocMouseDown)},beforeDestroy:function(){document.removeEventListener("mousedown",this._onDocMouseDown)}},pi=gi,mi=(i("b3bc"),Object(c["a"])(pi,hi,fi,!1,null,"62b57c1e",null)),yi=mi.exports,vi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"操作帮助"}},[i("ul",{staticClass:"help-list"},[i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么创建消息","https://wx.gtimg.com/resource/feuploader/202109/3c9d5633ada248909b1c6e353af15fcc_1042x978.gif","500px")}}},[t._v("怎么创建生命线和消息")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么创建自返消息","https://wx.gtimg.com/resource/feuploader/202109/7548994de65f3679c804ebc9855bb3c2_1042x978.gif","500px")}}},[t._v("怎么创建自返消息")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么创建Fragment条件","https://wx.gtimg.com/resource/feuploader/202109/8390c2b173f9bfc65c4fc3c05a1e9150_1024x655.gif","690px")}}},[t._v("怎么创建Fragment条件")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么修改颜色和字体大小","https://wx.gtimg.com/resource/feuploader/202109/6f2f9952af11cf8b60ff4aa94aec02c6_800x788.gif","500px")}}},[t._v("怎么修改颜色和字体大小")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么修改Fragment属性、位置和大小","https://wx.gtimg.com/resource/feuploader/202109/4daa8843e0ab20578d3ab40adb5a41d5_900x887.gif","500px")}}},[t._v("怎么修改Fragment属性、位置和大小")])],1)])])],1),i("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:t.width},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{src:this.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("学会了")])],1)]),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202104/830e68e99d7b7dbb20155390b86d1fdb_451x403.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202104/8812d8771e32497f62a9e5e175788634_451x403.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202104/cc6d18facaaef4991e666c4e7514ebf6_949x449.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202104/cf9848ebe5c0bd5fa16e33f4adbf5395_576x449.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202104/47235673b47342ea6778d1955fbf44b5_576x449.gif"}})],1)},wi=[],xi={data:function(){return{title:"",dialogVisible:!1,gifUrl:"",width:"800px"}},methods:{showDialog:function(t,e,i){this.width=i,this.dialogVisible=!0,this.title=t,this.gifUrl=e}}},Ci=xi,bi=(i("ed56"),Object(c["a"])(Ci,vi,wi,!1,null,"07bc8744",null)),Ii=bi.exports,Mi={components:{LifelinePropsPanel:Je,MsgPropsPanel:ai,FragmentPropsPanel:ui,DiagramPropsPanel:yi,HelpPanel:Ii},data:function(){return{state:Oe.state,isClosed:!1}},methods:{toggle:function(){this.isClosed=!this.isClosed}},mounted:function(){var t=this;Oe.openRightPanel=function(){t.isClosed=!1},Oe.closeRightPanel=function(){t.isClosed=!0}}},ki=Mi,Si=(i("6d84"),Object(c["a"])(ki,Ze,Ye,!1,null,"03176033",null)),Di=Si.exports;function Ni(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Ai(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ni(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ni(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Li={name:"SeqDiagram",methods:{onScroll:function(t){this.state.diagScrollLeft=t.currentTarget.scrollLeft,this.state.diagScrollTop=t.currentTarget.scrollTop},filterNode:function(){},handleNodeClick:function(){},nodeExpand:function(){},nothingTodo:function(){},objOk:function(){},msgOk:function(){},cancel:function(){},saveMySeqDiag:function(t){},onInputKeyUp:function(t){t.stopPropagation()},setToTop:function(t,e){e.stopPropagation(),t.SetToTop=1,this.options.mySeqDiagList.splice(this.options.mySeqDiagList.indexOf(t),1),this.options.mySeqDiagList.unshift(t),setSeqDiagTop(t.DiagramId)},cancelSetToTop:function(t,e){e.stopPropagation(),t.SetToTop=0,this.options.mySeqDiagList.splice(this.options.mySeqDiagList.indexOf(t),1),this.options.mySeqDiagList.push(t),cancelSeqDiagTop(t.DiagramId)},initSeq:function(t){var e=this;console.error(t),t.msgList.forEach((function(t){delete t.prevMsgId,delete t.nextMsgId,delete t.svingArrow,delete t.used,delete t.isRoot,delete t.msgId,delete t.svingArrow})),t.lifelineList.forEach((function(t){delete t.lifeline})),Se.initProps(),this.stage=new sving.Stage(this.$refs.svingRoot,2e3,4*window.innerHeight);var i=this.stage;if(i.on("click",(function(){Se.unSelectAll(),Oe.state.selectedElementType="diagram"})),Se.stage=i,t){__ac.gen(t),Se.baseData=t;var o=new be(t,{},i,!0);console.log(i),o.group.x=40,o.group.y=100,Se.sd=o,Se.linkline=new sving.Line(0,0,0,0),Se.linkline.el.style.pointerEvents="none",Se.linkline.setAttrs({stroke:"#111","stroke-dasharray":"5,5"}),i.add(Se.linkline),Se.initConnectLine(),Se.initNoteArrow();var n=new sving.Path("M479.046,283.925c-1.664-3.989-5.547-6.592-9.856-6.592H352.305V10.667C352.305,4.779,347.526,0,341.638,0H170.971 c-5.888,0-10.667,4.779-10.667,10.667v266.667H42.971c-4.309,0-8.192,2.603-9.856,6.571c-1.643,3.989-0.747,8.576,2.304,11.627 l212.8,213.504c2.005,2.005,4.715,3.136,7.552,3.136s5.547-1.131,7.552-3.115l213.419-213.504 C479.793,292.501,480.71,287.915,479.046,283.925z");n.scale=.03,n.rotation=180,n.setAttrs({fill:"white",stroke:"black","stroke-width":"15","pointer-events":"bounding-box"}),n.opacity=0,n.cursor="pointer",n.on("mousedown",(function(t){n.opacity=0,Se.isDraggingArrow=!0,Se.lifelineGroupList[Se.selectedIndex].selectBorder.setAttrs({stroke:"#5AB3EC"}),t.stopPropagation()})),Se.arrow=n,i.add(n),window.stage=i;var a=new sving.Group;i.add(a),Oe.fragmentGroup=a,i.el.addEventListener("mouseup",(function(t){if(Se.isDraggingArrow&&Se.lifelineGroupList[Se.selectedIndex])if(Se.lifelineGroupList[Se.targetIndex]){var i=Se.addMsgByDragAction((t.clientY-Se.clientRect.top-Se.stage.children[0].y-10)/config.durationLength);Se.editMsgName(i),e.setNormal()}else{var o=parseInt(Se.linkline.el.getAttribute("x2")),n=t.clientY;Se.isDraggingArrow=!1;var a=Oe.state.currentSeqType;setTimeout((function(){window.contextMenu({items:[[1,2].includes(a)&&{label:"Actor",onClick:function(){return e.addLifelineAndMsg("Actor",o,n)}},[2].includes(a)&&{label:"Object",onClick:function(){return e.addLifelineAndMsg("Object",o,n)},divided:!0},[1].includes(a)&&{label:"Boundary",onClick:function(){return e.addLifelineAndMsg("Boundary Object",o,n)}},[1].includes(a)&&{label:"Control",onClick:function(){return e.addLifelineAndMsg("Control Object",o,n)}},[1].includes(a)&&{label:"Entity",onClick:function(){return e.addLifelineAndMsg("Entity Object",o,n)},divided:!0},[0].includes(a)&&{label:"Business Actor",onClick:function(){return e.addLifelineAndMsg("Business Actor",o,n)}},[0].includes(a)&&{label:"Business Worker",onClick:function(){return e.addLifelineAndMsg("Business Worker",o,n)}},[0].includes(a)&&{label:"Business Entity",onClick:function(){return e.addLifelineAndMsg("Business Entity",o,n)},divided:!0},{label:"取消",onClick:function(){e.setNormal()}}],event:t})}),1)}else e.setNormal()}));var s=new ClipboardJS(".share-btn");s.on("success",(function(t){console.info("Action:",t.action),console.info("Text:",t.text),console.info("Trigger:",t.trigger),t.clearSelection(),e.$message.closeAll(),e.$message({type:"success",dangerouslyUseHTMLString:!0,message:'复制分享链接成功  <br>  <a target="_blank" href="'.concat(t.text,'">').concat(t.text,"</a>"),showClose:!0,duration:0})})),s.on("error",(function(t){console.error("Action:",t.action),console.error("Trigger:",t.trigger)})),Se.init()}},setNormal:function(){Se.clientRect=null,Se.linkline.opacity=0,Se.isDraggingArrow=!1},addLifelineAndMsg:function(t,e,i){this.$refs.toolbar.addObj(t,e,i,!1,!0),Se.targetIndex=Se.lifelineGroupList.length-1,Se.addMsgByDragAction((i-Se.clientRect.top-Se.stage.children[0].y-10)/config.durationLength),this.setNormal()},clearUnUseMsg:function(t){if(t.msgList)for(var e=function(e,n){var a=t.msgList[e];t.lifelineList.find((function(t){return t.id===a.from}))&&t.lifelineList.find((function(t){return t.id===a.to}))||(t.msgList.splice(e,1),e--,n--),i=e,o=n},i=0,o=t.msgList.length;i<o;i++)e(i,o)}},components:{Toolbar:Ue,PropsPanel:Di},props:{diagramUUId:String,showType:String,subType:Number,renderData:Object},data:function(){return{isClosed:!!ze("projectId"),seqColor:"默认视图",saveMsg:"",contentHeight:window.innerHeight-72,filterText:"",tabPosition:"bottom",state:Oe.state,guide:{title:"怎么创建生命线和消息",dialogVisible:!1,width:"500px",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/3c9d5633ada248909b1c6e353af15fcc_1042x978.gif"}}},computed:{diagramName:function(){return this.renderData.diagramName}},watch:{renderData:function(t){"seq"===this.showType&&(this.$refs.svingRoot.innerHTML="",this.stage.clear(),Oe.state.selectedElementType="diagram",this.initSeq(t))},subType:function(t){Oe.state.currentSeqType=t}},mounted:function(){var t=this;Oe.state.currentSeqType=this.subType,Pe.clearUndoRedo(),Oe.methodMap={},this.state.diagScrollLeft=this.$refs.svingRoot.scrollLeft;var e=Ai({msgList:[],lifelineList:[],fragmentList:[]},this.renderData);this.clearUnUseMsg(e),console.error(e),Oe.state.selectedElementType="diagram",this.initSeq(e),window.addEventListener("resize",(function(){t.contentHeight=window.innerHeight-72})),localStorage.getItem("__xwatt__iwiki__seq__guide__")||(this.guide.dialogVisible=!0,localStorage.setItem("__xwatt__iwiki__seq__guide__",!0))}},Ti=Li,Ei=(i("b759"),Object(c["a"])(Ti,g,p,!1,null,"32617e1c",null)),Oi=Ei.exports,ji=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"class-diagram"})},Pi=[],zi=(i("20d6"),new o["default"]),Ri=i("2ef0"),Bi=i("0d73"),Gi=(i("ac4d"),i("8a81"),i("5df3"),i("1c4c"),i("4917"),i("768b")),_i=i("d5d3"),Fi=i.n(_i),Ui=i("b079"),Zi=i.n(Ui),Yi=window.innerHeight,Hi=window.innerWidth,Vi="#4f4f4f",Qi="12px sans-serif",Wi=25,Xi="#2c3e50",Ji="#0bb955",$i=2,Ki=1,qi="2,2",to="0",eo="#faecd8",io="#2c3e50",oo=6,no=100,ao=86,so=26,ro=25,co=20,lo=5,uo={public:"+",private:"-",protected:"#",default:""},ho=100,fo=100,go=12,po=20,mo={NORMAL:0,DRAG_NEW_STATEMENT:1,DRAG_NEW_TRANSITION:2,ADJUST_STATEMENT_SIZE:3,PAN_STATEMENT:4,PAN_STAGE:5,SHIFT_MULTI_SELECTING:6,FRAME_MULTI_SELECTING:7,PAN_MULTI_STATEMENT:8,AFTER_PAN_MULTI_STATEMENT:9,DRAG_TRANSITION_ENDPOINT:10,ZOOM_STAGE:11},yo=[mo.DRAG_NEW_STATEMENT,mo.DRAG_NEW_TRANSITION,mo.ADJUST_STATEMENT_SIZE,mo.PAN_STAGE,mo.FRAME_MULTI_SELECTING,mo.DRAG_TRANSITION_ENDPOINT,mo.PAN_STATEMENT,mo.PAN_MULTI_STATEMENT,mo.NORMAL],vo={LEFT:1,MIDDLE:2,RIGHT:3},wo={LEFT_TOP:"left-top",RIGHT_TOP:"right-top",LEFT_BOTTOM:"left-bottom",RIGHT_BOTTOM:"right-bottom"},xo=[{value:"function"},{value:"string"},{value:"int"},{value:"boolean"},{value:"byte"},{value:"char"},{value:"float"},{value:"double"},{value:"long"},{value:"short"}],Co=[{value:"void"}].concat(xo),bo=["private","public","protected"],Io=["Generalization","Association","Directed Association","Dependency","Aggregation","Composition","Realization"],Mo={Generalization:"泛化/Generalization",Association:"关联/Association","Directed Association":"单向关联/Directed Association",Dependency:"依赖/Dependency",Aggregation:"聚合/Aggregation",Composition:"组合/Composition",Realization:"实现/Realization"},ko={Generalization:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMCw3IEwgMjIsNyIKICAgIHN0cm9rZS13aWR0aD0iMSIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICA+PC9wYXRoPgogIDxwYXRoCiAgICBkPSJNIDEwLDEgTCAyMiw3IEwgMTAsMTMgTCAxMCwxIFoiCiAgICBzdHJva2Utd2lkdGg9IjEiCiAgICBzdHJva2U9IiMyYzNlNTAiCiAgICBmaWxsPSIjZmFlY2Q4IgogID48L3BhdGg+Cjwvc3ZnPgo=",Association:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMCw3IEwgMjIsNyIKICAgIHN0cm9rZS13aWR0aD0iMiIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICA+PC9wYXRoPgo8L3N2Zz4K","Directed Association":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMTAsMSBMIDIyLDcgTCAxMCwxMyIKICAgIHN0cm9rZS13aWR0aD0iMSIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICAgIGZpbGw9Im5vbmUiCiAgPjwvcGF0aD4KICA8cGF0aAogICAgZD0iTSAwLDcgTCAyMiw3IgogICAgc3Ryb2tlLXdpZHRoPSIxIgogICAgc3Ryb2tlPSIjMmMzZTUwIgogID48L3BhdGg+Cjwvc3ZnPgo=",Dependency:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMCw3IEwgMjIsNyIKICAgIHN0cm9rZS13aWR0aD0iMSIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICAgIHN0cm9rZS1kYXNoYXJyYXk9IjQsNCIKICA+PC9wYXRoPgogIDxwYXRoCiAgICBkPSJNIDEwLDEgTCAyMiw3IEwgMTAsMTMiCiAgICBzdHJva2Utd2lkdGg9IjEiCiAgICBzdHJva2U9IiMyYzNlNTAiCiAgICBmaWxsPSJub25lIgogID48L3BhdGg+Cjwvc3ZnPgo=",Aggregation:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMSw3IEwgMTEsMTMgTCAyMSw3IEwgMTEsMSBMIDEsNyBaIgogICAgZmlsbD0iI2ZhZWNkOCIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICA+PC9wYXRoPgo8L3N2Zz4K",Composition:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMSw3IEwgMTEsMTMgTCAyMSw3IEwgMTEsMSBMIDEsNyBaIgogICAgZmlsbD0iIzAwMDAwMCIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICA+PC9wYXRoPgo8L3N2Zz4KCg==",Realization:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnCiAgdD0iMTYwNTI1Njc4NDE3MSIKICBjbGFzcz0iaWNvbiIKICB2aWV3Qm94PSIwIDAgMjIgMTQiCiAgdmVyc2lvbj0iMS4xIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBwLWlkPSIxNzQ5IgogIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgo+CiAgPHBhdGgKICAgIGQ9Ik0gMCw3IEwgMjIsNyIKICAgIHN0cm9rZS13aWR0aD0iMSIKICAgIHN0cm9rZT0iIzJjM2U1MCIKICAgIHN0cm9rZS1kYXNoYXJyYXk9IjQsNCIKICA+PC9wYXRoPgogIDxwYXRoCiAgICBkPSJNIDEwLDEgTCAyMiw3IEwgMTAsMTMgTCAxMCwxIFoiCiAgICBzdHJva2Utd2lkdGg9IjEiCiAgICBzdHJva2U9IiMyYzNlNTAiCiAgICBmaWxsPSIjZmFlY2Q4IgogID48L3BhdGg+Cjwvc3ZnPgo="},So=["access","bind","call","derive","friend","import","instanceOf","instantiate","powertype","refine","send","use"],Do={Association:["metaclass","subscribe"],"Directed Association":["metaclass","subscribe"],Dependency:So,Aggregation:["metaclass","subscribe"],Composition:["metaclass","subscribe"],Realization:So,Generalization:["implementation"]},No=[{value:"*"},{value:"0"},{value:"0..*"},{value:"0..1"},{value:"1"},{value:"1.."},{value:"1..*"}],Ao={BACKSPACE:8,DELETE:46,SPACE:32,SHIFT:16,ENTER:13,C:67,V:86,A:65,Z:90,S:83,Y:89},Lo={CLASS:5,CLASS_PROPERTY:6,CLASS_OPERATION:7},To={removeNode:"removeNode",createNode:"createNode",menuCreateNewNode:"menuCreateNewNode",dragNewStatement:"dragNewStatement",createSelfTransition:"createSelfTransition",lineToOtherNote:"lineToOtherNote",lineToOtherClass:"lineToOtherClass",lineToNewStatement:"lineToNewStatement",pasteElements:"pasteElements",updateNode:"updateNode",editClassName:"editClassName",editNoteText:"editNoteText",panStatement:"panStatement",adjustNodeSize:"adjustNodeSize",dragTransitionEndpoints:"dragTransitionEndpoints",moveRole:"moveRole",moveTransition:"moveTransition",updateNodeColor:"updateNodeColor",updateNodeFontColor:"updateNodeFontColor",updateNodeFontSize:"updateNodeFontSize",updateDirection:"updateDirection",bulkUpdateColor:"bulkUpdateColor",bulkUpdateFontSize:"bulkUpdateFontSize",panMultiStatement:"panMultiStatement"};function Eo(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=Oo(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw a}}}}function Oo(t,e){if(t){if("string"===typeof t)return jo(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?jo(t,e):void 0}}function jo(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}function Po(){var t=window.stage.el.getBoundingClientRect(),e=t.top,i=t.left;t.width,t.height;return{x:i,y:e}}function zo(t){t.el&&t.el.parentNode&&t.el.parentNode.removeChild(t.el)}function Ro(t){switch(t){case wo.LEFT_TOP:return wo.RIGHT_BOTTOM;case wo.RIGHT_TOP:return wo.LEFT_BOTTOM;case wo.RIGHT_BOTTOM:return wo.LEFT_TOP;case wo.LEFT_BOTTOM:return wo.RIGHT_TOP}}function Bo(t){return new Fi.a(t.pageX,t.pageY)}function Go(t,e){var i=t.children[0],o=new Fi.a(0,0),n=t.el.getBoundingClientRect(),a=i.scale;return i.workState===mo.PAN_STAGE?new Fi.a(e.x-n.left-o.x,e.y-n.top-o.y):(o=new Fi.a(i.x,i.y),new Fi.a((e.x-n.left-o.x)/a,(e.y-n.top-o.y)/a))}function _o(t){return t?"".concat(t,"-").concat(Object(b["a"])()):Object(b["a"])()}function Fo(t,e){return(e.y-t.y)/(e.x-t.x)}function Uo(t,e){var i=Fo(t,e),o=180*Math.atan(i)/Math.PI;return t.x>e.x&&(o+=180),o}function Zo(t,e,i,o,n){var a,s,r=Fo(o,n);return s=t.y,a=(s-n.y)/r+n.x,$o(a,[t.x,t.x+e])&&Yo(a,s,o,n)?new Fi.a(a,s):(a=t.x+e,s=r*(a-n.x)+n.y,$o(s,[t.y,t.y+i])&&Yo(a,s,o,n)?new Fi.a(a,s):(s=t.y+i,a=(s-n.y)/r+n.x,$o(a,[t.x,t.x+e])&&Yo(a,s,o,n)||(a=t.x,s=r*(a-n.x)+n.y,$o(s,[t.y,t.y+i])&&Yo(a,s,o,n)),new Fi.a(a,s)))}function Yo(t,e,i,o){return Math.min(i.x,o.x)<=t&&Math.max(i.x,o.x)>=t&&Math.min(i.y,o.y)<=e&&Math.max(i.y,o.y)>=e}function Ho(t,e){var i=e.x,o=e.y,n=e.width,a=e.height,s=Vo(t,e),r=.5;return"left"===s?r=(t.y-o)/a:"top"===s?r=(t.x-i)/n:"right"===s?r=(t.y-o)/a:"bottom"===s&&(r=(t.x-i)/n),{side:s,percent:r}}function Vo(t,e){var i=new Fi.a(e.x,e.y),o=e.getCenter(),n=Math.abs(Fo(i,o)),a=Math.abs(Fo(t,o));return t.y<o.y&&a>=n?"top":t.x>o.x&&a<=n?"right":t.y>o.y&&a>=n?"bottom":t.x<o.x&&a<=n?"left":void 0}function Qo(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}}function Wo(t,e){var i=t.length;if(2===i)return Qo(t[0],t[1],e);for(var o=0,n=[];o<i-1;o++)n.push(Qo(t[o],t[o+1],e));return Wo(n,e)}function Xo(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=t[4],r=t[5],c=t[6],l=t[7],d=1-e,u=d*d,h=e*e,f=-3*u*i+3*u*n-6*e*d*n-3*h*s+6*e*d*s+3*h*c,g=-3*u*o+3*u*a-6*e*d*a-3*h*r+6*e*d*r+3*h*l;return Math.atan2(g,f)}function Jo(t,e,i,o,n){return Wo([t,e,i,o],n)}function $o(t,e){var i=Object(Gi["a"])(e,2),o=i[0],n=i[1];return o<=t&&t<=n}function Ko(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.type,o=void 0===i?"long":i,n=e.source,a=void 0===n?"timestamp":n,s="";switch(a){default:case"timestamp":"number"===typeof t&&(t=new Date(t)),"string"===typeof t&&(t=new Date(Number(t))),s+=t.getFullYear()+"-",s+=qo(t.getMonth()+1)+"-",s+=qo(t.getDate()),s+=" ",s+=qo(t.getHours())+":",s+=qo(t.getMinutes())+":",s+=qo(t.getSeconds());break;case"string":t=t.toString(),s+=t.slice(0,4)+"-",s+=t.slice(4,6)+"-",s+=t.slice(6,8),s+=" ",s+=t.slice(8,10)+":",s+=t.slice(10,12)+":",s+=t.slice(12,14);break}return"long"!==o&&(s=s.slice(0,10)),s}function qo(t){return(t<10?"0":"")+t}function tn(t){var e=t.name?t.name.length:0,i=t.type?t.type.length:0;return 2+e+2+i}function en(t){var e,i=0,o=Eo(t.paramList||[]);try{for(o.s();!(e=o.n()).done;){var n=e.value,a=n.name?n.name.length:0,s=n.type?n.type.length:0;i+=s+1+a+1}}catch(l){o.e(l)}finally{o.f()}t.paramList&&i--;var r=t.type?t.type.length:0,c=t.name?t.name.length:0;return 2+c+1+i+3+r}function on(t){var e,i=t.name.length||0,o=Eo(t.operationList||[]);try{for(o.s();!(e=o.n()).done;){var n=e.value;i=Math.max(i,en(n))}}catch(d){o.e(d)}finally{o.f()}var a,s=Eo(t.propertyList||[]);try{for(s.s();!(a=s.n()).done;){var r=a.value;i=Math.max(i,tn(r))}}catch(d){s.e(d)}finally{s.f()}t.width=Math.max(100,8*i);var c=Array.isArray(t.propertyList)?t.propertyList.length:0,l=Array.isArray(t.operationList)?t.operationList.length:0;t.height=86+20*c+20*l}function nn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.forEach(on);var i={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.layered.spacing.nodeNodeBetweenLayers":150,"elk.direction":4},children:t,edges:e.map((function(t){return t.source=t.fromStateId,t.target=t.toStateId,t}))};console.log(i);var o=new Zi.a;return o.layout(i).then((function(t){var e,i=Eo(t.edges);try{for(i.s();!(e=i.n()).done;){var o=e.value,n=o.sections&&o.sections[0],a=n.startPoint,s=n.endPoint;n.bendPoints;o.from=a,o.to=s,delete o.sections,delete o.source,delete o.target,o.fromStateId!==o.toStateId&&(o.ca=Qo(o.from,o.to,.25),o.cb=Qo(o.from,o.to,.75))}}catch(r){i.e(r)}finally{i.f()}}))}var an=40,sn=60;function rn(t,e,i){var o=2;return Math.abs(t.y-i.y)<o&&Math.abs(e.y-i.y)<o?{ca:new Fi.a(t.x,t.y-sn),cb:new Fi.a(e.x,e.y-sn)}:Math.abs(t.x-(i.x+i.width))<o&&Math.abs(e.x-(i.x+i.width))<o?{ca:new Fi.a(t.x+sn,t.y),cb:new Fi.a(e.x+sn,e.y)}:Math.abs(t.y-(i.y+i.height))<o&&Math.abs(e.y-(i.y+i.height))<o?{ca:new Fi.a(t.x,t.y+sn),cb:new Fi.a(e.x,e.y+sn)}:Math.abs(t.x-i.x)<o&&Math.abs(e.x-i.x)<o?{ca:new Fi.a(t.x-sn,t.y),cb:new Fi.a(e.x-sn,e.y)}:{}}function cn(t,e,i){return t<e?e:t>i?i:t}function ln(t,e){var i,o,n=t.fromState,a=t.toState,s=n.getCenter(),r={x:n.x,y:n.y},c={x:n.x+n.width,y:n.y},l={x:n.x,y:n.y+n.height},d={x:n.x+n.width,y:n.y+n.height},u=[r,c],h=[c,d],f=[l,d],g=[r,l],p=a.getCenter(),m={x:a.x,y:a.y},y={x:a.x+a.width,y:a.y},v={x:a.x,y:a.y+a.height},w={x:a.x+a.width,y:a.y+a.height},x=[m,y],C=[y,w],b=[v,w],M=[m,v];return e=e||[s,p],s.x>p.x&&s.y>p.y?(i=hn.apply(void 0,Object(I["a"])(e).concat(u))||hn.apply(void 0,Object(I["a"])(e).concat(g)),o=hn.apply(void 0,Object(I["a"])(e).concat(b))||hn.apply(void 0,Object(I["a"])(e).concat(C))):s.x<p.x&&s.y<p.y?(i=hn.apply(void 0,Object(I["a"])(e).concat(f))||hn.apply(void 0,Object(I["a"])(e).concat(h)),o=hn.apply(void 0,Object(I["a"])(e).concat(x))||hn.apply(void 0,Object(I["a"])(e).concat(M))):s.x>p.x&&s.y<p.y?(i=hn.apply(void 0,Object(I["a"])(e).concat(g))||hn.apply(void 0,Object(I["a"])(e).concat(f)),o=hn.apply(void 0,Object(I["a"])(e).concat(C))||hn.apply(void 0,Object(I["a"])(e).concat(x))):s.x<p.x&&s.y>p.y&&(i=hn.apply(void 0,Object(I["a"])(e).concat(h))||hn.apply(void 0,Object(I["a"])(e).concat(u)),o=hn.apply(void 0,Object(I["a"])(e).concat(M))||hn.apply(void 0,Object(I["a"])(e).concat(b))),{from:i,to:o}}function dn(t,e,i){var o=t.fromState,n=t.toState,a=t.from,s=t.to,r={x:o.x,y:o.y},c={x:o.x+o.width,y:o.y},l={x:o.x,y:o.y+o.height},d={x:o.x+o.width,y:o.y+o.height},u=[r,c],h=[c,d],f=[l,d],g=[r,l],p={x:n.x,y:n.y},m={x:n.x+n.width,y:n.y},y={x:n.x,y:n.y+n.height},v={x:n.x+n.width,y:n.y+n.height},w=[p,m],x=[m,v],C=[y,v],b=[p,y],M=Object(Gi["a"])(e,2),k=M[0],S=M[1],D=Vo(k,o),N=Vo(S,n);switch(D){case"top":k.y=o.y;break;case"right":k.x=o.x+o.width;break;case"bottom":k.y=o.y+o.height;break;case"left":k.x=o.x;break}switch(N){case"top":S.y=n.y;break;case"right":S.x=n.x+n.width;break;case"bottom":S.y=n.y+n.height;break;case"left":S.x=n.x;break}var A=[hn.apply(void 0,Object(I["a"])(e).concat(u)),hn.apply(void 0,Object(I["a"])(e).concat(h)),hn.apply(void 0,Object(I["a"])(e).concat(f)),hn.apply(void 0,Object(I["a"])(e).concat(g))].filter(Boolean),L=[hn.apply(void 0,Object(I["a"])(e).concat(w)),hn.apply(void 0,Object(I["a"])(e).concat(x)),hn.apply(void 0,Object(I["a"])(e).concat(C)),hn.apply(void 0,Object(I["a"])(e).concat(b))].filter(Boolean);return"from"===i&&L.push(s),"to"===i&&A.push(a),0===L.length&&L.push(S),0===A.length&&A.push(k),un(A,L)}function un(t,e){if(0===t.length||0===e.length)return null;var i={};t.forEach((function(t,o){e.forEach((function(e,n){i["".concat(o,"_").concat(n)]=Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}))}));var o=Object.keys(i),n=o[0],a=i[n];o.forEach((function(t){i[t]<a&&(n=t,a=i[t])}));var s=n.split("_"),r=Object(Gi["a"])(s,2),c=r[0],l=r[1];return{from:t[c],to:e[l]}}function hn(t,e,i,o){var n=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),a=(t.x-o.x)*(e.y-o.y)-(t.y-o.y)*(e.x-o.x);if(n*a>=0)return!1;var s=(i.x-t.x)*(o.y-t.y)-(i.y-t.y)*(o.x-t.x),r=s+n-a;if(s*r>=0)return!1;var c=s/(a-n),l=c*(e.x-t.x),d=c*(e.y-t.y);return{x:t.x+l,y:t.y+d}}function fn(t,e){var i=t.getCenter(),o=e.x-i.x,n=e.y-i.y,a=Math.abs(o),s=Math.abs(n);return n<=0&&a<=s?{from:new Fi.a(i.x,t.y),to:new Fi.a(i.x+an,t.y)}:o>=0&&s<=a?{from:new Fi.a(t.x+t.width,i.y),to:new Fi.a(t.x+t.width,i.y+an)}:n>0&&a<s?{from:new Fi.a(i.x,t.y+t.height),to:new Fi.a(i.x+an,t.y+t.height)}:o<0&&s<a?{from:new Fi.a(t.x,i.y),to:new Fi.a(t.x,i.y+an)}:void 0}function gn(t,e,i){var o=t.from,n=t.to,a=t.fromState,s=t.toState;if(a.id===s.id){var r=a.x,c=a.y,l=a.width,d=a.height,u=r,h=u+l-an,f=u+an,g=u+l,p=c,m=p+d-an,y=p+an,v=p+d,w=n.x-o.x,x=n.y-o.y,C=2;Math.abs(o.y-a.y)<C&&Math.abs(n.y-a.y)<C||Math.abs(o.y-(a.y+a.height))<C&&Math.abs(n.y-(a.y+a.height))<C?(o.x+=e,n.x+=e,o.x=cn(o.x,w?u:f,w?h:g),n.x=cn(n.x,w?f:u,w?g:h)):(Math.abs(o.x-a.x)<C&&Math.abs(n.x-a.x)<C||Math.abs(o.x-(a.x+a.width))<C&&Math.abs(n.x-(a.x+a.width))<C)&&(o.y+=i,n.y+=i,o.y=cn(o.y,x?p:y,x?m:v),n.y=cn(n.y,x?y:p,x?v:m))}else{o=pn(a,o,e,i),n=pn(s,n,e,i);var b=ln(t,[o,n]);o=b.from||o,n=b.to||n}return{from:o,to:n}}function pn(t,e,i,o){var n=t.x,a=t.x+t.width,s=t.y,r=t.y+t.height;return e.x+=i,e.y+=o,e.x<n&&(e.x=n),e.x>a&&(e.x=a),e.y<s&&(e.y=s),e.y>r&&(e.y=r),e}function mn(t){var e=t.from,i=t.ca,o=2;return e.y-i.y>o?90:i.x-e.x>o?180:i.y-e.y>o?270:e.x-i.x>o?0:void 0}function yn(){return vn.apply(this,arguments)}function vn(){return vn=Object(C["a"])(regeneratorRuntime.mark((function t(){var e,i,o,n,a,s,r,c=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:1,zi.$emit("xClass:setScale",100),window.store.setAllNormal(),window.store.adjustSize(),window.store.adjustOrigin(),window.store.children.forEach((function(t){"toolBoard"===t.nodeName&&t.hide()})),zi.$emit("xClass:closeAllRightPanel"),i=30,o=window.store.getBound(!0),o.width+=2*i,o.height+=2*i,n=document.createElement("canvas"),a=n.getContext("2d"),s=window.stage.el.cloneNode(!0),s.setAttribute("width",o.width*e),s.setAttribute("height",o.height*e),r=Bi["a"].fromString(a,s.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(i,'" y="-').concat(i,'" width="').concat(o.left+o.width,'" height="').concat(o.top+o.height,'" fill="white"/>')),{scaleWidth:s.getAttribute("width")*e,scaleHeight:s.getAttribute("height")*e,offsetX:-o.left+i,offsetY:-o.top+i}),t.next=19,r.render();case 19:return t.abrupt("return",n.toDataURL("image/png"));case 20:case"end":return t.stop()}}),t)}))),vn.apply(this,arguments)}function wn(t,e){}function xn(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=i.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}i("f8f1");var Cn=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"class_diagram_container",attrs:{onselectstart:"return false"}},[i("ToolBox",{attrs:{mode:t.diagramMode,diagramUUId:t.diagramUUId,isShowGenCopy:t.isShowGenCopy,isShowSaveRevision:t.isShowSaveRevision,isShowShare:t.isShowShare,diagramName:t.diagramName},on:{dragNewStatement:t.dragNewStatement,genCopy:t.genCopy,saveRevision:t.saveRevision}}),i("div",{ref:"workSpace",staticClass:"work_space"},[i("div",{staticClass:"tip_box"},[t._v(t._s(t.tip))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpenRevision,expression:"isOpenRevision"}],staticClass:"revision-info"},[i("div",[t._v(t._s(t.currentRevision.RevisionNotes))]),i("div",[t._v(t._s(t.currentRevision.Creater)+" 修订于 "+t._s((t.currentRevision.CreateTime+"").substr(0,8)))]),i("el-tooltip",{attrs:{content:"关闭当前修订记录",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-circle-close",on:{click:t.closeRevision}})])],1),i("div",{staticClass:"sving_root",style:t.isOpenRevision?"background: rgb(239, 239, 239);":"",attrs:{id:"svingRoot"}},[i("div",{attrs:{id:"pan_satge_layer"}})]),i("InsertBoard",{attrs:{position:t.insertBoard.position,show:t.insertBoard.show,getData:t.getData},on:{cancelAddNew:t.cancelAddNew,createNewStatement:t.createNewStatement}}),i("RelationBoard",{attrs:{position:t.relationBoard.position,show:t.relationBoard.show,getData:t.getData},on:{cancelAddNew:t.cancelAddNew,createNewTransition:t.createNewTransition}}),i("CommentBoard",{attrs:{position:t.commentBoard.position,show:t.commentBoard.show,uuid:t.commentBoard.uuid}}),i("ContextToolbar",{attrs:{position:t.toolbar.position,show:t.toolbar.show,node:t.toolbar.node,historyColors:t.historyColors}}),i("KeyTips"),i("DiagramPanel",{attrs:{historyColors:t.historyColors,revisionList:t.revisionList,commentList:t.commentList,staffName:t.staffName}}),i("el-dialog",{attrs:{title:t.pasteTitle,visible:t.isShowPasteDialog,width:"600px","modal-append-to-body":!1},on:{"update:visible":function(e){t.isShowPasteDialog=e}}},[i("el-form",{staticStyle:{width:"400px",margin:"20px 0 0 20px"},attrs:{"label-position":"left","label-width":"80px"}},[i("el-form-item",{attrs:{label:"复制类型"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.pasteType,callback:function(e){t.pasteType=e},expression:"pasteType"}},t._l(t.pasteOptions,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.isShowPasteDialog=!1}}},[t._v("取 消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.comfirmPaste}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:t.guide.title,visible:t.guide.dialogVisible,width:t.guide.width},on:{"update:visible":function(e){return t.$set(t.guide,"dialogVisible",e)}}},[i("img",{attrs:{src:t.guide.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.guide.dialogVisible=!1}}},[t._v("学会了")])],1)])],1)],1)},bn=[],In=i("e5d9"),Mn=function(){function t(e){var i=e.store;Object(M["a"])(this,t),this.store=i,this.actionName="",this.beforeData=null,this.afterData=null}return Object(k["a"])(t,[{key:"before",value:function(){this.beforeData=this.store.exportData()}},{key:"after",value:function(){this.afterData=this.store.exportData(),this.store.pushStack(this.actionName,{before:this.beforeData,after:this.afterData})}}]),t}();function kn(t){var e=Sn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Sn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Dn=function(t){Object(L["a"])(i,t);var e=kn(i);function i(t){var o,n=t.store,a=t.done;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.store=n,o.originPoint=null,o.originPos=null,o.done=a,o.actionName="整体平移",o.before(),o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(t){this.store.setCursor("grabbing"),this.originPoint=t,this.originPos=new Fi.a(this.store.x,this.store.y)}},{key:"setMouseMove",value:function(t){this.store.workState===mo.PAN_STAGE&&(this.store.x=t.x-this.originPoint.x+this.originPos.x,this.store.y=t.y-this.originPoint.y+this.originPos.y)}},{key:"setMouseUp",value:function(){this.done(),this.after(),window.store.adjustSize()}}]),i}(Mn);function Nn(t){var e=An();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function An(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ln=function(t){Object(L["a"])(i,t);var e=Nn(i);function i(t){var o,n=t.store,a=t.statement,s=t.done;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.statement=a,o.originPoint=null,o.shadow=null,o.done=s,o.actionName="修改节点坐标",o.beforePoint=new Fi.a(o.statement.x,o.statement.y),o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(t){this.originPoint=t,this.shadow=new sving.Rect(this.statement.width,this.statement.height),this.shadow.nodeName="shadow",this.shadow.x=this.statement.x,this.shadow.y=this.statement.y,this.shadow.setAttrs({fill:"none",stroke:Xi,"stroke-width":$i,"stroke-dasharray":qi}),this.store.add(this.shadow)}},{key:"setMouseMove",value:function(t,e){if(this.store.workState===mo.PAN_STATEMENT&&"number"===typeof t&&"number"===typeof e){var i=this.shadow.x+t,o=this.shadow.y+e;this.shadow.x=i,this.shadow.y=o}}},{key:"setMouseUp",value:function(t){var e=this.statement.exportData(),i=t.x-this.originPoint.x,o=t.y-this.originPoint.y;this.done(),this.statement.x=this.shadow.x,this.statement.y=this.shadow.y,window.store.children.forEach((function(t){"shadow"===t.nodeName&&zo(t)})),this.shadow=null;var n=this.statement.exportData(),a=this.statement.moveLines(i,o),s=a.beforeList,r=a.afterList;this.afterPoint=new Fi.a(this.statement.x,this.statement.y);var c=this.beforePoint.distance(this.afterPoint);c>1&&(window.store.pushStack({actionType:To.panStatement,data:{beforeData:{nodeList:[e].concat(Object(I["a"])(s))},afterData:{nodeList:[n].concat(Object(I["a"])(r))}},type:"undo"}),zi.$emit("xClass:autoSave",To.panStatement))}}]),i}(Mn);function Tn(t){var e=En();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function En(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var On=function(t){Object(L["a"])(i,t);var e=Tn(i);function i(t){var o,n=t.store,a=t.done;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.store=n,o.done=a,o.originPoint=null,o.shadowList=[],o.originPos={},o.actionName="批量平移多个节点",o.beforeList=[],o.afterList=[],o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(t){var e=this;this.originPoint=t,this.beforeList=[],this.afterList=[],this.store.selectedNodes.forEach((function(t){if("relation"!==t.nodeName){e.beforeList.push(t.exportData());var i=new sving.Rect(t.width,t.height);i.x=t.x,i.y=t.y,i.nodeName="shadow",i.setAttrs({fill:"none",stroke:Xi,"stroke-width":$i,"stroke-dasharray":qi}),e.store.add(i),e.shadowList.push(i)}}))}},{key:"setMouseMove",value:function(t,e){var i=this;this.store.selectedNodes.forEach((function(o,n){if("relation"!==o.nodeName&&i.store.workState===mo.PAN_MULTI_STATEMENT&&"number"===typeof t&&"number"===typeof e){var a=i.shadowList[n];a.x+=t,a.y+=e}}))}},{key:"setMouseUp",value:function(t){var e=this,i=t.x-this.originPoint.x,o=t.y-this.originPoint.y;this.done();var n=[],a=[];this.store.selectedNodes.forEach((function(t,s){if("relation"!==t.nodeName){var r=e.shadowList[s];t.x=r.x,t.y=r.y;var c=t.moveLines(i,o);n.push.apply(n,Object(I["a"])(c.beforeList)),a.push.apply(a,Object(I["a"])(c.afterList)),e.afterList.push(t.exportData())}})),window.store.children.forEach((function(t){"shadow"===t.nodeName&&zo(t)})),this.shadowList=[],n.forEach((function(t){var i=e.beforeList.findIndex((function(e){return e.id===t.id}));i>-1||e.beforeList.push(t)})),a.forEach((function(t){var i=e.afterList.findIndex((function(e){return e.id===t.id}));i>-1&&e.afterList.splice(i,1),e.afterList.push(t)})),window.store.pushStack({actionType:To.panMultiStatement,data:{beforeData:{nodeList:this.beforeList},afterData:{nodeList:this.afterList}},type:"undo"}),zi.$emit("xClass:autoSave",To.panMultiStatement)}}]),i}(Mn);function jn(t){var e=Pn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Pn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var zn=function(t){Object(L["a"])(i,t);var e=jn(i);function i(t){var o,n=t.store,a=t.statement,s=t.originPoint,r=t.originPointIndex,c=t.done;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.store=n,o.statement=a,o.originPoint=s,o.originPointIndex=r,o.startPoint=null,o.originCenter=null,o.actionName="调整节点大小",o.done=c,o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(t){var e=this;this.startPoint=t,this.originX=this.statement.x,this.originY=this.statement.y,this.originWidth=this.statement.width,this.originHeight=this.statement.height,this.initialWidth=this.statement.width,this.initialHeight=this.statement.height,this.originCenter=this.statement.getCenter();var i=this.startPoint,o=this.originCenter;this.signX=Math.abs(i.x-o.x)/(i.x-o.x),this.signY=Math.abs(i.y-o.y)/(i.y-o.y),this.beforeData=this.statement.exportData(),this.beforeData.x=this.statement.x,this.beforeData.y=this.statement.y,this.beforeData.width=this.statement.width,this.beforeData.height=this.statement.height,this.beforeList=[],this.afterList=[],this.store.transitionList.forEach((function(t){t.fromStateId!==e.statement.id&&t.toStateId!==e.statement.id||e.beforeList.push(t.exportData())}))}},{key:"setMouseMove",value:function(t){var e=t.x-this.startPoint.x,i=t.y-this.startPoint.y,o=this.initialWidth+e*this.signX,n=this.initialHeight+i*this.signY,a=this.statement.getMinWidth(),s=this.statement.getMinHeight();"note"===this.statement.nodeName&&((o<ho||o<a)&&(o=a>ho?a:ho),(n<fo||n<s)&&(n=s>fo?s:fo)),"class"===this.statement.nodeName&&((o<no||o<a)&&(o=a>no?a:no),(n<ao||n<s)&&(n=s>ao?s:ao)),this.statement.adjustSize(o,n,this.originPoint,this.originPointIndex),this.updateLinesPoint(o,n)}},{key:"setMouseUp",value:function(){var t=this;this.done(),this.afterData=this.statement.exportData(),this.afterData.x=this.statement.x,this.afterData.y=this.statement.y,this.afterData.width=this.statement.width,this.afterData.height=this.statement.height,this.store.transitionList.forEach((function(e){e.fromStateId!==t.statement.id&&e.toStateId!==t.statement.id||t.afterList.push(e.exportData())})),window.store.pushStack({actionType:To.adjustNodeSize,data:{beforeData:{nodeList:[this.beforeData].concat(Object(I["a"])(this.beforeList))},afterData:{nodeList:[this.afterData].concat(Object(I["a"])(this.afterList))}},type:"undo"}),zi.$emit("xClass:autoSave",To.adjustNodeSize)}},{key:"updateLinesPoint",value:function(t,e){var i=this,o=this.statement.id,n=this.statement.x,a=this.statement.y;this.store.transitionList.forEach((function(s){["to","from"].forEach((function(r){var c=s["".concat(r,"State")],l=s["".concat(r,"StateId")],d="from"===r?"updateFromPoint":"updateToPoint";if(c&&l===o){var u=i.getSideFromStateByPoint(s[r],{x:i.originX,y:i.originY,width:i.originWidth,height:i.originHeight}),h=u.side,f=u.percent,g=i.getPointBySidePosition({side:h,percent:f,startX:n,startY:a,width:t,height:e});s[d](g)}}))})),this.originX=n,this.originY=a,this.originWidth=t,this.originHeight=e}},{key:"getPointBySidePosition",value:function(t){var e,i,o=t.side,n=t.percent,a=t.startX,s=t.startY,r=t.width,c=t.height;return"top"===o?(e=a+r*n,i=s):"left"===o?(e=a,i=s+c*n):"right"===o?(e=a+r,i=s+c*n):"bottom"===o&&(e=a+r*n,i=s+c),new Fi.a(e,i)}},{key:"getSideFromStateByPoint",value:function(t,e){var i,o,n=2,a=e.x,s=e.y,r=e.width,c=e.height;return Math.abs(t.x-a)<n?(i="left",o=(t.y-s)/c,{side:i,percent:o}):Math.abs(t.y-s)<n?(i="top",o=(t.x-a)/r,{side:i,percent:o}):Math.abs(t.x-(a+r))<n?(i="right",o=(t.y-s)/c,{side:i,percent:o}):Math.abs(t.y-(s+c))<n?(i="bottom",o=(t.x-a)/r,{side:i,percent:o}):{}}}]),i}(Mn);function Rn(t){var e=Bn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Bn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Gn=function(t){Object(L["a"])(i,t);var e=Rn(i);function i(t){var o,n=t.store,a=t.position,s=t.index;return Object(M["a"])(this,i),o=e.call(this),o.store=n,o.active=!1,o.index=s,o.mainSVG=new sving.Rect(oo,oo),o.mainSVG.setAttrs({fill:"#409EFF",stroke:"#409EFF","stroke-width":1}),o.x=a.x,o.y=a.y,o.add(o.mainSVG),o.initEvents(),o}return Object(k["a"])(i,[{key:"getSVGposition",value:function(){return new Fi.a(this.parent.parent.x+this.x,this.parent.parent.y+this.y)}},{key:"initEvents",value:function(){var t=this;this.on("mousedown",(function(){if(t.store.workState===mo.NORMAL){var e=Ro(t.index),i=t.parent.parent.sizePointList.find((function(t){return t.index===e}));t.store.mouseEvent=new zn({store:t.store,statement:t.parent.parent,originPoint:i.getSVGposition(),originPointIndex:i.index,done:function(){t.store.mouseEvent=null,t.store.workState=mo.NORMAL}}),t.store.workState=mo.ADJUST_STATEMENT_SIZE,t.store.mouseEvent.setMouseDown(t.getSVGposition())}})),this.on("mouseover",(function(){t.cursor="crosshair"})),this.on("mouseout",(function(){t.cursor="auto"}))}}]),i}(sving.Group);function _n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Fn(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_n(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Un(t){var e=Zn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Zn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Yn=function(t){Object(L["a"])(i,t);var e=Un(i);function i(t){var o,n=t.x,a=t.y,s=t.width,r=t.height,c=t.id,l=void 0===c?_o("statement"):c,d=t.store,u=t.isNeedEvent,h=void 0===u||u;return Object(M["a"])(this,i),o=e.call(this),o.id=l,o.store=d,o.x=n,o.y=a,o.width=s,o.height=r,h&&o.initEvent(),o}return Object(k["a"])(i,[{key:"initEvent",value:function(){var t=this;this.initBaseClick(),this.initDrag(),this.on("mouseover",(function(){t.store.setOverNode(t)}))}},{key:"initBaseClick",value:function(){var t=this;this.on("mousedown",(function(e){t.which=e.which})),this.on("mouseup",(function(e){t.which=e.which}))}},{key:"initDrag",value:function(){var t=this,e=function(){if(t.which===vo.LEFT)return t.store.selectedNodes.length>1&&t.store.workState!==mo.SHIFT_MULTI_SELECTING&&t.store.workState!==mo.PAN_STAGE&&t.store.selectedNodes.find((function(e){return e===t}))?(t.store.workState=mo.PAN_MULTI_STATEMENT,void(t.store.mouseEvent=new On({store:t.store,done:function(){t.store.mouseEvent=null,t.store.workState=mo.AFTER_PAN_MULTI_STATEMENT}}))):void(t.store.workState===mo.NORMAL&&(t.store.mouseEvent=new Ln({store:t.store,statement:t,done:function(e){t.store.mouseEvent=null,t.store.workState=mo.NORMAL,e&&e()}}),t.store.workState=mo.PAN_STATEMENT))},i=function(e,i){if(t.which===vo.LEFT){if(t.store.workState===mo.PAN_MULTI_STATEMENT){var o=t.store.scale;t.store.mouseEvent.setMouseMove(e/o,i/o)}if(t.store.workState===mo.PAN_STATEMENT){var n=t.store.scale;t.store.mouseEvent.setMouseMove(e/n,i/n)}}},o=function(){};this.onDragStart(e),this.onDrag(i),this.onDragEnd(o)}},{key:"moveLines",value:function(t,e){var i=this,o=[],n=[];return this.store.transitionList.forEach((function(a){if(a.fromStateId===i.id&&a.toStateId===i.id){o.push(a.exportData());var s=a.from,r=a.to;a.updateFromPoint({x:s.x+t,y:s.y+e}),a.updateToPoint({x:r.x+t,y:r.y+e}),n.push(a.exportData())}else if(a.fromStateId===i.id){o.push(a.exportData());var c=[{x:a.from.x+t,y:a.from.y+e},a.to],l=dn(a,c),d=l.from,u=l.to;a.updateFromPoint(d),a.updateToPoint(u),a.updateDirection(),n.push(a.exportData())}else if(a.toStateId===i.id){o.push(a.exportData());var h=[a.from,{x:a.to.x+t,y:a.to.y+e}],f=dn(a,h),g=f.from,p=f.to;a.updateFromPoint(g),a.updateToPoint(p),a.updateDirection(),n.push(a.exportData())}})),{beforeList:o,afterList:n}}},{key:"isPointIn",value:function(t){var e=t.x>this.x&&t.y>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height;return e}},{key:"getIntersection",value:function(t,e){var i=new Fi.a(this.x,this.y);return e||(e=this.getCenter()),Zo(i,this.width,this.height,t,e)}},{key:"getCenter",value:function(){return new Fi.a(this.x+this.width/2,this.y+this.height/2)}},{key:"initSizePoints",value:function(){var t=this,e=this.initSizePointDataModel();this.controlPointsGroup=new sving.Group,e.forEach((function(e){var i=Fn(Fn({},e),{},{store:t.store}),o=new Gn(i);t.controlPointsGroup.add(o),t.sizePointList.push(o)}))}},{key:"initSizePointDataModel",value:function(){var t=this.width,e=this.height,i=oo/2;return[{position:{x:-i,y:0-i},index:wo.LEFT_TOP},{position:{x:t-i,y:0-i},index:wo.RIGHT_TOP},{position:{x:t-i,y:e-i},index:wo.RIGHT_BOTTOM},{position:{x:0-i,y:e-i},index:wo.LEFT_BOTTOM}]}},{key:"updatePoints",value:function(t){var e=t.width,i=t.height,o=oo/2;this.sizePointList.forEach((function(t){return t.index===wo.LEFT_TOP?(t.x=-o,void(t.y=-o)):t.index===wo.RIGHT_TOP?(t.x=e-o,void(t.y=-o)):t.index===wo.LEFT_BOTTOM?(t.x=-o,void(t.y=i-o)):t.index===wo.RIGHT_BOTTOM?(t.x=e-o,void(t.y=i-o)):void 0}))}},{key:"isPointInSide",value:function(t){var e=this.x,i=this.y,o=this.width,n=this.height,a=2;return $o(t.x,[e,e+o])&&$o(t.y,[i-a,i+a])?new Fi.a(t.x,i):$o(t.x,[e,e+o])&&$o(t.y,[i+n-a,i+n+a])?new Fi.a(t.x,i+n):$o(t.x,[e-a,e+a])&&$o(t.y,[i,i+n])?new Fi.a(e,t.y):$o(t.x,[e+o-a,e+o+a])&&$o(t.y,[i,i+n])?new Fi.a(e+o,t.y):null}}]),i}(sving.Group);function Hn(t){var e=Vn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Vn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Qn=document.createElement("input");Qn.style.position="absolute",Qn.style.display="none",Qn.style.resize="none",Qn.style.fontFamily=Qi,document.body.appendChild(Qn),Qn.onkeydown=function(t){t.stopPropagation(),t.keyCode===Ao.ENTER&&Qn.blur()};var Wn=function(t){Object(L["a"])(i,t);var e=Hn(i);function i(t){var o,n=t.x,a=t.y,s=t.width,r=t.height,c=void 0===r?so:r,l=t.text,d=t.isNeedEvent,u=t.fontSize,h=void 0===u?12:u,f=t.fontColor,g=void 0===f?Vi:f,p=t.parent,m=t.classType,y=void 0===m?"":m;return Object(M["a"])(this,i),o=e.call(this,{x:n,y:a,width:s,height:c,isNeedEvent:d}),o.text=l,o.fontSize=h,o.fontColor=g,o.parent=p,o.classType=y,""!==o.classType&&(o.height+=20),o.initEventRect(),o.initClassType(),o.initClassName(),o.initEvent(),o}return Object(k["a"])(i,[{key:"gc",value:function(){this.eventRect=null,this.typeSVG=null,this.nameSVG=null}},{key:"initEventRect",value:function(){this.eventRect=new sving.Rect(this.width,this.height),this.eventRect.setAttrs({fill:"rgba(0, 0, 0, 0)"}),this.add(this.eventRect)}},{key:"initClassType",value:function(){var t=this;""!==this.classType&&(this.typeSVG=new sving.Text("《".concat(this.classType,"》"),"".concat(this.fontSize,"px sans-serif")),this.typeSVG.el.style.userSelect="none",this.typeSVG.el.style.textAnchor="middle",this.typeSVG.el.style.dominantBaseline="central",this.typeSVG.setAttrs({fill:this.fontColor}),this.typeSVG.onAddedToStage((function(){t.setTypeCenter()})),this.add(this.typeSVG))}},{key:"initClassName",value:function(){var t=this;this.nameSVG=new sving.Text(this.text,"".concat(this.fontSize,"px sans-serif")),this.nameSVG.el.style.userSelect="none",this.nameSVG.el.style.textAnchor="middle",this.nameSVG.el.style.dominantBaseline="central",this.nameSVG.setAttrs({fill:this.fontColor}),this.nameSVG.onAddedToStage((function(){t.setTextCenter()})),this.add(this.nameSVG)}},{key:"initEvent",value:function(){var t=this;this.on("dblclick",(function(e){e.stopPropagation();var i=document.querySelector("#svingRoot"),o=function(){document.activeElement===Qn&&Qn.blur()};Qn.onblur=function(){Qn.style.display="none";var e=t.parent.exportData();if(e.name!==Qn.value){var n=Object(Ri["cloneDeep"])(e),a=Object(Ri["cloneDeep"])(e);e.name=Qn.value,a.name=Qn.value,t.parent.updateData(e),window.store.pushStack({actionType:To.editClassName,data:{beforeData:{nodeList:[n]},afterData:{nodeList:[a]}},type:"undo"}),zi.$emit("xClass:autoSave",To.editClassName),i.removeEventListener("scroll",o)}},i.addEventListener("scroll",o);var n=t.nameSVG.el.getBoundingClientRect(),a=t.el.getBoundingClientRect();Qn.value=t.text,Qn.style.width=a.width+"px",Qn.style.height=n.height+"px",Qn.style.left=a.x+"px",Qn.style.top=n.top+"px",Qn.style.display="block",Qn.style.border="none",Qn.focus(),Qn.select()}))}},{key:"updateSize",value:function(t){var e=t.width;t.height;this.width=e,this.eventRect.setAttrs({width:e}),this.setTextCenter(),""!==this.classType&&this.setTypeCenter()}},{key:"updateText",value:function(t,e,i){this.text=t,this.fontSize=e,this.fontColor=i,this.nameSVG.textContent=t,this.nameSVG.font="".concat(e,"px sans-serif"),this.nameSVG.setAttrs({fill:this.fontColor}),this.setTextCenter(),""!==this.classType&&(this.typeSVG.font="".concat(e,"px sans-serif"),this.typeSVG.setAttrs({fill:this.fontColor}),this.setTypeCenter())}},{key:"setTypeCenter",value:function(){this.typeSVG.x=this.width/2,this.typeSVG.y=so/2}},{key:"setTextCenter",value:function(){this.nameSVG.x=this.width/2,this.nameSVG.y=so/2,""!==this.classType&&(this.nameSVG.y+=20)}}]),i}(Yn);function Xn(t){var e=Jn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Jn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var $n=function(t){Object(L["a"])(i,t);var e=Xn(i);function i(t){var o,n=t.x,a=t.y,s=t.width,r=t.height,c=t.propertyList,l=void 0===c?[]:c,d=t.isNeedEvent,u=t.fontSize,h=t.fontColor,f=void 0===h?Vi:h;return Object(M["a"])(this,i),o=e.call(this,{x:n,y:a,width:s,height:r,isNeedEvent:d}),o.propertyList=l,o.fontSize=u,o.fontColor=f,o.nodeList=[],o.initBorder(),o.initProperty(),o}return Object(k["a"])(i,[{key:"gc",value:function(){this.border=null,this.nodeList.forEach((function(t){null})),this.nodeList=null,this.propertyList=null}},{key:"initBorder",value:function(){this.border=new sving.Rect(this.width,Ki),this.border.x=0,this.border.y=0,this.border.setAttrs({fill:Xi}),this.add(this.border)}},{key:"initProperty",value:function(){var t=this;this.propertyList.forEach((function(e,i){var o="".concat(uo[e.modifier]||uo.default," ").concat(e.name,": ").concat(e.type),n=new sving.Text(o,"".concat(t.fontSize,"px sans-serif"));n.el.style.userSelect="none",n.setAttrs({fill:t.fontColor}),n.onAddedToStage((function(){t.setTextCenter(n,i)}));var a=co*t.propertyList.length+2*lo;t.height=a>ro?a:ro,t.add(n),t.nodeList.push(n)}))}},{key:"setTextCenter",value:function(t,e){var i=t.getBBox(),o=i.x,n=i.y;t.x=Math.abs(o)+lo,t.y=Math.abs(n)+Ki+(co-this.fontSize)/2+co*e}},{key:"updateSize",value:function(t){var e=t.width;t.height;this.border.setAttrs({width:e})}},{key:"updateData",value:function(t,e,i){this.propertyList=t,this.clear(),this.fontSize=e,this.fontColor=i,this.initBorder(),this.initProperty()}},{key:"adjustText",value:function(){var t=this;this.nodeList.forEach((function(e,i){t.setTextCenter(e,i)}))}}]),i}(Yn);function Kn(t){var e=qn();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function qn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ta=function(t){Object(L["a"])(i,t);var e=Kn(i);function i(t){var o,n=t.x,a=t.y,s=t.width,r=t.height,c=t.operationList,l=void 0===c?[]:c,d=t.isNeedEvent,u=t.fontSize,h=t.fontColor,f=void 0===h?Vi:h;return Object(M["a"])(this,i),o=e.call(this,{x:n,y:a,width:s,height:r,isNeedEvent:d}),o.operationList=l,o.nodeList=[],o.fontSize=u,o.fontColor=f,o.initBorder(),o.initOperation(),o}return Object(k["a"])(i,[{key:"gc",value:function(){this.border=null,this.nodeList.forEach((function(t){null})),this.nodeList=null,this.operationList=null}},{key:"initBorder",value:function(){this.border=new sving.Rect(this.width,Ki),this.border.x=0,this.border.y=0,this.border.setAttrs({fill:Xi}),this.add(this.border)}},{key:"initOperation",value:function(){var t=this;this.operationList.forEach((function(e,i){var o=e.paramList,n=void 0===o?[]:o,a=n.map((function(t){return"".concat(t.type," ").concat(t.name)})).filter((function(t){return" "!==t})).join(","),s="".concat(uo[e.modifier]||uo.default," ").concat(e.name,"(").concat(a,")").concat(e.type?": "+e.type:""),r=new sving.Text(s,"".concat(t.fontSize,"px sans-serif"));r.el.style.userSelect="none",r.setAttrs({fill:t.fontColor}),r.onAddedToStage((function(){t.setTextCenter(r,i)}));var c=co*t.operationList.length+2*lo;t.height=c>ro?c:ro,t.add(r),t.nodeList.push(r)}))}},{key:"setTextCenter",value:function(t,e){var i=t.getBBox(),o=(i.width,i.x),n=i.y;t.x=Math.abs(o)+lo,t.y=Math.abs(n)+Ki+(co-this.fontSize)/2+co*e}},{key:"updateSize",value:function(t){var e=t.width;t.height;this.border.setAttrs({width:e})}},{key:"updateData",value:function(t,e,i,o,n){this.operationList=t,this.y=e+i,this.clear(),this.fontSize=o,this.fontColor=n,this.initBorder(),this.initOperation()}},{key:"adjustText",value:function(){var t=this;this.nodeList.forEach((function(e,i){t.setTextCenter(e,i)}))}}]),i}(Yn);function ea(t){var e=ia();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function ia(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var oa=function(t){Object(L["a"])(i,t);var e=ea(i);function i(t){var o,n=t.x,a=t.y,s=t.width,r=t.height,c=t.store,l=t.id,d=t.name,u=void 0===d?"":d,h=t.fontSize,f=void 0===h?12:h,g=t.fontColor,p=void 0===g?Vi:g,m=t.backgroundColor,y=void 0===m?eo:m,v=t.propertyList,w=void 0===v?[]:v,x=t.operationList,C=void 0===x?[]:x,b=t.classType,I=void 0===b?"":b,k=t.linkId,S=void 0===k?"":k;return Object(M["a"])(this,i),o=e.call(this,{x:n,y:a,width:s,height:r,id:l,store:c}),o.sizePointList=[],o.nodeName="class",o.isActive=!1,o.backgroundColor=y,o.name=""===u?"Class".concat(o.store.statementList.length+1):u,o.fontSize=f,o.fontColor=p,o.propertyList=w,o.operationList=C,o.classType=I,o.linkId=S,o.dataModel={name:o.name,fontSize:f,fontColor:p,backgroundColor:y,propertyList:w,operationList:C,classType:I},o.initBackground(),o.initClassName(),o.initClassProperty(),o.initClassOperation(),o.initClick(),o.initSizePoints(),o.setMode(o.store.diagramMode),o}return Object(k["a"])(i,[{key:"gc",value:function(){this.className.gc(),this.classProperty.gc(),this.classOperation.gc(),this.background=null,this.className=null,this.classProperty=null,this.classOperation=null}},{key:"initBackground",value:function(){this.background=new sving.Rect(this.width,this.height),this.background.setAttrs({fill:this.backgroundColor||eo,stroke:Xi,"stroke-width":$i,"stroke-dasharray":to}),this.add(this.background)}},{key:"initClassName",value:function(){this.className=new Wn({x:0,y:0,width:this.width,text:this.name,fontSize:this.fontSize,fontColor:this.fontColor,classType:this.classType,isNeedEvent:!1,parent:this}),this.add(this.className)}},{key:"initClassProperty",value:function(){this.classProperty=new $n({x:0,y:this.className.height,width:this.width,height:ro,isNeedEvent:!1,fontSize:this.fontSize,fontColor:this.fontColor,propertyList:this.propertyList.filter((function(t){return""!==t.name&&""!==t.type&&""!==t.modifier}))}),this.add(this.classProperty)}},{key:"initClassOperation",value:function(){this.classOperation=new ta({x:0,y:this.className.height+this.classProperty.height,width:this.width,height:ro,isNeedEvent:!1,fontSize:this.fontSize,fontColor:this.fontColor,operationList:this.operationList.filter((function(t){return""!==t.name&&""!==t.type&&""!==t.modifier}))}),this.add(this.classOperation)}},{key:"initClick",value:function(){var t=this;this.on("click",(function(e){e.stopPropagation(),t.store.workState!==mo.PAN_MULTI_STATEMENT&&t.store.workState!==mo.AFTER_PAN_MULTI_STATEMENT&&(t.store.setActiveNode(t),wn(t,450))})),this.on("dblclick",(function(e){e.stopPropagation(),t.store.setActiveNode(t),zi.$emit("xClass:setRightPanelShow",!0),wn(t,450)})),this.on("contextmenu",(function(e){e.stopPropagation(),e.preventDefault(),t.store.setActiveNode(t),window.contextmenu({items:[{label:"删除",onClick:function(){zi.$emit("xClass:removeElement"),zi.$emit("xClass:cancelAddNew")}}],event:e,zIndex:1e3,minWidth:230});var i=Go(window.stage,e);zi.$emit("xClass:showContextToolbar",{point:i,origin:{x:t.store.x,y:t.store.y},node:t})}))}},{key:"setActive",value:function(t,e){this.isActive=t,this.background.setAttrs({stroke:t?Ji:Xi,"stroke-dasharray":t?qi:to}),t?this.add(this.controlPointsGroup):zo(this.controlPointsGroup),e&&zi.$emit("xClass:editClass",this.dataModel,this)}},{key:"adjustSize",value:function(t,e,i,o){switch(o){case wo.RIGHT_TOP:this.x=i.x-t;break;case wo.RIGHT_BOTTOM:this.x=i.x-t,this.y=i.y-e;break;case wo.LEFT_BOTTOM:this.y=i.y-e;break;default:break}var n=this.getMinWidth();t<n&&(t=n>no?n:no);var a=this.getMinHeight();e<a&&(e=a>ao?a:ao),this.updateSize({width:t,height:e}),this.updatePoints({width:t,height:e})}},{key:"updateSize",value:function(t){var e=t.width,i=t.height;this.width=e,this.height=i,this.background.setAttrs({width:e,height:i}),this.className.updateSize({width:e,height:i}),this.classProperty.updateSize({width:e,height:i}),this.classOperation.updateSize({width:e,height:i})}},{key:"exportData",value:function(){return{id:this.id,width:this.width,height:this.height,x:this.x,y:this.y,nodeName:this.nodeName,name:this.name,fontSize:this.fontSize,fontColor:this.fontColor,backgroundColor:this.backgroundColor,propertyList:Object(I["a"])(this.propertyList),operationList:Object(I["a"])(this.operationList),classType:this.classType,linkId:this.linkId}}},{key:"updateData",value:function(t){var e=new zn({store:this.store,statement:this,originPoint:{x:this.x,y:this.y},originPointIndex:wo.LEFT_TOP,done:function(){}});e.setMouseDown({x:this.x+this.width,y:this.y+this.height}),this.dataModel=null,this.dataModel=Object(Ri["cloneDeep"])(t);var i=this.dataModel,o=i.name,n=i.backgroundColor,a=i.propertyList,s=void 0===a?[]:a,r=i.operationList,c=void 0===r?[]:r,l=i.fontSize,d=i.fontColor,u=i.classType;this.name=o,this.backgroundColor=n,this.propertyList=s,this.operationList=c,this.fontSize=l,this.fontColor=d,this.classType=u,this.className.updateText(o,l,d),this.background.setAttrs({fill:this.backgroundColor}),this.classProperty.updateData(s.map((function(t){return""!==t.name&&(""===t.type&&(t.type="int"),""===t.modifier&&(t.modifier="private"),t)})).filter(Boolean),l,d),this.classOperation.updateData(c.map((function(t){return""!==t.name&&(""===t.type&&(t.type="int"),""===t.modifier&&(t.modifier="private"),t)})).filter(Boolean),this.className.height,this.classProperty.height,l,d);var h=this.getMinWidth();this.width<h&&(this.width=h>no?h:no);var f=this.getMinHeight();this.height<f&&(this.height=f>ao?f:ao),e.setMouseMove({x:this.x+this.width,y:this.y+this.height}),e=null}},{key:"getMinWidth",value:function(){var t=[];return this.className.children.forEach((function(e){"text"===e.nodeName&&t.push(e.getBBox().width)})),this.classProperty.children.forEach((function(e){"text"===e.nodeName&&t.push(e.getBBox().width)})),this.classOperation.children.forEach((function(e){"text"===e.nodeName&&t.push(e.getBBox().width)})),Math.max.apply(Math,t)+10}},{key:"getMinHeight",value:function(){return this.className.height+this.classProperty.height+this.classOperation.height}},{key:"setMode",value:function(t){switch(t){case"class":this.add(this.classProperty),this.add(this.classOperation),this.updateData(this.dataModel);break;case"domain":zo(this.classProperty),zo(this.classOperation);break}}}]),i}(Yn);function na(t){var e=aa();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function aa(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var sa=document.createElement("textarea");sa.style.position="absolute",sa.style.display="none",sa.style.resize="none",sa.style.fontFamily=Qi,document.body.appendChild(sa),sa.onkeydown=function(t){t.stopPropagation()};var ra=function(t){Object(L["a"])(i,t);var e=na(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),t.font="".concat(t.fontSize,"px sans-serif");var n=t.width-t.paddingH-10,a=ca(t.text,"".concat(t.fontSize,"px"),n,2),s=new sving.MultilineText(a.map((function(t){return{text:t}})),t);return s.setAttrs({fill:t.fontColor||Vi,"alignment-baseline":"hanging"}),s.x=t.paddingH/2,s.y=t.paddingV/2,s.el.style.userSelect="none",s.on("dblclick",(function(e){sa.onblur=function(){sa.style.display="none",t.onBlur&&t.onBlur(sa.value)};var i=t.background.el.getBoundingClientRect(s.el);sa.value=t.text,sa.setAttribute("rows",a.length>5?a.length:5),sa.style.width=i.width+"px",sa.style.height=i.height+"px",sa.style.left=i.left+"px",sa.style.top=i.top+"px",sa.style.display="block",sa.style.border="none",sa.focus(),sa.select(),e.stopPropagation()})),o.add(s),s.cursor="pointer",o.text=s,o}return i}(sving.Group);function ca(t,e,i,o){var n=t.split(/[\r\n]/),a=[];return n.forEach((function(t,n){var s=la(t,e,i,o);s.forEach((function(t){a.push(t)}))})),a}function la(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;var s=t.split("");""===t&&s.push("");for(var r,c="",l="",d=[],u=0;u<s.length;u++)l=c+s[u],a.textContent=l,r=a.getBBox().width,r+2*o>i?(d.push(l),l="",c=""):c=l,u===s.length-1&&d.push(l);return document.body.removeChild(n),d}function da(t){var e=ua();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function ua(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ha="#fff",fa="#eee",ga=function(t){Object(L["a"])(i,t);var e=da(i);function i(t){var o,n=t.x,a=t.y,s=t.width,r=t.height,c=t.store,l=t.id,d=t.backgroundColor,u=void 0===d?ha:d,h=t.text,f=void 0===h?"":h,g=t.fontSize,p=void 0===g?12:g,m=t.fontColor,y=void 0===m?Vi:m;return Object(M["a"])(this,i),o=e.call(this,{x:n,y:a,width:s,height:r,id:l,store:c}),o.sizePointList=[],o.nodeName="note",o.isActive=!1,o.backgroundColor=u,o.text=f,o.fontSize=p,o.fontColor=y,o.dataModel={fontSize:p,fontColor:y,backgroundColor:u,text:f},o.background=new sving.Path(""),o.knuckle=new sving.Path(""),o.initBackground(),o.add(o.background),o.add(o.knuckle),o.initText(),o.initClick(),o.initSizePoints(),o}return Object(k["a"])(i,[{key:"gc",value:function(){this.background=null,this.knuckle=null,this.noteText=null}},{key:"initBackground",value:function(){var t=this.width,e=this.height;this.background.setAttrs({d:"M 0,0 L ".concat(t-go,",0 L ").concat(t,",").concat(go," L ").concat(t,",").concat(e," L 0,").concat(e," L 0,0 Z"),fill:this.backgroundColor||ha,stroke:this.isActive?Ji:Xi,"stroke-width":$i,"stroke-dasharray":this.isActive?qi:to,"stroke-linejoin":"round"}),this.knuckle.setAttrs({d:"M ".concat(t-go,",0 L ").concat(t-go,",").concat(go," L ").concat(t,",").concat(go),fill:fa,stroke:Xi,"stroke-width":$i,"stroke-linejoin":"round"})}},{key:"initText",value:function(){var t=this;this.noteText&&zo(this.noteText),this.noteText=new ra({width:this.width,text:this.text,paddingH:po,paddingV:2*po+go,lineHeight:this.fontSize+2,background:this.background,textAnchor:"start",fontSize:this.fontSize,fontColor:this.fontColor,onBlur:function(e){if(t.text!==e){var i=t.exportData(),o=Object(Ri["cloneDeep"])(i),n=Object(Ri["cloneDeep"])(i);t.text=e,t.dataModel.text=e,n.text=e,t.updateData(t.dataModel),window.store.pushStack({actionType:To.editNoteText,data:{beforeData:{nodeList:[o]},afterData:{nodeList:[n]}},type:"undo"}),zi.$emit("xClass:autoSave",To.editNoteText)}}}),this.add(this.noteText)}},{key:"initClick",value:function(){var t=this;this.on("click",(function(e){e.stopPropagation(),t.store.workState!==mo.PAN_MULTI_STATEMENT&&(t.store.setActiveNode(t),wn(t,350))})),this.on("dblclick",(function(e){e.stopPropagation(),t.store.setActiveNode(t),zi.$emit("xClass:setRightPanelShow",!0),wn(t,350)})),this.on("contextmenu",(function(e){e.stopPropagation(),e.preventDefault(),t.store.setActiveNode(t),window.contextmenu({items:[{label:"删除",onClick:function(){zi.$emit("xClass:removeElement"),zi.$emit("xClass:cancelAddNew")}}],event:e,zIndex:1e3,minWidth:230});var i=Go(window.stage,e);zi.$emit("xClass:showContextToolbar",{point:i,origin:{x:t.store.x,y:t.store.y},node:t})}))}},{key:"setActive",value:function(t,e){this.isActive=t,this.background.setAttrs({stroke:t?Ji:Xi,"stroke-dasharray":t?qi:to}),t?this.add(this.controlPointsGroup):zo(this.controlPointsGroup),e&&zi.$emit("xClass:editNote",this.dataModel,this)}},{key:"adjustSize",value:function(t,e,i,o){switch(o){case wo.RIGHT_TOP:this.x=i.x-t;break;case wo.RIGHT_BOTTOM:this.x=i.x-t,this.y=i.y-e;break;case wo.LEFT_BOTTOM:this.y=i.y-e;break;default:break}var n=this.getMinWidth();(t<ho||t<n)&&(t=n>ho?n:ho);var a=this.getMinHeight();(e<fo||e<a)&&(e=a>fo?a:fo),this.updateSize({width:t,height:e}),this.updatePoints({width:t,height:e}),this.initText()}},{key:"updateSize",value:function(t){var e=t.width,i=t.height;this.width=e,this.height=i,this.initBackground()}},{key:"exportData",value:function(){return{id:this.id,width:this.width,height:this.height,x:this.x,y:this.y,nodeName:this.nodeName,fontColor:this.fontColor,fontSize:this.fontSize,backgroundColor:this.backgroundColor,text:this.text}}},{key:"updateData",value:function(t){var e=new zn({store:this.store,statement:this,originPoint:{x:this.x,y:this.y},originPointIndex:wo.LEFT_TOP,done:function(){}});e.setMouseDown({x:this.x+this.width,y:this.y+this.height}),this.dataModel=null,this.dataModel=Object(Ri["cloneDeep"])(t);var i=this.dataModel,o=i.backgroundColor,n=i.text,a=void 0===n?"":n,s=i.fontSize,r=i.fontColor;this.backgroundColor=o,this.text=a,this.fontSize=s,this.fontColor=r,this.initText();var c=this.getMinWidth();(this.width<c||this.width<ho)&&(this.width=c>ho?c:ho);var l=this.getMinHeight();(this.height<l||this.height<fo)&&(this.height=l>fo?l:fo),e.setMouseMove({x:this.x+this.width,y:this.y+this.height})}},{key:"getMinWidth",value:function(){var t=[];return this.noteText.children.forEach((function(e){"text"===e.nodeName&&t.push(e.getBBox().width)})),Math.max.apply(Math,t)+po}},{key:"getMinHeight",value:function(){var t=[];return this.noteText.children.forEach((function(e){"text"===e.nodeName&&t.push(e.getBBox().height)})),Math.max.apply(Math,t)+po}}]),i}(Yn);function pa(t){var e=ma();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function ma(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ya=15,va=function(t){Object(L["a"])(i,t);var e=pa(i);function i(t){var o,n=t.store,a=t.done;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.store=n,o.startPoint=null,o.actionName=To.dragNewStatement,o.done=a,o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(t,e,i){var o,n={x:t.x,y:t.y,store:this.store};"class"===e&&(n.width=no,n.height=ao,n.classType=i,o=new oa(n)),"note"===e&&(n.text="注释",n.width=ho,n.height=fo,o=new ga(n)),this.statement=o,this.startPoint=t,this.store.add(this.statement)}},{key:"setMouseMove",value:function(t){this.statement.x=t.x,this.statement.y=t.y}},{key:"setMouseUp",value:function(t){var e=t.distance(this.startPoint);if(e<ya)return this.destory(),!1;var i=this.statement.exportData();this.destory(i),window.store.pushStack({actionType:To.dragNewStatement,data:{nodeList:[i]},type:"undo"}),zi.$emit("xClass:autoSave",To.dragNewStatement)}},{key:"destory",value:function(t){this.statement&&(this.store.remove(this.statement),this.statement=null),this.done(t)}}]),i}(Mn);function wa(t){var e=xa();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function xa(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ca=function(t){Object(L["a"])(i,t);var e=wa(i);function i(t){var o,n=t.from,a=t.to,s=t.moveable,r=void 0===s||s,c=t.color,l=void 0===c?"#000000":c,d=t.isNeedCtrlPoint,u=void 0===d||d,h=t.onPointsDrag;Object(M["a"])(this,i),o=e.call(this),o.endArrow=new sving.Path("M 4.88 23 L -2.12 26.5 L -0.37 23 L -2.12 19.5 Z"),o.endArrow.originX=5,o.endArrow.originY=23;var f=Qo(n,a,.25),g=Qo(n,a,.75),p=o.getD(n,f,g,a);o.curvePath=new sving.Path(p),o.ca=f,o.cb=g,o.from=n,o.to=a,o.isNeedCtrlPoint=u,o.eventCurvePath=new sving.Path(p);var m=o.computeAngle(o.from,o.ca,o.cb,o.to);return o.endArrow.rotation=180*m/Math.PI,o.endArrow.x=a.x,o.endArrow.y=a.y,o.add(o.endArrow),o.add(o.curvePath),o.add(o.eventCurvePath),o.eventCurvePath.setAttrs({fill:l,stroke:"none","stroke-width":14,visibility:"hidden","pointer-events":"stroke"}),o.moveable=r,o.onPointsDrag=h||function(){},o.eventCurvePath.cursor=o.moveable?"move":"pointer",o.curvePath.setAttrs({fill:"none",stroke:l}),o.endArrow.setAttrs({fill:l,stroke:"none"}),o.eventCurvePath.on("click",(function(){o.selected?o.unselect():o.select()})),o.initControlPoints(n,f,g,a),o.unselect(),o}return Object(k["a"])(i,[{key:"updateMoveable",value:function(t){this.moveable=t,this.eventCurvePath.cursor=this.moveable?"move":"pointer"}},{key:"computeAngle",value:function(t,e,i,o){return Xo([t.x,t.y,e.x,e.y,i.x,i.y,o.x,o.y],1)}},{key:"getD",value:function(t,e,i,o){return"M".concat(t.x," ").concat(t.y," C").concat(e.x," ").concat(e.y," ").concat(i.x," ").concat(i.y," ").concat(o.x," ").concat(o.y)}},{key:"initControlPoints",value:function(t,e,i,o){this.controlPointsGroup=new sving.Group,this.add(this.controlPointsGroup);var n="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";this.controlPointA=new sving.Img(n),this.controlPointB=new sving.Img(n),this.fromPoint=new sving.Img(n),this.fromPoint.opacity=.7,this.toPoint=new sving.Img(n),this.toPoint.opacity=.7,this.isNeedCtrlPoint&&this.norm(this.controlPointA,e,"ca"),this.isNeedCtrlPoint&&this.norm(this.controlPointB,i,"cb"),this.norm(this.fromPoint,t,"from"),this.norm(this.toPoint,o,"to")}},{key:"updateFromPoint",value:function(t,e){this.from.x=t,this.from.y=e,this.refresh()}},{key:"updateToPoint",value:function(t,e){this.to.x=t,this.to.y=e,this.refresh()}},{key:"updateControlPointA",value:function(t,e){this.ca.x=t,this.ca.y=e,this.refresh()}},{key:"updateControlPointB",value:function(t,e){this.cb.x=t,this.cb.y=e,this.refresh()}},{key:"updatePoints",value:function(t,e,i,o){this.from.x=t.x,this.from.y=t.y,this.ca.x=e.x,this.ca.y=e.y,this.cb.x=i.x,this.cb.y=i.y,this.to.x=o.x,this.to.y=o.y,this.refresh()}},{key:"refresh",value:function(){var t=this.getD(this.from,this.ca,this.cb,this.to);this.curvePath.setAttrs({d:t}),this.eventCurvePath.setAttrs({d:t});var e=this.computeAngle(this.from,this.ca,this.cb,this.to);this.endArrow.rotation=180*e/Math.PI,this.controlPointA.x=this.ca.x,this.controlPointA.y=this.ca.y,this.controlPointB.x=this.cb.x,this.controlPointB.y=this.cb.y,this.fromPoint.x=this.from.x,this.fromPoint.y=this.from.y,this.endArrow.x=this.to.x,this.endArrow.y=this.to.y,this.toPoint.x=this.to.x,this.toPoint.y=this.to.y}},{key:"norm",value:function(t,e,i){var o=this;t.originX=9,t.originY=9,t.cursor="crosshair",t.onDrag((function(e,n){t.x+=e,t.y+=n,o[i].x=t.x,o[i].y=t.y;var a=o.getD(o.from,o.ca,o.cb,o.to);o.curvePath.setAttrs({d:a}),o.eventCurvePath.setAttrs({d:a});var s=o.computeAngle(o.from,o.ca,o.cb,o.to);o.endArrow.rotation=180*s/Math.PI,o.endArrow.x=o.to.x,o.endArrow.y=o.to.y,o.toPoint.x=o.to.x,o.toPoint.y=o.to.y,o.onPointsDrag(o.from,o.ca,o.cb,o.to,s,i)})),t.x=e.x,t.y=e.y,this.controlPointsGroup.add(t)}},{key:"select",value:function(){this.selected=!0,this.add(this.controlPointsGroup)}},{key:"unselect",value:function(){this.selected=!1,zo(this.controlPointsGroup)}}]),i}(sving.Group);window.SvingArrow=Ca;var ba=Ca;function Ia(t){var e=Ma();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Ma(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Sa="#e8e6e3",Da={top:"M5 0,L10 10,L0 10,Z",right:"M0 0,L10 5,L0 10,Z",bottom:"M0 0,L5 10,L10 0,Z",left:"M0 5,L10 10,L10 0,Z"},Na=function(t){Object(L["a"])(i,t);var e=Ia(i);function i(t){var o,n=t.text,a=t.bgColor,s=void 0===a?"#ffffff":a,r=t.fontSize,c=void 0===r?12:r,l=t.fontColor,d=void 0===l?Vi:l,u=t.draggable,h=void 0===u||u,f=t.origin,g=t.direction,p=void 0===g?"":g,m=t.updatePos,y=void 0===m?function(){}:m;return Object(M["a"])(this,i),o=e.call(this),o.bgColor=s,o.text=n,o.fontSize=c,o.fontColor=d,o.draggable=h,o.origin=f,o.updatePos=y,o.active=!1,o.direction=p,o.initText(),o.initEvents(),o}return Object(k["a"])(i,[{key:"initText",value:function(){var t=this;this.mainSVG=new sving.Text(this.text,"".concat(this.fontSize,"px sans-serif")),this.mainSVG.x=0,this.mainSVG.y=0,this.mainSVG.setAttrs({fill:this.fontColor}),this.mainSVG.el.style.userSelect="none",this.draggable&&(this.mainSVG.cursor="move"),this.add(this.mainSVG),this.mainSVG.onAddedToStage((function(){t.initDirection(),t.updateDirection(t.direction)}))}},{key:"initDirection",value:function(){this.directionSVG=new sving.Path(""),this.add(this.directionSVG)}},{key:"updateDirection",value:function(t){if(this.direction=t,this.parent&&this.parent.fromStateId!==this.parent.toStateId){if("source"===this.direction){var e=Vo(this.parent.fromState.getCenter(),this.parent.toState),i=this.getBBox(),o=i.width,n=i.height,a=i.x,s=i.y;this.directionSVG.setAttrs({d:Da[e]}),"left"!==e&&"top"!==e&&"bottom"!==e||(this.directionSVG.x=a-13,this.directionSVG.y=s+(n-10)/2),"right"===e&&(this.directionSVG.x=a+o+3,this.directionSVG.y=s+(n-10)/2)}if("target"===this.direction){var r=Vo(this.parent.toState.getCenter(),this.parent.fromState),c=this.getBBox(),l=c.width,d=c.height,u=c.x,h=c.y;this.directionSVG.setAttrs({d:Da[r]}),"left"!==r&&"top"!==r&&"bottom"!==r||(this.directionSVG.x=u-13,this.directionSVG.y=h+(d-10)/2),"right"===r&&(this.directionSVG.x=u+l+3,this.directionSVG.y=h+(d-10)/2)}this.resetDirectionOpacity()}}},{key:"resetDirectionOpacity",value:function(){""!==this.text&&""!==this.direction&&this.parent.fromStateId!==this.parent.toStateId?this.directionSVG.opacity=1:this.directionSVG.opacity=0}},{key:"initLine",value:function(){this.lineSVG&&zo(this.lineSVG);var t=this.getBBox(),e=t.width,i=t.height,o=t.x,n=t.y;this.lineSVG=new sving.Path,this.lineSVG.setAttrs({d:"M ".concat(this.origin.x-this.x," ").concat(this.origin.y-this.y," L ").concat(o+e/2," ").concat(n+i/2),stroke:this.active?Sa:"none","stroke-dasharray":"2,2"}),this.add(this.lineSVG)}},{key:"setPos",value:function(t,e){var i=this.getBBox(),o=i.width,n=i.height;this.x=t-o/2,this.y=e-n/2}},{key:"getBBox",value:function(){return this.mainSVG.getBBox()}},{key:"updateText",value:function(t,e,i){this.text=t,this.fontSize=e,this.fontColor=i,this.mainSVG.textContent=t,this.mainSVG.font="".concat(this.fontSize,"px sans-serif"),this.mainSVG.setAttrs({fill:this.fontColor})}},{key:"setActive",value:function(t){this.active=t,t?this.initLine():this.lineSVG&&zo(this.lineSVG)}},{key:"initEvents",value:function(){var t=this;this.draggable&&(this.onDragStart((function(){t.isMove=!1,t.beforeData=t.parent.exportData()})),this.onDrag((function(e,i){0===e&&0===i||(t.isMove=!0),t.x+=e/window.diagramScale,t.y+=i/window.diagramScale;var o=t.getBBox(),n=o.width,a=o.height,s=o.x,r=o.y;t.lineSVG.setAttrs({d:"M ".concat(t.origin.x-t.x," ").concat(t.origin.y-t.y," L ").concat(s+n/2," ").concat(r+a/2)}),t.updatePos({x:t.x-t.origin.x,y:t.y-t.origin.y})})),this.onDragEnd((function(){t.isMove&&(t.isMove=!1,t.afterData=t.parent.exportData(),window.store.pushStack({actionType:To.moveRole,data:{beforeData:{nodeList:[t.beforeData]},afterData:{nodeList:[t.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.moveRole))})),this.on("mousedown",(function(){t.setActive(!0),zi.$emit("xClass:cancelAddNew")})),this.on("mouseup",(function(){t.setActive(!1)})))}}]),i}(sving.Group);function Aa(t){var e=La();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function La(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ta=function(t){Object(L["a"])(i,t);var e=Aa(i);function i(t){var o,n=t.store,a=t.transition,s=t.statement,r=t.dragPoint,c=t.done,l=t.updatePointFunc,d=t.endpointType;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.store=n,o.transition=a,o.updatePointFunc=l,o.statement=s,o.dragPoint=r,o.endpointType=d,o.originNodeName=s.nodeName,o.startPoint=null,o.beforeData=o.transition.exportData(),o.done=c||function(){},o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(t){this.startPoint=new Fi.a(t.x,t.y);var e=this.transition,i=e.ca,o=e.cb;this.originCA=new Fi.a(i.x,i.y),this.originCB=new Fi.a(o.x,o.y)}},{key:"setMouseMove",value:function(t){var e=this.store.statementList,i=e.find((function(e){return e.isPointIn(t)}));i||this.statement.setActive(!1),i&&i.id!==this.statement&&(this.statement.setActive(!1),i.setActive(!0),this.statement=i),this.transition[this.updatePointFunc](t)}},{key:"setMouseUp",value:function(t){var e=this.statement.isPointIn(t);if(e&&this.statement.nodeName===this.originNodeName){var i;if("from"===this.endpointType&&(this.transition.fromState=this.statement,this.transition.fromStateId=this.statement.id,this.transition.dataModel.fromState=this.statement,i=[t,this.transition.to]),"to"===this.endpointType&&(this.transition.toState=this.statement,this.transition.toStateId=this.statement.id,this.transition.dataModel.toState=this.statement,i=[this.transition.from,t]),this.transition.fromStateId===this.transition.toStateId){var o=fn(this.transition.fromState,t),n=o.from,a=o.to;this.transition.updateFromPoint(n),this.transition.updateToPoint(a)}else{var s=dn(this.transition,i,this.endpointType),r=s.from,c=s.to;this.transition.updateFromPoint(r),this.transition.updateToPoint(c),this.transition.updateDirection()}this.afterData=this.transition.exportData(),window.store.pushStack({actionType:To.dragTransitionEndpoints,data:{beforeData:{nodeList:[this.beforeData]},afterData:{nodeList:[this.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.dragTransitionEndpoints)}else this.transition[this.updatePointFunc](this.startPoint),this.transition.setTextCenter();this.dragPoint.cursor="crosshair",this.done()}}]),i}(Mn);function Ea(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Oa(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ea(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ea(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ja(t){var e=Pa();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Pa(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var za=function(t){Object(L["a"])(i,t);var e=ja(i);function i(t){var o,n=t.store,a=t.id,s=void 0===a?_o("transition"):a,r=t.from,c=t.to,l=t.ca,d=t.cb,u=t.fromStateId,h=t.toStateId,f=t.fromState,g=void 0===f?null:f,p=t.toState,m=void 0===p?null:p,y=t.status,v=void 0===y?"formal":y,w=t.color,x=void 0===w?io:w,C=t.fontSize,b=void 0===C?12:C,I=t.fontColor,k=void 0===I?Vi:I,S=t.relation,D=void 0===S?"Association":S,N=t.stereotype,A=void 0===N?[]:N,L=t.sourceMultiplicity,T=void 0===L?"":L,E=t.targetMultiplicity,O=void 0===E?"":E,j=t.sourceRoleName,P=void 0===j?"":j,z=t.targetRoleName,R=void 0===z?"":z,B=t.sourceMultiplicitySVGPos,G=t.targetMultiplicitySVGPos,_=t.sourceRoleNameSVGPos,F=t.targetRoleNameSVGPos,U=t.remark,Z=void 0===U?"":U,Y=t.remarkDirection,H=void 0===Y?"":Y;return Object(M["a"])(this,i),o=e.call(this),o.store=n,o.id=s,o.nodeName="relation",o.relation=D,o.remark=Z,o.remarkDirection=H,o.stereotype=A,o.sourceMultiplicity=T,o.targetMultiplicity=O,o.sourceRoleName=P,o.targetRoleName=R,o.sourceMultiplicitySVGPos=B,o.targetMultiplicitySVGPos=G,o.sourceRoleNameSVGPos=_,o.targetRoleNameSVGPos=F,o.fromStateId=u,o.fromState=g,o.toStateId=h,o.toState=m,o.color=x,o.fontSize=b,o.fontColor=k,o.isActive=!1,o.status=v,o.moveStartPoint=null,o.mainSVG=new ba({from:r,to:c,moveable:!1,isNeedCtrlPoint:!1,onPointsDrag:function(){o.setTextCenter()}}),o.isDrag=!1,o.initClick(),o.setEndArrow(),o.updateColor(o.color),"guide"===o.status?o.mainSVG.setAttrs({"stroke-dasharray":"5,5",stroke:io}):o.initDrag(),l&&d?(o.updateCa(l),o.updateCb(d)):o.initControlPoints(),o.initText(),o.initMultiplicity(),o.initRoleName(),o.add(o.mainSVG),o.initEvents(),o.dataModel={relation:D,remark:Z,fromState:g,toState:m,stereotype:A,sourceMultiplicity:T,targetMultiplicity:O,sourceRoleName:P,targetRoleName:R,color:x,fontColor:k,fontSize:b},o}return Object(k["a"])(i,[{key:"to",get:function(){return this.mainSVG.to}},{key:"from",get:function(){return this.mainSVG.from}},{key:"ca",get:function(){return this.mainSVG.ca}},{key:"cb",get:function(){return this.mainSVG.cb}},{key:"gc",value:function(){this.fromState=null,this.toState=null,this.mainSVG=null,this.sourceMultiplicity=null,this.targetMultiplicity=null,this.sourceRoleName=null,this.targetRoleName=null}},{key:"initClick",value:function(){var t=this;this.on("mousedown",(function(e){e.stopPropagation(),t.isDrag=!0,zi.$emit("xClass:cancelAddNew")})),this.on("mouseup",(function(){t.isDrag=!1}))}},{key:"initDrag",value:function(){var t=this;this.mainSVG.eventCurvePath.cursor="move",this.mainSVG.eventCurvePath.onDragStart((function(){t.isMove=!1,t.beforeData=t.exportData()})),this.mainSVG.eventCurvePath.onDrag((function(e,i){if(0===e&&0===i||(t.isMove=!0),t.isDrag){var o=gn(t,e,i),n=o.from,a=o.to;t.updateFromPoint(n),t.updateToPoint(a)}})),this.mainSVG.eventCurvePath.onDragEnd((function(){t.isMove&&(t.isMove=!1,t.afterData=t.exportData(),window.store.pushStack({actionType:To.moveTransition,data:{beforeData:{nodeList:[t.beforeData]},afterData:{nodeList:[t.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.moveTransition))}))}},{key:"updateColor",value:function(t){this.color=t;var e=this.mainSVG.curvePath;e.setAttrs({stroke:t}),this.mainSVG.endArrow.setAttrs({stroke:t})}},{key:"initControlPoints",value:function(){if(this.fromStateId===this.toStateId&&"guide"!==this.status){var t=rn(this.from,this.to,this.fromState),e=t.ca,i=void 0===e?this.ca:e,o=t.cb,n=void 0===o?this.cb:o;this.updateCa(i),this.updateCb(n)}else{var a=this.to.x-this.from.x,s=this.to.y-this.from.y,r={x:this.from.x+a/3,y:this.from.y+s/3},c={x:this.from.x+a/3*2,y:this.from.y+s/3*2};this.updateCa(r),this.updateCb(c)}}},{key:"initMultiplicity",value:function(){var t=this;this.sourceMultiplicitySVG=new Na({text:this.sourceMultiplicity,bgColor:"none",fontSize:this.fontSize,fontColor:this.fontColor,origin:this.from,updatePos:function(e){return t.sourceMultiplicitySVGPos=e}}),""!==this.sourceMultiplicity&&this.add(this.sourceMultiplicitySVG),this.sourceMultiplicitySVG.onAddedToStage((function(){t.setMultiplicityPos(t.from,t.fromState,t.sourceMultiplicitySVG,t.sourceMultiplicitySVGPos)})),this.targetMultiplicitySVG=new Na({text:this.targetMultiplicity,bgColor:"none",fontSize:this.fontSize,fontColor:this.fontColor,origin:this.to,updatePos:function(e){return t.targetMultiplicitySVGPos=e}}),""!==this.targetMultiplicity&&this.add(this.targetMultiplicitySVG),this.targetMultiplicitySVG.onAddedToStage((function(){t.setMultiplicityPos(t.to,t.toState,t.targetMultiplicitySVG,t.targetMultiplicitySVGPos)}))}},{key:"setMultiplicityPos",value:function(t,e,i,o){if("guide"!==this.status&&null!==e){var n=t.x,a=t.y;if(o)i.x=n+o.x,i.y=a+o.y;else{var s=Ho(t,e),r=s.side,c={right:{dx:10,dy:-10},left:{dx:-25,dy:-10},top:{dx:10,dy:-10},bottom:{dx:10,dy:20}};i.x=n+c[r].dx,i.y=a+c[r].dy}}else zo(i)}},{key:"initRoleName",value:function(){var t=this;this.sourceRoleNameSVG=new Na({text:this.sourceRoleName?"+ "+this.sourceRoleName:"",bgColor:"none",fontSize:this.fontSize,fontColor:this.fontColor,origin:this.from,updatePos:function(e){return t.sourceRoleNameSVGPos=e}}),""!==this.sourceRoleName&&this.add(this.sourceRoleNameSVG),this.sourceRoleNameSVG.onAddedToStage((function(){t.setRoleNamePos(t.from,t.fromState,t.sourceRoleNameSVG,t.sourceRoleNameSVGPos)})),this.targetRoleNameSVG=new Na({text:this.targetRoleName?"+ "+this.targetRoleName:"",bgColor:"none",fontSize:this.fontSize,fontColor:this.fontColor,origin:this.to,updatePos:function(e){return t.targetRoleNameSVGPos=e}}),""!==this.targetRoleName&&this.add(this.targetRoleNameSVG),this.targetRoleNameSVG.onAddedToStage((function(){t.setRoleNamePos(t.to,t.toState,t.targetRoleNameSVG,t.targetRoleNameSVGPos)}))}},{key:"setRoleNamePos",value:function(t,e,i,o){if("guide"!==this.status&&null!==e){var n=t.x,a=t.y;if(o)i.x=n+o.x,i.y=a+o.y;else{var s=i.getBBox(),r=s.width,c=Ho(t,e),l=c.side,d={right:{dx:10,dy:20},left:{dx:-r-10,dy:20},top:{dx:-r-10,dy:-10},bottom:{dx:-r-10,dy:20}};i.x=n+d[l].dx,i.y=a+d[l].dy}}else zo(i)}},{key:"initText",value:function(){var t=this,e=this.stereotype.length?"《".concat(this.stereotype.join(","),"》"):"";this.textSVG=new Na({text:e,bgColor:"none",fontSize:this.fontSize,fontColor:this.fontColor,draggable:!1}),this.stereotype.length&&this.add(this.textSVG),this.remarkSVG=new Na({text:this.remark,bgColor:"none",fontSize:this.fontSize,fontColor:this.fontColor,direction:this.remarkDirection,draggable:!1}),""!==this.remark&&this.add(this.remarkSVG),this.textSVG.onAddedToStage((function(){t.setTextCenter()})),this.remarkSVG.onAddedToStage((function(){t.setTextCenter()}))}},{key:"updateText",value:function(){if(this.textSVG){var t=this.stereotype.length?"《".concat(this.stereotype.join(","),"》"):"";this.textSVG.updateText(t,this.fontSize,this.fontColor),this.stereotype.length?this.add(this.textSVG):zo(this.textSVG),this.remarkSVG.updateText(this.remark,this.fontSize,this.fontColor),""!==this.remark?this.add(this.remarkSVG):zo(this.remarkSVG),this.setTextCenter()}}},{key:"setTextCenter",value:function(){if(this.textSVG&&"guide"!==this.status){var t=new Fi.a(this.from.x,this.from.y),e=new Fi.a(this.to.x,this.to.y),i=new Fi.a(this.mainSVG.ca.x,this.mainSVG.ca.y),o=new Fi.a(this.mainSVG.cb.x,this.mainSVG.cb.y),n=Jo(t,i,o,e,.5);this.remarkSVG.setPos(n.x,n.y),this.textSVG.setPos(n.x,n.y+20)}}},{key:"updateFromPoint",value:function(t){t&&(this.mainSVG.updateFromPoint(t.x,t.y),this.initControlPoints(),this.setTextPos(),"guide"!==this.status&&this.setEndArrow())}},{key:"updateToPoint",value:function(t){t&&(this.mainSVG.updateToPoint(t.x,t.y),this.initControlPoints(),this.setTextPos(),"guide"!==this.status&&this.setEndArrow())}},{key:"updateCa",value:function(t){this.mainSVG.updateControlPointA(t.x,t.y)}},{key:"updateCb",value:function(t){this.mainSVG.updateControlPointB(t.x,t.y)}},{key:"setActive",value:function(t,e){this.isActive=t;var i=t?"#07C160":io;this.mainSVG.setAttr("stroke",i),t?this.mainSVG.select():this.mainSVG.unselect(),e&&"class"===this.fromState.nodeName&&"class"===this.toState.nodeName&&zi.$emit("xClass:editLine",this.dataModel,this)}},{key:"setTextPos",value:function(){this.setTextCenter(),this.setMultiplicityPos(this.from,this.fromState,this.sourceMultiplicitySVG,this.sourceMultiplicitySVGPos),this.setMultiplicityPos(this.to,this.toState,this.targetMultiplicitySVG,this.targetMultiplicitySVGPos),this.setRoleNamePos(this.from,this.fromState,this.sourceRoleNameSVG,this.sourceRoleNameSVGPos),this.setRoleNamePos(this.to,this.toState,this.targetRoleNameSVG,this.targetRoleNameSVGPos)}},{key:"updateDirection",value:function(){this.remarkSVG.updateDirection(this.remarkDirection)}},{key:"initEvents",value:function(){var t=this;this.on("click",(function(e){e.stopPropagation(),t.store.setActiveNode(t)})),this.on("dblclick",(function(e){e.stopPropagation(),zi.$emit("xClass:setRightPanelShow",!0),t.store.setActiveNode(t)})),this.on("contextmenu",(function(e){e.stopPropagation(),e.preventDefault(),t.store.setActiveNode(t);var i=t.fromStateId===t.toStateId;window.contextmenu({items:[!i&&{label:"关系备注指向",divided:!0,children:[{label:"无",icon:""===t.remarkDirection?"el-icon-check":"",onClick:function(){zi.$emit("xClass:cancelAddNew"),t.remarkDirection="",t.updateDirection(),zi.$emit("xClass:autoSave",To.updateDirection)}},{label:"指向源",icon:"source"===t.remarkDirection?"el-icon-check":"",onClick:function(){zi.$emit("xClass:cancelAddNew"),t.remarkDirection="source",t.updateDirection(),zi.$emit("xClass:autoSave",To.updateDirection)}},{label:"指向目标",icon:"target"===t.remarkDirection?"el-icon-check":"",onClick:function(){zi.$emit("xClass:cancelAddNew"),t.remarkDirection="target",t.updateDirection(),zi.$emit("xClass:autoSave",To.updateDirection)}}]},{label:"删除",onClick:function(){zi.$emit("xClass:removeElement"),zi.$emit("xClass:cancelAddNew")}}],event:e,zIndex:1e3,minWidth:230});var o=Go(window.stage,e);zi.$emit("xClass:showContextToolbar",{point:o,origin:{x:t.store.x,y:t.store.y},node:t})}));var e=function(e){var i=new Fi.a(t.mainSVG[e].x,t.mainSVG[e].y);t.store.mouseEvent.setMouseMove(i)},i=function(e){var i=new Fi.a(t.mainSVG[e].x,t.mainSVG[e].y);t.store.mouseEvent.setMouseUp(i),t.store.workState=mo.NORMAL},o=function(o){if(t.store.workState===mo.NORMAL){var n,a,s,r=t.store,c=t.mainSVG[o];r.workState=mo.DRAG_TRANSITION_ENDPOINT,"to"===o?(n=t.toState,a=t.mainSVG.toPoint,s="updateToPoint"):(n=t.fromState,a=t.mainSVG.fromPoint,s="updateFromPoint"),r.mouseEvent=new Ta({store:r,transition:t,statement:n,dragPoint:a,updatePointFunc:s,endpointType:o,done:function(){r.workState=mo.NORMAL,r.mouseEvent=null,a.offDrag(e),a.offDragEnd(i)}}),r.mouseEvent.setMouseDown({x:c.x,y:c.y}),a.onDrag((function(){e(o)})),a.onDragEnd((function(){i(o)}))}};this.mainSVG.toPoint.onDragStart((function(){o("to")})),this.mainSVG.fromPoint.onDragStart((function(){o("from")}));var n=function(){t.store.workState=mo.DRAG_TRANSITION_CTRLPOINT},a=function(){t.store.workState=mo.NORMAL};this.mainSVG.controlPointA.onDragStart(n),this.mainSVG.controlPointA.onDragEnd(a),this.mainSVG.controlPointB.onDragStart(n),this.mainSVG.controlPointB.onDragEnd(a)}},{key:"exportData",value:function(){return{id:this.id,stereotype:this.stereotype,sourceMultiplicity:this.sourceMultiplicity,targetMultiplicity:this.targetMultiplicity,sourceRoleName:this.sourceRoleName,targetRoleName:this.targetRoleName,sourceMultiplicitySVGPos:this.sourceMultiplicitySVGPos,targetMultiplicitySVGPos:this.targetMultiplicitySVGPos,sourceRoleNameSVGPos:this.sourceRoleNameSVGPos,targetRoleNameSVGPos:this.targetRoleNameSVGPos,remark:this.remark,remarkDirection:this.remarkDirection,nodeName:this.nodeName,relation:this.relation,color:this.color,fontSize:this.fontSize,fontColor:this.fontColor,from:new Fi.a(this.mainSVG.from.x,this.mainSVG.from.y),to:new Fi.a(this.mainSVG.to.x,this.mainSVG.to.y),ca:new Fi.a(this.mainSVG.ca.x,this.mainSVG.ca.y),cb:new Fi.a(this.mainSVG.cb.x,this.mainSVG.cb.y),fromStateId:this.fromState&&this.fromState.id,toStateId:this.toState&&this.toState.id}}},{key:"updateDataModel",value:function(t){this.dataModel=Oa(Oa({},this.dataModel),t)}},{key:"updateData",value:function(t){var e=t.stereotype,i=t.sourceMultiplicity,o=t.targetMultiplicity,n=t.sourceRoleName,a=t.targetRoleName,s=t.remark,r=t.color,c=t.fontSize,l=t.fontColor,d=t.sourceMultiplicitySVGPos,u=t.targetMultiplicitySVGPos,h=t.sourceRoleNameSVGPos,f=t.targetRoleNameSVGPos;this.stereotype=e,this.remark=s,this.fontSize=c,this.fontColor=l,this.sourceMultiplicitySVGPos=d,this.targetMultiplicitySVGPos=u,this.sourceRoleNameSVGPos=h,this.targetRoleNameSVGPos=f,this.updateText(),this.updateColor(r),this.sourceMultiplicity=i,this.targetMultiplicity=o,this.sourceMultiplicitySVG.updateText(this.sourceMultiplicity,this.fontSize,this.fontColor),this.targetMultiplicitySVG.updateText(this.targetMultiplicity,this.fontSize,this.fontColor),this.setMultiplicityPos(this.from,this.fromState,this.sourceMultiplicitySVG,this.sourceMultiplicitySVGPos),this.setMultiplicityPos(this.to,this.toState,this.targetMultiplicitySVG,this.targetMultiplicitySVGPos),""!==this.sourceMultiplicity?this.add(this.sourceMultiplicitySVG):zo(this.sourceMultiplicitySVG),""!==this.targetMultiplicity?this.add(this.targetMultiplicitySVG):zo(this.targetMultiplicitySVG),this.sourceRoleName=n,this.targetRoleName=a,this.sourceRoleNameSVG.updateText(this.sourceRoleName?"+ "+this.sourceRoleName:"",this.fontSize,this.fontColor),this.targetRoleNameSVG.updateText(this.targetRoleName?"+ "+this.targetRoleName:"",this.fontSize,this.fontColor),this.setRoleNamePos(this.from,this.fromState,this.sourceRoleNameSVG,this.sourceRoleNameSVGPos),this.setRoleNamePos(this.to,this.toState,this.targetRoleNameSVG,this.targetRoleNameSVGPos),""!==this.sourceRoleName?this.add(this.sourceRoleNameSVG):zo(this.sourceRoleNameSVG),""!==this.targetRoleName?this.add(this.targetRoleNameSVG):zo(this.targetRoleNameSVG),this.setTextPos(),this.updateDataModel(t)}},{key:"setEndArrow",value:function(){if(this.mainSVG.remove(this.mainSVG.endArrow),"guide"!==this.status){var t=0;switch(t=this.fromStateId===this.toStateId?mn(this):Uo(this.mainSVG.from,this.mainSVG.to),this.relation){case"NoteLink":this.mainSVG.setAttrs({"stroke-dasharray":"5,5"}),this.mainSVG.endArrow=new sving.Path("M 0,0"),this.mainSVG.add(this.mainSVG.endArrow);break;case"Association":this.mainSVG.setAttrs({"stroke-dasharray":"0"}),this.mainSVG.endArrow=new sving.Path("M 0,0"),this.mainSVG.add(this.mainSVG.endArrow);break;case"Directed Association":this.mainSVG.setAttrs({"stroke-dasharray":"0"}),this.mainSVG.endArrow=new sving.Path("M 0,0 L 12,6 L 0,12"),this.mainSVG.endArrow.x=this.mainSVG.to.x,this.mainSVG.endArrow.y=this.mainSVG.to.y,this.mainSVG.endArrow.originX=12,this.mainSVG.endArrow.originY=6,this.mainSVG.endArrow.rotation=t,this.mainSVG.endArrow.setAttrs({fill:"transparent",stroke:this.color}),this.mainSVG.add(this.mainSVG.endArrow);break;case"Aggregation":this.mainSVG.setAttrs({"stroke-dasharray":"0"}),this.mainSVG.endArrow=new sving.Path("M 0,6 L 10,12 L 20,6 L 10,0 L 0,6"),this.mainSVG.endArrow.x=this.mainSVG.to.x,this.mainSVG.endArrow.y=this.mainSVG.to.y,this.mainSVG.endArrow.originX=20,this.mainSVG.endArrow.originY=6,this.mainSVG.endArrow.rotation=t,this.mainSVG.endArrow.setAttrs({fill:eo,stroke:this.color}),this.mainSVG.add(this.mainSVG.endArrow);break;case"Composition":this.mainSVG.setAttrs({"stroke-dasharray":"0"}),this.mainSVG.endArrow=new sving.Path("M 0,6 L 10,12 L 20,6 L 10,0 L 0,6"),this.mainSVG.endArrow.x=this.mainSVG.to.x,this.mainSVG.endArrow.y=this.mainSVG.to.y,this.mainSVG.endArrow.originX=20,this.mainSVG.endArrow.originY=6,this.mainSVG.endArrow.rotation=t,this.mainSVG.endArrow.setAttrs({fill:io,stroke:this.color}),this.mainSVG.add(this.mainSVG.endArrow);break;case"Realization":this.mainSVG.setAttrs({"stroke-dasharray":"5,5"}),this.mainSVG.endArrow=new sving.Path("M 0,0 L 12,6 L 0,12 L 0,0"),this.mainSVG.endArrow.x=this.mainSVG.to.x,this.mainSVG.endArrow.y=this.mainSVG.to.y,this.mainSVG.endArrow.originX=12,this.mainSVG.endArrow.originY=6,this.mainSVG.endArrow.rotation=t,this.mainSVG.endArrow.setAttrs({fill:eo,stroke:this.color,"stroke-dasharray":"0"}),this.mainSVG.add(this.mainSVG.endArrow);break;case"Dependency":this.mainSVG.setAttrs({"stroke-dasharray":"5,5"}),this.mainSVG.endArrow=new sving.Path("M 0,0 L 12,6 L 0,12"),this.mainSVG.endArrow.x=this.mainSVG.to.x,this.mainSVG.endArrow.y=this.mainSVG.to.y,this.mainSVG.endArrow.originX=12,this.mainSVG.endArrow.originY=6,this.mainSVG.endArrow.rotation=t,this.mainSVG.endArrow.setAttrs({fill:"transparent",stroke:this.color,"stroke-dasharray":"0"}),this.mainSVG.add(this.mainSVG.endArrow);break;case"Generalization":this.mainSVG.setAttrs({"stroke-dasharray":"0"}),this.mainSVG.endArrow=new sving.Path("M 0,0 L 12,6 L 0,12 L 0,0"),this.mainSVG.endArrow.x=this.mainSVG.to.x,this.mainSVG.endArrow.y=this.mainSVG.to.y,this.mainSVG.endArrow.originX=12,this.mainSVG.endArrow.originY=6,this.mainSVG.endArrow.rotation=t,this.mainSVG.endArrow.setAttrs({fill:eo,stroke:this.color,"stroke-dasharray":"0"}),this.mainSVG.add(this.mainSVG.endArrow);break}}}}]),i}(sving.Group);function Ra(t){var e=Ba();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Ba(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ga={FAIL:0,SELF:1,OTHER_STATE:2,NEW_STATE:3},_a=function(t){Object(L["a"])(i,t);var e=Ra(i);function i(t){var o,n=t.store,a=t.fromState,s=t.toState,r=void 0===s?null:s,c=t.from,l=t.to,d=void 0===l?null:l,u=t.done;return Object(M["a"])(this,i),o=e.call(this,{store:n}),o.store=n,o.fromState=a,o.toState=r,o.from=c,o.to=d,o.done=u||function(){},o.transition=null,o.moveStatus=!0,o.before(),o}return Object(k["a"])(i,[{key:"setMouseDown",value:function(){var t=this.from;this.transition=new za({from:{x:t.x,y:t.y},to:{x:t.x,y:t.y},status:"guide"}),this.store.add(this.transition)}},{key:"setMouseMove",value:function(t){this.moveStatus&&this.transition.updateToPoint(t)}},{key:"setMouseUp",value:function(t){if(this.moveStatus){var e=this.getCreateStatus(t),i=e.status,o=e.toState;switch(i){case Ga.FAIL:this.destory();break;case Ga.SELF:this.createSelfTransition(t);break;case Ga.OTHER_STATE:this.createNewTransition(t,o);break;case Ga.NEW_STATE:this.createNewStatement(t);break;default:this.destory()}}}},{key:"destory",value:function(t){this.transition&&(this.store.remove(this.transition),this.transition=null),this.done(t),this.after()}},{key:"createSelfTransition",value:function(t){var e=this;this.moveStatus=!1;var i=function(i){if(i){var o=fn(e.fromState,t),n=o.from,a=o.to,s=rn(n,a,e.fromState),r=s.ca,c=s.cb,l={from:n,to:a,ca:r,cb:c,fromStateId:e.fromState.id,toStateId:e.fromState.id,relation:i,id:_o("transition"),nodeName:"relation"};e.destory(l),window.store.pushStack({actionType:To.createSelfTransition,data:{nodeList:[l]},type:"undo"}),zi.$emit("xClass:autoSave",To.createSelfTransition)}else e.destory()};zi.$emit("xClass:showRelationBoard",{point:t,origin:{x:this.store.x,y:this.store.y},position:t,callback:i})}},{key:"lineToOtherStatement",value:function(t,e,i){var o=this.fromState,n=o.getCenter(),a=this.fromState.getIntersection(t,n),s=e.getIntersection(n,t),r={from:a,to:s,fromStateId:o.id,toStateId:e.id,relation:i,id:_o("transition"),nodeName:"relation"};return this.destory(r),r}},{key:"createNewTransition",value:function(t){var e=this;this.moveStatus=!1;var i=this.getCreateStatus(t),o=i.toState,n="note"===this.fromState.nodeName||"note"===o.nodeName;if(n){var a=this.lineToOtherStatement(t,o,"NoteLink");return window.store.pushStack({actionType:To.lineToOtherNote,data:{nodeList:[a]},type:"undo"}),void zi.$emit("xClass:autoSave",To.lineToOtherNote)}var s=function(i){if(i){var n=e.lineToOtherStatement(t,o,i);window.store.pushStack({actionType:To.lineToOtherClass,data:{nodeList:[n]},type:"undo"}),zi.$emit("xClass:autoSave",To.lineToOtherClass)}else e.destory()};zi.$emit("xClass:showRelationBoard",{point:t,origin:{x:this.store.x,y:this.store.y},position:t,callback:s})}},{key:"createNewStatement",value:function(t){var e=this;this.moveStatus=!1;var i="note"===this.fromState.nodeName;if(i)this.destory();else{var o=function(i,o){if(i&&o){var n=e.lineToOtherStatement(t,i,o);window.store.pushStack({actionType:To.lineToNewStatement,data:{nodeList:[i.exportData(),n]},type:"undo"}),zi.$emit("xClass:autoSave",To.lineToNewStatement)}else e.destory()},n=new Fi.a(t.x,t.y),a=new Fi.a(t.x-this.from.x,t.y-this.from.y),s=a.x,r=a.y;s>0&&s>=Math.abs(r)?n.y=t.y-ao/2:r>0&&r>=Math.abs(s)?n.x=t.x-no/2:s<0&&Math.abs(s)>=Math.abs(r)?(n.x=t.x-no,n.y=t.y-ao/2):(n.x=t.x-no/2,n.y=t.y-ao),zi.$emit("xClass:showInsertBoard",{point:t,origin:{x:this.store.x,y:this.store.y},position:n,callback:o})}}},{key:"getCreateStatus",value:function(t){var e,i,o=this.fromState;return o.isPointIn(t)?e="class"===o.nodeName?Ga.SELF:Ga.FAIL:(i=this.store.statementList.find((function(e){return e.isPointIn(t)})),e=i?Ga.OTHER_STATE:Ga.NEW_STATE),{status:e,toState:i}}}]),i}(Mn),Fa=function(){function t(e){var i=e.store,o=e.done;Object(M["a"])(this,t),this.store=i,this.done=o,this.originPoint=null,this.rect=null}return Object(k["a"])(t,[{key:"setMouseDown",value:function(t){this.store.selectedNodes.forEach((function(t){return t.setActive(!1)})),this.store.selectedNodes=[],this.originPoint=t,this.rect=new sving.Rect(0,0),this.rect.x=t.x,this.rect.y=t.y,this.rect.nodeName="multi",this.rect.setAttrs({stroke:"#5AB3EC",fill:"rgba(90,179,236, 0.2)"}),this.store.add(this.rect)}},{key:"setMouseMove",value:function(t){var e=t.x-this.originPoint.x,i=t.y-this.originPoint.y;e<0&&(this.rect.x=this.originPoint.x+e),i<0&&(this.rect.y=this.originPoint.y+i),e=Math.abs(e),i=Math.abs(i),this.rect.width=e,this.rect.height=i,this.rect.setAttrs({width:e,height:i})}},{key:"setMouseUp",value:function(t){var e=this.store.statementList,i=this.rect.x,o=this.rect.y,n=this.rect.x+this.rect.width,a=this.rect.y+this.rect.height,s=e.filter((function(t){return t.x>=i&&t.y>=o&&t.x+t.width<=n&&t.y+t.height<=a}));this.store.activeNode&&this.store.activeNode.setActive(!1),this.store.activeNode=null,this.store.selectedNodes=s,s.forEach((function(t){return t.setActive(!0)})),window.store.children.forEach((function(t){"multi"===t.nodeName&&zo(t)})),this.shadow=null,this.done()}}]),t}();function Ua(t){var e=Za();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Za(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ya=function(t){Object(L["a"])(i,t);var e=Ua(i);function i(t){var o,n=t.store,a=t.position,s=void 0===a?{}:a;return Object(M["a"])(this,i),o=e.call(this),o.store=n,o.nodeName="toolBoard",o.x=s.x,o.y=s.y,o.active=!1,o.initDrawLineTool(),o.initEvents(),o}return Object(k["a"])(i,[{key:"initDrawLineTool",value:function(){this.arrow=new sving.Img("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAKmUlEQVR4Xu2dW+h2YxqHfw6Q0ISxPZFNkimEA/Epyi45sE9mhpMZTpCySSEUIeOAULaNfZQ4kRPS1JjmxJBwIo44ESdCSTbdY618+G/W/az7Wffzfs+16jtb9+a57uf61rve9b7vfztxQAAC6xLYDjYQgMD6BBCE3QGBDQggCNsDAgjCHoBAGQGuIGXciOqEAIJ0MmiWWUYAQcq4EdUJAQTpZNAss4wAgpRxI6oTAgjSyaBZZhkBBCnjRlQnBBCkk0GzzDICCFLGjahOCCBIJ4NmmWUEEKSMG1GdEECQTgbNMssIIEgZN6I6IYAgnQyaZZYRQJAybkR1QgBBOhk0yywjgCBl3IjqhACCdDJolllGAEHKuBHVCQEE6WTQLLOMAIKUcSOqEwII0smgWWYZAQQp40ZUJwQQpJNBs8wyAghSxo2oTgggSCeDZpllBBCkjBtRnRBAkE4GzTLLCCBIGTeiOiGAIJ0MmmWWEUCQMm5EdUIAQToZNMssI4AgZdyI6oQAgnQyaJZZRgBByrgR1QkBBOlk0CyzjACClHEjqhMCCJI/6EMkXSzpNEnHSHpf0r8lPSzpf/nt9d0BguTN39g/KOkSSTut0caPku6QdENei1RGkJw9YNxfkHTehPL3SrpqwnmcUoEAglSAuklKjxxjqtsk3bR8q1REkGX3QIkcY4f/kHTtsu1SDUGW2wNz5Bi7fEDS5cu1TCUEWWYPGOfnJZ0fUO4xSX8LyEOKCQQQZAKkmadEyjG28oykv8zsi/AJBBBkAqQZp9SQY2znxYnvgs1on1AEqbsH7K3ciJdV63X5iqQz6y6h7+wIUm/+teUYO39d0sn1ltF3ZgSpM/+l5Bi7f1PSljpL6TsrgsTPf2k5xhW8NXyWK35FHWdEkNjhZ8kxrsI+6Hi4pB9il9VvNgSJm322HONKPhok+SZuaf1mQpCY2bcix7iaTyUdIemLmOX1mwVB5s++NTnGFZkcJonJwlFIAEEKwQ1hrcoxrurrQRJ72cVRQABBCqCtiBzjyr4fJLEbeA4nAQRxAlsxObZenX2d194K5nAQQBAHrBWWY1ylPUy0h4ocEwkgyERQwXLYy50/+UrrHUlHOmPWOt0+lmIfT+GYQABBJkCqIId96emN6aX/f+aJku6UdKwzbq3T7QOO9kFHjk0IIMi0LRL1bpVdOS6QtFehIJ9IekTSSdPa3vAs+8EI+8g8xwYEEGTz7REtxwfD1aDkCvIvSfsNkpyxeeubnmFfurIvX3GsQwBBNt4aNeQYXy6VCmLxuw2SnBuws+3ru/Y1Xo41CCDI+tuilhwRgliOHSU9GvTVW7snsh+E4PgNAQRZe0vUlCNKkLFzuyeJ+BGHayTdgyG/JoAgv98RteWIFsTy3SfpioDNfaOk2wPybDMpEOTXo1xCjhqCWM67JF0XsDP5FcetICLILzCWkqOWIJb3Fkk3B0jCrzgOEBHkZxBLylFTEMt9/fCr8HM9uT/oZdvcPlLjEWR5OWoLYvmvlGS/Cj/3sHfJ/j43ySrH9y7I0leOca/Yx0bmPAeZsufsnS17h2vu8bSkv85NsqrxPQvyZNDgx4+P2BPyqccSglgvF0l6fHhmMrW3tc57avgrWHNyrGRsr4LYe/53B0ysRI4lXmJtvbSzJP1T0h9mrrfL5yQ9CrKrpC9nbhYLL5VjaUGs3qmSnpC0z4x125+Es/jPZuRYudAeBTlY0oczJzVHjgxBrKZ9WcpeVh4wY+2nSHptRvzKhfYoyPHDX5EtHdZcObIEsbpHSbL7icMKF9/dy6weBbFv8r1XuEEi5MgUxGofKsnemTq6gMHZkl4uiFvZkB4F2UPS5wUTi5IjWxCrv/9wJTnByeEgSR87Y1b69B4FsYHZ/6B/dkwuUo4WBLEe9hwkOW0ihy6fh/QqiO0J++XB3Sdsjmg5WhHE+th5kMReOm10GKs/TmC1zZ3SsyA2zOckXbjBVGvI0ZIg1ovtAXsmdPU6HIyRPXDs8uhdEBu6fQLWbljt377DLrD3+p8dPqrheUI+dRMt9SR9aj923sWSTh/+xsjekv4r6T+SbvUk2dbORZCcibYoSA6JxqsiSM6AECSHu7sqgriRhQQgSAjG+kkQpD7jtSogSA53d1UEcSMLCUCQEIz1kyBIfcZcQXIYh1RFkBCM7iRcQdzIcgIQJIc7guRwd1dFEDeykAAECcFYPwmC1GfMPUgO45CqCBKC0Z2EK4gbWU4AguRwR5Ac7u6qCOJGFhKAICEY6ydBkPqMuQfJYRxSFUFCMLqTcAVxI8sJQJAc7giSw91dFUHcyEICECQEY/0kCFKfMfcgOYxDqiJICEZ3Eq4gbmQ5AQiSwx1Bcri7qyKIG1lIAIKEYKyfBEHqM+YeJIdxSFUECcHoTsIVxI0sJwBBcrgjSA53d1UEcSMLCUCQEIz1kyBIfcbcg+QwDqmKICEY3Um4griR5QQgSA53BMnh7q6KIG5kIQEIEoKxfhIEqc+Ye5AcxiFVESQEozsJVxA3spwABMnhjiA53N1VEcSNLCQAQUIw1k+CIPUZcw+SwzikKoKEYHQn4QriRpYTgCA53BEkh7u7KoK4kYUEIEgIxvpJEKQ+Y+5BchiHVEWQEIzuJFxB3MhyAhAkhzuC5HB3V0UQN7KQAAQJwVg/CYLUZ8w9SA7jkKoIEoLRnYQriBtZTgCC5HBHkBzu7qoI4kYWEoAgIRjrJ0GQ+oy5B8lhHFIVQUIwupNwBXEjywlAkBzuCJLD3V0VQdzIQgIQJARj/SQIUp8x9yA5jEOqIkgIRncSriBuZDkBCJLDHUFyuLurIogbWUgAgoRgrJ8EQeoz5h4kh3FIVQQJwehOwhXEjSwnAEFyuCNIDnd3VQRxIwsJQJAQjPWTIEh9xtyD5DAOqYogIRjdSbiCuJHlBCBIDncEyeHuroogbmQhAQgSgrF+EgSpz5h7kBzGIVURJASjOwlXEDeynAAEyeGOIDnc3VURxI0sJOAoSW85M1nM284YTp9JAEFmAiwM317SV5J2mBj/raRdJX038XxOCyKAIEEgC9K8Kem4iXF27paJ53JaIAEECYTpTHWppIcmxlwm6eGJ53JaIAEECYRZkOpVSadvEmfnnFGQm5AAAggSAHFminMk3S3pwN/k+UjStZJempmf8BkEEGQGvMDQXSQdPvyztO8O/+xGniORAIIkwqd0+wQQpP0Z0WEiAQRJhE/p9gkgSPszosNEAgiSCJ/S7RNAkPZnRIeJBBAkET6l2yeAIO3PiA4TCSBIInxKt08AQdqfER0mEkCQRPiUbp8AgrQ/IzpMJIAgifAp3T4BBGl/RnSYSABBEuFTun0CCNL+jOgwkQCCJMKndPsEEKT9GdFhIgEESYRP6fYJIEj7M6LDRAIIkgif0u0TQJD2Z0SHiQQQJBE+pdsngCDtz4gOEwkgSCJ8SrdPAEHanxEdJhJAkET4lG6fAIK0PyM6TCSAIInwKd0+AQRpf0Z0mEgAQRLhU7p9AgjS/ozoMJEAgiTCp3T7BBCk/RnRYSIBBEmET+n2CSBI+zOiw0QCCJIIn9LtE0CQ9mdEh4kEECQRPqXbJ4Ag7c+IDhMJIEgifEq3TwBB2p8RHSYS+AmiR2nY30twWwAAAABJRU5ErkJggg=="),this.arrow.cursor="pointer",this.arrow.setAttrs({width:Wi,height:Wi}),this.add(this.arrow)}},{key:"initEvents",value:function(){var t=this;this.on("mousedown",(function(){t.store.dragNewTransition(t.store.hoverNode)}))}},{key:"show",value:function(){this.active=!0,this.arrow.opacity=1}},{key:"hide",value:function(){this.active=!1,this.arrow.opacity=0}}]),i}(sving.Group);function Ha(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Va(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ha(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ha(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Qa(t){var e=Wa();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Wa(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Xa=function(t){Object(L["a"])(i,t);var e=Qa(i);function i(t){var o,n=t.stage,a=t.name,s=t.id,r=t.x,c=t.y,l=t.diagramMode,d=t.statementList,u=t.transitionList;return Object(M["a"])(this,i),o=e.call(this),o._stage=n,o.name=a,o.id=s,o.isOpenRevision=!1,o.statementList=[],o.transitionList=[],o.activeNode=null,o.hoverNode=null,o.selectedNodes=[],o.undoStack=[],o.redoStack=[],o.copyNodes=[],o.copyNum=0,o.workState=mo.NORMAL,o.initRender({x:r,y:c,statementList:d,transitionList:u,diagramMode:l}),o.initEvents(),o}return Object(k["a"])(i,[{key:"setOverNode",value:function(t){this.hoverNode=t,this.initToolBoard()}},{key:"initToolBoard",value:function(){var t=this;this.children.forEach((function(e){"toolBoard"===e.nodeName&&t.remove(e)})),this.toolBoard=new Ya({store:this,position:{x:this.hoverNode.x+this.hoverNode.width,y:this.hoverNode.y}}),this.add(this.toolBoard)}},{key:"pushStack",value:function(t){var e=t.type,i=t.data,o=t.actionType,n=t.isUserAction,a=void 0===n||n;if(To[o]){var s={actionType:o,data:i};"undo"===e&&(this.undoStack.push(s),a&&(this.redoStack=[])),"redo"===e&&this.redoStack.push(s),zi.$emit("xClass:stackchange",{undoStack:this.undoStack,redoStack:this.redoStack})}}},{key:"clearStack",value:function(){this.undoStack=[],this.redoStack=[]}},{key:"getUndoStack",value:function(){return this.undoStack}},{key:"getRedoStack",value:function(){return this.redoStack}},{key:"setCursor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";document.querySelector("#pan_satge_layer").style.cursor=t}},{key:"gc",value:function(){this.transitionList.forEach((function(t){t.gc(),t=null})),this.statementList.forEach((function(t){t.gc(),t=null})),this.statementList=null,this.transitionList=null,this.selectedNodes=null,this.copyNodes=null,this.undoStack=null,this.redoStack=null,this.activeNode=null,this.hoverNode=null}},{key:"clearStage",value:function(){this.statementList=[],this.transitionList=[],this.selectedNodes=[],this.copyNodes=[],this.undoStack=[],this.redoStack=[],this.copyNum=0,this.workState=mo.NORMAL,zi.$emit("xClass:stackchange",{undoStack:this.undoStack,redoStack:this.redoStack}),this.clear()}},{key:"initRender",value:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(e,i){var o,n,a,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=e.x,n=e.y,a=e.statementList,s=e.transitionList,r=e.diagramMode,this.gc(),this.clearStage(),this.x=o,this.y=n,this.diagramMode=r,!i){t.next=9;break}return t.next=9,nn(a,s);case 9:this.initStatementList(a),this.initTransitionList(s);case 11:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{key:"initEvents",value:function(){var t=this;this._stage.el.oncontextmenu=function(i){return t.setAllNormal(),e=Go(t._stage,i),zi.$emit("xClass:showMenuBoard",{point:e,origin:{x:t.x,y:t.y},position:e,callback:function(){}}),zi.$emit("xClass:closeAllRightPanel"),!1};var e=null;this._stage.el.onmousedown=function(i){e=Go(t._stage,i),zi.$emit("xClass:cancelAddNew")},this._stage.el.onmouseup=function(i){var o=Go(t._stage,i);t.workState!==mo.SHIFT_MULTI_SELECTING&&e&&o.distance(e)},this._stage.el.onclick=function(){t.children.forEach((function(t){"toolBoard"===t.nodeName&&t.hide()})),t.workState!==mo.AFTER_PAN_MULTI_STATEMENT&&zi.$emit("xClass:closeAllRightPanel")};var i=document.querySelector("#svingRoot");window.onmousedown=function(e){if(e.path.includes(i)){var o=Go(t._stage,e);return e.which===vo.LEFT&&t.workState===mo.PAN_STAGE?(t.mouseEvent=new Dn({store:t,done:function(){t.mouseEvent=null,t.workState=mo.NORMAL}}),void t.mouseEvent.setMouseDown(o)):e.which!==vo.LEFT||t.workState!==mo.NORMAL&&t.workState!==mo.AFTER_PAN_MULTI_STATEMENT?void(yo.includes(t.workState)&&t.mouseEvent&&t.mouseEvent.setMouseDown(o)):(t.workState=mo.FRAME_MULTI_SELECTING,t.mouseEvent=new Fa({store:t,done:function(){t.mouseEvent=null,t.selectedNodes.length>1?(t.workState=mo.AFTER_PAN_MULTI_STATEMENT,zi.$emit("xClass:openMultiProperty",t.selectedNodes)):t.workState=mo.NORMAL}}),void t.mouseEvent.setMouseDown(o))}},window.onmousemove=function(e){if(e.path.includes(i)&&e.which===vo.LEFT)if(yo.includes(t.workState)){var o=Go(t._stage,e);t.mouseEvent&&t.mouseEvent.setMouseMove(o)}else;},window.onmouseup=function(e){if(e.which===vo.LEFT&&yo.includes(t.workState)){var i=Go(t._stage,e);t.mouseEvent&&t.mouseEvent.setMouseUp(i)}};var o=["INPUT","TEXTAREA"],n=function(e){var i=e.keyCode;if(i!==Ao.DELETE&&i!==Ao.BACKSPACE||!t.activeNode&&!t.selectedNodes.length||o.includes(e.target.nodeName))return i!==Ao.SPACE||o.includes(e.target.nodeName)?i===Ao.SHIFT?(t.workState=mo.NORMAL,!1):void 0:(document.querySelector("#pan_satge_layer").style.display="none",t.setCursor("default"),void(t.workState===mo.PAN_STAGE&&(t.workState=mo.NORMAL)));zi.$emit("xClass:removeElement")},a=function(e){var i=e.keyCode;if(i===Ao.SPACE&&!o.includes(e.target.nodeName))return document.querySelector("#pan_satge_layer").style.display="block",t.setCursor("grab"),t.workState=mo.PAN_STAGE,!1;if(i===Ao.SHIFT)return t.workState=mo.SHIFT_MULTI_SELECTING,!1;if(!e.metaKey&&!e.ctrlKey||e.keyCode!==Ao.C||o.includes(e.target.nodeName)){if(!e.metaKey&&!e.ctrlKey||e.keyCode!==Ao.V||o.includes(e.target.nodeName))return!e.metaKey&&!e.ctrlKey||e.keyCode!==Ao.A||o.includes(e.target.nodeName)?(!e.metaKey&&!e.ctrlKey||e.keyCode!==Ao.S)&&void 0:(e.preventDefault(),t.setAllNormal(),t.workState=mo.AFTER_PAN_MULTI_STATEMENT,t.selectedNodes=Object(I["a"])(t.statementList),t.selectedNodes.forEach((function(t){return t.setActive(!0)})),void zi.$emit("xClass:openMultiProperty",t.selectedNodes));t.pasteElements()}else t.copyElements()};window.onkeyup=n,window.onkeydown=a,i.onfocus=function(){window.onkeyup=n,window.onkeydown=a},i.onblur=function(){window.onkeyup=function(e){var i=e.keyCode;if(i===Ao.SPACE)return document.querySelector("#pan_satge_layer").style.display="none",t.setCursor("default"),void(t.workState===mo.PAN_STAGE&&(t.workState=mo.NORMAL))},window.onkeydown=function(e){var i=e.keyCode;return i!==Ao.SPACE||o.includes(e.target.nodeName)?(!e.metaKey&&!e.ctrlKey||e.keyCode!==Ao.S)&&void 0:(t.setCursor("grab"),t.workState=mo.PAN_STAGE,!1)}},zi.$on("xClass:removeElement",(function(){var e=[];t.selectedNodes.length>0&&t.selectedNodes.forEach((function(i){t.removeElement(i.id,e)})),zi.$emit("xClass:closeAllRightPanel"),t.pushStack({actionType:To.removeNode,data:{nodeList:e},type:"undo"}),zi.$emit("xClass:autoSave",To.removeNode)})),zi.$on("xClass:setMode",(function(e){t.diagramMode=e,t.statementList.forEach((function(t){return t.setMode&&t.setMode(e)}))}))}},{key:"copyElements",value:function(){this.copyNodes=[],this.copyNodes=this.selectedNodes.map((function(t){return t})),this.copyNum=0}},{key:"pasteElements",value:function(){var t=this;this.statementList.forEach((function(t){t.setActive(!1)})),this.transitionList.forEach((function(t){return t.setActive(!1)})),this.selectedNodes=[],this.activeNode=null;var e=20*++this.copyNum,i=[];if(this.copyNodes.length>1)this.copyNodes.forEach((function(t){var o=t.exportData();o.oldId=o.id,o.id=_o("statement"),o.x+=e,o.y+=e,o.renderType="statement",i.push(o)})),this.transitionList.forEach((function(t){var o=i.find((function(e){return t.fromStateId===e.oldId})),n=i.find((function(e){return t.toStateId===e.oldId}));if(o&&n){var a=t.exportData();a.id=_o("transition"),a.from.x+=e,a.from.y+=e,a.to.x+=e,a.to.y+=e,a.ca.x+=e,a.ca.y+=e,a.cb.x+=e,a.cb.y+=e,a.fromStateId=o.id,a.toStateId=n.id,a.renderType="transition",i.push(a)}}));else if(1===this.copyNodes.length){var o=this.copyNodes[0];if(o.constructor!==za){var n=o.exportData();delete n.id,n.x+=e,n.y+=e,n.renderType="statement",i.push(n)}}var a=[];i.forEach((function(e){if("statement"===e.renderType){var i=e.propertyList,o=void 0===i?[]:i,n=e.operationList,s=void 0===n?[]:n;o.forEach((function(t,i){e.propertyList[i]=Va(Va({},t),{},{key:Object(b["a"])()})})),s.forEach((function(t,i){e.operationList[i]=Va(Va({},t),{},{key:Object(b["a"])()})}));var r=t.addNewStatement(e,e.nodeName);r.setActive(!0),t.selectedNodes.push(r),t.activeNode=r,a.push(r.exportData())}else{var c=t.addNewTransition(e);a.push(c.exportData())}})),i.length&&(this.pushStack({actionType:To.pasteElements,data:{nodeList:a},type:"undo"}),zi.$emit("xClass:autoSave",To.pasteElements))}},{key:"getStage",value:function(){return this._stage}},{key:"setActiveNode",value:function(t){if(this.workState===mo.SHIFT_MULTI_SELECTING)if(t.isActive){var e=this.selectedNodes.findIndex((function(e){return e.id===t.id}));e>-1&&(this.selectedNodes.splice(e,1),this.selectedNodes.length<1&&zi.$emit("xClass:closeAllRightPanel")),t.setActive(!1)}else t.setActive(!0),this.selectedNodes.push(t),this.selectedNodes.length>0&&zi.$emit("xClass:openMultiProperty",this.selectedNodes);else this.setAllNormal(),this.selectedNodes=[],this.selectedNodes.push(t),t.setActive(!0,!0);this.activeNode=t}},{key:"setActiveNodeByUUID",value:function(t){var e=this.children.find((function(e){return e.id===t}));e&&this.setActiveNode(e)}},{key:"dragNewStatement",value:function(t,e){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(t.which===vo.LEFT){var n=Go(this._stage,Bo(t));this.mouseEvent=new va({store:this,done:function(t){if(i.mouseEvent=null,i.workState=mo.NORMAL,t){var o=i.addNewStatement(t,e);setTimeout((function(){var t=document.createEvent("MouseEvents");if(t.initEvent("click",!0,!0),o.el.dispatchEvent(t),"class"===e){var i=document.createEvent("MouseEvents");i.initEvent("dblclick",!0,!0),o.className.nameSVG.el.dispatchEvent(i)}if("note"===e){var n=document.createEvent("MouseEvents");n.initEvent("dblclick",!0,!0),o.noteText.text.el.dispatchEvent(n)}}),100)}}}),this.mouseEvent.setMouseDown(n,e,o),this.workState=mo.DRAG_NEW_STATEMENT}}},{key:"addNewStatement",value:function(t,e){var i,o=Object.assign({},t,{store:this});return"class"===e&&(i=new oa(o)),"note"===e&&(i=new ga(o)),this.statementList.push(i),this.add(i),i}},{key:"dragNewTransition",value:function(t){var e=this;this.workState===mo.NORMAL&&(this.mouseEvent=new _a({store:this,from:t.getCenter(),fromState:t,done:function(t){if(e.mouseEvent=null,e.workState=mo.NORMAL,t){var i=e.addNewTransition(t);e.setActiveNode(i)}}}),this.mouseEvent.setMouseDown(),this.workState=mo.DRAG_NEW_TRANSITION)}},{key:"addNewTransition",value:function(t){t.fromStateId&&!t.fromState&&(t.fromState=this.statementList.find((function(e){return e.id===t.fromStateId}))),t.toStateId&&!t.toState&&(t.toState=this.statementList.find((function(e){return e.id===t.toStateId})));var e=Va(Va({},t),{},{store:this}),i=new za(e);return this.transitionList.push(i),this.add(i),i}},{key:"exportData",value:function(){return{x:this.x,y:this.y,diagramMode:this.diagramMode,statementList:this.statementList.map((function(t){return t.exportData()})),transitionList:this.transitionList.map((function(t){return t.exportData()}))}}},{key:"removeElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t=t||this.activeNode.id,t&&(/^statement-/.test(t)?(this.toolBoard&&zo(this.toolBoard),this.removeStatement(t,e)):this.removeTransition(t,e))}},{key:"removeStatement",value:function(t,e){var i=this,o=this.statementList.findIndex((function(e){return e.id===t})),n=this.children.find((function(e){return e.id===t}));if(o>-1&&n){e.push(n.exportData()),this.statementList.splice(o,1),this.remove(n);var a=this.getTransitionsByStatement(t);a.forEach((function(t){return i.removeTransition(t,e)}))}}},{key:"removeTransition",value:function(t,e){var i=this.transitionList.findIndex((function(e){return e.id===t})),o=this.children.find((function(e){return e.id===t}));i>-1&&o&&(e.push(o.exportData()),this.transitionList.splice(i,1),this.remove(o))}},{key:"getTransitionsByStatement",value:function(t){var e=[];return this.transitionList.forEach((function(i){i.fromStateId!==t&&i.toStateId!==t||e.push(i.id)})),e}},{key:"initStatementList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){t.addNewStatement(e,e.nodeName)}))}},{key:"initTransitionList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){var i=t.statementList.find((function(t){return t.id===e.fromStateId})),o=t.statementList.find((function(t){return t.id===e.toStateId}));i&&o&&t.addNewTransition(e)}))}},{key:"setAllNormal",value:function(){this.workState!==mo.MULTI_SELECTED&&(this.workState=mo.NORMAL,this.activeNode=void 0,this.selectedNodes=[],this.statementList.forEach((function(t){t.setActive(!1)})),this.transitionList.forEach((function(t){return t.setActive(!1)})))}},{key:"updateElementName",value:function(t){var e,i=t.newName,o=t.refMenuNode;o.Type===Lo.CLASS&&(e=this.statementList.find((function(t){return t.id===o.UUId})),e.dataModel.name=i),o.Type===Lo.CLASS_PROPERTY&&(e=this.statementList.find((function(t){return t.id===o.ParentId})),e.propertyList.forEach((function(t){t.key===o.UUId&&(t.name=i)})),e.dataModel.propertyList.forEach((function(t){t.key===o.UUId&&(t.name=i)}))),o.Type===Lo.CLASS_OPERATION&&(e=this.statementList.find((function(t){return t.id===o.ParentId})),e.operationList.forEach((function(t){t.key===o.UUId&&(t.name=i)})),e.dataModel.operationList.forEach((function(t){t.key===o.UUId&&(t.name=i)}))),e.updateData(e.dataModel)}},{key:"getApex",value:function(){var t={minX:0,maxX:0,minY:0,maxY:0};return this.statementList.forEach((function(e){e.x<t.minX&&(t.minX=e.x),e.y<t.minY&&(t.minY=e.y),e.x+e.width+Wi>t.maxX&&(t.maxX=e.x+e.width+Wi),e.y+e.height>t.maxY&&(t.maxY=e.y+e.height)})),t}},{key:"getBound",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={top:1/0,left:1/0,bottom:-1/0,right:-1/0};return this.statementList.forEach((function(t){e.top=Math.min(e.top,t.y),e.left=Math.min(e.left,t.x),e.bottom=Math.max(e.bottom,t.y+t.height),e.right=Math.max(e.right,t.x+t.width)})),e.top===1/0&&(e.top=0),e.left===1/0&&(e.left=0),e.bottom===-1/0&&(e.bottom=0),e.right===-1/0&&(e.right=0),e.width=e.right-e.left,e.height=e.bottom-e.top,t&&(e.left=Math.max(0,e.left),e.top=Math.max(0,e.top),e.right=e.left+e.width,e.bottom=e.top+e.height),e}},{key:"getSize",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=t?450:0,i=this.getApex(),o=i.maxX-i.minX+e+(this.x>0?this.x:0),n=i.maxY-i.minY+e+(this.y>0?this.y:0);return{width:o,height:n}}},{key:"adjustSize",value:function(){var t=this.getSize();window.stage.el.setAttribute("width",Math.max(1e3,t.width,window.innerWidth)),window.stage.el.setAttribute("height",Math.max(1e3,t.height,window.innerHeight));var e=document.querySelector("#pan_satge_layer");e.style.width=Math.max(1e3,t.width,window.innerWidth)+"px",e.style.height=Math.max(1e3,t.height,window.innerHeight)+"px"}},{key:"adjustOrigin",value:function(){var t=this.getApex(),e=t.minX,i=t.minY;this.x=e<0?-e:0,this.y=i<0?-i:0}},{key:"setDiagramMode",value:function(t){zi.$emit("xClass:setDiagramMode",t)}},{key:"openMultiProperty",value:function(){zi.$emit("xClass:openMultiProperty",this.selectedNodes)}}]),i}(sving.Group),Ja=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tool-bar"},[i("div",{staticClass:"tool"},[i("div",{staticClass:"graph-list"},[i("div",{staticClass:"graph-item graph-item-undo",on:{click:t.undo}},[i("el-tooltip",{staticClass:"item",class:{disabled:!t.undoable},attrs:{effect:"light",content:"撤销 Ctrl/⌘+Z",placement:"bottom"}},[i("svg",{staticClass:"toolbar_undo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M8 8.25h6c2.761 0 5 1.989 5 4.75a5 5 0 01-5 5H7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M9 5.372V10.9a.2.2 0 01-.301.173L4.276 8.474a.2.2 0 01-.009-.339l4.423-2.93a.2.2 0 01.31.167z",fill:"currentColor"}})])])])],1),i("div",{staticClass:"graph-item graph-item-redo",on:{click:t.redo}},[i("el-tooltip",{staticClass:"item",class:{disabled:!t.redoable},attrs:{effect:"light",content:"重做 Ctrl/⌘+Shift+Z | Ctrl/⌘+Y",placement:"bottom"}},[i("svg",{staticClass:"toolbar_redo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M16 8.25h-6c-2.761 0-5 1.989-5 4.75a5 5 0 005 5h7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M15 5.372V10.9a.2.2 0 00.301.173l4.423-2.599a.2.2 0 00.009-.339l-4.423-2.93a.2.2 0 00-.31.167z",fill:"currentColor"}})])])])],1)]),i("div",{staticClass:"graph-list"},[i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"class")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"类（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(12,0,0,12,-10,150)"}},[i("rect",{attrs:{width:"60",height:"60",stroke:"black",fill:"rgb(250, 236, 216)","stroke-width":"4",transform:"matrix(1,0,0,1,14,0)"}}),i("line",{attrs:{x1:"0",y1:"4",x2:"60",y2:"4",stroke:"black",fill:"white","stroke-width":"4",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"0",y1:"4",x2:"60",y2:"4",stroke:"black",fill:"white","stroke-width":"4",transform:"matrix(1,0,0,1,16,40)"}})])])])],1),i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"class","interface")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"接口（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(12,0,0,12,-10,150)"}},[i("circle",{attrs:{cx:"10",cy:"30",r:"8"}}),i("line",{attrs:{x1:"3",y1:"30",x2:"60",y2:"30",stroke:"black",fill:"white","stroke-width":"2"}}),i("circle",{attrs:{cx:"60",cy:"30",r:"14"}})])])])],1),i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"class","dataType")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"数据类型（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(12,0,0,12,-10,150)"}},[i("rect",{attrs:{width:"60",height:"60",stroke:"black",fill:"rgb(250, 236, 216)","stroke-width":"4",transform:"matrix(1,0,0,1,14,0)"}}),i("line",{attrs:{x1:"0",y1:"4",x2:"60",y2:"4",stroke:"black",fill:"white","stroke-width":"4",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"10",y1:"14",x2:"50",y2:"14",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"10",y1:"24",x2:"50",y2:"24",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"10",y1:"34",x2:"50",y2:"34",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}})])])])],1),i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"class","enumeration")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"枚举（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(12,0,0,12,-10,150)"}},[i("rect",{attrs:{width:"60",height:"60",stroke:"black",fill:"rgb(250, 236, 216)","stroke-width":"4",transform:"matrix(1,0,0,1,14,0)"}}),i("line",{attrs:{x1:"10",y1:"4",x2:"25",y2:"4",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"10",y1:"14",x2:"25",y2:"14",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"10",y1:"24",x2:"25",y2:"24",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"30",y1:"4",x2:"45",y2:"4",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"30",y1:"14",x2:"45",y2:"14",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"30",y1:"24",x2:"45",y2:"24",stroke:"black",fill:"white","stroke-width":"2",transform:"matrix(1,0,0,1,16,10)"}}),i("line",{attrs:{x1:"0",y1:"4",x2:"60",y2:"4",stroke:"black",fill:"white","stroke-width":"4",transform:"matrix(1,0,0,1,16,45)"}})])])])],1),i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"class","primitive")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"原函数（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(12,0,0,12,-10,150)"}},[i("rect",{attrs:{width:"60",height:"60",stroke:"black",fill:"rgb(250, 236, 216)","stroke-width":"4",transform:"matrix(1,0,0,1,14,0)"}}),i("line",{attrs:{x1:"0",y1:"4",x2:"60",y2:"4",stroke:"black",fill:"white","stroke-width":"4",transform:"matrix(1,0,0,1,16,10)"}})])])])],1),i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"class","signal")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"信号（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(12,0,0,12,-10,150)"}},[i("rect",{attrs:{width:"60",height:"60",stroke:"black",fill:"rgb(250, 236, 216)","stroke-width":"4",transform:"matrix(1,0,0,1,14,0)"}}),i("line",{attrs:{x1:"0",y1:"4",x2:"60",y2:"4",stroke:"black",fill:"white","stroke-width":"4",transform:"matrix(1,0,0,1,16,10)"}}),i("path",{attrs:{d:"M30 10 L20 30 L30 30 L20 50",stroke:"black","stroke-width":"2",transform:"matrix(1,0,0,1,16,5)"}})])])])],1),i("div",{staticClass:"graph-item",on:{mousedown:function(e){return t.addNew(arguments[0],"note")}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"注释（点击拖拽）",placement:"bottom"}},[i("svg",{attrs:{width:"1.5em",height:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024",focusable:"false",fill:"currentColor","aria-hidden":"true"}},[i("g",{attrs:{transform:"matrix(1,0,0,1,50,50)"}},[i("path",{attrs:{d:"M 100 100 L 700 100 L 820 220 L 820 820 L 100 820 Z ",stroke:"black",fill:"#F7F4F5","stroke-width":"30","stroke-linejoin":"round"}}),i("path",{attrs:{d:" M 700 100 L 820 220 L 700 220   Z ",stroke:"black",fill:"#CBCBCB","stroke-width":"30","stroke-linejoin":"round"}})])])])],1)]),i("div",{staticClass:"graph-list el_icon_list"},[t.isShowGenCopy?i("div",{staticClass:"graph-item"},[i("el-tooltip",{staticClass:"item",attrs:{content:"生成副本",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-plus el-ui-icon",on:{click:t.copy}})])],1):t._e(),t.isShowShare?i("div",{staticClass:"graph-item"},[i("el-tooltip",{staticClass:"item",attrs:{content:"分享链接",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-share el-ui-icon",on:{click:t.share}})])],1):t._e(),i("div",{staticClass:"graph-item"},[i("el-tooltip",{staticClass:"item",attrs:{content:"下载PNG",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-download el-ui-icon",on:{click:t.downLoadPng}})])],1),t.isShowSaveRevision?i("div",{staticClass:"graph-item"},[i("el-tooltip",{staticClass:"item",attrs:{content:"保存当前版本到修订记录",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-edit-outline el-ui-icon",on:{click:t.saveRevision}})])],1):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"domain"===t.diagramMode,expression:"diagramMode === 'domain'"}],staticClass:"graph-item"},[i("el-tooltip",{staticClass:"item",attrs:{content:"显示详情",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-view el-ui-icon",on:{click:function(e){t.diagramMode="class"}}})])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"class"===t.diagramMode,expression:"diagramMode === 'class'"}],staticClass:"graph-item invisible"},[i("el-tooltip",{staticClass:"item",attrs:{content:"隐藏详情",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-view el-ui-icon",on:{click:function(e){t.diagramMode="domain"}}})])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"graph-item"},[i("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"item",attrs:{slot:"reference",content:"上传到 XWatt",effect:"light",placement:"bottom"},slot:"reference"},[i("i",{staticClass:"el-ui-icon el-icon-upload",on:{click:t.openMessageBox}})])],1),i("el-tooltip",{staticClass:"item",attrs:{content:"问题反馈",effect:"light",placement:"bottom"}},[i("el-link",{staticClass:"el-ui-icon",staticStyle:{"margin-left":"10px","font-size":"1.2em"},attrs:{icon:"el-icon-question",href:"https://git.woa.com/td/xwatt-web/issues/new",target:"_blank"}})],1)],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isConfluence,expression:"!isConfluence"}],staticClass:"scale_container"},[i("ScaleAdjuster",{attrs:{scale:t.scale},on:{"scale-changed":t.onScaleChanged}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"confluence_btn_group"},[i("el-button",{attrs:{plain:"",size:"mini",type:"info"},on:{click:t.onCancel}},[t._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)])},$a=[],Ka=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"scale-adjuster"},[i("el-tooltip",{staticClass:"item",attrs:{content:"缩小",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-minus el-ui-icon",on:{click:t.scaleReduce}})]),i("el-dropdown",{on:{command:t.setScale}},[i("span",{staticClass:"el-dropdown-link"},[t._v(" "+t._s(t.innerScale)+"% ")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:50}},[t._v("50%")]),i("el-dropdown-item",{attrs:{command:75}},[t._v("75%")]),i("el-dropdown-item",{attrs:{command:100}},[t._v("100%")]),i("el-dropdown-item",{attrs:{command:125}},[t._v("125%")]),i("el-dropdown-item",{attrs:{command:150}},[t._v("150%")]),i("el-dropdown-item",{attrs:{command:200}},[t._v("200%")])],1)],1),i("el-tooltip",{staticClass:"item",attrs:{content:"放大",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-plus el-ui-icon",on:{click:t.scalePuls}})])],1)},qa=[],ts={props:{scale:{type:Number,default:100}},data:function(){return{innerScale:this.scale}},methods:{scaleReduce:function(){this.innerScale-=5,this.innerScale<50&&(this.innerScale=50),this.$emit("scale-changed",this.innerScale)},scalePuls:function(){this.innerScale+=5,this.innerScale>200&&(this.innerScale=200),this.$emit("scale-changed",this.innerScale)},setScale:function(t){this.innerScale!==t&&(this.innerScale=t,this.$emit("scale-changed",this.innerScale))}}},es=ts,is=(i("690b"),Object(c["a"])(es,Ka,qa,!1,null,"b3a19da8",null)),os=is.exports,ns=10,as={name:"ToolBox",props:{mode:String,diagramUUId:String,diagramName:String,isShowGenCopy:Boolean,isShowSaveRevision:Boolean,isShowShare:Boolean},components:{ScaleAdjuster:os},data:function(){var t=100*window.diagramScale,e=xn("tag");return{diagramMode:this.mode,undoable:!1,redoable:!1,scale:t||100,selectorShow:!1,isConfluence:e&&e.includes("iwiki"),visible:!1,nameForm:{name:this.diagramName},loadingInstance:null,xwattBaseUrl:"//xwatt.wxp.oa.com/node/ad-tools",saving:!1}},watch:{mode:function(t){this.diagramMode=t},diagramMode:function(t){zi.$emit("xClass:setMode",t)}},mounted:function(){var t=this;this.bindEvents(),this.initEvent(),window.addEventListener("message",(function(e){var i=e.data.type,o=e.data.diagramType;"class"===o&&("xwatt_iframe:save_done"===i?(t.saving=!1,t.hideLoading(),t.$refs["nameForm"]&&t.$refs["nameForm"].resetFields()):"xwatt_iframe:save_error"===i&&(t.saving=!1,t.hideLoading(),t.$message({type:"error",message:"保存失败，请重试！"}),aegis.error({msg:"xwatt_iframe:save_error",ext1:"class",ext2:e.data.error,ext3:e.data.data})))}))},destroyed:function(){this.destroyEvent()},methods:{bindEvents:function(){var t=this;document.onkeydown=function(e){if(!e.metaKey&&!e.ctrlKey||!e.shiftKey||e.keyCode!==Ao.Z)return(e.metaKey||e.ctrlKey)&&e.keyCode===Ao.Y?(e.preventDefault(),void t.redo()):void(!e.metaKey&&!e.ctrlKey||e.keyCode!==Ao.Z||t.undo());t.redo()},zi.$on("xClass:stackchange",(function(e){var i=e.undoStack,o=e.redoStack;t.undoable=i.length>0,t.redoable=o.length>0})),zi.$on("xClass:setScale",(function(e){t.setScale(e)}))},reset:function(){window.store.children.forEach((function(t){"toolBoard"===t.nodeName&&window.store.remove(t)})),window.store.setAllNormal(),zi.$emit("xClass:closeAllRightPanel")},undo:function(){var t=window.store.getUndoStack();if(0!==t.length){this.reset();var e=t.pop();if(e){var i=e.actionType,o=e.data;switch(To[i]){case To.createNode:case To.menuCreateNewNode:case To.dragNewStatement:case To.createSelfTransition:case To.lineToOtherClass:case To.lineToOtherNote:case To.lineToNewStatement:case To.pasteElements:o.nodeList.forEach((function(t){window.store.removeElement(t.id)})),window.store.pushStack({actionType:To.removeNode,data:o,type:"redo"});break;case To.removeNode:o.nodeList.forEach((function(t){"class"!==t.nodeName&&"note"!==t.nodeName||window.store.addNewStatement(t,t.nodeName)})),o.nodeList.forEach((function(t){"relation"===t.nodeName&&window.store.addNewTransition(t)})),window.store.pushStack({actionType:To.createNode,data:o,type:"redo"});break;case To.updateNode:case To.editClassName:case To.editNoteText:case To.moveRole:case To.updateNodeColor:case To.updateNodeFontColor:case To.updateNodeFontSize:case To.bulkUpdateColor:case To.bulkUpdateFontSize:o.beforeData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));e&&e.updateData(t)})),window.store.pushStack({actionType:To.updateNode,data:o,type:"redo"});break;case To.panStatement:case To.moveTransition:case To.panMultiStatement:o.beforeData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));if(e&&("class"!==t.nodeName&&"note"!==t.nodeName||(e.x=t.x,e.y=t.y),"relation"===t.nodeName)){var i=t.from,o=t.to,n=t.ca,a=t.cb;e.updateFromPoint(i),e.updateToPoint(o),e.updateCa(n),e.updateCb(a)}})),window.store.pushStack({actionType:To.panStatement,data:o,type:"redo"});break;case To.adjustNodeSize:o.beforeData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));if(e&&("class"!==t.nodeName&&"note"!==t.nodeName||(e.x=t.x,e.y=t.y,e.updateSize({width:t.width,height:t.height}),e.updatePoints({width:t.width,height:t.height})),"relation"===t.nodeName)){var i=t.from,o=t.to;e.updateFromPoint(i),e.updateToPoint(o)}})),window.store.pushStack({actionType:To.adjustNodeSize,data:o,type:"redo"});break;case To.dragTransitionEndpoints:o.beforeData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));if(e&&"relation"===t.nodeName){var i=t.from,o=t.to,n=t.fromStateId,a=t.toStateId;e.updateFromPoint(i),e.updateToPoint(o),e.fromStateId=n,e.toStateId=a,e.fromState=window.store.children.find((function(t){return t.id===n})),e.toState=window.store.children.find((function(t){return t.id===a})),e.updateDirection()}})),window.store.pushStack({actionType:To.dragTransitionEndpoints,data:o,type:"redo"});break}zi.$emit("xClass:autoSave","undo")}}else this.undoable=!1},redo:function(){var t=window.store.getRedoStack();if(0!==t.length){this.reset();var e=t.pop();if(e){var i=e.actionType,o=e.data;switch(To[i]){case To.removeNode:o.nodeList.forEach((function(t){"class"!==t.nodeName&&"note"!==t.nodeName||window.store.addNewStatement(t,t.nodeName)})),o.nodeList.forEach((function(t){"relation"===t.nodeName&&window.store.addNewTransition(t)})),window.store.pushStack({actionType:To.createNode,data:o,type:"undo",isUserAction:!1});break;case To.createNode:o.nodeList.forEach((function(t){window.store.removeElement(t.id)})),window.store.pushStack({actionType:To.removeNode,data:o,type:"undo",isUserAction:!1});break;case To.updateNode:o.afterData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));e&&e.updateData(t)})),window.store.pushStack({actionType:To.updateNode,data:o,type:"undo",isUserAction:!1});break;case To.panStatement:o.afterData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));if(e&&("class"!==t.nodeName&&"note"!==t.nodeName||(e.x=t.x,e.y=t.y),"relation"===t.nodeName)){var i=t.from,o=t.to,n=t.ca,a=t.cb;e.updateFromPoint(i),e.updateToPoint(o),e.updateCa(n),e.updateCb(a)}})),window.store.pushStack({actionType:To.panStatement,data:o,type:"undo",isUserAction:!1});break;case To.adjustNodeSize:o.afterData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));if(e&&("class"!==t.nodeName&&"note"!==t.nodeName||(e.x=t.x,e.y=t.y,e.updateSize({width:t.width,height:t.height}),e.updatePoints({width:t.width,height:t.height})),"relation"===t.nodeName)){var i=t.from,o=t.to;e.updateFromPoint(i),e.updateToPoint(o)}})),window.store.pushStack({actionType:To.adjustNodeSize,data:o,type:"undo",isUserAction:!1});break;case To.dragTransitionEndpoints:o.afterData.nodeList.forEach((function(t){var e=window.store.children.find((function(e){return e.id===t.id}));if(e&&"relation"===t.nodeName){var i=t.from,o=t.to,n=t.fromStateId,a=t.toStateId;e.updateFromPoint(i),e.updateToPoint(o),e.fromStateId=n,e.toStateId=a,e.fromState=window.store.children.find((function(t){return t.id===n})),e.toState=window.store.children.find((function(t){return t.id===a})),e.updateDirection()}})),window.store.pushStack({actionType:To.dragTransitionEndpoints,data:o,type:"undo",isUserAction:!1});break}zi.$emit("xClass:autoSave","redo")}}else this.redoable=!1},addNew:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.$emit("dragNewStatement",{e:t,type:e,classType:i})},importJson:function(t){var e=new FileReader;e.readAsText(t,"UTF-8"),e.onload=function(t){var e=t.target.result;try{window.store.initRender(JSON.parse(e)),zi.$emit("xClass:autoSave","importJson")}catch(t){throw t}}},initEvent:function(){window.addEventListener("wheel",this.wheelEvent,{passive:!1})},destroyEvent:function(){window.removeEventListener("wheel",this.wheelEvent)},wheelEvent:function(t){var e="svingRoot";if(t.path.find((function(t){return t.id===e}))&&t.ctrlKey){t.preventDefault();var i=t.wheelDeltaY>0?1:-1;this.scale+=i*ns,this.scale<ns&&(this.scale=ns),this.changeScale(t)}},setScale:function(t){var e=Po();window.diagramScale=t,this.scale=t,this.changeScale(e)},onScaleChanged:function(t){var e=Po();window.diagramScale=t,this.scale=t,this.changeScale(e)},changeScale:function(t){if(window.stage&&window.store){if(t){var e=window.store.getApex(),i=e.minX,o=e.maxX,n=e.minY,a=e.maxY,s=window.store.scale,r=Go(window.stage,t);window.store.scale=this.scale/100;var c=window.store.scale,l=c-s,d=i*l,u=o*l,h=n*l,f=a*l,g=0,p=0;g=r.x>0?r.x/o*u:0===i?d:r.x/i*d,p=r.y>0?r.y/a*f:0===n?h:r.y/n*h,window.store.x-=g,window.store.y-=p}window.store.scale=this.scale/100}window.diagramScale=this.scale/100},copy:function(){this.$emit("genCopy")},downLoadPng:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=document.createElement("a"),t.next=3,yn(2);case 3:e.href=t.sent,e.download="classDiagram".concat((new Date).getTime(),".png"),e.click();case 6:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),onCancel:function(){window.parent.postMessage({type:"xwatt_iframe:close"},"*")},onSave:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){var e,i,o,n,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.showLoading(),e=window.store.exportData(),e.diagramName=this.nameForm.name||this.diagramName,e.fromIwiki=!0,t.next=6,yn(2);case 6:i=t.sent,o=30,n=window.store.getBound().width+2*o,window.parent.postMessage({type:"xwatt_iframe:save",renderData:e,picData:i,diagramType:"class",width:n},"*"),this.visible=!1,this.saving=!0,setTimeout((function(){a.saving&&(a.saving=!1,a.hideLoading(),a.$message({type:"warning",message:"保存超时，请重试！"}))}),3e4),aegis.reportEvent({name:"类图保存",ext1:"类图",ext2:this.nameForm.name||this.diagramName}),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-save-class"});case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleShow:function(){this.$refs["nameForm"].resetFields(),this.$refs["diagramNameInput"].focus()},saveRevision:function(){this.$emit("saveRevision")},share:function(){if(xn("projectId"))window.parent.postMessage({type:"xwatt-project:copy-resource-share-url",payload:{resource:{mountedNodeId:xn("mountedId"),resourceBzId:this.diagramUUId,resourceBzName:"",resourceType:Number(xn("resourceType"))}}},"*");else{var t="".concat(location.protocol,"//").concat(location.host).concat(location.pathname,"#/?id=").concat(this.diagramUUId),e=document.createElement("input");document.body.appendChild(e),e.setAttribute("value",t),e.select(),document.execCommand("copy")&&(document.execCommand("copy"),this.$message.closeAll(),this.$message({type:"success",dangerouslyUseHTMLString:!0,message:'复制分享链接成功  <br>  <a target="_blank" href="'.concat(t,'">').concat(t,"</a>"),showClose:!0,duration:0})),document.body.removeChild(e),e=null}},openHelpPanel:function(){zi.$emit("xClass:closeAllRightPanel"),zi.$emit("xClass:setDiagramPanelShow",!1),zi.$emit("xClass:setRightPanelShow",!0),zi.$emit("xClass:openHelpPanel")},showLoading:function(t){this.loadingInstance=y["Loading"].service({text:t})},hideLoading:function(){this.loadingInstance.close()},upload2Xwatt:function(t){var e=this,i=window.store.exportData();i.diagramName=t,i.fromIwiki=!0;var o={JSONData:JSON.stringify(i),name:t};this.showLoading(),Be()({url:"".concat(this.xwattBaseUrl,"/classCreate"),method:"POST",data:o,withCredentials:!0}).then((function(t){var i=t.status,o=t.data;if(200!==i||0!==o.code)throw Error("[XWATT] Response With Code ".concat(o.code));console.log("[XWATT] Send to XWatt Success, ret:",o),e.$message({type:"success",message:"上传成功"})})).catch((function(t){console.error("[XWATT] Request XWATT Failed, err:",t),e.$message({type:"error",message:"上传失败，错误：".concat(t.message)})})).finally((function(){e.hideLoading()}))},openMessageBox:function(){var t=this;this.$prompt("请输入类图名称","类图上传至 XWATT",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){return null!==t&&""!==t},inputErrorMessage:"命名不能为空"}).then((function(e){var i=e.value;t.showLoading("上传中.."),t.upload2Xwatt(i),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-upload-class"})})).catch((function(t){console.log(t),console.log("取消输入")}))}}},ss=as,rs=(i("012b"),Object(c["a"])(ss,Ja,$a,!1,null,"deb1b6bc",null)),cs=rs.exports,ls=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"insertBoard",staticClass:"insert-board",style:t.styleObj},[i("div",{staticClass:"graph-item hasChild"},[t._v("\n    新增类\n    "),i("div",{staticClass:"insert-board children"},t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew("class",e)}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n        "+t._s(t.RELATION_NAME_MAP[e])+"\n      ")])})),0)]),i("div",{staticClass:"graph-item hasChild"},[t._v("\n    新增接口\n    "),i("div",{staticClass:"insert-board children"},t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew("class",e,"interface")}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n        "+t._s(t.RELATION_NAME_MAP[e])+"\n      ")])})),0)]),i("div",{staticClass:"graph-item hasChild"},[t._v("\n    新增数据类型\n    "),i("div",{staticClass:"insert-board children"},t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew("class",e,"dataType")}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n        "+t._s(t.RELATION_NAME_MAP[e])+"\n      ")])})),0)]),i("div",{staticClass:"graph-item hasChild"},[t._v("\n    新增枚举\n    "),i("div",{staticClass:"insert-board children"},t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew("class",e,"enumeration")}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n        "+t._s(t.RELATION_NAME_MAP[e])+"\n      ")])})),0)]),i("div",{staticClass:"graph-item hasChild"},[t._v("\n    新增原函数\n    "),i("div",{staticClass:"insert-board children"},t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew("class",e,"primitive")}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n        "+t._s(t.RELATION_NAME_MAP[e])+"\n      ")])})),0)]),i("div",{staticClass:"graph-item hasChild"},[t._v("\n    新增信号\n    "),i("div",{staticClass:"insert-board children"},t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew("class",e,"signal")}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n        "+t._s(t.RELATION_NAME_MAP[e])+"\n      ")])})),0)]),i("div",{staticClass:"graph-item divider",on:{click:t.cancel}},[t._v("取消")])])},ds=[],us={name:"InsertBoard",props:{position:{type:Object,default:function(){return{x:800,y:800}}},show:Boolean,getData:Function},data:function(){return{RELATION_LIST:Io,RELATION_ICON_MAP:ko,RELATION_NAME_MAP:Mo,hasEndState:!1}},watch:{show:function(t){if(t){var e=this.getData();this.hasEndState=e.statementList.findIndex((function(t){return"end"===t.type}))>-1}}},computed:{styleObj:function(){var t=this.position,e=t.x,i=t.y;return{left:e+"px",top:i+"px"}}},mounted:function(){var t=this;this.$refs.insertBoard.oncontextmenu=function(){return t.$emit("cancelAddNew"),!1}},methods:{addNew:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.$emit("createNewStatement",t,e,i)},cancel:function(){this.$emit("cancelAddNew")}}},hs=us,fs=(i("9a82"),Object(c["a"])(hs,ls,ds,!1,null,"28bc6e0c",null)),gs=fs.exports,ps=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"relationBoard",staticClass:"relation-board",style:t.styleObj},[t._l(t.RELATION_LIST,(function(e){return i("div",{key:e,staticClass:"graph-item",on:{click:function(i){return t.addNew(e)}}},[i("img",{attrs:{src:t.RELATION_ICON_MAP[e],alt:""}}),t._v("\n    "+t._s(t.RELATION_NAME_MAP[e])+"\n  ")])})),i("div",{staticClass:"graph-item divider",on:{click:t.cancel}},[t._v("取消")])],2)},ms=[],ys={name:"RelationBoard",props:{position:{type:Object,default:function(){return{x:800,y:800}}},show:Boolean,getData:Function},data:function(){return{RELATION_LIST:Io,RELATION_ICON_MAP:ko,RELATION_NAME_MAP:Mo,hasEndState:!1}},watch:{show:function(t){if(t){var e=this.getData();this.hasEndState=e.statementList.findIndex((function(t){return"end"===t.type}))>-1}}},computed:{styleObj:function(){var t=this.position,e=t.x,i=t.y;return{left:e+"px",top:i+"px"}}},mounted:function(){var t=this;this.$refs.relationBoard.oncontextmenu=function(){return t.$emit("cancelAddNew"),!1}},methods:{addNew:function(t){this.$emit("createNewTransition",t)},cancel:function(){this.$emit("cancelAddNew")}}},vs=ys,ws=(i("95c6"),Object(c["a"])(vs,ps,ms,!1,null,"afcbd63c",null)),xs=ws.exports,Cs=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{title:"快捷键秘籍",visible:t.isShowKeyTips,"show-close":!1,"append-to-body":!1},on:{"update:visible":function(e){t.isShowKeyTips=e}}},[i("div",{staticClass:"popup shortcut-panel on"},[i("article",[i("section",[i("h3",[t._v("编辑")]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Delete",attrs:{title:"Delete"}},[t._v("Delete")]),t._v(",\n            "),i("span",{staticClass:"shortcut-key Backspace",attrs:{title:"Backspace"}},[t._v("Backspace")])]),i("span",{staticClass:"description"},[t._v("删除节点")])]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Ctrl",attrs:{title:"Ctrl"}},[t._v("Ctrl")]),t._v(" +\n            "),i("span",{staticClass:"shortcut-key C",attrs:{title:"C"}},[t._v("C")])]),i("span",{staticClass:"description"},[t._v("复制节点")])]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Ctrl",attrs:{title:"Ctrl"}},[t._v("Ctrl")]),t._v(" +\n            "),i("span",{staticClass:"shortcut-key V",attrs:{title:"V"}},[t._v("V")])]),i("span",{staticClass:"description"},[t._v("粘贴节点")])]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Ctrl",attrs:{title:"Ctrl"}},[t._v("Ctrl")]),t._v(" +\n            "),i("span",{staticClass:"shortcut-key A",attrs:{title:"A"}},[t._v("A")])]),i("span",{staticClass:"description"},[t._v("全选节点")])])]),i("section",[i("h3",[t._v("交互")]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Shift",attrs:{title:"Shift"}},[t._v("Shift")]),t._v(" +\n            "),i("span",{staticClass:"shortcut-key 左键",attrs:{title:"左键"}},[t._v("左键")])]),i("span",{staticClass:"description"},[t._v("批量选择")])]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Ctrl",attrs:{title:"Ctrl"}},[t._v("Ctrl")]),t._v(" +\n            "),i("span",{staticClass:"shortcut-key 滚轮",attrs:{title:"滚轮"}},[t._v("滚轮")])]),i("span",{staticClass:"description"},[t._v("缩放")])]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key Shift",attrs:{title:"Shift"}},[t._v("Shift")]),t._v(" +\n            "),i("span",{staticClass:"shortcut-key 滚轮",attrs:{title:"滚轮"}},[t._v("滚轮")])]),i("span",{staticClass:"description"},[t._v("水平平移画布")])]),i("div",{staticClass:"shortcut-group"},[i("span",{staticClass:"shortcut"},[i("span",{staticClass:"shortcut-key 滚轮",attrs:{title:"滚轮"}},[t._v("滚轮")])]),i("span",{staticClass:"description"},[t._v("垂直平移画布")])])])]),i("div",[i("button",{attrs:{id:"close-short-btn"},on:{click:function(e){t.isShowKeyTips=!1}}},[t._v("已阅")])])])])},bs=[],Is={name:"KeyTips",data:function(){return{isShowKeyTips:!1}},mounted:function(){var t=this;zi.$on("xClass:openKeyTips",(function(){return t.isShowKeyTips=!0}))}},Ms=Is,ks=(i("8a41"),Object(c["a"])(Ms,Cs,bs,!1,null,null,null)),Ss=ks.exports,Ds=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-info",class:{hide:!t.isShow},style:{width:t.panelWidth+"px"},attrs:{id:"rightPanel"}},[i("div",{staticClass:"drag-line",on:{mousedown:t.onPanelMouseDown}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"foldbox",on:{click:t.toggleShow}}),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShow,expression:"!isShow"}],staticClass:"unfoldbox",on:{click:t.toggleShow}}),!t.isConfluence&&t.isShow&&t.isShowDiagramInfo&&t.diagramInfo?i("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"基本信息",name:"baseInfo"}},[i("div",{staticClass:"base_info"},[i("div",{staticClass:"diagram-info-base"},[t.diagramInfo.name?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("名称")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.name))])]):t._e(),t.diagramInfo.type?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("类型")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.type))])]):t._e(),t.diagramInfo.creater?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("创建人")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.creater))])]):t._e(),t.diagramInfo.createTime?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("创建时间")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.createTime))])]):t._e(),t.diagramInfo.modifier?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("修改人")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.modifier))])]):t._e(),t.diagramInfo.modifyTime?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("修改时间")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.modifyTime))])]):t._e(),t.diagramInfo.width?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布宽度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.width))])]):t._e(),t.diagramInfo.height?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布高度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.diagramInfo.height))])]):t._e()]),t.revisionList.length>0?i("div",{staticStyle:{"margin-bottom":"100px"}},[i("div",{staticClass:"diagram-info-title",staticStyle:{"margin-top":"20px"}},[t._v("\n            修订记录\n            "),t.currentRevisionId?i("el-button",{attrs:{icon:"el-icon-close",size:"mini"},on:{click:t.closeRevision}},[t._v("关闭修订记录")]):t._e()],1),t._l(t.revisionList,(function(e,o){return i("div",{key:o,staticClass:"diagram-info-base diagram-info-revision"},t._l(e,(function(e,o){return i("div",{key:e.RevisionUUId,on:{click:function(i){return t.openRevision(e)}}},[0===o?i("div",{staticClass:"diagram-info-base-item-title"},[i("i",{staticClass:"el-icon-date"}),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(t.formatTime(e.CreateTime).substring(0,10)))])]):t._e(),i("div",{staticClass:"diagram-info-base-item-detail",style:t.currentRevisionId===e.RevisionUUId?{border:"1px solid #07C160"}:{border:"1px solid transparent"}},[i("div",{staticClass:"diagram-info-base-item-rv"},[i("img",{staticClass:"diagram-info-base-item-head",attrs:{src:"http://r.hrc.oa.com/photo/150/"+e.Creater+".png"}}),i("div",{staticClass:"diagram-info-base-item-value"},[t._v(t._s(e.Creater))]),i("div",{staticClass:"diagram-info-base-item-value",staticStyle:{"text-align":"right",color:"#888"}},[t._v(t._s(e.distanceFromNow))])]),i("div",{staticClass:"diagram-info-base-item-rv"},[i("div",{staticClass:"diagram-info-base-item-value"},[i("el-link",{attrs:{icon:"el-icon-view"}},[t._v(t._s(e.RevisionNotes))])],1)])])])})),0)}))],2):t._e()])])],1):t._e(),i("PropertyPanel",{attrs:{isShow:t.isShow}}),i("MultiProperty",{attrs:{isShow:t.isShow,historyColors:t.historyColors}}),i("HelpPanel",{attrs:{isShow:t.isShow}})],1)},Ns=[],As=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow&&t.isShowMultiPanel,expression:"isShow && isShowMultiPanel"}],staticClass:"multi-property-wrap"},[i("div",{staticClass:"title"},[t._v("批量属性修改")]),i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("背景色")]),i("div",{staticClass:"section-content"},[i("div",{staticClass:"color_picker"},[i("div",{staticClass:"msg-text-color",style:"background:"+t.color,on:{click:t.toggleColorPicker}}),i("ColorPicker",{directives:[{name:"show",rawName:"v-show",value:t.isShowColorPicker,expression:"isShowColorPicker"}],staticClass:"sketch-picker-obj",attrs:{color:t.color,historyColors:t.historyColors},on:{"color-change":t.colorChange,"custom-color-change":t.customColorChange}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowColorPicker,expression:"isShowColorPicker"}],staticClass:"color_layer",on:{click:t.toggleColorPicker}})])]),i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("字体大小")]),i("div",{staticClass:"section-content"},[i("div",{staticClass:"font-size-change"},[i("el-input-number",{attrs:{size:"mini",label:"描述文字",min:10,max:24},on:{change:t.fontSizeChange},model:{value:t.fontSize,callback:function(e){t.fontSize=e},expression:"fontSize"}})],1)])])])},Ls=[],Ts=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-palette-panel-3DIVh",style:"display: flex;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"palette"},[i("div",{staticStyle:{"padding-left":"2px"}},[i("div",{staticClass:"palette-color-grid"},t._l(t.standardColors,(function(e,o){return i("div",{key:o,staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box inner-box-border",style:"background-color:"+e.color+" ;"})])})),0),i("div",{staticStyle:{height:"8px"}}),i("div",{staticClass:"palette-color-grid"},t._l(t.presetColors,(function(e,o){return i("div",{key:o},t._l(e,(function(e,o){return i("div",{key:o,staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e.color+" ;"})])})),0)})),0),t.historyColors.length>0?i("span",{staticClass:"palette-text-font",staticStyle:{"margin-top":"10px","padding-left":"12px","padding-bottom":"10px"}},[t._v("最近使用")]):t._e(),i("div",{staticClass:"palette-color-grid"},[t.historyColors.length>0?i("div",t._l(t.historyColors,(function(e){return i("div",{key:e,staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e+" ;"})])})),0):t._e()])]),t._m(0),i("ul",{staticClass:"palette-list"},[i("li",{staticClass:"list-item list-item-sub",on:{mouseenter:t.showPicker,mouseleave:t.hidePicker}},[i("img",{staticClass:"list-item-img",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUzLjEgKDcyNjMxKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT7oh6rlrprkuYnpopzoibJpY29uPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IuiHquWumuS5ieminOiJsmljb24iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxyZWN0IGlkPSLnn6nlvaItY29weS0xMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ij48L3JlY3Q+CiAgICAgICAgPHBhdGggZD0iTTExLjYsOCBDMTEuMDY2ODQ2Myw4IDEwLjYsNy41MzI2NzQzMiAxMC42LDcuMDAwMzEyNjcgQzEwLjYsNi40NjY2ODQzIDExLjA2NjgzMDMsNiAxMS42LDYgQzEyLjEzMzE2OTcsNiAxMi42LDYuNDY3MzI1NjggMTIuNiw3LjAwMDMxMjY3IEMxMi42LDcuNTMyMDQ4OTcgMTIuMTMzMTY5Nyw4IDExLjYsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOS44MDAzMTI2Nyw1LjQgQzkuMjY2Njg0Myw1LjQgOC44LDQuOTMzMTY5NzMgOC44LDQuNCBDOC44LDMuODY2ODMwMjcgOS4yNjczMjU2OCwzLjQgOS44MDAzMTI2NywzLjQgQzEwLjMzMzMxNTcsMy40IDEwLjgsMy44NjY4MzAyNyAxMC44LDQuNCBDMTAuOCw0LjkzMzE2OTczIDEwLjMzMjY5MDMsNS40IDkuODAwMzEyNjcsNS40IFoiIGlkPSLot6/lvoQiIGZpbGw9IiM1QzVDNUMiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgIDxwYXRoIGQ9Ik02LjM5OTk5MTk4LDUuNCBDNS44NjU1NjY4OCw1LjQgNS40LDQuOTMzMTY5NzMgNS40LDQuNCBDNS40LDMuODY2ODMwMjcgNS44NjU1NjY4OCwzLjQgNi4zOTk5OTE5OCwzLjQgQzYuOTMzMTY1OTksMy40IDcuNCwzLjg2NjgzMDI3IDcuNCw0LjQgQzcuNCw0LjkzMzE2OTczIDYuOTMzMTY1OTksNS40IDYuMzk5OTkxOTgsNS40IEw2LjM5OTk5MTk4LDUuNCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNNC4zOTk2OTUzNSw4IEMzLjg2NjA3MTI2LDggMy40LDcuNTMyNjc0MzIgMy40LDcuMDAwMzEyNjcgQzMuNCw2LjQ2NjY4NDMgMy44NjYwNTUyMiw2IDQuMzk5Njc5MzEsNiBDNC45MzMzMDM0LDYgNS40LDYuNDY3MzI1NjggNS40LDcuMDAwMzEyNjcgQzUuNCw3LjUzMjA0ODk3IDQuOTMyNjc4MDYsOCA0LjM5OTY3OTMxLDggTDQuMzk5Njk1MzUsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOCwxLjUxNTc5MiBMNy45OTc5MzQ2NCwxLjUxNTc4NzczIEM2LjI3NjU5MjQ1LDEuNTA4Njc3MyA0LjYyMzY5ODUsMi4xODkzMzIyNiAzLjQwNjUxNTM4LDMuNDA2NTE1MzggQzIuMTg5MzMyMjYsNC42MjM2OTg1IDEuNTA4Njc3Myw2LjI3NjU5MjQ1IDEuNTE1NzkyLDggQzEuNTE1NzkyLDExLjYwMzQwNyA0LjM5NjU5MzA0LDE0LjQ4NDIwOCA4LDE0LjQ4NDIwOCBDOC4zNDQ5MjgzMiwxNC40ODQyMDggOC42NjM3OTIsMTQuMTY0OTI5IDguNjYzNzkyLDEzLjgyMDQxNiBDOC42NjM3OTIsMTMuNjIxMTM1IDguNjI1OTEzOTcsMTMuNTIyMDgyMSA4LjQ0MDU5MzI4LDEzLjMyMzgyIEM4LjE1NjA5Njg4LDEyLjkwMjM3NTEgOC4wNDMyOTMzMywxMi42NTgyNjg2IDguMDQzMjkzMzMsMTIuMjY4NDY5MyBDOC4wNDMyOTMzMywxMS4zNzA5NjM4IDguODEwNTc5NjUsMTAuNjA0NjU4NyA5LjcwNzA4NTMzLDEwLjYwNDY1ODcgTDExLjEwMzkxMiwxMC42MDQ2NTg3IEMxMy4wMDEyNjc3LDEwLjYwNDY1ODcgMTQuNDg0MjA4LDkuMTIxMTQzNjQgMTQuNDg0MjA4LDcuMjIzNjUzMzMgQzE0LjQ4NDIwOCw0LjA4NjM3MTgzIDExLjYwMzI5OTcsMS41MTU3OTIgOCwxLjUxNTc5MiBaIE04LjAwMTAzMjY4LDAuNTE1NzkyMDcxIEM4LjAwMTM3NjksMC41MTU3OTM0NDYgOC4wMDE3MjExMywwLjUxNTc5NDg0NCA4LjAwMjA2NTM2LDAuNTE1Nzk2MjY2IEw4LDAuNTE1NzkyIEM4LjAwMDM0NDI0LDAuNTE1NzkyIDguMDAwNjg4NDcsMC41MTU3OTIwMjEgOC4wMDEwMzI3LDAuNTE1NzkyMDYyIFoiIGlkPSLot6/lvoQiIHN0cm9rZT0iIzVDNUM1QyIgZmlsbC1ydWxlPSJub256ZXJvIj48L3BhdGg+CiAgICA8L2c+Cjwvc3ZnPg=="}}),i("span",{staticClass:"palette-text-font list-item-text"},[t._v("自定义颜色")]),i("img",{staticClass:"list-item-arrow",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNHB4IiBoZWlnaHQ9IjZweCIgdmlld0JveD0iMCAwIDQgNiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTIuNSAoNjc0NjkpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPgogICAgPHRpdGxlPueureWktDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSJQYWdlLTMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIG9wYWNpdHk9IjAuNDAwMDAwMDA2Ij4KICAgICAgICA8cGF0aCBkPSJNMy45MzU4Mzk2NSwzLjEyMjkwMzMxIEwwLjM3Mzk1MzkzNiw1Ljk0OTA5MTc4IEMwLjI4ODQwNjgsNi4wMTY5Njk0MSAwLjE0OTcwNzQ4OCw2LjAxNjk2OTQxIDAuMDY0MTYwMzUyLDUuOTQ5MDkxNzggQzAuMDIzMDc5MTY4NSw1LjkxNjQ5NTggMCw1Ljg3MjI4NjE2IDAsNS44MjYxODg0OCBMMCwwLjE3MzgxMTUyMiBDMCwwLjA3NzgxODA2OSAwLjA5ODA3NTIyNCwwIDAuMjE5MDU3MTQ0LDAgQzAuMjc3MTU0NzExLDAgMC4zMzI4NzI3NTIsMC4wMTgzMTIyMzI4IDAuMzczOTUzOTM2LDAuMDUwOTA4MjE2MSBMMy45MzU4Mzk2NSwyLjg3NzA5NjY5IEM0LjAyMTM4Njc4LDIuOTQ0OTc0MzIgNC4wMjEzODY3OCwzLjA1NTAyNTY4IDMuOTM1ODM5NjUsMy4xMjI5MDMzMSBaIiBpZD0i566t5aS0IiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgIDwvZz4KPC9zdmc+"}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:t.showColorPicker,expression:"showColorPicker"}],staticClass:"chrome-picker",staticStyle:{padding:"10px 10px 0 10px"},attrs:{value:t.color},on:{input:t.updateValue}})],1)])])])},Es=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"line"})])}],Os={name:"ColorPicker",methods:{updateValue:Object(Ri["debounce"])((function(t){this.mergeHistoryColor(t.hex),this.$emit("custom-color-change",t.hex)}),600),onColorChange:function(t){this.mergeHistoryColor(t),this.$emit("color-change",t)},showPicker:function(){this.showColorPicker=!0},hidePicker:function(){this.showColorPicker=!1},mergeHistoryColor:function(t){var e=this.historyColors;-1===e.indexOf(t)&&e.unshift(t),e.length>9&&(e.length=9),window.historyColors=e}},props:{historyColors:Array,color:String},data:function(){return{standardColors:[{color:"#faecd8"},{color:"#000000"},{color:"#FF0000"},{color:"#FF9900"},{color:"#FFFF00"},{color:"#98FA1C"},{color:"#6CDEFF"},{color:"#403ED6"},{color:"#ED41FD"}],presetColors:[[{color:"#E9E9E9"},{color:"#7B7B7B"},{color:"#FFC8B8"},{color:"#FFE1B2"},{color:"#FFF2CC"},{color:"#D9EAD3"},{color:"#DFF8FF"},{color:"#CFC7F4"},{color:"#FEE4FF"}],[{color:"#D9D9D9"},{color:"#5c5c5c"},{color:"#E99899"},{color:"#FFB84D"},{color:"#FFE59A"},{color:"#ACDB7E"},{color:"#85D4E6"},{color:"#8C7BE8"},{color:"#EE93F6"}],[{color:"#C4C4C4"},{color:"#333333"},{color:"#E06666"},{color:"#FB8D00"},{color:"#FFD966"},{color:"#87C120"},{color:"#4CC2EE"},{color:"#3F49B9"},{color:"#D041E1"}],[{color:"#9D9D9D"},{color:"#262626"},{color:"#CC0000"},{color:"#E75200"},{color:"#FFB700"},{color:"#678F00"},{color:"#0188FB"},{color:"#2741B1"},{color:"#A419D3"}]],showColorPicker:!1}},components:{"chrome-picker":W["Chrome"]}},js=Os,Ps=(i("2807"),Object(c["a"])(js,Ts,Es,!1,null,"7a9469aa",null)),zs=Ps.exports,Rs={name:"multi-property",components:{ColorPicker:zs},props:{historyColors:Array,isShow:Boolean},data:function(){return{nodes:[],color:"#000",fontSize:12,originFontSize:12,originData:{},isShowMultiPanel:!1,isShowColorPicker:!1,beforeList:[],afterList:[]}},mounted:function(){var t=this;zi.$on("xClass:openMultiProperty",(function(e){zi.$emit("xClass:closeAllRightPanel"),zi.$emit("xClass:setDiagramPanelShow",!1),t.isShowMultiPanel=!0,t.nodes=e,t.color=t.nodes[0].backgroundColor,t.fontSize=t.nodes[0].fontSize,t.originFontSize=t.nodes[0].fontSize,t.nodes.forEach((function(e){t.originData[e.id]=e.exportData()}))})),zi.$on("xClass:closeMultiProperty",(function(){t.isShowMultiPanel=!1,t.nodes=[]}))},methods:{toggleColorPicker:function(){this.isShowColorPicker=!this.isShowColorPicker},colorChange:function(t){this.color=t,this.updateColor(t),this.isShowColorPicker=!1},customColorChange:function(t){this.color=t,this.updateColor(t)},updateColor:function(t){var e=this;this.beforeList=[],this.afterList=[],this.nodes.forEach((function(i){e.beforeList.push(i.exportData());var o=i.exportData();o.backgroundColor=t,i.updateData(o),e.afterList.push(i.exportData())})),window.store.pushStack({actionType:To.bulkUpdateColor,data:{beforeData:{nodeList:this.beforeList},afterData:{nodeList:this.afterList}},type:"undo"}),zi.$emit("xClass:autoSave",To.bulkUpdateColor)},fontSizeChange:function(t){var e=this;this.beforeList=[],this.afterList=[],this.nodes.forEach((function(i){e.beforeList.push(i.exportData());var o=i.exportData();o.fontSize=t,i.updateData(o),e.afterList.push(i.exportData())})),window.store.pushStack({actionType:To.bulkUpdateFontSize,data:{beforeData:{nodeList:this.beforeList},afterData:{nodeList:this.afterList}},type:"undo"}),zi.$emit("xClass:autoSave",To.bulkUpdateFontSize)}}},Bs=Rs,Gs=(i("e1b6"),Object(c["a"])(Bs,As,Ls,!1,null,null,null)),_s=Gs.exports,Fs=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow&&t.isShowProperty,expression:"isShow && isShowProperty"}],staticClass:"property_panel"},[i("el-card",{directives:[{name:"show",rawName:"v-show",value:"class"===t.showType,expression:"showType === 'class'"}],staticClass:"property-panel-drawer"},[i("el-form",{attrs:{model:t.classForm,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-form-item",{attrs:{label:"类名"}},[i("el-input",{ref:"className",attrs:{placeholder:"输入类名"},on:{change:t.onSave},model:{value:t.classForm.name,callback:function(e){t.$set(t.classForm,"name",e)},expression:"classForm.name"}})],1),i("el-form-item",{attrs:{label:"类属性"}},[i("el-table",{attrs:{id:"propTable",data:t.classForm.propertyList,border:""}},[i("el-table-column",{attrs:{label:"属性名","min-width":90},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-input",{attrs:{size:"small",placeholder:"输入属性名"},on:{change:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteProperty(e.$index):null},function(e){return(e.type.indexOf("key")||78===e.keyCode)&&e.ctrlKey?t.addProperty.apply(null,arguments):null}]},model:{value:e.row.name,callback:function(i){t.$set(e.row,"name",i)},expression:"scope.row.name"}})]}}])}),i("el-table-column",{attrs:{label:"类型",width:80},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-autocomplete",{staticClass:"section-input",staticStyle:{width:"100%"},attrs:{size:"small","fetch-suggestions":t.typeOptions,placeholder:"选择类型"},on:{change:t.onSave,select:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteProperty(e.$index):null},function(e){return(e.type.indexOf("key")||78===e.keyCode)&&e.ctrlKey?t.addProperty.apply(null,arguments):null}]},model:{value:e.row.type,callback:function(i){t.$set(e.row,"type",i)},expression:"scope.row.type"}})]}}])}),i("el-table-column",{attrs:{label:"作用域",width:90},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-select",{attrs:{size:"small",placeholder:"选择作用域"},on:{change:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteProperty(e.$index):null},function(e){return(e.type.indexOf("key")||78===e.keyCode)&&e.ctrlKey?t.addProperty.apply(null,arguments):null}]},model:{value:e.row.modifier,callback:function(i){t.$set(e.row,"modifier",i)},expression:"scope.row.modifier"}},t._l(t.MODIFIER_LIST,(function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})})),1)]}}])}),i("el-table-column",{attrs:{label:"",width:17},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{staticClass:"action_button",attrs:{content:"删除",effect:"light",placement:"bottom"}},[i("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(i){return t.deleteProperty(e.$index)}}})],1)]}}])})],1),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addProperty.apply(null,arguments)}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:t.addProperty}},[i("span",[t._v("添加属性")])])])],1),i("el-form-item",{attrs:{label:"类方法"}},[i("el-table",{attrs:{id:"methodTable",data:t.classForm.operationList,border:""}},[i("el-table-column",{attrs:{label:"方法名","min-width":90},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-input",{attrs:{size:"small",placeholder:"输入方法名"},on:{change:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteOperation(e.$index):null},function(e){return(e.type.indexOf("key")||78===e.keyCode)&&e.ctrlKey?t.addOperation.apply(null,arguments):null}]},model:{value:e.row.name,callback:function(i){t.$set(e.row,"name",i)},expression:"scope.row.name"}})]}}])}),i("el-table-column",{attrs:{label:"返回类型",width:80},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-autocomplete",{staticClass:"section-input",staticStyle:{width:"100%"},attrs:{size:"small","fetch-suggestions":t.returnTypeOptions,placeholder:"选择类型"},on:{change:t.onSave,select:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteOperation(e.$index):null},function(e){return(e.type.indexOf("key")||78===e.keyCode)&&e.ctrlKey?t.addOperation.apply(null,arguments):null}]},model:{value:e.row.type,callback:function(i){t.$set(e.row,"type",i)},expression:"scope.row.type"}})]}}])}),i("el-table-column",{attrs:{label:"作用域",width:90},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-select",{attrs:{size:"small",placeholder:"选择作用域"},on:{change:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteOperation(e.$index):null},function(e){return(e.type.indexOf("key")||78===e.keyCode)&&e.ctrlKey?t.addOperation.apply(null,arguments):null}]},model:{value:e.row.modifier,callback:function(i){t.$set(e.row,"modifier",i)},expression:"scope.row.modifier"}},t._l(t.MODIFIER_LIST,(function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})})),1)]}}])}),i("el-table-column",{attrs:{width:33},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-popover",{attrs:{placement:"left-start",width:"240",trigger:"click","append-to-body":!0}},[i("el-tooltip",{attrs:{slot:"reference",content:"编辑参数",effect:"light",placement:"bottom"},slot:"reference"},[i("el-button",{attrs:{icon:"el-icon-edit",type:"text"}})],1),i("el-table",{attrs:{data:e.row.paramList,border:""}},[i("el-table-column",{attrs:{label:"参数名","min-width":70},scopedSlots:t._u([{key:"default",fn:function(o){return[i("el-input",{attrs:{size:"small",placeholder:"参数名称"},on:{change:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteParam(e.$index,o.$index):null},function(i){return(i.type.indexOf("key")||78===i.keyCode)&&i.ctrlKey?t.addParam(e.$index):null}]},model:{value:o.row.name,callback:function(e){t.$set(o.row,"name",e)},expression:"param.row.name"}})]}}],null,!0)}),i("el-table-column",{attrs:{label:"类型","min-width":70},scopedSlots:t._u([{key:"default",fn:function(o){return[i("el-autocomplete",{staticClass:"section-input",staticStyle:{width:"100%"},attrs:{size:"small","fetch-suggestions":t.typeOptions,placeholder:"参数类型"},on:{change:t.onSave,select:t.onSave},nativeOn:{keyup:[function(i){return(i.type.indexOf("key")||46===i.keyCode)&&i.ctrlKey?t.deleteParam(e.$index,o.$index):null},function(i){return(i.type.indexOf("key")||78===i.keyCode)&&i.ctrlKey?t.addParam(e.$index):null}]},model:{value:o.row.type,callback:function(e){t.$set(o.row,"type",e)},expression:"param.row.type"}})]}}],null,!0)}),i("el-table-column",{attrs:{width:17},scopedSlots:t._u([{key:"default",fn:function(o){return[i("el-tooltip",{staticClass:"action_button",attrs:{content:"删除",effect:"light",placement:"bottom"}},[i("el-button",{attrs:{tabindex:"-1",icon:"el-icon-delete",type:"text"},on:{click:function(i){return t.deleteParam(e.$index,o.$index)}}})],1)]}}],null,!0)})],1),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.addParam(e.$index)}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:function(i){return t.addParam(e.$index)}}},[i("span",[t._v("添加参数")])])])],1),i("el-tooltip",{staticClass:"action_button",attrs:{content:"删除",effect:"light",placement:"bottom"}},[i("el-button",{attrs:{tabindex:"-1",icon:"el-icon-delete",type:"text"},on:{click:function(i){return t.deleteOperation(e.$index)}}})],1)]}}])})],1),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addOperation.apply(null,arguments)}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:t.addOperation}},[i("span",[t._v("添加方法")])])])],1)],1)],1),i("el-card",{directives:[{name:"show",rawName:"v-show",value:"line"===t.showType,expression:"showType === 'line'"}],staticClass:"property-panel-drawer"},[i("el-form",{attrs:{model:t.lineForm,"label-position":"top"}},[i("el-form-item",{attrs:{label:"关系"}},[i("div",{staticClass:"input_disable"},[t._v(t._s(t.RELATION_NAME_MAP[t.lineForm.relation]))])]),i("el-form-item",{attrs:{label:"关系备注"}},[i("el-input",{on:{change:t.onSave},model:{value:t.lineForm.remark,callback:function(e){t.$set(t.lineForm,"remark",e)},expression:"lineForm.remark"}})],1),i("el-form-item",{attrs:{label:"构造型/Stereotype"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},on:{change:t.onSave},model:{value:t.lineForm.stereotype,callback:function(e){t.$set(t.lineForm,"stereotype",e)},expression:"lineForm.stereotype"}},t._l(t.RELATION_STEREOTYPE_MAP[t.lineForm.relation],(function(t){return i("el-option",{key:t,attrs:{label:t,value:t,size:"normal"}})})),1)],1),i("div",{staticClass:"source-and-target"},[i("div",{staticClass:"source-wrap"},[i("span",{staticClass:"source-title"},[t._v(t._s("源： "+(t.lineForm.fromState.name||"")))]),"Generalization"!==t.lineForm.relation?i("div",{staticClass:"source-section"},[t._v("\n            多重性\n            "),i("el-autocomplete",{staticClass:"section-input",staticStyle:{width:"100%"},attrs:{size:"small","fetch-suggestions":t.multiplicityOptions,placeholder:"输入多重性"},on:{change:t.onSave,select:t.onSave},model:{value:t.lineForm.sourceMultiplicity,callback:function(e){t.$set(t.lineForm,"sourceMultiplicity",e)},expression:"lineForm.sourceMultiplicity"}})],1):t._e(),i("div",{staticClass:"source-section"},[t._v("\n            角色\n            "),i("el-input",{staticClass:"section-input",attrs:{size:"small",placeholder:"输入角色名"},on:{change:t.onSave},model:{value:t.lineForm.sourceRoleName,callback:function(e){t.$set(t.lineForm,"sourceRoleName",e)},expression:"lineForm.sourceRoleName"}})],1)]),i("div",{staticClass:"target-wrap"},[i("span",{staticClass:"source-title"},[t._v(t._s("目标： "+(t.lineForm.toState.name||"")))]),"Generalization"!==t.lineForm.relation?i("div",{staticClass:"source-section"},[t._v("\n            多重性\n            "),i("el-autocomplete",{staticClass:"section-input",staticStyle:{width:"100%"},attrs:{size:"small","fetch-suggestions":t.multiplicityOptions,placeholder:"输入多重性"},on:{change:t.onSave,select:t.onSave},model:{value:t.lineForm.targetMultiplicity,callback:function(e){t.$set(t.lineForm,"targetMultiplicity",e)},expression:"lineForm.targetMultiplicity"}})],1):t._e(),i("div",{staticClass:"source-section"},[t._v("\n            角色\n            "),i("el-input",{staticClass:"section-input",attrs:{size:"small",placeholder:"输入角色名"},on:{change:t.onSave},model:{value:t.lineForm.targetRoleName,callback:function(e){t.$set(t.lineForm,"targetRoleName",e)},expression:"lineForm.targetRoleName"}})],1)])])],1)],1),i("el-card",{directives:[{name:"show",rawName:"v-show",value:"note"===t.showType,expression:"showType === 'note'"}],staticClass:"property-panel-drawer"},[i("el-form",{attrs:{model:t.noteForm,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-form-item",{attrs:{label:"注释"}},[i("el-input",{ref:"noteText",attrs:{type:"textarea",autosize:{minRows:4,maxRows:30},placeholder:"输入注释",resize:"none"},on:{change:t.onSave},model:{value:t.noteForm.text,callback:function(e){t.$set(t.noteForm,"text",e)},expression:"noteForm.text"}})],1)],1)],1)],1)},Us=[],Zs=i("aa47"),Ys=function(){return window.store.statementList.map((function(t){return"class"===t.nodeName&&""!==t.name&&{value:t.name}})).filter(Boolean)},Hs={name:"PropertyPanel",props:{isShow:Boolean},data:function(){return{TYPE_LIST:xo,RETURN_LIST:Co,MODIFIER_LIST:bo,RELATION_LIST:Io,RELATION_STEREOTYPE_MAP:Do,RELATION_NAME_MAP:Mo,element:null,showType:"",isShowProperty:!1,isShowColorPicker:!1,classForm:{name:"",backgroundColor:"",propertyList:[],operationList:[]},lineForm:{relation:"",fromState:{},toState:{},stereotype:[],remark:"",sourceMultiplicity:"",targetMultiplicity:"",sourceRoleName:"",targetRoleName:"",color:""},noteForm:{text:"",backgroundColor:""},beforeData:null,afterData:null,classNameList:[]}},mounted:function(){var t=this;this.initEvent(),setTimeout((function(){t.initDrag()}),100)},methods:{initEvent:function(){var t=this;zi.$on("xClass:editClass",(function(e,i){t.classForm=Object(Ri["cloneDeep"])(e),t.classForm.operationList.forEach((function(t){t.paramList||(t.paramList=[])})),t.element=i,t.show("class"),t.classNameList=Ys()})),zi.$on("xClass:editLine",(function(e,i){t.lineForm=e,t.element=i,t.show("line")})),zi.$on("xClass:editNote",(function(e,i){t.noteForm=e,t.element=i,t.show("note")})),zi.$on("xClass:hidePropertyPanel",(function(){t.hide()}))},initDrag:function(){var t=this,e=document.querySelector("#propTable tbody");Zs["a"].create(e,{onEnd:function(e){var i=e.oldIndex,o=e.newIndex,n=Object(Ri["cloneDeep"])(t.classForm.propertyList),a=n.map((function(t){return t.key})),s=n.splice(i,1)[0];n.splice(o,0,s),t.classForm.propertyList=[],setTimeout((function(){n.forEach((function(e,i){e.key=a[i],t.$set(t.classForm.propertyList,i,e)})),t.onSave()}),1)}});var i=document.querySelector("#methodTable tbody");Zs["a"].create(i,{onEnd:function(e){var i=e.oldIndex,o=e.newIndex,n=Object(Ri["cloneDeep"])(t.classForm.operationList),a=n.map((function(t){return t.key})),s=n.splice(i,1)[0];n.splice(o,0,s),t.classForm.operationList=[],setTimeout((function(){n.forEach((function(e,i){e.key=a[i],t.$set(t.classForm.operationList,i,e)})),t.onSave()}),1)}})},addProperty:function(){this.classForm.propertyList.push({key:Object(b["a"])(),name:"",type:"",modifier:""})},addOperation:function(){this.classForm.operationList.push({key:Object(b["a"])(),name:"",type:"",modifier:"",paramList:[]})},deleteProperty:function(t){this.classForm.propertyList.splice(t,1),this.onSave()},deleteOperation:function(t){this.classForm.operationList.splice(t,1),this.onSave()},addParam:function(t){this.classForm.operationList[t].paramList.push({name:"",type:""})},deleteParam:function(t,e){this.classForm.operationList[t].paramList.splice(e,1),this.onSave()},onSave:Object(Ri["debounce"])((function(){"class"===this.showType&&(this.beforeData=this.element.exportData(),this.element.updateData(this.classForm),this.afterData=this.element.exportData()),"line"===this.showType&&(this.beforeData=this.element.exportData(),this.element.updateData(this.lineForm),this.afterData=this.element.exportData()),"note"===this.showType&&(this.beforeData=this.element.exportData(),this.element.updateData(this.noteForm),this.afterData=this.element.exportData()),window.store.pushStack({actionType:To.updateNode,data:{beforeData:{nodeList:[this.beforeData]},afterData:{nodeList:[this.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.updateNode)}),200),show:function(t){zi.$emit("xClass:closeAllRightPanel"),zi.$emit("xClass:setDiagramPanelShow",!1),this.showType=t,this.isShowProperty=!0},hide:function(){zi.$emit("xClass:setDiagramPanelShow",!0),this.isShowProperty=!1},toggleColorPicker:function(){this.isShowColorPicker=!this.isShowColorPicker},colorChange:function(t,e){this.updateColor(e,t),this.isShowColorPicker=!1},customColorChange:function(t,e){this.updateColor(e,t)},updateColor:function(t,e){"class"===t&&(this.classForm.backgroundColor=e),"note"===t&&(this.noteForm.backgroundColor=e),"line"===t&&(this.lineForm.color=e),this.onSave()},multiplicityOptions:function(t,e){e(No)},typeOptions:function(t,e){e([].concat(Object(I["a"])(xo),Object(I["a"])(this.classNameList)))},returnTypeOptions:function(t,e){e([].concat(Object(I["a"])(Co),Object(I["a"])(this.classNameList)))}}},Vs=Hs,Qs=(i("577e"),Object(c["a"])(Vs,Fs,Us,!1,null,null,null)),Ws=Qs.exports,Xs=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container comment_container"},[t._l(t.comments,(function(e,o){return i("div",{key:e.createTime,staticClass:"comment"},[i("div",{staticClass:"info"},[i("img",{staticClass:"avatar",attrs:{src:e.avatar,height:"36",width:"36"}}),i("div",{staticClass:"right"},[i("div",{staticClass:"name"},[t._v(t._s(e.creator))]),i("div",{staticClass:"date"},[t._v(t._s(e.createTime))])])]),i("div",{staticClass:"content"},[e.replyTo?i("span",{staticClass:"to-name"},[t._v("@"+t._s(e.replyTo))]):t._e(),i("span",[t._v(t._s(e.content))])]),i("div",{staticClass:"control"},[i("span",{staticClass:"like",class:{active:-1!==e.likeStaffList.indexOf(t.staffName)},on:{click:function(i){return t.likeClick(e)}}},[i("svg",{staticClass:"svg-icon",staticStyle:{width:"1.0009765625em",height:"1em","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},attrs:{version:"1.1",viewBox:"0 0 1025 1024",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"M1024.549 498.788c0.379 4.717 0.025 9.567-1.254 14.401l-92.244 407.161c-1.295 4.876-3.43 9.305-6.137 13.242-9.879 19.727-24.902 37.173-44.875 49.875-21.041 13.375-44.541 19.618-67.752 19.576l0-0.256-592.522-0.247c-2.071 0.307-4.168 0.515-6.327 0.515-2.165 0-4.271-0.208-6.356-0.524l-157.605-0.065c-2.215 0.355-4.47 0.59-6.788 0.59C19.109 1003.056 0 983.944 0 960.37l0.387-512.489c0-23.58 19.118-42.688 42.698-42.688 1.761 0 3.488 0.136 5.198 0.352l141.671-0.331 0-0.805c130.35-9.331 233.638-116.19 237.323-248.024-0.328-3.71-0.563-7.438-0.563-11.233 0-68.586 55.596-124.191 124.192-124.191 58.941 0 108.18 41.102 120.9 96.173l0.627-0.082c6.992 31.441 10.803 64.079 10.803 97.619 0 51.715-8.83 101.353-24.984 147.544l238.277 0.257c2.191 0 4.334 0.219 6.443 0.542 40.684 1.598 79.869 22.548 102.949 59.75C1020.604 446.423 1026.461 473.007 1024.549 498.788M85.417 917.107l85.37 0.036 0.322-426.51-85.29 0.19L85.417 917.107 85.417 917.107zM933.867 467.369c-8.207-13.231-22.701-20.186-37.229-19.402l0-0.127c-0.035 0-0.072 0-0.107 0l-301.186-0.314c-23.572 0-42.688-19.118-42.688-42.695 0-6.787 1.631-13.186 4.451-18.883l-0.453-0.374c17.053-31.748 29.459-66.356 36.492-102.865l0.535 0.014c0 0 5.676-23.051 5.604-67.264-0.061-35.024-6.443-66.999-6.443-66.999l-0.322 0c0.029-0.621 0.096-1.228 0.096-1.857 0-22.042-17.875-39.916-39.916-39.916-22.053 0-39.928 17.874-39.928 39.916 0 0.921 0.082 1.83 0.139 2.736l-0.556 0.008c0 0 0.679 33.328-5.974 67.893-2.825 14.663-6.795 28.337-10.41 39.168-0.073-0.035-0.137-0.064-0.21-0.1-35.93 109.848-126.277 194.998-239.189 223.682l-0.41 437.186 556.325 0.227c1.881 0 3.717 0.16 5.529 0.407 5.551-0.74 11.037-2.657 16.076-5.861 7.152-4.544 12.344-10.99 15.387-18.263l0.109 0.061 88.814-392.011-0.344-0.103C941.611 490.546 940.484 478.038 933.867 467.369"}})]),e.likeStaffList&&e.likeStaffList.length>0?i("el-tooltip",{attrs:{content:e.likeStaffList.join(",")+"赞了",effect:"light",placement:"bottom"}},[i("span",{staticClass:"like-num"},[t._v(t._s(e.likeStaffList.length+"人赞"))])]):i("span",{staticClass:"like-num"},[t._v("赞")])],1),i("span",{staticClass:"comment-reply",on:{click:function(i){return t.showCommentInput(e,"",o)}}},[i("i",{staticClass:"el-icon-chat-dot-round"}),i("span",[t._v("回复")])]),e.subSystemId?i("span",{staticClass:"comment-reply",staticStyle:{"margin-left":"20px"},on:{click:function(i){return t.selectComponent(e)}}},[i("i",{staticClass:"el-icon-box"}),i("span",[t._v("元件")])]):t._e(),i("el-popconfirm",{attrs:{"cancel-button-text":"取消","confirm-button-text":"删除",icon:"el-icon-info","icon-color":"red",title:"确认要删除吗？"},on:{confirm:function(i){return t.deleteComment(e,t.comments)}}},[t.staffName===e.creator?i("span",{staticClass:"comment-reply",staticStyle:{"margin-left":"17px"},attrs:{slot:"reference"},slot:"reference"},[i("i",{staticClass:"el-icon-delete"}),i("span",[t._v("删除")])]):t._e()])],1),i("div",{staticClass:"reply"},[t._l(e.reply,(function(n){return i("div",{key:n.createTime,staticClass:"item"},[i("div",{staticClass:"reply-content"},[i("div",[i("span",{staticClass:"from-name"},[t._v(t._s(n.creator))]),i("span",[t._v(":")]),n.replyTo?i("span",{staticClass:"to-name"},[t._v("@"+t._s(n.replyTo))]):t._e(),t._v("\n            "+t._s(n.content)+"\n          ")])]),i("div",{staticClass:"reply-bottom"},[i("span",[t._v(t._s(n.createTime))]),i("span",{staticClass:"reply-text",on:{click:function(i){return t.showCommentInput(e,n,o)}}},[i("i",{staticClass:"el-icon-chat-dot-round"}),i("span",[t._v("回复")])]),i("el-popconfirm",{attrs:{"cancel-button-text":"取消","confirm-button-text":"删除",icon:"el-icon-info","icon-color":"red",title:"确认要删除吗？"},on:{confirm:function(i){return t.deleteReply(n,e.reply)}}},[t.staffName===n.creator?i("span",{staticClass:"reply-text",attrs:{slot:"reference"},slot:"reference"},[i("i",{staticClass:"el-icon-delete"}),i("span",[t._v("删除")])]):t._e()])],1)])})),e.reply.length>0?i("div",{staticClass:"write-reply",on:{click:function(i){return t.showCommentInput(e,"",o)}}},[i("i",{staticClass:"el-icon-edit"}),i("span",{staticClass:"add-comment"},[t._v("添加新评论")])]):t._e(),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showItemId===e.id,expression:"showItemId === item.id"}],staticClass:"input-wrapper"},[i("el-input",{ref:"replyTextarea",refInFor:!0,staticClass:"gray-bg-input",attrs:{rows:3,autofocus:"",placeholder:"写下你的评论",type:"textarea"},model:{value:t.inputComment,callback:function(e){t.inputComment=e},expression:"inputComment"}}),i("div",{staticClass:"btn-control"},[i("span",{staticClass:"cancel",staticStyle:{"font-size":"12px"},on:{click:t.cancel}},[t._v("取消")]),i("el-button",{staticClass:"btn",attrs:{round:"",size:"mini",type:"success"},on:{click:function(i){return t.replyComment(e.id,e.subSystemId)}}},[t._v("发表")])],1)],1)])],2)])})),i("div",{staticClass:"input-wrapper"},[i("el-input",{staticClass:"gray-bg-input",attrs:{rows:3,autofocus:"",placeholder:"写下你的评论",type:"textarea"},model:{value:t.currentInputComment,callback:function(e){t.currentInputComment=e},expression:"currentInputComment"}}),i("div",{staticClass:"btn-control"},[i("el-button",{staticClass:"btn",attrs:{round:"",size:"mini",type:"success"},on:{click:t.commitComment}},[t._v("发表")])],1)],1)],2)},Js=[],$s={props:{comments:{type:Array,required:!0},staffName:{type:String,default:""}},components:{},data:function(){return{currentInputComment:"",inputComment:"",showItemId:""}},computed:{},methods:{likeClick:function(t){var e=t.likeStaffList.indexOf(this.staffName);-1!==e?(t.likeStaffList.splice(e,1),zi.$emit("xClass:unlikeComment",t)):(t.likeStaffList.push(this.staffName),zi.$emit("xClass:likeComment",t))},selectComponent:function(t){window.store.setActiveNodeByUUID(t.subSystemId)},deleteComment:function(t,e){e.splice(e.indexOf(t),1),zi.$emit("xClass:removeComment",t)},deleteReply:function(t,e){e.splice(e.indexOf(t),1),zi.$emit("xClass:removeComment",t)},cancel:function(){this.showItemId=""},replyComment:function(t,e){zi.$emit("xClass:replyComment",t,this.inputComment.trim(),e),this.showItemId=""},commitComment:function(){zi.$emit("xClass:replyComment",void 0,this.currentInputComment),this.currentInputComment=""},showCommentInput:function(t,e,i){var o=this;this.inputComment=e?"@"+e.creator+" ":"",this.showItemId=t.id,this.$nextTick((function(){o.$refs.replyTextarea[i].focus()}))}}},Ks=$s,qs=(i("0878"),i("320e"),Object(c["a"])(Ks,Xs,Js,!1,null,"eda72ba4",null)),tr=qs.exports,er=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow&&t.isShowHelpPanel,expression:"isShow && isShowHelpPanel"}],staticClass:"help_panel"},[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"操作帮助"}},[i("ul",{staticClass:"help-list"},[i("li",[i("el-link",{on:{click:t.showKeyTips}},[t._v("快捷键秘籍")])],1),t._l(t.helpList,(function(e){return i("li",{key:e.title},[i("el-link",{on:{click:function(i){return t.showDialog(e)}}},[t._v(t._s(e.title))])],1)}))],2)])],1),i("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:t.width,"modal-append-to-body":!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{staticStyle:{width:"100%"},attrs:{src:this.gifUrl}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("学会了")])],1)]),t._l(t.helpList,(function(t){return i("img",{key:t.title,staticStyle:{display:"none"},attrs:{src:t.gifUrl}})}))],2)},ir=[],or={name:"HelpPanel",components:{},props:{isShow:Boolean},data:function(){return{isShowHelpPanel:!1,title:"",dialogVisible:!1,gifUrl:"",width:"800px",helpList:[{title:"怎么创建类和关系",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/25c72dcccb979c4b7bb8280fddd63d98_1688x1232.gif",width:"700px"},{title:"怎么修改颜色和字体大小",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/a9dffdb9a13ebe52d97d3b271f86dd90_1688x1232.gif",width:"700px"},{title:"怎么修改关系指向",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/1fb5934006a53aca984abdd13ac30ec5_1688x1232.gif",width:"700px"},{title:"怎么快速修改类名和注释",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/88163cb088427b463ebc27535f8eb5be_1688x1232.gif",width:"700px"},{title:"怎么调整多重性和角色名位置",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/978724f9f811a7ab45594ab0be23fcb3_1688x1232.gif",width:"700px"}]}},mounted:function(){var t=this;zi.$on("xClass:openHelpPanel",(function(){return t.isShowHelpPanel=!0})),zi.$on("xClass:closeHelpPanel",(function(){return t.isShowHelpPanel=!1}))},methods:{showKeyTips:function(){zi.$emit("xClass:openKeyTips")},showDialog:function(t){var e=t.title,i=t.gifUrl,o=t.width;this.width=o,this.dialogVisible=!0,this.title=e,this.gifUrl=i}}},nr=or,ar=(i("ed88"),Object(c["a"])(nr,er,ir,!1,null,null,null)),sr=ar.exports,rr={name:"DiagramPanel",components:{MultiProperty:_s,PropertyPanel:Ws,Comment:tr,HelpPanel:sr},props:{historyColors:Array,revisionList:Array,commentList:Array,staffName:String},data:function(){var t={width:"1000",height:"1000"},e=xn("tag");return{activeName:"baseInfo",currentRevisionId:"",diagramInfo:window.diagramInfo||t,isShow:!0,isShowDiagramInfo:!0,isConfluence:e&&e.includes("iwiki"),panelWidth:330}},mounted:function(){var t=this;this.prevPanelWidth=this.panelWidth,zi.$on("xClass:setRightPanelShow",(function(e){t.isShow=e,t.panelWidth=t.prevPanelWidth})),zi.$on("xClass:setDiagramPanelShow",(function(e){return t.isShowDiagramInfo=e})),zi.$on("xClass:setDiagramPanelShowName",(function(e){return t.activeName=e})),zi.$on("xClass:resetRevision",(function(){return t.closeRevision()})),zi.$on("xClass:closeAllRightPanel",(function(){zi.$emit("xClass:hidePropertyPanel"),zi.$emit("xClass:closeMultiProperty"),zi.$emit("xClass:closeHelpPanel"),zi.$emit("xClass:setDiagramPanelShow",!0),t.isConfluence&&zi.$emit("xClass:openHelpPanel")})),zi.$emit("xClass:closeAllRightPanel")},methods:{toggleShow:function(){this.isShow=!this.isShow,0===this.panelWidth?this.panelWidth=this.prevPanelWidth:this.panelWidth=0},formatTime:function(t){return Ko(t,{source:"string"})},openRevision:function(t){this.currentRevisionId=t.RevisionUUId,zi.$emit("xClass:openRevision",t)},closeRevision:function(){this.currentRevisionId="",zi.$emit("xClass:closeRevision")},onPanelMouseDown:function(t){this.isShow&&(this._prevX=t.pageX,document.addEventListener("mousemove",this.mouseMove),document.addEventListener("mouseup",this.mouseUp))},mouseMove:function(t){t.preventDefault(),this.panelWidth+=this._prevX-t.pageX,this.prevPanelWidth=this.panelWidth,this._prevX=t.pageX},mouseUp:function(){document.removeEventListener("mousemove",this.mouseMove),document.removeEventListener("mouseup",this.mouseUp)}}},cr=rr,lr=(i("2f68"),i("d714"),i("1cc3"),Object(c["a"])(cr,Ds,Ns,!1,null,"67e83f86",null)),dr=lr.exports,ur=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"index-quickBar-3rbxS",style:"left:"+t.position.x+"px;top:"+t.position.y+"px;",on:{click:function(t){return t.stopPropagation()},mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"字体颜色",effect:"light",placement:"top"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT7mlrBpY29uL+Wtl+iJskAzeDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSLmlrBpY29uL+Wtl+iJsiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZD0iTTEzLjA3NSw1LjUgTDE4LDE5IEwxNi41MDgsMTkgTDExLjk5OTk4NTYsNi42NDAxMjc2MSBMNy40OTEsMTkgTDYsMTkgTDEwLjkyMyw1LjUgTDEzLjA3NSw1LjUgWiIgaWQ9IuW9oueKtue7k+WQiCIgZmlsbD0iIzQ2NEQ1QSI+PC9wYXRoPgogICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUiIGZpbGw9IiM0NjRENUEiIHg9IjcuOTY2MDA2MjgiIHk9IjEzLjciIHdpZHRoPSI4IiBoZWlnaHQ9IjEuMyI+PC9yZWN0PgogICAgPC9nPgo8L3N2Zz4="},on:{click:function(){return t.changeFontColor(t.historyColors[0])}}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.historyColors[0]+";"})]),i("img",{ref:"fontArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleFontColorPicker}}),i("ColorPicker",{directives:[{name:"show",rawName:"v-show",value:t.isShowFontColorPicker,expression:"isShowFontColorPicker"}],staticClass:"color_picker",attrs:{color:t.node.fontColor,historyColors:t.historyColors},on:{"color-change":function(e){return t.changeFontColor(e)},"custom-color-change":function(e){return t.changeFontColor(e,!0)}}})],1)])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"图形填充色",effect:"light",placement:"top"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT50b29sYmFyX2ZpbGwgY29sb3I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0idG9vbGJhcl9maWxsLWNvbG9yIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAiPgogICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlIiBzdHJva2U9IiM5Nzk3OTciIGZpbGw9IiNEOEQ4RDgiIG9wYWNpdHk9IjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTkuNzUsMTMgTDIwLjgzNDU0MDgsMTUgQzIxLjA1NTcyMzgsMTUuNDEwMzEwMSAyMS4wNTUxMTQ1LDE1LjkxMjE1NiAyMC44MzI5MzYsMTYuMzIxODc1MiBDMjAuNjEwNzU3NCwxNi43MzE1OTQzIDIwLjE5OTYyNCwxNi45ODkwNDI0IDE5Ljc1LDE3IEMxOS4zMDAzNzYsMTYuOTg5MDQyNCAxOC44ODkyNDI2LDE2LjczMTU5NDMgMTguNjY3MDY0LDE2LjMyMTg3NTIgQzE4LjQ0NDg4NTUsMTUuOTEyMTU2IDE4LjQ0NDI3NjIsMTUuNDEwMzEwMSAxOC42NjU0NTkyLDE1IEwxOS43NSwxMyBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNDY0RDVBIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xOC44NTc5NjY5LDExLjMxNDIwMzMgQzE5LjA0NzM0NDQsMTEuNTAzNTgwOCAxOS4wNDczNDQ0LDExLjgxMDYyMjUgMTguODU3OTY2OSwxMiBMMTIsMTguODU3OTY2OSBDMTEuODEwNjIyNSwxOS4wNDczNDQ0IDExLjUwMzU4MDgsMTkuMDQ3MzQ0NCAxMS4zMTQyMDMzLDE4Ljg1Nzk2NjkgTDUuMTQyMDMzMTQsMTIuNjg1Nzk2NyBDNC45NTI2NTU2MiwxMi40OTY0MTkyIDQuOTUyNjU1NjIsMTIuMTg5Mzc3NSA1LjE0MjAzMzE0LDEyIEwxMiw1LjE0MjAzMzE0IEMxMi4xODkzNzc1LDQuOTUyNjU1NjIgMTIuNDk2NDE5Miw0Ljk1MjY1NTYyIDEyLjY4NTc5NjcsNS4xNDIwMzMxNCBMMTguODU3OTY2OSwxMS4zMTQyMDMzIFogTTE3LjQxNzc5MzgsMTEuNjU3MTAxNyBMMTIuMzQyODk4Myw2LjU4MjIwNjE4IEw2LjU4MjIwNjE4LDEyLjM0Mjg5ODMgTDExLjY1NzEwMTcsMTcuNDE3NzkzOCBMMTcuNDE3NzkzOCwxMS42NTcxMDE3IFoiIGlkPSLlvaLnirYiIGZpbGw9IiM0NjRENUEiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgICAgICA8cG9seWdvbiBpZD0i6Lev5b6ELTMiIGZpbGw9IiM0NjRENUEiIHBvaW50cz0iNiAxMyAxMS42NTkwMDMgMTcuOTcxNDU4MyAxNy4xMTU2MzQ4IDEzIj48L3BvbHlnb24+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="},on:{click:function(){return t.changeShapeColor(t.historyColors[0])}}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.historyColors[0]+";"})]),i("img",{ref:"shapeArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleShapeColorPicker}}),i("ColorPicker",{directives:[{name:"show",rawName:"v-show",value:t.isShowShapeColorPicker,expression:"isShowShapeColorPicker"}],staticClass:"color_picker",attrs:{color:t.node.backgroundColor||t.node.color,historyColors:t.historyColors},on:{"color-change":function(e){return t.changeShapeColor(e)},"custom-color-change":function(e){return t.changeShapeColor(e,!0)}}})],1)])],1)])]),i("div",{staticClass:"dui-divider dui-divider-vertical",staticStyle:{"vertical-align":"middle","background-color":"rgba(0, 0, 0, 0.08)",margin:"0px 10px"}}),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"增大字号",effect:"light",placement:"top"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|up"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5Yqg5aSnQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPliqDlpKciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUuMDAwMDAwLCA0LjAwMDAwMCkiIGZpbGw9IiM0NjRENUEiPgogICAgICAgICAgICA8cGF0aCBkPSJNNi42MDAxMDQyNiwwLjM2IEwxMiwxNC4zNiBMMTAuNjAxOTMzMSwxNC4zNiBMOS4wOTMsMTAuMzQ5IEwyLjg3MSwxMC4zNDkgTDEuMzUyNTgyNDcsMTQuMzYgTDAsMTQuMzYgTDUuMjgwNDc5NDcsMC4zNiBMNi42MDAxMDQyNiwwLjM2IFogTTUuOTkzMTg0ODMsMi4xMDYxODExNyBMMy4zNDUsOS4wOTkgTDguNjIzLDkuMDk5IEw1Ljk5MzE4NDgzLDIuMTA2MTgxMTcgWiIgaWQ9IlBhdGgtOOWkjeWItiI+PC9wYXRoPgogICAgICAgICAgICA8ZyBpZD0i57yW57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMS4wMDAwMDAsIDAuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIwIiB5PSIyIiB3aWR0aD0iNSIgaGVpZ2h0PSIxLjI1Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIxLjg2OTMyMzczIiB5PSIwLjEzMDM3MTA5NCIgd2lkdGg9IjEuMjUiIGhlaWdodD0iNSI+PC9yZWN0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}})])])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(-1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"减小字号",effect:"light",placement:"top"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|down"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5YeP5bCPQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPlh4/lsI8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtOCI+CiAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGXlpIfku70tNSIgb3BhY2l0eT0iMC4yNDY3NjgwNDMiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTEuNjAwMTA0Myw0LjM2IEwxNywxOC4zNiBMMTUuNjAxOTMzMSwxOC4zNiBMMTQuMDkzLDE0LjM0OSBMNy44NzEsMTQuMzQ5IEw2LjM1MjU4MjQ3LDE4LjM2IEw1LDE4LjM2IEwxMC4yODA0Nzk1LDQuMzYgTDExLjYwMDEwNDMsNC4zNiBaIE0xMC45OTMxODQ4LDYuMTA2MTgxMTcgTDguMzQ1LDEzLjA5OSBMMTMuNjIzLDEzLjA5OSBMMTAuOTkzMTg0OCw2LjEwNjE4MTE3IFoiIGlkPSJQYXRoLTjlpI3liLblpIfku70iIGZpbGw9IiM0NjRENUEiPjwvcGF0aD4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iIzQ2NEQ1QSIgeD0iMTYiIHk9IjYiIHdpZHRoPSI1IiBoZWlnaHQ9IjEuMjUiPjwvcmVjdD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="}})])])])],1)])])]):t._e()},hr=[],fr={name:"ContextToolbar",components:{ColorPicker:zs},props:{position:{type:Object,default:function(){return{x:0,y:0}}},show:{type:Boolean,default:!1},node:{type:Object},historyColors:Array},data:function(){return{isShowFontColorPicker:!1,isShowShapeColorPicker:!1,beforeData:null,afterData:null}},watch:{show:function(){this.isShowFontColorPicker=!1,this.isShowShapeColorPicker=!1}},mounted:function(){this.isShowFontColorPicker=!1,this.isShowShapeColorPicker=!1},methods:{changeShapeColor:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.beforeData=this.node.exportData();var i=this.node.exportData();"relation"===this.node.nodeName&&(i.color=t),"class"!==this.node.nodeName&&"note"!==this.node.nodeName||(i.backgroundColor=t),this.node.updateData(i),this.isShowShapeColorPicker=e,this.afterData=this.node.exportData(),window.store.pushStack({actionType:To.updateNodeColor,data:{beforeData:{nodeList:[this.beforeData]},afterData:{nodeList:[this.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.updateNodeColor)},changeFontColor:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.beforeData=this.node.exportData();var i=this.node.exportData();i.fontColor=t,this.node.updateData(i),this.isShowFontColorPicker=e,this.afterData=this.node.exportData(),window.store.pushStack({actionType:To.updateNodeFontColor,data:{beforeData:{nodeList:[this.beforeData]},afterData:{nodeList:[this.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.updateNodeFontColor)},onFontSizeChange:function(t){this.beforeData=this.node.exportData();var e=this.node.exportData(),i=this.node.fontSize+t;i<10&&(i=10),i>24&&(i=24),e.fontSize=i,this.node.updateData(e),this.afterData=this.node.exportData(),window.store.pushStack({actionType:To.updateNodeFontSize,data:{beforeData:{nodeList:[this.beforeData]},afterData:{nodeList:[this.afterData]}},type:"undo"}),zi.$emit("xClass:autoSave",To.updateNodeFontSize)},toggleFontColorPicker:function(t){t.stopPropagation(),this.isShowShapeColorPicker=!1,this.isShowFontColorPicker=!this.isShowFontColorPicker},toggleShapeColorPicker:function(t){t.stopPropagation(),this.isShowFontColorPicker=!1,this.isShowShapeColorPicker=!this.isShowShapeColorPicker}}},gr=fr,pr=(i("2110"),Object(c["a"])(gr,ur,hr,!1,null,"6c24e390",null)),mr=pr.exports,yr=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-form",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"form",staticClass:"comment_board",style:"left: "+t.position.x+"px; top: "+t.position.y+"px;",attrs:{"label-width":"0px"}},[i("el-form-item",{attrs:{label:""}},[i("el-input",{ref:"commentInput",attrs:{rows:5,type:"textarea"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),i("div",[i("span",{staticClass:"cancel-btn",on:{click:t.cancelComment}},[t._v("取消")]),i("el-button",{attrs:{round:"",size:"mini",type:"primary"},on:{click:t.comment}},[t._v("评论")])],1)],1)},vr=[],wr={name:"CommentBoard",props:{position:{type:Object,default:function(){return{x:0,y:0}}},show:Boolean,uuid:String},data:function(){return{content:""}},mounted:function(){},methods:{cancelComment:function(){zi.$emit("xClass:cancelAddNew")},comment:function(){zi.$emit("xClass:replyComment",void 0,this.content.trim(),this.uuid),zi.$emit("xClass:cancelAddNew"),zi.$emit("xClass:closeAllRightPanel"),zi.$emit("xClass:setRightPanelShow",!0),zi.$emit("xClass:setDiagramPanelShow",!0),zi.$emit("xClass:setDiagramPanelShowName","userComment"),this.content=""}}},xr=wr,Cr=(i("031b"),Object(c["a"])(xr,yr,vr,!1,null,"05ff0ce7",null)),br=Cr.exports;o["default"].use(In["a"]);var Ir={name:"XClassDiagram",components:{ToolBox:cs,InsertBoard:gs,RelationBoard:xs,KeyTips:Ss,DiagramPanel:dr,ContextToolbar:mr,CommentBoard:br},props:{data:Object,diagramUUId:String,staffName:String,isShowGenCopy:Boolean,isShowSaveRevision:Boolean,isShowShare:Boolean},data:function(){return{tip:"",diagramMode:"",historyColors:window.historyColors||["#FAECD8","#000000"],isOpenRevision:!1,revisionList:[],currentRevision:{},beforeRenderData:null,commentList:[],isShowPasteDialog:!1,pasteTitle:"粘贴 Class",pasteType:"link",pasteData:{},pasteOptions:[{value:"link",label:"引用"},{value:"deepclone",label:"深拷贝"}],insertBoard:{show:!1,position:{x:800,y:400},done:function(){}},relationBoard:{show:!1,position:{x:800,y:400},done:function(){}},menuBoard:{newPos:{x:0,y:0}},toolbar:{show:!1,position:{x:100,y:100},node:{fontColor:"#000",backgroundColor:"#000"},done:function(){}},commentBoard:{show:!1,position:{x:0,y:0},uuid:"",done:function(){}},guide:{title:"怎么创建类和关系",dialogVisible:!1,width:"500px",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/25c72dcccb979c4b7bb8280fddd63d98_1688x1232.gif"}}},computed:{diagramName:function(){return this.data.diagramName}},mounted:function(){var t=this;window.contextmenu=this.$contextmenu,setTimeout((function(){t.initStage(),t.initMessage(),t.initEvent()}),100),localStorage.getItem("__xwatt__iwiki__class__guide__")||(this.guide.dialogVisible=!0,localStorage.setItem("__xwatt__iwiki__class__guide__",!0))},beforeDestroy:function(){this.beforeDestroy()},methods:{initEvent:function(){var t=this,e=document.querySelector("#svingRoot");zi.$on("xClass:showInsertBoard",(function(i){var o=i.origin,n=i.point,a=i.position,s=i.callback,r=window.store.scale;t.insertBoard.position={x:n.x*r+o.x-e.scrollLeft,y:n.y*r+o.y-e.scrollTop},t.insertBoard.svgPoint=n,t.insertBoard.newPos=a,t.insertBoard.show=!0,t.insertBoard.done=function(e,i){t.insertBoard.done=function(){},t.insertBoard.show=!1,s(e,i)}})),zi.$on("xClass:showRelationBoard",(function(i){var o=i.origin,n=i.point,a=i.position,s=i.callback,r=window.store.scale;t.relationBoard.position={x:n.x*r+o.x-e.scrollLeft,y:n.y*r+o.y-e.scrollTop},t.relationBoard.svgPoint=n,t.relationBoard.newPos=a,t.relationBoard.show=!0,t.relationBoard.done=function(e){t.relationBoard.done=function(){},t.relationBoard.show=!1,s(e)}})),zi.$on("xClass:showMenuBoard",(function(e){e.origin,e.point;var i=e.position;e.callback;t.menuBoard.newPos=i,window.contextmenu({items:[{label:"新增类",onClick:function(){t.createNewNode("class")}},{label:"新增接口",onClick:function(){t.createNewNode("class","interface")}},{label:"新增数据类型",onClick:function(){t.createNewNode("class","dataType")}},{label:"新增枚举",onClick:function(){t.createNewNode("class","enumeration")}},{label:"新增原函数",onClick:function(){t.createNewNode("class","primitive")}},{label:"新增信号",onClick:function(){t.createNewNode("class","signal")}},{label:"新增注释",divided:!0,onClick:function(){t.createNewNode("note")}},{label:"取消"}],event:event,zIndex:1e3,minWidth:230})})),zi.$on("xClass:showContextToolbar",(function(i){var o=i.origin,n=i.point,a=i.node,s=window.store.scale;t.toolbar.position={x:n.x*s+o.x-e.scrollLeft,y:n.y*s+o.y-e.scrollTop-40},t.toolbar.show=!0,t.toolbar.node=a,t.toolbar.done=function(){t.toolbar.done=function(){},t.toolbar.show=!1}})),zi.$on("xClass:cancelAddNew",(function(){t.cancelAddNew()})),zi.$on("xClass:autoSaveTip",(function(e){return t.tip=e||""})),zi.$on("xClass:autoSave",Object(Ri["debounce"])((function(e){if(console.log("🚀 ~ file: index.vue ~ line 194 ~ saveSource",e),window.store.adjustSize(),t.isOpenRevision)return t.$notify.closeAll(),void t.$notify({title:"提示",type:"info",message:"修订记录不可修改和保存"});t.$emit("update")}),1e3)),zi.$on("xClass:setDiagramMode",(function(e){return t.diagramMode=e})),zi.$on("xClass:openRevision",(function(e){t.isOpenRevision||(t.beforeRenderData=window.store.exportData()),t.currentRevision=e,t.isOpenRevision=!0,window.store.isOpenRevision=!0;var i=""===e.ExtendJSONData?{}:JSON.parse(e.ExtendJSONData);window.store.initRender(i)})),zi.$on("xClass:closeRevision",(function(){t.isOpenRevision=!1,t.currentRevision={},window.store.isOpenRevision=!1,window.store.initRender(t.beforeRenderData),t.beforeRenderData=null})),zi.$on("xClass:removeComment",(function(e,i){t.$emit("removeComment",e,i)})),zi.$on("xClass:replyComment",(function(e,i,o){t.$emit("replyComment",e,i,o)})),zi.$on("xClass:likeComment",(function(e){t.$emit("likeComment",e)})),zi.$on("xClass:unlikeComment",(function(e){t.$emit("unlikeComment",e)})),zi.$on("xClass:showCommentForm",(function(e,i,o){t.commentBoard.position={x:e,y:i},t.commentBoard.uuid=o,t.commentBoard.show=!0,t.commentBoard.done=function(){t.commentBoard.done=function(){},t.commentBoard.show=!1}}))},initStage:function(){var t=this.data,e=t.x,i=void 0===e?0:e,o=t.y,n=void 0===o?0:o,a=t.diagramMode,s=void 0===a?"class":a,r=t.statementList,c=void 0===r?[]:r,l=t.transitionList,d=void 0===l?[]:l;this.diagramMode=s,window.stage=new window.sving.Stage("#svingRoot",Hi,Yi),window.store=new Xa({stage:window.stage,x:i,y:n,diagramMode:s,statementList:c,transitionList:d}),window.store.scale=window.diagramScale||1,window.diagramScale=window.store.scale,window.store.adjustSize(),window.store.adjustOrigin(),window.stage.add(window.store)},initMessage:function(){window.addEventListener("message",this.receiveMessage,!1)},receiveMessage:function(t){switch(t.data.type){case"xwatt-project:clickMenuItem:modelDiagram":break;case"xwatt-project:modeltree:deleteElement":if(t.data.payload.Type===Lo.CLASS&&(window.store.removeElement(t.data.payload.UUId),this.$emit("update")),t.data.payload.Type===Lo.CLASS_PROPERTY){var e=window.store.statementList.find((function(e){return e.id===t.data.payload.ParentId})),i=e.propertyList.findIndex((function(e){return e.key===t.data.payload.UUId}));e.propertyList.splice(i,1);var o=e.dataModel.propertyList.findIndex((function(e){return e.key===t.data.payload.UUId}));e.dataModel.propertyList.splice(o,1),e.updateData(e.dataModel)}if(t.data.payload.Type===Lo.CLASS_OPERATION){var n=window.store.statementList.find((function(e){return e.id===t.data.payload.ParentId})),a=n.operationList.findIndex((function(e){return e.key===t.data.payload.UUId}));n.operationList.splice(a,1);var s=n.dataModel.operationList.findIndex((function(e){return e.key===t.data.payload.UUId}));n.dataModel.operationList.splice(s,1),n.updateData(n.dataModel)}break;case"xwatt-project:modeltree:renameElement":window.store.updateElementName(t.data.payload);break;case"xwatt-project:clickMenuItem:modelElement":t.data.payload.Type===Lo.CLASS&&window.store.setActiveNodeByUUID(t.data.payload.UUId),t.data.payload.Type!==Lo.CLASS_PROPERTY&&t.data.payload.Type!==Lo.CLASS_OPERATION||window.store.setActiveNodeByUUID(t.data.payload.ParentId);break;case"xwatt-project:modeltree:addElement":this.addElement(t);break;case"xwatt-project:clickTab":break;case"xwatt-project:activeTab":t.data.payload.projectEditableTabValue!==t.data.payload.id&&this.reload();break}},dragNewStatement:function(t){var e=t.e,i=t.type,o=t.classType;window.store.dragNewStatement(e,i,o)},createNewStatement:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o="class"===t?this.insertBoard.newPos:this.insertBoard.svgPoint,n={nodeName:t,x:o.x,y:o.y,width:no,height:ao,classType:i},a=window.store.addNewStatement(n,t);this.insertBoard.done(a,e)},createNewNode:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.menuBoard.newPos,o={nodeName:t,x:i.x,y:i.y};"class"===t&&(o.width=no,o.height=ao,o.classType=e),"note"===t&&(o.width=ho,o.height=fo,o.text="注释");var n=window.store.addNewStatement(o,t);window.store.pushStack({actionType:To.menuCreateNewNode,data:{nodeList:[n.exportData()]},type:"undo"}),zi.$emit("xClass:autoSave",To.menuCreateNewNode)},createNewTransition:function(t){this.relationBoard.done(t)},cancelAddNew:function(){this.insertBoard.done(),this.relationBoard.done(),this.toolbar.done(),this.commentBoard.done(),window.contextmenu({items:[]})},getData:function(){return window.store.exportData()},beforeDestroy:function(){zi.$off(),window.store&&window.store.gc&&window.store.gc(),window.stage&&window.stage.clear(),window.stage=null,window.store=null,window.diagramData={}},genCopy:function(){this.$emit("genCopy")},saveRevision:function(){this.$emit("saveRevision")},updateRevision:function(t){this.revisionList=t},closeRevision:function(){zi.$emit("xClass:resetRevision")},updateComment:function(t){this.commentList=t},addElement:function(t){if(5===t.data.payload.Type){var e=JSON.parse(t.data.payload.ExtendJSONData),i=window.store.statementList.find((function(t){return t.linkId===e.id}));if(i)return void this.$message({type:"warning",message:'该类图已包含 "'.concat(e.name,'" 的引用，禁止粘贴')});var o=window.store.statementList.find((function(t){return t.name===e.name}));if(o)return void this.$message({type:"warning",message:'该类图已包含与 "'.concat(e.name,'" 同名的 class，禁止粘贴')});this.pasteTitle='粘贴 "'.concat(e.name,'"'),this.isShowPasteDialog=!0;var n=Go(window.stage,{x:t.data.payload.clientX,y:t.data.payload.clientY});e.x=n.x,e.y=n.y,e.linkId=e.id,e.id=_o("statement"),console.log("🚀 ~ file: index.vue ~ line 402 ~ receiveMessage ~ jsonData",e),this.pasteData=e}else this.$message({type:"warning",message:"类图暂不支持添加此类型节点"})},comfirmPaste:function(){"deepclone"===this.pasteType&&(this.pasteData.linkId="",this.pasteData.propertyList.forEach((function(t){return t.key=_o()})),this.pasteData.operationList.forEach((function(t){return t.key=_o()})));var t=window.store.addNewStatement(this.pasteData,"class");window.store.pushStack({actionType:To.menuCreateNewNode,data:{nodeList:[t.exportData()]},type:"undo"}),zi.$emit("xClass:autoSave",To.menuCreateNewNode),this.isShowPasteDialog=!1,this.pasteData={},this.pasteType="link"},reload:function(){this.$emit("reload")}}},Mr=Ir,kr=(i("87be"),i("1fb3"),Object(c["a"])(Mr,Cn,bn,!1,null,"6b117ca6",null)),Sr=kr.exports;function Dr(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Nr(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Dr(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Dr(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}o["default"].use(v.a);var Ar=o["default"].extend(Sr),Lr=function(){function t(e){var i=e.el,o=e.data,n=e.diagramUUId,a=e.staffName,s=e.isShowGenCopy,r=void 0!==s&&s,c=e.isShowSaveRevision,l=void 0!==c&&c,d=e.isShowShare,u=void 0!==d&&d,h=e.reload,f=void 0===h?function(){}:h,g=e.update,p=void 0===g?function(){}:g,m=e.genCopy,y=void 0===m?function(){}:m,v=e.saveRevision,w=void 0===v?function(){}:v,x=e.removeComment,C=void 0===x?function(){}:x,b=e.replyComment,I=void 0===b?function(){}:b,k=e.likeComment,S=void 0===k?function(){}:k,D=e.unlikeComment,N=void 0===D?function(){}:D;Object(M["a"])(this,t),this.data=Object(Ri["cloneDeep"])(o),this.renderNode=document.querySelector(i),this.instance=new Ar({propsData:{data:this.data,diagramUUId:n,staffName:a,isShowGenCopy:r,isShowSaveRevision:l,isShowShare:u}}),this.instance.beforeDestroy(),this.instance.$on("reload",f),this.instance.$on("update",p),this.instance.$on("genCopy",y),this.instance.$on("saveRevision",w),this.instance.$on("removeComment",C),this.instance.$on("replyComment",I),this.instance.$on("likeComment",S),this.instance.$on("unlikeComment",N),this.instance.$mount(),this.renderNode.appendChild(this.instance.$el)}return Object(k["a"])(t,[{key:"getClassById",value:function(t){return window.store.statementList.find((function(e){return e.id===t}))}},{key:"getClassByPropertyId",value:function(t){return window.store.statementList.find((function(e){var i=e.propertyList,o=void 0===i?[]:i;if(o.find((function(e){return e.key===t})))return e}))}},{key:"getClassByMethodId",value:function(t){return window.store.statementList.find((function(e){var i=e.operationList,o=void 0===i?[]:i;if(o.find((function(e){return e.key===t})))return e}))}},{key:"getPropertyById",value:function(t){var e=window.store.statementList.map((function(t){return t.propertyList})).flat();return e.find((function(e){return e.key===t}))}},{key:"getMethodById",value:function(t){var e=window.store.statementList.map((function(t){return t.operationList})).flat();return e.find((function(e){return e.key===t}))}},{key:"getNoteById",value:function(t){return window.store.statementList.find((function(e){return e.id===t}))}},{key:"getRelationById",value:function(t){return window.store.transitionList.find((function(e){return e.id===t}))}},{key:"createClass",value:function(t){return window.store.addNewStatement(t,"class")}},{key:"createProperty",value:function(t,e,i){var o=this.getClassById(t);if(o){var n=o.exportData(),a=n.propertyList,s=void 0===a?[]:a;e.key=Object(b["a"])(),i?s.splice(i,0,e):s.push(e),o.updateData(n)}}},{key:"createMethod",value:function(t,e,i){var o=this.getClassById(t);if(o){var n=o.exportData(),a=n.operationList,s=void 0===a?[]:a;e.key=Object(b["a"])(),i?s.splice(i,0,e):s.push(e),o.updateData(n)}}},{key:"createNote",value:function(t){return window.store.addNewStatement(t,"note")}},{key:"createRelation",value:function(t){return window.store.addNewTransition(t)}},{key:"deleteClass",value:function(t){return window.store.removeStatement(t)}},{key:"deleteProperty",value:function(t){var e=this.getClassByPropertyId(t);if(e){var i=e.exportData(),o=i.propertyList,n=void 0===o?[]:o,a=n.findIndex((function(e){return e.key===t}));a<0||(n.splice(a,1),e.updateData(i))}}},{key:"deleteMethod",value:function(t){var e=this.getClassByMethodId(t);if(e){var i=e.exportData(),o=i.operationList,n=void 0===o?[]:o,a=n.findIndex((function(e){return e.key===t}));a<0||(n.splice(a,1),e.updateData(i))}}},{key:"deleteNote",value:function(t){return window.store.removeStatement(t)}},{key:"deleteRelation",value:function(t){return window.store.removeTransition(t)}},{key:"updateClass",value:function(t,e){var i=this.getClassById(t);if(i){var o=Nr(Nr({},i.exportData()),{},{dataModel:e});i.updateData(o)}}},{key:"updateProperty",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getClassByPropertyId(t);if(i){var o=i.exportData(),n=o.propertyList,a=void 0===n?[]:n,s=a.find((function(e){return e.key===t}));if(s){var r=e.type,c=e.name,l=e.modifier;void 0!==r&&(s.type=r),void 0!==c&&(s.name=c),void 0!==l&&(s.modifier=l),i.updateData(o)}}}},{key:"updateMethod",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getClassByMethodId(t);if(i){var o=i.exportData(),n=o.operationList,a=void 0===n?[]:n,s=a.find((function(e){return e.key===t}));if(s){var r=e.type,c=e.name,l=e.modifier;void 0!==r&&(s.type=r),void 0!==c&&(s.name=c),void 0!==l&&(s.modifier=l),i.updateData(o)}}}},{key:"updateNote",value:function(t,e){var i=this.getNoteById(t);if(i){var o=Nr(Nr({},i.exportData()),{},{dataModel:e});i.updateData(o)}}},{key:"updateRelation",value:function(t,e){var i=this.getRelationById(t);if(i){var o=Nr(Nr({},i.exportData()),{},{dataModel:e});i.updateData(o)}}},{key:"updateFontSize",value:function(t,e){var i=window.store,o=i.statementList,n=i.transitionList,a=[].concat(Object(I["a"])(o),Object(I["a"])(n)).find((function(e){return e.id===t}));if(a){var s=a.exportData();s.fontSize=e,a.updateData(s)}}},{key:"updateFontColor",value:function(t,e){var i=window.store,o=i.statementList,n=i.transitionList,a=[].concat(Object(I["a"])(o),Object(I["a"])(n)).find((function(e){return e.id===t}));if(a){var s=a.exportData();s.fontColor=e,a.updateData(s)}}},{key:"updateFillColor",value:function(t,e){var i;if(i=/^statement-/.test(t)?this.getClassById(t):this.getRelationById(t),i){var o=i.exportData();/^statement-/.test(t)?o.backgroundColor=e:o.color=e,i.updateData(o)}}},{key:"updateScale",value:function(t){zi.$emit("xClass:setScale",t)}},{key:"updateData",value:function(t){t&&window.store.initRender(t)}},{key:"showDetail",value:function(){zi.$emit("xClass:setMode","class")}},{key:"hideDetail",value:function(){zi.$emit("xClass:setMode","domain")}},{key:"exportData",value:function(){return window.store.exportData()}},{key:"exportPng",value:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,yn();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"focusOnNode",value:function(t){window.store.setActiveNodeByUUID(t)}},{key:"focusOnNodes",value:function(t){t.forEach((function(t){return window.store.setActiveNodeByUUID(t)}))}},{key:"autoSaveTip",value:function(t){zi.$emit("xClass:autoSaveTip",t)}},{key:"triggerUpdate",value:function(){zi.$emit("xClass:autoSave","triggerUpdate")}},{key:"updateRevision",value:function(t){this.instance.updateRevision(t)}},{key:"updateComment",value:function(t){this.instance.updateComment(t)}}]),t}();window.XClassDiagram=Lr;var Tr={props:{showType:String,renderData:Object},watch:{renderData:function(t){if("class"===this.showType){var e=document.querySelector(".class-diagram");e.innerHTML="",this.classDiagram=new Lr({data:t,el:".class-diagram"})}}},mounted:function(){this.classDiagram=new Lr({data:this.renderData,el:".class-diagram"})}},Er=Tr,Or=(i("5f95"),Object(c["a"])(Er,ji,Pi,!1,null,"7859d806",null)),jr=Or.exports,Pr=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("StateDiagram",{attrs:{diagramUUId:t.diagramUUId,showType:t.showType,renderData:t.renderData}})},zr=[],Rr=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"100%"},attrs:{id:"state-diagram"}},["diagram"===t.activeName?i("Toolbar",{ref:"toolbar",attrs:{state:t.state,diagramName:t.diagramName}}):t._e(),i("i",{staticClass:"el-icon-download toolbar-icon",staticStyle:{right:"60px",display:"none"},attrs:{id:"downBtn",title:"下载PNG"},on:{click:t.downLoadPng}},[i("span",[t._v("下载")])]),i("i",{staticClass:"share-btn el-icon-user toolbar-icon",staticStyle:{right:"110px",display:"none"},attrs:{"data-clipboard-text":"http://res.teflow.oa.com/td/state-diagram/master/?id="+t.diagramUUId,id:"shareBtn",title:"分享给他人"}},[i("span",[t._v("分享")])]),i("i",{staticClass:"el-icon-download toolbar-icon",staticStyle:{right:"160px",display:"none"},attrs:{id:"iwikiBtn",title:"保存到 iwiki"},on:{click:t.iwikiSave}},[i("span",[t._v("保存到 iwiki")])]),i("div",{staticClass:"seq-main"},[i("div",{staticClass:"seq-main-graph"},[i("div",{ref:"svingRoot",staticClass:"sving-root",style:"height:"+t.contentHeight+"px;",attrs:{id:"sving-root"},on:{scroll:t.onScroll}},[i("div",{staticClass:"save-msg"},[t._v(t._s(t.state.saveMsg))])])]),i("PropsPanel",{attrs:{state:t.state},on:{"toggle-panel":t.onTogglePanel}})],1),i("el-dialog",{attrs:{title:t.guide.title,visible:t.guide.dialogVisible,width:t.guide.width},on:{"update:visible":function(e){return t.$set(t.guide,"dialogVisible",e)}}},[i("img",{attrs:{src:t.guide.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.guide.dialogVisible=!1}}},[t._v("学会了")])],1)])],1)},Br=[],Gr=(i("8615"),{CREATE_ELEMENT:"create element",MODIFY_ELEMENT_LABEL:"modify element name",DELETE_ELEMENT:"delete element",MOVE_NODE:"move node",UPDATE_ELEMENT:"update element",MODIFY_STATE_RECT:"modify state rect",CREATE_TRANSITION:"create transition",DELETE_TRANSITION:"delete transition",MODIFY_TRANSITION_TEXT:"modify transition text",MOVE_TRANSITION:"move transition",CREATE_BOUNDARY:"create boundary",DELETE_BOUNDARY:"delete boundary",MODIFY_BOUNDARY_RECT:"modify fragment rect",CREATE_NOTE:"create note",DELETE_NOTE:"delete note",MODIFY_NOTE_CONTENT:"modify note content",MOVE_NOTE:"move note",CREATE_NOTE_CONN:"create note conn",DELETE_NOTE_CONN:"delete note conn",REVERSE_TRANSITION:"reverse transition"}),_r={FILL_COLOR:"#faecd8",STROKE_COLOR:"black"},Fr=function(){function t(){Object(M["a"])(this,t),this.undoStack=[],this.redoStack=[],this.undoIndex=0,this.redoIndex=0}return Object(k["a"])(t,[{key:"reset",value:function(){this.undoStack.length=0,this.redoStack.length=0,this.undoIndex=0,this.redoIndex=0}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}]),t}();function Ur(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Zr(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ur(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ur(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Yr=["INPUT","TEXTAREA"],Hr=function(){function t(e){var i=this;Object(M["a"])(this,t),this.undoRedo=new Fr,this.stateStore=e,this.lockUndoRodoStack=!1,keyboardJS.bind(["command > z","ctrl > z"],(function(t){t.preventDefault(),Yr.includes(t.target.nodeName)||i.undo()})),keyboardJS.bind(["ctrl + shift > z","command + shift > z","command > y","ctrl > y"],(function(t){t.preventDefault(),Yr.includes(t.target.nodeName)||i.redo()})),keyboardJS.bind(["command > s","ctrl > s"],(function(t){t.preventDefault()}))}return Object(k["a"])(t,[{key:"emit",value:function(t){for(var e,i,o,n,a,s,r,c,l,d,u,h,f,g,p,m,y,v,w,x,C=arguments.length,b=new Array(C>1?C-1:0),I=1;I<C;I++)b[I-1]=arguments[I];switch(t){case Gr.REVERSE_TRANSITION:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.REVERSE_TRANSITION,payload:b}),this.updateUndoRedo(t,b)),(e=this.stateStore).reverseTransition.apply(e,b);break;case Gr.CREATE_ELEMENT:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.DELETE_ELEMENT,payload:[b[0].id,b[1]]}),this.updateUndoRedo(t,b)),(i=this.stateStore).createElement.apply(i,b),this.stateStore.showTransition(b[0].id),this.stateStore.updateStateButton();break;case Gr.DELETE_ELEMENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var M=this.stateStore.getDataById(b[0]);this.undoRedo.undoStack.push({actionType:Gr.CREATE_ELEMENT,payload:[M]}),this.updateUndoRedo(t,b)}(o=this.stateStore).deleteElement.apply(o,b),this.stateStore.hideTransition(b[0]),this.stateStore.updateStateButton();break;case Gr.UPDATE_ELEMENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var k=this.stateStore.getDataById(b[0]);this.undoRedo.undoStack.push({actionType:Gr.UPDATE_ELEMENT,payload:[b[0],Object(Ri["cloneDeep"])(Zr(Zr({},k.dataModel),{},{id:b[0]})),b[2]]}),this.updateUndoRedo(t,b)}switch(b[2]){case"state":this.stateStore.updateState(b[1]);break;case"transition":this.stateStore.updateTransition(b[1])}break;case Gr.MODIFY_ELEMENT_LABEL:if(!this.lockUndoRodoStack){this.resetUndoRedo();var S=this.stateStore.getDataById(b[0]);this.undoRedo.undoStack.push({actionType:Gr.MODIFY_ELEMENT_LABEL,payload:[S.id,S.text]}),this.updateUndoRedo(t,b)}(n=this.stateStore).updateElementLabel.apply(n,b);break;case Gr.CREATE_TRANSITION:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.DELETE_TRANSITION,payload:[b[0].id]}),this.updateUndoRedo(t,b)),(a=this.stateStore).createTransition.apply(a,b);break;case Gr.DELETE_TRANSITION:if(!this.lockUndoRodoStack){this.resetUndoRedo();var D=this.stateStore.baseData.transitionList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.CREATE_TRANSITION,payload:[D]}),this.updateUndoRedo(t,b)}(s=this.stateStore).deleteTransition.apply(s,b);break;case Gr.MODIFY_MSG_NAME:if(!this.lockUndoRodoStack){this.resetUndoRedo();var N=this.stateStore.baseData.msgList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.MODIFY_MSG_NAME,payload:[N.id,N.text]}),this.updateUndoRedo(t,b)}(r=this.stateStore).updateMsgContentAndArgs.apply(r,b);break;case Gr.MOVE_NODE:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.MOVE_NODE,payload:[b[0],b[3],b[4],b[1],b[2]]}),this.updateUndoRedo(t,b)),w=this.stateStore.svingDiagram.svingNodeMap[b[0]],w.x=b[1],w.y=b[2],x=this.stateStore.svingDiagram.data.statementList.find((function(t){return t.id===b[0]})),x.position.x=w.x,x.position.y=w.y,this.stateStore.svingDiagram.fitTransition(b[0],b[1]-b[3],b[2]-b[4]);break;case Gr.MODIFY_STATE_RECT:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.MODIFY_STATE_RECT,payload:[b[0],b[5],b[6],b[7],b[8],b[1],b[2],b[3],b[4]]}),this.updateUndoRedo(t,b)),this.stateStore.svingDiagram.fitTransitionBoxChange(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]),this.stateStore.svingDiagram.svingNodeMap[b[0]].width!==b[3]&&this.stateStore.svingDiagram.svingNodeMap[b[0]].cbDrag(b[3]-b[7],b[4]-b[8]);break;case Gr.MOVE_MSG:if(!this.lockUndoRodoStack){this.resetUndoRedo();var A=this.stateStore.baseData.msgList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.MOVE_MSG,payload:[A.id,A.time]}),this.updateUndoRedo(t,b)}(c=this.stateStore).updateArrowTime.apply(c,b);break;case Gr.CREATE_BOUNDARY:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.DELETE_BOUNDARY,payload:[b[0].id,b[1]]}),this.updateUndoRedo(t,b)),(l=this.stateStore).createBoundary.apply(l,b);break;case Gr.DELETE_BOUNDARY:if(!this.lockUndoRodoStack){this.resetUndoRedo();var L=this.stateStore.baseData.scopes.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.CREATE_BOUNDARY,payload:[L]}),this.updateUndoRedo(t,b)}(d=this.stateStore).deleteBoundary.apply(d,b);break;case Gr.MODIFY_BOUNDARY_RECT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var T=this.stateStore.baseData.scopes.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.MODIFY_BOUNDARY_RECT,payload:[T.id,T.position.x,T.position.y,T.size.width,T.size.height]}),this.updateUndoRedo(t,b)}(u=this.stateStore).updateBoundaryBox.apply(u,b);break;case Gr.CHANGE_LIFELINE_TYPE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var E=this.stateStore.baseData.lifelineList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.CHANGE_LIFELINE_TYPE,payload:[E.id,E.type]}),this.updateUndoRedo(t,b)}(h=this.stateStore).changeLifelineType.apply(h,b);break;case Gr.CREATE_NOTE:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.DELETE_NOTE,payload:[b[0].id]}),this.updateUndoRedo(t,b)),(f=this.stateStore).addNote.apply(f,b);break;case Gr.DELETE_NOTE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var O=this.stateStore.baseData.noteList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.CREATE_NOTE,payload:[O,b[1]]}),this.updateUndoRedo(t,b)}(g=this.stateStore).deleteNote.apply(g,b);break;case Gr.MOVE_NOTE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var j=this.stateStore.baseData.noteList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.MOVE_NOTE,payload:[j.id,j.x,j.y]}),this.updateUndoRedo(t,b)}(p=this.stateStore).updateNotePosition.apply(p,b);break;case Gr.MODIFY_NOTE_CONTENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var P=this.stateStore.baseData.noteList.find((function(t){return t.id===b[0]}));this.undoRedo.undoStack.push({actionType:Gr.MODIFY_NOTE_CONTENT,payload:[P.id,P.text]}),this.updateUndoRedo(t,b)}(m=this.stateStore).updateNoteContent.apply(m,b);break;case Gr.CREATE_NOTE_CONN:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.DELETE_NOTE_CONN,payload:b}),this.updateUndoRedo(t,b)),(y=this.stateStore).addNoteConn.apply(y,b);break;case Gr.DELETE_NOTE_CONN:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Gr.CREATE_NOTE_CONN,payload:b}),this.updateUndoRedo(t,b)),(v=this.stateStore).deleteNoteConn.apply(v,b);break}}},{key:"resetUndoRedo",value:function(){this.undoRedo.undoIndex+1<this.undoRedo.undoStack.length&&(this.undoRedo.undoStack.length=this.undoRedo.undoIndex+1,this.undoRedo.redoStack.length=this.undoRedo.undoStack.length)}},{key:"updateUndoRedo",value:function(t,e){this.undoRedo.redoStack.push({actionType:t,payload:e}),this.undoRedo.undoIndex=this.undoRedo.undoStack.length-1,this.undoRedo.redoStack.length=this.undoRedo.undoStack.length,this.undoRedo.redoIndex=this.undoRedo.undoIndex+1,this.updateButton()}},{key:"updateButton",value:function(){this.undoRedo.undoStack.length>0&&this.undoRedo.undoIndex>-1?this.stateStore.state.isUndoDisabled=!1:this.stateStore.state.isUndoDisabled=!0,this.undoRedo.redoStack.length>0&&this.undoRedo.redoIndex>-1&&this.undoRedo.redoIndex<this.undoRedo.redoStack.length?this.stateStore.state.isRedoDisabled=!1:this.stateStore.state.isRedoDisabled=!0}},{key:"undo",value:function(){if(!this.stateStore.state.isUndoDisabled){var t=this.undoRedo.undoStack[this.undoRedo.undoIndex];this.undoRedo.redoIndex=this.undoRedo.undoIndex,this.undoRedo.undoIndex--,this.lockUndoRodoStack=!0,this.emit.apply(this,[t.actionType].concat(Object(I["a"])(t.payload))),this.lockUndoRodoStack=!1,this.updateButton()}}},{key:"redo",value:function(){if(!this.stateStore.state.isRedoDisabled){var t=this.undoRedo.redoStack[this.undoRedo.redoIndex];this.undoRedo.redoIndex++,this.undoRedo.undoIndex++,this.lockUndoRodoStack=!0,this.emit.apply(this,[t.actionType].concat(Object(I["a"])(t.payload))),this.lockUndoRodoStack=!1,this.updateButton()}}}]),t}(),Vr=Hr;function Qr(t){var e=Wr();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Wr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Xr=document.createElement("textarea");function Jr(t){if(document.selection){var e=document.body.createTextRange();e.moveToElementText(t),e.select()}else if(window.getSelection){e=document.createRange();e.selectNodeContents(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)}}Xr.style.cssText="\n  outline: none;\n  border: 1px solid rgb(204, 204, 204);\n\nword-break:break-all;\n\n  background: white;\n  position: absolute;\n  background:white;",Xr.setAttribute("contenteditable","true"),Xr.addEventListener("focus",(function(){Jr(Xr)})),document.body.appendChild(Xr),Xr.style.position="absolute",Xr.style.display="none";var $r={onEnter:function(){},onBlur:function(){},text:""};Xr.addEventListener("keyup",(function(t){})),Xr.addEventListener("blur",(function(t){Xr.style.display="none",$r.onBlur&&$r.onBlur(Xr.value)}));var Kr=function(t){Object(L["a"])(i,t);var e=Qr(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=t.width-t.padding.h-10,a=qr(t.text,t.fontSize,n,2);t.lineHeight=parseInt(t.fontSize)+2;var s=new sving.MultilineText(a.map((function(t){return{text:t}})),t);return s.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize}),s.x=t.padding.h/2,s.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",s.y=t.padding.v/2+10,!t.isEditDisable&&s.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation(),$r.onDblClick&&$r.onDblClick()})),t.bgColor&&(o.bg=new sving.Rect(0,0),o.add(o.bg)),o.add(s),s.cursor="pointer",o.options=t,o.text=s,s.onAddedToStage((function(){o.updateBg()})),o}return Object(k["a"])(i,[{key:"updateBg",value:function(){if(this.options.bgColor){var t=this.text.el.getBBox(),e=t.width,i=t.height,o=t.x,n=t.y;this.bg.setAttrs({x:o,y:n+10,width:e,height:i,fill:this.options.bgColor})}}},{key:"focusAndSelect",value:function(){var t=this.options;$r.text=t.text,$r.onEnter=t.onEnter,$r.onBlur=t.onBlur,$r.onDblClick=t.onDblClick,setTimeout((function(){Xr.focus(),Xr.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);Xr.style.width=t.width+"px",Xr.style.height=t.height+"px",Xr.value=this.options.text,Xr.style.display="block",Xr.style.left=e.left-10+"px",Xr.style.top=e.top-18+"px"}},{key:"updateWidth",value:function(t){this.options.width=t,this.updateText(this.options.text)}},{key:"updateText",value:function(t){var e=this.options.width-this.options.padding.h-10;this.options.text=t;var i=qr(t,"13px",e,2);this.text.update(i.map((function(t){return{text:t}}))),this.text.y=this.options.padding.v/2+10,this.updateBg()}},{key:"updateFontColor",value:function(t){this.text.setAttrs({fill:t})}},{key:"updateFontSize",value:function(t){this.text.setAttrs({"font-size":t}),this.options.fontSize=t;var e=qr(this.options.text,t,this.options.width,2);this.text.options.lineHeight=parseInt(t)+2,this.text.update(e.map((function(t){return{text:t}}))),this.updateBg()}}]),i}(sving.Group);function qr(t,e,i,o){var n=t.split(/[\r\n]/),a=[];return n.forEach((function(t,n){var s=tc(t,e,i,o);s.forEach((function(t){a.push(t)}))})),a}function tc(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;for(var s,r=t.split(""),c="",l="",d=[],u=0;u<r.length;u++)l=c+r[u],a.textContent=l,s=a.getBBox().width,s+2*o>i?(d.push(l),l="",c=""):c=l,u===r.length-1&&d.push(l);return document.body.removeChild(n),d}function ec(t){var e=ic();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function ic(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var oc=function(t){Object(L["a"])(i,t);var e=ec(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="note",o.width=t.width,o.height=t.height,o.id=t.id,o.frontPlane=new sving.Path("M0 0 L".concat(o.width-15," 0  L").concat(o.width," 15  L ").concat(o.width," ").concat(o.height," L 0 ").concat(o.height," Z")),o.frontIcon=new sving.Path("M".concat(o.width-15," 0  L").concat(o.width," 15  L ").concat(o.width-15," 15 Z")),o.frontIcon.setAttrs({stroke:"#303D4E",fill:"#eee","stroke-width":1,"stroke-linejoin":"round"}),o.frontPlane.setAttrs({stroke:"#303D4E",fill:"white","stroke-width":1,"stroke-linejoin":"round"}),o.selectGroup=new sving.Group,o.selectBorder=new sving.Rect(o.width,o.height),o.selectBorder.setAttrs({stroke:"#5AB3EC",fill:"transparent","stroke-width":2,"stroke-dasharray":"4,4"}),o.cursor="move",o.selectGroup.add(o.selectBorder);var n=new sving.Group;""===t.text.trim()&&(t.text="　　　　　");var a,s,r=new Kr({text:t.text,font:"13px Helvetica",fill:"black",padding:{h:10,v:10},width:o.width,height:o.height,textAnchor:"start",lineHeight:15,onBlur:function(e){o.updateText(e),t.onTextChange&&t.onTextChange(e)},onDblClick:function(){}});o.textContent=t.text,r.onDragStart((function(e){a=e.clientX,s=e.clientY,e.stopPropagation(),t.onDragStart&&t.onDragStart()})),r.onDrag((function(e,i,n){o.x+=e,o.y+=i,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,t.onDrag&&t.onDrag(e,i,Object(vt["a"])(o))})),r.onDragEnd((function(e){(Math.abs(e.clientX-a)>10||Math.abs(e.clientY-s)>10)&&t.onDragEnd&&t.onDragEnd()})),r.x=5,r.y=15;var c="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";return o.controlPoint=new sving.Img(c),o.controlPoint.setAttrs({width:18,height:18}),o.controlPoint.x=o.width-10,o.controlPoint.y=o.height-10,o.controlPoint.cursor="nwse-resize",o.controlPoint.onDrag((function(e,i){o.controlPoint.x+=e,o.controlPoint.y+=i,o.width+=e,o.height+=i,o.width<30&&(o.width=30),o.height<30&&(o.height=30),t.onResize&&t.onResize(o.width,o.height),o.resize(o.width,o.height)})),o.controlPoint.onDragEnd((function(){t.onResizeEnd&&t.onResizeEnd()})),o.selectGroup.add(o.controlPoint),o.cube=new sving.Group,o.cube.add(o.frontPlane),o.cube.add(o.frontIcon),n.add(o.cube),n.add(o.selectGroup),o.add(n),o.selectBorder.setAttrs({"pointer-events":"none"}),o.cube.onDrag((function(e,i){o.x+=e,o.y+=i,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,t.onDrag&&t.onDrag(e,i,Object(vt["a"])(o))})),o.cube.onDragStart((function(e){a=e.clientX,s=e.clientY,e.stopPropagation(),t.onDragStart&&t.onDragStart()})),o.cube.onDragEnd((function(e){(Math.abs(e.clientX-a)>10||Math.abs(e.clientY-s)>10)&&t.onDragEnd&&t.onDragEnd()})),o.cube.on("click",(function(e){t.onClick&&t.onClick(e),o.select(),e.stopPropagation()})),o.on("mousedown",(function(t){t.stopPropagation()})),o.cube.on("mousedown",(function(e){t.onMouseDown&&t.onMouseDown(e),e.stopPropagation()})),n.on("mouseover",(function(){t.onMouseOver&&t.onMouseOver()})),n.on("mouseout",(function(){t.onMouseOut&&t.onMouseOut()})),n.on("mouseup",(function(e){t.onMouseUp&&t.onMouseUp(e)})),n.add(r),o.x=t.x,o.y=t.y,o.selectGroup.opacity=0,o.editableText=r,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,o.on("contextmenu",(function(e){e.preventDefault(),t.onContextMenu&&t.onContextMenu(Object(vt["a"])(o)),window.contextMenu({items:[{label:"删除",onClick:function(){t.onRemove&&t.onRemove(Object(vt["a"])(o))}}],event:event,zIndex:1e3,minWidth:200})})),o}return Object(k["a"])(i,[{key:"updateText",value:function(t){this.textContent!==t&&(this.textContent=t,this.editableText.updateText(t))}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.controlPoint.x=this.width-10,this.controlPoint.y=this.height-10,this.centerX=this.x+this.width/2,this.centerY=this.y+this.height/2,this.selectBorder.setAttrs({width:this.width,height:this.height}),this.frontIcon.setAttrs({d:"M".concat(this.width-15," 0  L").concat(this.width," 15  L ").concat(this.width-15," 15 Z")}),this.frontPlane.setAttrs({d:"M0 0 L".concat(this.width-15," 0  L").concat(this.width," 15  L ").concat(this.width," ").concat(this.height," L 0 ").concat(this.height," Z")})}},{key:"select",value:function(){this.isSelected=!0,this.selectGroup.opacity=1}},{key:"toggleSelect",value:function(){0===this.selectGroup.opacity?this.select():this.unselect()}},{key:"unselect",value:function(){this.isSelected=!1,this.selectGroup.opacity=0}}]),i}(sving.Group);var nc=void 0;function ac(t){var e=sc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function sc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var rc=document.createElement("textarea");rc.setAttribute("rows",4),rc.style.position="absolute",rc.style.display="none",rc.className="seq-mult-textarea",document.body.appendChild(rc),rc.addEventListener("keydown",(function(t){"Enter"==t.key&&t.preventDefault()}));var cc={onEnter:function(){},onBlur:function(){},text:""};rc.addEventListener("keyup",(function(t){var e=t.ctrlKey||t.metaKey||t.altKey;if("Enter"==t.key&&e)return rc.value=rc.value+"\r\n",void t.preventDefault();"Enter"===t.key&&(rc.style.display="none",nc.text.textContent=rc.value,cc.onEnter&&cc.onEnter(rc.value),t.preventDefault()),"Escape"===t.key&&(rc.style.display="none",rc.value=cc.text),t.stopPropagation()})),rc.addEventListener("blur",(function(t){rc.style.display="none",cc.onBlur&&cc.onBlur(rc.value)}));var lc=function(t){Object(L["a"])(i,t);var e=ac(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),t.fontSize=t.fontSize||"14px",t.textAnchor=t.textAnchor||"middle";var n=dc(t.text,t.fontSize,t.width,2);t.lineHeight=parseInt(t.fontSize);var a=new sving.MultilineText(n.map((function(t){return{text:t}})),t);return a.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize,"text-anchor":t.textAnchor,"alignment-baseline":t.alignmentBaseline}),a.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",a.x=t.paddingH/2,t.y?a.y=t.y:(a.y=t.paddingV/2+5,n.length>1&&(a.y-=n.length/2*8)),t.disableEdit||a.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation()})),o.add(a),a.cursor="pointer",o.options=t,o.text=a,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;cc.text=t.text,cc.onEnter=t.onEnter,cc.onBlur=t.onBlur,setTimeout((function(){rc.focus(),rc.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);rc.style.width=e.width+40+"px",rc.value=this.options.text,rc.style.display="block",rc.style.left=e.left-20+"px",rc.style.top=e.top+"px"}},{key:"updateText",value:function(t){""===t.trim()&&(t="　　　　　　"),this.options.text=t;var e=dc(t,this.options.fontSize,this.options.width,2);this.text.update(e.map((function(t){return{text:t}}))),this.text.y=this.options.paddingV/2+5}},{key:"updateFontColor",value:function(t){this.text.setAttrs({fill:t})}},{key:"updateFontSize",value:function(t){this.text.setAttrs({"font-size":t}),this.options.fontSize=t;var e=dc(this.options.text,t,this.options.width,2);this.text.options.lineHeight=parseInt(t),this.text.update(e.map((function(t){return{text:t}}))),this.text.y=this.options.paddingV/2+5}}]),i}(sving.Group);function dc(t,e,i,o){var n=t.split(/[\r\n]/),a=[];return n.forEach((function(t,n){var s=uc(t,e,i,o);s.forEach((function(t){a.push(t)}))})),a}function uc(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;for(var s,r=t.split(""),c="",l="",d=[],u=0;u<r.length;u++)l=c+r[u],a.textContent=l,s=a.getBBox().width,s+2*o>i?(d.push(l),l="",c=""):c=l,u===r.length-1&&d.push(l);return document.body.removeChild(n),d}function hc(t){var e=fc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function fc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var gc=function(t){Object(L["a"])(i,t);var e=hc(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="start",o.id=t.id,o.on("mouseover",(function(e){t.onMouseOver&&t.onMouseOver(e,Object(vt["a"])(o))})),o.cursor="pointer",o.on("mouseout",(function(e){t.onMouseOut&&t.onMouseOut(e,Object(vt["a"])(o))})),o.selectBorder=new sving.Rect(80,60),o.selectBorder.setAttrs({fill:"transparent",stroke:"transparent","stroke-width":2,"stroke-dasharray":"5,5"}),o.on("click",(function(e){t.onClick&&t.onClick(e,t.id),o.select()})),o.add(o.selectBorder);var n=t.paddingV||6;o.svingObj=new sving.Circle(10),o.svingObj.setAttrs({fill:t.shapeColor||"black"}),o.add(o.svingObj),t.text=t.text.replace(/[\b]/g,""),""===t.text.trim()&&(t.text="　　　　　");var a=new lc({text:t.text,font:t.font,fill:t.fontColor||_r.STROKE_COLOR,fontSize:t.fontSize||"14px",width:80,paddingH:0,paddingV:n,disableEdit:!0,textAnchor:"middle",onBlur:function(e){t.text!==e&&t.onTextChange(t.id,e)},onEnter:function(e){t.text!==e&&t.onTextChange(t.id,e)}});return o.add(a),o.text=a,o.width=20,o.height=20,o.selectBorder.setAttrs({width:80}),o.selectBorder.originX=40,o.selectBorder.originY=15,a.y+=30,o}return Object(k["a"])(i,[{key:"selectByOthers",value:function(){}},{key:"select",value:function(){this.isSelected=!0,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unselect",value:function(){this.isSelected=!1,this.selectBorder.setAttrs({fill:"transparent",stroke:"transparent"})}},{key:"targetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}},{key:"updateText",value:function(t){this.text.updateText(t)}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.svingObj.setAttrs({fill:t})}},{key:"update",value:function(t){this.baseData.dataModel.comment=t.comment,this.baseData.dataModel.value=t.value,this.updateText("".concat(this.baseData.dataModel.comment)),this.baseData.dataModel.name!==t.name&&(this.baseData.dataModel.name=t.name)}}]),i}(sving.Group);function pc(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}}function mc(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=t[4],r=t[5],c=t[6],l=t[7],d=1-e,u=d*d,h=e*e,f=-3*u*i+3*u*n-6*e*d*n-3*h*s+6*e*d*s+3*h*c,g=-3*u*o+3*u*a-6*e*d*a-3*h*r+6*e*d*r+3*h*l;return Math.atan2(g,f)}function yc(t){var e=vc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function vc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var wc=function(t){Object(L["a"])(i,t);var e=yc(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=Object.assign({},{moveable:!0,ca:pc(t.from,t.to,.25),cb:pc(t.from,t.to,.75)},t),a=n.moveable,s=n.from,r=n.to,c=n.ca,l=n.cb,d=n.color,u=n.lineStyle,h=n.hideControlPoints;o.color=d,o.endArrow=new sving.Path("M 4.88 23 L -2.12 26.5 L -0.37 23 L -2.12 19.5 Z"),o.endArrow.originX=5,o.endArrow.originY=23;var f=o.getD(s,c,l,r);return o.curvePath=new sving.Path(f),o.ca=c,o.cb=l,o.from=s,o.to=r,o.eventCurvePath=new sving.Path(f),o.add(o.curvePath),o.add(o.eventCurvePath),o.add(o.endArrow),o.eventCurvePath.setAttrs({fill:"none",stroke:d,"stroke-width":9,visibility:"hidden"}),o.moveable=a,o.onDrag=t.onDrag||function(){},o.onDragEnd=t.onDragEnd||function(){},o.eventCurvePath.onDrag((function(t,e,i){o.onDrag(t,e,i),i.preventDefault()})),o.eventCurvePath.onDragEnd((function(t){o.onDragEnd(t)})),o.onPointsDrag=t.onPointsDrag||function(){},o.onPointsDragEnd=t.onPointsDragEnd||function(){},o.eventCurvePath.cursor=o.moveable?"move":"pointer",o.curvePath.setAttrs({fill:"none",stroke:d}),o.endArrow.setAttrs({fill:d,stroke:d}),o.eventCurvePath.on("click",(function(){o.selected?o.unselect():o.select()})),o.initDirectArrow(s.x,s.y,r.x,r.y,d),o.initControlPoints(s,c,l,r),o.updateLineStyle(u),o.unselect(),o.on("click",(function(t){o.select()})),o.endArrow.x=o.to.x,o.endArrow.y=o.to.y,o.lineStyle=u,o.hideControlPoints=h,o.hideControlPoints&&(o.controlPointA.opacity=0,o.controlPointB.opacity=0,o.fromPoint.opacity=0,o.toPoint.opacity=0),o}return Object(k["a"])(i,[{key:"initDirectArrow",value:function(t,e,i,o,n){var a=this;this.line=new sving.Line(t,e,i,o),this.eventLine=new sving.Line(t,e,i,o),this.eventLine.setAttrs({fill:"none",stroke:n,"stroke-width":10,visibility:"hidden"}),this.eventLine.onDrag((function(t,e,i){a.onDrag(t,e,i),i.preventDefault()})),this.eventLine.onDragEnd((function(t){a.onDragEnd(t)})),this.add(this.eventLine),this.line.setAttrs({stroke:n,"pointer-events":"none"}),this.add(this.line)}},{key:"updateLineStyle",value:function(t){if(this.lineStyle=t,"direct"===t){var e=Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x);this.endArrow.rotation=180*e/Math.PI,this.eventLine.setAttrs({"pointer-events":"stroke"}),this.eventCurvePath.setAttrs({"pointer-events":"none"}),this.curvePath.opacity=0,this.line.opacity=1,this.controlPointA.opacity=0,this.controlPointB.opacity=0}else{var i=this.computeAngle(this.from,this.ca,this.cb,this.to);this.endArrow.rotation=180*i/Math.PI,this.eventLine.setAttrs({"pointer-events":"none"}),this.eventCurvePath.setAttrs({"pointer-events":"stroke"}),this.curvePath.opacity=1,this.line.opacity=0,this.controlPointA.opacity=1,this.controlPointB.opacity=1}this.hideControlPoints&&(this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.fromPoint.opacity=0,this.toPoint.opacity=0)}},{key:"updateMoveable",value:function(t){this.moveable=t,this.eventCurvePath.cursor=this.moveable?"move":"pointer"}},{key:"computeAngle",value:function(t,e,i,o){return mc([t.x,t.y,e.x,e.y,i.x,i.y,o.x,o.y],1)}},{key:"getD",value:function(t,e,i,o){return"M".concat(t.x," ").concat(t.y," C").concat(e.x," ").concat(e.y," ").concat(i.x," ").concat(i.y," ").concat(o.x," ").concat(o.y)}},{key:"initControlPoints",value:function(t,e,i,o){this.controlPointsGroup=new sving.Group,this.add(this.controlPointsGroup);var n="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";this.controlPointA=new sving.Img(n),this.controlPointB=new sving.Img(n),this.fromPoint=new sving.Img(n),this.fromPoint.opacity=.7,this.toPoint=new sving.Img(n),this.toPoint.opacity=.7,this.norm(this.controlPointA,e,"ca"),this.norm(this.controlPointB,i,"cb"),this.norm(this.fromPoint,t,"from"),this.norm(this.toPoint,o,"to"),this.controlPointsGroup.setAttrs({"pointer-events":"none"})}},{key:"updateDirectControlPoints",value:function(){this.ca=pc({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},.25),this.cb=pc({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},.75)}},{key:"updateFromPoint",value:function(t,e){this.from.x=t,this.from.y=e,"direct"===this.lineStyle&&this.updateDirectControlPoints(),this.refresh()}},{key:"updateToPoint",value:function(t,e){this.to.x=t,this.to.y=e,"direct"===this.lineStyle&&this.updateDirectControlPoints(),this.refresh()}},{key:"updateControlPointA",value:function(t,e){this.ca.x=t,this.ca.y=e,this.refresh()}},{key:"updateControlPointB",value:function(t,e){this.cb.x=t,this.cb.y=e,this.refresh()}},{key:"updatePoints",value:function(t,e,i,o,n,a,s,r){this.from.x=t,this.from.y=e,this.ca.x=i,this.ca.y=o,this.cb.x=n,this.cb.y=a,this.to.x=s,this.to.y=r,this.refresh()}},{key:"refresh",value:function(){var t=this.getD(this.from,this.ca,this.cb,this.to);this.curvePath.setAttrs({d:t}),this.eventCurvePath.setAttrs({d:t}),this.controlPointA.x=this.ca.x,this.controlPointA.y=this.ca.y,this.controlPointB.x=this.cb.x,this.controlPointB.y=this.cb.y,this.fromPoint.x=this.from.x,this.fromPoint.y=this.from.y,this.endArrow.x=this.to.x,this.endArrow.y=this.to.y,this.toPoint.x=this.to.x,this.toPoint.y=this.to.y,this.x1=this.from.x,this.y1=this.from.y,this.x2=this.to.x,this.y2=this.to.y,this.line.setAttrs({x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2}),this.eventLine.setAttrs({x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2}),this.updateLineStyle(this.lineStyle)}},{key:"norm",value:function(t,e,i){var o=this;t.originX=9,t.originY=9,t.cursor="crosshair",t.onDrag((function(e,n,a){t.x+=e,t.y+=n,o[i].x=t.x,o[i].y=t.y,o.refresh();var s=o.computeAngle(o.from,o.ca,o.cb,o.to);o.onPointsDrag(o.from,o.ca,o.cb,o.to,s,i),a.preventDefault()})),t.onDragEnd((function(){var t=o.computeAngle(o.from,o.ca,o.cb,o.to);o.onPointsDragEnd(o.from,o.ca,o.cb,o.to,t,i)})),t.x=e.x,t.y=e.y,this.controlPointsGroup.add(t)}},{key:"select",value:function(){this.selected=!0,this.controlPointsGroup.opacity=1,this.controlPointsGroup.setAttrs({"pointer-events":"stroke"}),this.hideControlPoints&&(this.curvePath.setAttrs({stroke:"#5AB3EC","stroke-width":3,"stroke-dasharray":"5,5"}),this.endArrow.setAttrs({fill:"#5AB3EC",stroke:"#5AB3EC"}))}},{key:"unselect",value:function(){this.selected=!1,this.controlPointsGroup.opacity=0,this.controlPointsGroup.setAttrs({"pointer-events":"none"}),this.hideControlPoints&&(this.curvePath.setAttrs({stroke:this.color,"stroke-width":1,"stroke-dasharray":"none"}),this.endArrow.setAttrs({fill:this.color,stroke:this.color}))}},{key:"updateShapeColor",value:function(t){this.color=t,this.endArrow.setAttrs({fill:t,stroke:t}),this.line.setAttrs({stroke:t}),this.curvePath.setAttrs({stroke:t})}}]),i}(sving.Group),xc=wc,Cc=i("f2f0");function bc(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=i.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function Ic(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.type,o=void 0===i?"long":i,n=e.source,a=void 0===n?"timestamp":n,s="";switch(a){default:case"timestamp":"number"===typeof t&&(t=new Date(t)),"string"===typeof t&&(t=new Date(Number(t))),s+=t.getFullYear()+"-",s+=Mc(t.getMonth()+1)+"-",s+=Mc(t.getDate()),s+=" ",s+=Mc(t.getHours())+":",s+=Mc(t.getMinutes())+":",s+=Mc(t.getSeconds());break;case"string":t=t.toString(),s+=t.slice(0,4)+"-",s+=t.slice(4,6)+"-",s+=t.slice(6,8),s+=" ",s+=t.slice(8,10)+":",s+=t.slice(10,12)+":",s+=t.slice(12,14);break}return"long"!==o&&(s=s.slice(0,10)),s}function Mc(t){return(t<10?"0":"")+t}function kc(t,e,i,o,n,a,s,r,c){var l=i-t,d=o-e,u=s-n,h=r-a,f=l*h-u*d;if(0!=f){var g=t-n,p=e-a,m=l*p-d*g;if(m<0!=f>0){var y=u*p-h*g;if(y<0!=f>0&&m>f!=f>0&&y>f!=f>0){var v=y/f;return c.x=t+v*l,c.y=e+v*d,c}}}}function Sc(t,e,i,o,n,a,s,r,c){var l=kc(t,e,i,o,n,a,n+s,a,c);return l||(l=kc(t,e,i,o,n,a,n,a+r,c),l||(l=kc(t,e,i,o,n,a+r,n+s,a+r,c),l||(l=kc(t,e,i,o,n+s,a,n+s,a+r,c),l||void 0)))}function Dc(t,e,i,o,n,a,s,r,c,l,d,u){var h=new Cc["Bezier"](t,e,i,o,n,a,s,r),f=h.intersects({p1:{x:c,y:l},p2:{x:d,y:u}});if(f.length>0)return h.get(f[0])}function Nc(t,e,i,o,n,a,s,r,c,l,d,u){var h=Dc(t,e,i,o,n,a,s,r,c,l,c+d,l);return h||(h=Dc(t,e,i,o,n,a,s,r,c,l,c,l+u),h||(h=Dc(t,e,i,o,n,a,s,r,c,l+u,c+d,l+u),h||(h=Dc(t,e,i,o,n,a,s,r,c+d,l,c+d,l+u),h||void 0)))}function Ac(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}}function Lc(t,e){var i=t.length;if(2===i)return Ac(t[0],t[1],e);for(var o=0,n=[];o<i-1;o++)n.push(Ac(t[o],t[o+1],e));return Lc(n,e)}function Tc(t,e,i,o,n,a,s,r,c){return Lc([{x:t,y:e},{x:i,y:o},{x:n,y:a},{x:s,y:r}],c)}function Ec(t){var e=Oc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Oc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var jc={stroke:"#303D4E"},Pc=function(t){Object(L["a"])(i,t);var e=Ec(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="transition";var n=t.onClick,a=t.id,s=t.color,r=t.textColor,c=t.fontSize,l=t.fromStateId,d=t.toStateId,u=t.onToPointDragEnd,h=t.onFromPointDragEnd,f=t.onCaDragEnd,g=t.onCbDragEnd,p=t.onTextDragEnd,m=t.isSelfTransition,y=t.onDrag,v=t.onDragEnd,w=t.offsetX,x=t.offsetY,C=t.onFromPointDrag,b=t.onToPointDrag;o.id=a,o.fromStateId=l,o.toStateId=d,o.offsetX=w||0,o.offsetY=x||0,o.x1=t.from.x,o.x2=t.to.x,o.y1=t.from.y,o.y2=t.to.y,o.cax=t.ca.x,o.cay=t.ca.y,o.cbx=t.cb.x,o.cby=t.cb.y;var I=t.lineStyle;m&&(I="curve"),o.lineStyle=I,o.isSelfTransition=m,o.curveLine=new xc({color:s,from:{x:o.x1,y:o.y1},to:{x:o.x2,y:o.y2},ca:{x:o.cax,y:o.cay},cb:{x:o.cbx,y:o.cby},lineStyle:I,moveable:!0,hideControlPoints:m,onPointsDrag:function(t,e,i,n,a,s){switch(s){case"from":o.x1=t.x,o.y1=t.y,o.cax=e.x,o.cay=e.y,o.cbx=i.x,o.cby=i.y,C(t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y,l);break;case"ca":o.cax=e.x,o.cay=e.y;break;case"cb":o.cbx=i.x,o.cby=i.y;break;case"to":o.x2=n.x,o.y2=n.y,o.cax=e.x,o.cay=e.y,o.cbx=i.x,o.cby=i.y,b(t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y,d);break}},onPointsDragEnd:function(t,e,i,o,n,a){switch(a){case"from":h(t.x,t.y,e.x,e.y,i.x,i.y,o.x,o.y);break;case"ca":f(t.x,t.y,e.x,e.y,i.x,i.y,o.x,o.y);break;case"cb":g(t.x,t.y,e.x,e.y,i.x,i.y,o.x,o.y);break;case"to":u(t.x,t.y,e.x,e.y,i.x,i.y,o.x,o.y);break}},onDrag:function(t,e,i){y(t,e,i)},onDragEnd:function(t){v(t)}}),o.updateLineStyle(I),o.updateLinkLine(),o.cursor="move",o.curveLine.setAttrs({stroke:s||jc.stroke}),o.add(o.curveLine);var k=o.genTextContent(t),S=new Kr({width:120,text:k.replace(/[\b]/g,""),fill:r||jc.stroke,fontSize:c||"12px",padding:{h:0,v:0},bgColor:"white",textAnchor:"middle",isEditDisable:!0,onBlur:function(t){},onEnter:function(t){}});if(S.onDrag((function(t,e,i){o.text.x+=t,o.text.y+=e,o.offsetX+=t,o.offsetY+=e,i.preventDefault(),o.updateLinkLine()})),S.onDragEnd((function(){p(o.offsetX,o.offsetY)})),o.add(S),o.text=S,"curve"===I){var D=Tc(o.x1,o.y1,o.cax,o.cay,o.cbx,o.cby,o.x2,o.y2,.5);S.x=D.x,S.y=D.y}else S.x=o.x1+(o.x2-o.x1)/2,S.y=o.y1+(o.y2-o.y1)/2;return S.x+=w,S.y+=x,o.on("click",(function(t){n&&n(t,o.id),o.select()})),o}return Object(k["a"])(i,[{key:"updateLinkLine",value:function(){if(this.linkLine||(this.linkLine=new sving.Line(0,0,0,0),this.linkLine.el.style.pointerEvents="none",this.linkLine.setAttrs({stroke:"#111","stroke-dasharray":"5,5"}),this.add(this.linkLine)),0===this.offsetX&&0===this.offsetY?this.linkLine.opacity=0:this.linkLine.opacity=1,"curve"===this.lineStyle){var t=Tc(this.x1,this.y1,this.cax,this.cay,this.cbx,this.cby,this.x2,this.y2,.5);this.linkLine.setAttrs({x1:t.x,y1:t.y,x2:t.x+this.offsetX,y2:t.y+this.offsetY})}else this.linkLine.setAttrs({x1:this.x1+(this.x2-this.x1)/2,y1:this.y1+(this.y2-this.y1)/2,x2:this.x1+(this.x2-this.x1)/2+this.offsetX,y2:this.y1+(this.y2-this.y1)/2+this.offsetY})}},{key:"genTextContent",value:function(t){var e="";return t.dataModel.event.comment&&""!==t.dataModel.event.comment&&(e+=t.dataModel.event.comment),t.dataModel.guard.comment&&""!==t.dataModel.guard.comment&&(e+="[".concat(t.dataModel.guard.comment,"]")),t.dataModel.actions&&t.dataModel.actions.length&&(e+=" / ",e+=t.dataModel.actions.map((function(t){return t.comment})).filter((function(t){return""!==t})).join(" , ")),e}},{key:"updateLineStyle",value:function(t){this.lineStyle=t,this.curveLine.updateLineStyle(t)}},{key:"updateToPoint",value:function(t,e){this.x2=t,this.y2=e,this.curveLine.updateToPoint(t,e)}},{key:"updateFromPoint",value:function(t,e){this.x1=t,this.y1=e,this.curveLine.updateFromPoint(t,e)}},{key:"select",value:function(){this.curveLine.select()}},{key:"unselect",value:function(){this.curveLine.unselect()}},{key:"updatePoints",value:function(t,e,i,o,n,a,s,r){this.x1=t,this.x2=s,this.y1=e,this.y2=r,this.cax=i,this.cay=o,this.cbx=n,this.cby=a,this.curveLine.updatePoints(t,e,i,o,n,a,s,r)}},{key:"update",value:function(t){this.linkData.dataModel.event=t.event,this.linkData.dataModel.guard=t.guard,this.linkData.dataModel.actions=t.actions;var e=this.genTextContent(this.linkData);this.text.updateText(e)}},{key:"setTextCenter",value:function(){if("curve"===this.lineStyle){var t=Tc(this.linkData.from.x,this.linkData.from.y,this.linkData.ca.x,this.linkData.ca.y,this.linkData.cb.x,this.linkData.cb.y,this.linkData.to.x,this.linkData.to.y,.5);this.text.x=t.x,this.text.y=t.y}else this.text.x=this.linkData.from.x+(this.linkData.to.x-this.linkData.from.x)/2,this.text.y=this.linkData.from.y+(this.linkData.to.y-this.linkData.from.y)/2;this.text.x+=this.linkData.label.offset.x,this.text.y+=this.linkData.label.offset.y,this.updateLinkLine()}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.curveLine.updateShapeColor(t)}}]),i}(sving.Group),zc=void 0;function Rc(t){var e=Bc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Bc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Gc=document.createElement("input");Gc.setAttribute("type","text"),Gc.style.position="absolute",Gc.style.display="none",Gc.className="seq-input",document.body.appendChild(Gc);var _c={onEnter:function(){},onBlur:function(){},text:""};Gc.addEventListener("keyup",(function(t){"Enter"===t.key?(Gc.style.display="none",zc.text.textContent=Gc.value,_c.onEnter&&_c.onEnter(Gc.value)):"Escape"===t.key&&(Gc.style.display="none",Gc.value=_c.text),t.stopPropagation()})),Gc.addEventListener("blur",(function(t){Gc.style.display="none",_c.onBlur&&_c.onBlur(Gc.value)}));var Fc=function(t){Object(L["a"])(i,t);var e=Rc(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=new sving.Text(t.text,t);return n.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize||"14px","text-anchor":t.textAnchor||"middle"}),n.x=t.paddingH/2,n.y=t.paddingV/2+13-t.text.split(/[\r\n]/).length/2*10,n.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",!t.isEditDisable&&n.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation()})),o.add(n),n.cursor="pointer",o.text=n,o.options=t,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;_c.text=t.text,_c.onEnter=t.onEnter,_c.onBlur=t.onBlur,setTimeout((function(){Gc.focus(),Gc.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);Gc.style.width=e.width+40+"px",Gc.value=this.options.text,Gc.style.display="block",Gc.style.left=e.left-20+"px",Gc.style.top=e.top+"px"}},{key:"updateText",value:function(t){this.options.text=t,this.text.textContent=t}},{key:"updateFontColor",value:function(t){this.text.setAttrs({fill:t})}},{key:"updateFontSize",value:function(t){this.text.setAttrs({"font-size":t}),this.options.fontSize=t}}]),i}(sving.Group);function Uc(t){var e=Zc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Zc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Yc=function(t){Object(L["a"])(i,t);var e=Uc(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),o.type="rect",o.id=t.id,o.height=t.height,o.width=t.width,o.createMainContent(t),o.initEventBox(t),o.bindEvent(t),o}return Object(k["a"])(i,[{key:"createMainContent",value:function(t){this.rect=new sving.Rect(0,0),this.rect.setAttrs({fill:t.shapeColor||_r.FILL_COLOR,stroke:_r.STROKE_COLOR,rx:10,ry:10,width:t.width,height:t.height}),this.add(this.rect),this.line=new sving.Line(0,0,t.width,0),this.line.setAttrs({stroke:_r.STROKE_COLOR}),this.add(this.line),this.rect.cursor="pointer",t.text=t.text.replace(/[\b]/g,""),""===t.text.trim()&&(t.text="　　　　　");var e=new Fc({text:t.text,font:t.font,fill:t.fontColor||_r.STROKE_COLOR,fontSize:t.fontSize||"12px",paddingH:0,paddingV:0,width:this.width,textAnchor:"middle",alignmentBaseline:"hanging",isEditDisable:!0,onBlur:function(e){t.text!==e&&t.onTextChange(t.id,e)},onEnter:function(e){t.text!==e&&t.onTextChange(t.id,e)}});this.add(e),this.text=e,this.text.x=t.width/2,this.text.y=6,this.line.y=20,this.createAction(t)}},{key:"bindEvent",value:function(t){var e=this;this.on("mouseover",(function(i){t.onMouseOver&&t.onMouseOver(i,e)})),this.on("mouseout",(function(i){t.onMouseOut&&t.onMouseOut(i,e)})),this.on("click",(function(i){t.onClick&&t.onClick(i,t.id),e.select()})),this.rect.onDrag((function(i,o,n){e.x+=i,e.y+=o,t.onDrag&&t.onDrag(n,i,o,t.id)})),this.rect.onDragStart((function(e){t.onDragStart&&t.onDragStart(e,t.id)})),this.rect.onDragEnd((function(e){t.onDragEnd&&t.onDragEnd(e,t.id)}))}},{key:"createAction",value:function(t){var e=this.genActionText(t),i=new Kr({text:e,font:t.font,fill:t.fontColor||_r.STROKE_COLOR,fontSize:t.fontSize||"12px",padding:{h:10,v:0},width:this.width,textAnchor:"start",alignmentBaseline:"hanging",isEditDisable:!0});this.add(i),this.actionNode=i,this.actionNode.y=26,this.resetActionOpacity(t.dataModel)}},{key:"genActionText",value:function(t){t.dataModel.entryActions||(t.dataModel.entryActions=[]),t.dataModel.doActions||(t.dataModel.doActions=[]),t.dataModel.exitActions||(t.dataModel.exitActions=[]);var e=t.dataModel.entryActions.map((function(t){return t.comment})).filter((function(t){return""!==t})).join(", "),i=t.dataModel.doActions.map((function(t){return t.comment})).filter((function(t){return""!==t})).join(", "),o=t.dataModel.exitActions.map((function(t){return t.comment})).filter((function(t){return""!==t})).join(", "),n="entry / ".concat(e," \r\ndo / ").concat(i," \r\nexit / ").concat(o);return n}},{key:"resetActionOpacity",value:function(t){0===t.entryActions.length&&0===t.doActions.length&&0===t.exitActions.length?(this.actionNode.opacity=0,this.line.opacity=0):(this.actionNode.opacity=1,this.line.opacity=1)}},{key:"targetIt",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"transparent",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"transparent",stroke:"transparent"})}},{key:"updateText",value:function(t){this.text.updateText(t)}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t),this.actionNode.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t),this.actionNode.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.rect.setAttrs({fill:t})}},{key:"initEventBox",value:function(t){var e=this;this.width=t.width,this.height=t.height,this.selectBorder=new sving.Rect(t.width,t.height),this.selectBorder.setAttrs({fill:"transparent",stroke:"#ccc","stroke-width":2,"stroke-dasharray":"5,5"}),this.selectBorder.opacity=0,this.selectBorder.el.style.pointerEvents="none",this.add(this.selectBorder);var i="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";this.controlPointA=new sving.Img(i),this.controlPointB=new sving.Img(i),this.controlPointC=new sving.Img(i),this.controlPointD=new sving.Img(i),this.controlPointA.cursor="move",this.controlPointB.cursor="move",this.controlPointC.cursor="nwse-resize",this.controlPointD.cursor="move",this.controlPointA.originX=9,this.controlPointA.originY=9,this.controlPointB.originX=9,this.controlPointB.originY=9,this.controlPointC.originX=9,this.controlPointC.originY=9,this.controlPointD.originX=9,this.controlPointD.originY=9,this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=0,this.controlPointD.opacity=0,this.add(this.controlPointA),this.add(this.controlPointB),this.add(this.controlPointC),this.add(this.controlPointD),this.controlPointC.onDrag((function(t,i,o){o.preventDefault(),e.cbDrag(t,i)})),this.controlPointC.onDragStart((function(){e.options.onBeforeBoxChange(e.id,e.x,e.y,e.width,e.height)})),this.controlPointC.onDrag((function(){e.options.onBoxChanging(e.id,e.x,e.y,e.width,e.height)})),this.controlPointC.onDragEnd((function(){e.options.onBoxChanged(e.id,e.x,e.y,e.width,e.height)})),this.controlPointB.x=t.width,this.controlPointC.x=t.width,this.controlPointC.y=t.height,this.controlPointD.y=t.height,this.options=t}},{key:"cbDrag",value:function(t,e){this.controlPointC.x<this.controlPointA.x+40?this.controlPointC.x=this.controlPointA.x+40:this.controlPointC.y<this.controlPointA.y+40?this.controlPointC.y=this.controlPointA.y+40:(this.controlPointC.x+=t,this.controlPointC.y+=e),this.controlPointB.x=this.controlPointC.x,this.controlPointD.y=this.controlPointC.y,this.updateBox(this.x,this.y,this.controlPointC.x-this.controlPointA.x,this.controlPointC.y-this.controlPointA.y),this.line.setAttrs({x2:this.controlPointC.x-this.controlPointA.x}),this.actionNode.updateWidth(this.controlPointC.x-this.controlPointA.x)}},{key:"updateBox",value:function(t,e,i,o){this.rect.setAttrs({width:i,height:o}),this.selectBorder.setAttrs({width:i,height:o}),this.x=t,this.y=e,this.width=i,this.height=o,this.controlPointC.x=i,this.controlPointC.y=o,this.text.x=i/2}},{key:"select",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"transparent",stroke:"#5AB3EC"}),this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=1,this.controlPointD.opacity=0}},{key:"unselect",value:function(){this.selectBorder.opacity=0,this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=0,this.controlPointD.opacity=0}},{key:"update",value:function(t){this.baseData.dataModel.comment=t.comment,this.baseData.dataModel.value=t.value,this.updateText("".concat(this.baseData.dataModel.comment,"[").concat(this.baseData.dataModel.value,"]")),this.baseData.dataModel.name!==t.name&&(this.baseData.dataModel.name=t.name),this.baseData.dataModel.entryActions=t.entryActions,this.baseData.dataModel.doActions=t.doActions,this.baseData.dataModel.exitActions=t.exitActions;var e=this.genActionText(this.baseData);this.actionNode.updateText(e),this.resetActionOpacity(this.baseData.dataModel)}}]),i}(sving.Group);function Hc(t){var e=Vc();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Vc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Qc=function(t){Object(L["a"])(i,t);var e=Hc(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="end",o.id=t.id,o.on("mouseover",(function(e){t.onMouseOver&&t.onMouseOver(e,Object(vt["a"])(o))})),o.on("mouseout",(function(e){t.onMouseOut&&t.onMouseOut(e,Object(vt["a"])(o))})),o.cursor="pointer",o.selectBorder=new sving.Rect(80,60),o.selectBorder.setAttrs({fill:"transparent",stroke:"transparent","stroke-width":2,"stroke-dasharray":"5,5"}),o.on("click",(function(e){t.onClick&&t.onClick(e,t.id),o.select()})),o.add(o.selectBorder);var n=t.paddingV||6;o.svingObj=new sving.Circle(10),o.svingObj.setAttrs({fill:"transparent",stroke:t.shapeColor||"black"}),o.add(o.svingObj),o.svingObjInner=new sving.Circle(5),o.svingObjInner.setAttrs({fill:t.shapeColor||"black"}),o.add(o.svingObjInner),t.text=t.text.replace(/[\b]/g,""),""===t.text.trim()&&(t.text="　　　　　");var a=new lc({text:t.text,font:t.font,fill:t.fontColor||_r.STROKE_COLOR,fontSize:t.fontSize||"14px",width:80,paddingH:0,paddingV:n,disableEdit:!0,textAnchor:"middle",onBlur:function(e){t.text!==e&&t.onTextChange(t.id,e)},onEnter:function(e){t.text!==e&&t.onTextChange(t.id,e)}});return o.add(a),o.text=a,o.width=20,o.height=20,o.selectBorder.setAttrs({width:80}),o.selectBorder.originX=40,o.selectBorder.originY=15,a.y+=30,o}return Object(k["a"])(i,[{key:"selectByOthers",value:function(){}},{key:"select",value:function(){this.isSelected=!0,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unselect",value:function(){this.isSelected=!1,this.selectBorder.setAttrs({fill:"transparent",stroke:"transparent"})}},{key:"targetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}},{key:"updateText",value:function(t){this.text.updateText(t)}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.svingObj.setAttrs({stroke:t}),this.svingObjInner.setAttrs({fill:t})}},{key:"update",value:function(t){this.baseData.dataModel.comment=t.comment,this.baseData.dataModel.value=t.value,this.updateText("".concat(this.baseData.dataModel.comment)),this.baseData.dataModel.name!==t.name&&(this.baseData.dataModel.name=t.name)}}]),i}(sving.Group);function Wc(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Xc(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Wc(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Wc(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Jc=function(){function t(e){var i=this;Object(M["a"])(this,t),this.data=e.data,this.stateStore=e.stateStore,console.log("初始化数据:",this.data),this.size=this.getDataContentSize(),this.options=e,this.svingNodeMap={},setTimeout((function(){i.initStage(),i.bindEvent(),i.init()}),100)}return Object(k["a"])(t,[{key:"init",value:function(){this.initNodeGroup(),this.initLinkLine(),this.initConnectLine(),this.initNoteArrow(),this.initArrow(),this.renderState(),this.renderTransition()}},{key:"updateTransitionPoints",value:function(t,e,i,o,n,a,s,r,c){var l=this.data.transitionList.find((function(e){return e.id===t}));l.from.x=e,l.from.y=i,l.ca.x=o,l.ca.y=n,l.cb.x=a,l.cb.y=s,l.to.x=r,l.to.y=c,this.options.onEventHandler("transition point moved"),this.options.onEventHandler("data changed",this.data)}},{key:"updateTransitionLineStyle",value:function(t,e){this.svingNodeMap[t].updateLineStyle(e);var i=this.data.transitionList.find((function(e){return e.id===t}));i.lineStyle=e,this.options.onEventHandler("line style changed",t,e),this.options.onEventHandler("data changed",this.data)}},{key:"moveSelfTransition",value:function(t,e,i,o){var n=i.clientX-this.clientRect.left,a=i.clientY-this.clientRect.top,s=this.svingNodeMap[o.fromStateId].x,r=this.svingNodeMap[o.fromStateId].y;i.preventDefault();var c=this.svingNodeMap[o.fromStateId].width,l=this.svingNodeMap[o.fromStateId].height;if(n<s&&a>r&&a<r+l){a-r<15?a=r+15:a+15>r+l&&(a=r+l-15);var d=s,u=a-15,h=s,f=a+15;this.svingNodeMap[o.id].updatePoints(d,u,d-50,u,h-50,f,h,f),this.updateTransitionPoints(o.id,d,u,d-50,u,h-50,f,h,f)}else if(n>s+c&&a>r&&a<r+l){a-r<15?a=r+15:a+15>r+l&&(a=r+l-15);var g=s+c,p=a-15,m=s+c,y=a+15;this.svingNodeMap[o.id].updatePoints(g,p,g+50,p,m+50,y,m,y),this.updateTransitionPoints(o.id,g,p,g+50,p,m+50,y,m,y)}else if(a<r&&n>s&&n<s+c){n-s<15?n=s+15:n+15>s+c&&(n=s+c-15);var v=n-15,w=r,x=r,C=n+15;this.svingNodeMap[o.id].updatePoints(v,w,v,w-50,C,x-50,C,x),this.updateTransitionPoints(o.id,v,w,v,w-50,C,x-50,C,x)}else if(a>r+l&&n>s&&n<s+c){n-s<15?n=s+15:n+15>s+c&&(n=s+c-15);var b=n-15,I=r+l,M=r+l,k=n+15;this.svingNodeMap[o.id].updatePoints(b,I,b,I+50,k,M+50,k,M),this.updateTransitionPoints(o.id,b,I,b,I+50,k,M+50,k,M)}}},{key:"moveTransition",value:function(t,e,i,o){var n=this.svingNodeMap[o.fromStateId],a=this.svingNodeMap[o.id],s=n.x,r=n.y,c=n.width,l=n.height;"start"!==n.type&&(o.from.x+=t,o.from.y+=e,o.from.x>s+c/2?o.from.y>r+l/2?(o.from.y-r)/l<(o.from.x-s)/c?o.from.x=s+c:o.from.y=r+l:(o.from.y-r)/l>Math.abs(o.from.x-s-c)/c?o.from.x=s+c:o.from.y=r:o.from.y>r+l/2?Math.abs(o.from.y-r-l)/l>(o.from.x-s)/c?o.from.x=s:o.from.y=r+l:(o.from.y-r)/l>(o.from.x-s)/c?o.from.x=s:o.from.y=r,o.from.x<s&&(o.from.x=s),o.from.x>s+c&&(o.from.x=s+c),o.from.y<r&&(o.from.y=r),o.from.y>r+l&&(o.from.y=r+l),a.updateFromPoint(o.from.x,o.from.y));var d=this.svingNodeMap[o.toStateId];if("end"!==d.type){var u=d.x,h=d.y,f=d.width,g=d.height;o.to.x+=t,o.to.y+=e,o.to.x>u+f/2?o.to.y>h+g/2?(o.to.y-h)/g<(o.to.x-u)/f?o.to.x=u+f:o.to.y=h+g:(o.to.y-h)/g>Math.abs(o.to.x-u-f)/f?o.to.x=u+f:o.to.y=h:o.to.y>h+g/2?Math.abs(o.to.y-h-g)/g>(o.to.x-u)/f?o.to.x=u:o.to.y=h+g:(o.to.y-h)/g>(o.to.x-u)/f?o.to.x=u:o.to.y=h,o.to.x<u&&(o.to.x=u),o.to.x>u+f&&(o.to.x=u+f),o.to.y<h&&(o.to.y=h),o.to.y>h+g&&(o.to.y=h+g),a.updateToPoint(o.to.x,o.to.y)}}},{key:"fixPointOnRect",value:function(){}},{key:"createTransition",value:function(t){var e=this,i=this.data,o=i.statementList.find((function(e){return e.id===t.fromStateId})),n=i.statementList.find((function(e){return e.id===t.toStateId}));if(o&&n){var a;t.label||(t.label={offset:{x:0,y:0}}),a=new Pc({id:t.id,fromStateId:t.fromStateId,toStateId:t.toStateId,from:t.from,to:t.to,ca:t.ca,cb:t.cb,type:t.type,arrow:t.arrow,color:t.color,textColor:t.textColor,fontSize:t.fontSize,isSelfTransition:t.fromStateId===t.toStateId,lineStyle:t.lineStyle||"curve",dataModel:t.dataModel,offsetX:t.label.offset.x,offsetY:t.label.offset.y,onMouseOver:function(){e.overMsg=a},onMouseOut:function(){e.overMsg=null},onClick:function(t,i){e.selectElementById(i),t.stopPropagation()},onDrag:function(i,o,n){t.fromStateId===t.toStateId?e.moveSelfTransition(i,o,n,t):e.moveTransition(i,o,n,t),a.setTextCenter(),n.preventDefault()},onTextDragEnd:function(i,o){t.label.offset.x=i,t.label.offset.y=o,e.options.onEventHandler("data changed",e.data)},onDragEnd:function(){e.options.onEventHandler("data changed",e.data)},onCaDragEnd:function(i,o,n,s,r,c,l,d){e.updateTransitionPoints(t.id,i,o,n,s,r,c,l,d),a.setTextCenter()},onCbDragEnd:function(i,o,n,s,r,c,l,d){e.updateTransitionPoints(t.id,i,o,n,s,r,c,l,d),a.setTextCenter()},onFromPointDrag:function(t,i,o,n,a,s,r,c,l){var d=e.svingNodeMap[l];t>=d.x&&i>d.y&&t<=d.x+d.width&&i<=d.y+d.height?d.select():d.unselect()},onToPointDrag:function(t,i,o,n,a,s,r,c,l){var d=e.svingNodeMap[l];r>=d.x&&c>d.y&&r<=d.x+d.width&&c<=d.y+d.height?d.select():d.unselect()},onToPointDragEnd:function(i,o,n,s,r,c,l,d){var u=e.svingNodeMap[t.toStateId];if("direct"===t.lineStyle){var h=pc({x:i,y:o},{x:l,y:d},.25),f=pc({x:i,y:o},{x:l,y:d},.75);n=h.x,s=h.y,r=f.x,c=f.y}var g=Nc(i,o,n,s,r,c,l,d,u.x,u.y,u.width,u.height);g?(e.updateTransitionPoints(t.id,i,o,n,s,r,c,g.x,g.y),e.svingNodeMap[t.id].updateToPoint(g.x,g.y)):e.svingNodeMap[t.id].updateToPoint(t.to.x,t.to.y),a.setTextCenter()},onFromPointDragEnd:function(i,o,n,s,r,c,l,d){var u=e.svingNodeMap[t.fromStateId];if("direct"===t.lineStyle){var h=pc({x:i,y:o},{x:l,y:d},.25),f=pc({x:i,y:o},{x:l,y:d},.75);n=h.x,s=h.y,r=f.x,c=f.y}var g=Nc(i,o,n,s,r,c,l,d,u.x,u.y,u.width,u.height);g?(e.updateTransitionPoints(t.id,g.x,g.y,n,s,r,c,l,d),e.svingNodeMap[t.id].updateFromPoint(g.x,g.y)):e.svingNodeMap[t.id].updateFromPoint(t.from.x,t.from.y),a.setTextCenter()}}),a.linkData=t,a.cursor="pointer";var s=function(){e.selectElementById(t.id)};a.on("dblclick",(function(){e.options.onElementDblClick()}));var r=t.id;a.on("contextmenu",(function(i){s(),e.options.onElementContextMenu(t,i),e.selectElementById(r),i.preventDefault();i.clientX,i.clientY;window.contextMenu({items:[{label:"direct"===t.lineStyle?"使用曲线":"使用直线",onClick:function(){e.updateTransitionLineStyle(r,"direct"===t.lineStyle?"curve":"direct"),a.setTextCenter()},divided:!0},{label:"删除",onClick:function(){e.options.onElementDeleted(r,"transition")}}],x:i.clientX,y:i.clientY,minWidth:214})})),this.svingNodeGroup.add(a),t.svingArrow=a,this.svingNodeMap[r]=a}else this.data.transitionList.splice(this.data.transitionList.indexOf(t),1)}},{key:"deleteState",value:function(t){this.data.statementList.splice(this.data.statementList.indexOf(this.data.statementList.find((function(e){return e.id===t}))),1),this.svingNodeMap[t].destroy(),this._resetByDelete(t)}},{key:"_resetByDelete",value:function(t){var e=this.svingNodeMap[t];e.destroy(),delete this.svingNodeMap[t],this.unselectAll()}},{key:"deleteTransition",value:function(t){var e=this.data.transitionList.find((function(e){return e.id===t}));this.data.transitionList.splice(this.data.transitionList.indexOf(e),1),this.svingNodeMap[t].destroy(),delete this.svingNodeMap[t],this.unselectAll()}},{key:"fitSvingTransition",value:function(t){var e=this,i=this.svingNodeMap[t].x-this.startX,o=this.svingNodeMap[t].y-this.startY,n=this.data.transitionList.filter((function(e){return e.fromStateId===t}));n.forEach((function(t){if(e.svingNodeMap[t.id]){e.svingNodeMap[t.id].updateFromPoint(t.from.x+i,t.from.y+o);var n=e.data.statementList.find((function(e){return e.id===t.toStateId}));if(n&&"end"===n.type){var a=Math.atan2(t.to.y-t.from.y-o,t.to.x-t.from.x-i);e.svingNodeMap[t.id].updateToPoint(n.position.x-10*Math.cos(a),n.position.y-10*Math.sin(a))}e.svingNodeMap[t.id].setTextCenter()}})),n=this.data.transitionList.filter((function(e){return e.toStateId===t})),n.forEach((function(t){e.svingNodeMap[t.id]&&(e.svingNodeMap[t.id].updateToPoint(t.to.x+i,t.to.y+o),e.svingNodeMap[t.id].setTextCenter())}))}},{key:"fitTransition",value:function(t,e,i){var o=this,n=this.data.transitionList.filter((function(e){return e.fromStateId===t}));n.forEach((function(t){if(o.svingNodeMap[t.id]){var n=o.data.statementList.find((function(e){return e.id===t.fromStateId}));if("start"===n.type){t.from.x=n.position.x,t.from.y=n.position.y;var a=Math.atan2(t.to.y-t.from.y,t.to.x-t.from.x);t.from.x=n.position.x+10*Math.cos(a),t.from.y=n.position.y+10*Math.sin(a)}else t.from.x+=e,t.from.y+=i;o.svingNodeMap[t.id].updateFromPoint(t.from.x,t.from.y);var s=o.data.statementList.find((function(e){return e.id===t.toStateId}));if("end"===s.type){t.to.x=s.position.x,t.to.y=s.position.y;var r=Math.atan2(t.to.y-t.from.y,t.to.x-t.from.x);t.to.x=s.position.x-10*Math.cos(r),t.to.y=s.position.y-10*Math.sin(r),o.svingNodeMap[t.id].updateToPoint(t.to.x,t.to.y)}o.svingNodeMap[t.id].setTextCenter()}})),n=this.data.transitionList.filter((function(e){return e.toStateId===t})),n.forEach((function(t){if(o.svingNodeMap[t.id]){var n=o.data.statementList.find((function(e){return e.id===t.toStateId}));if(n&&"end"===n.type){t.to.x=n.position.x,t.to.y=n.position.y;var a=Math.atan2(t.to.y-t.from.y,t.to.x-t.from.x);t.to.x=n.position.x-10*Math.cos(a),t.to.y=n.position.y-10*Math.sin(a)}else t.to.x+=e,t.to.y+=i;o.svingNodeMap[t.id].updateToPoint(t.to.x,t.to.y);var s=o.data.statementList.find((function(e){return e.id===t.fromStateId}));if(s&&"start"===s.type){t.from.x=s.position.x,t.from.y=s.position.y;var r=Math.atan2(t.to.y-t.from.y,t.to.x-t.from.x);t.from.x=s.position.x+10*Math.cos(r),t.from.y=s.position.y+10*Math.sin(r),o.svingNodeMap[t.id].updateFromPoint(t.from.x,t.from.y)}o.svingNodeMap[t.id].setTextCenter()}})),n=this.data.transitionList.filter((function(e){return e.fromStateId===t&&e.fromStateId===e.toStateId})),n.forEach((function(t){o.svingNodeMap[t.id]&&o.fixSelfTransition(t)}));var a=this.data.statementList.find((function(e){return e.id===t}));a.position.x=this.svingNodeMap[t].x,a.position.y=this.svingNodeMap[t].y}},{key:"fixSelfTransition",value:function(t){var e=this.svingNodeMap[t.fromStateId];e.x===t.from.x&&t.to.x===e.x?(t.ca.x=t.from.x-50,t.cb.x=t.from.x-50,t.to.y=t.from.y+30,t.ca.y=t.from.y,t.cb.y=t.to.y):e.x+e.width===t.from.x&&t.to.x===e.width+e.x?(t.ca.x=t.from.x+50,t.cb.x=t.from.x+50,t.to.y=t.from.y+30,t.ca.y=t.from.y,t.cb.y=t.to.y):e.y===t.from.y&&t.to.y===e.y?(t.ca.y=t.from.y-50,t.cb.y=t.from.y-50,t.to.x=t.from.x+30,t.ca.x=t.from.x,t.cb.x=t.to.x):(t.ca.y=t.from.y+50,t.cb.y=t.from.y+50,t.to.x=t.from.x+30,t.ca.x=t.from.x,t.cb.x=t.to.x),this.svingNodeMap[t.id].updatePoints(t.from.x,t.from.y,t.ca.x,t.ca.y,t.cb.x,t.cb.y,t.to.x,t.to.y),this.svingNodeMap[t.id].setTextCenter()}},{key:"getDataById",value:function(t){var e=this.data.statementList.find((function(e){return e.id===t}));return e||(e=this.data.transitionList.find((function(e){return e.id===t})),e||void 0)}},{key:"unselectAll",value:function(){for(var t in this.selectedId=null,this.arrow.opacity=0,this.dragFromId=null,this.svingNodeMap)this.svingNodeMap[t].unselect()}},{key:"selectElementById",value:function(t){this.selectedId=t;var e=this.svingNodeMap[t];for(var i in"transition"!==e.type&&(this.arrow.opacity=1,this.dragFromId=t,"rect"===e.type?(this.arrow.x=e.x+e.width+20,this.arrow.y=e.y+20):(this.arrow.x=e.x+e.width/2+20,this.arrow.y=e.y+5)),this.svingNodeMap)i===t?this.svingNodeMap[t].select():this.svingNodeMap[i].unselect();"transition"===e.type&&(this.options.setSelectedElementType("transition"),this.stateStore.state.addTransitionForm=null,this.stateStore.state.addTransitionForm=Object(Ri["cloneDeep"])(Xc(Xc({},e.linkData.dataModel),{},{id:t}))),"rect"!==e.type&&"start"!==e.type&&"end"!==e.type||(this.options.setSelectedElementType("state"),this.stateStore.state.addStateForm=null,this.stateStore.state.addStateForm=Object(Ri["cloneDeep"])(Xc(Xc({},e.baseData.dataModel),{},{id:t,type:e.type})))}},{key:"updateBoundaryBox",value:function(t,e,i,o,n){var a=this.data.scopes.find((function(e){return e.id===t}));a.position.x=e,a.position.y=i,a.size.width=o,a.size.height=n,this.svingNodeMap[t].updateBox(e,i,o,n)}},{key:"updateBoundaryLabel",value:function(t,e){var i=this.data.scopes.find((function(e){return e.id===t}));i.text=e,this.svingNodeMap[t].updateText(e),this.options.onDataChanged(this.data)}},{key:"updateTransitionLabel",value:function(){}},{key:"updateTransitionType",value:function(){}},{key:"updateTransitionDirection",value:function(){}},{key:"initNodeGroup",value:function(){this.svingNodeGroup=new sving.Group,this.rootGroup.add(this.svingNodeGroup),this.svingNodeGroup.on("click",(function(t){t.stopPropagation()}))}},{key:"bindEvent",value:function(){var t=this;this.onStageMouseUp=this.onStageMouseUp.bind(this),this.stage.el.addEventListener("mouseup",this.onStageMouseUp),window.addEventListener("keyup",(function(e){if(8===e.keyCode||46===e.keyCode){var i=t.selectedId;i&&t.options.onElementDeleted(i,t.svingNodeMap[i].type)}})),window.addEventListener("mousemove",(function(e){if(t.clientRect=t.stage.el.getBoundingClientRect(),t.isDraggingArrow){var i=t.svingNodeMap[t.dragFromId];t.linkLine.opacity=1,t.linkLine.setAttrs({x1:i.x+("rect"===i.type?i.width/2:0),y1:i.y+("rect"===i.type?i.height/2:0),x2:e.pageX-t.clientRect.left,y2:e.pageY-t.clientRect.top}),t.mouseOverLifeline(t.mouseOverGroup),e.preventDefault()}}))}},{key:"mouseOverLifeline",value:function(t,e){if(t)for(var i in this.dragToId=t.id,this.svingNodeMap){var o=this.svingNodeMap[i];o.isSelected||(i===this.dragToId?o.targetIt&&o.targetIt(e):o.unTargetIt&&o.unTargetIt())}else for(var n in this.dragToId=null,this.svingNodeMap){var a=this.svingNodeMap[n];a.isSelected||a.unTargetIt&&a.unTargetIt()}}},{key:"onStageMouseUp",value:function(t){this.isDraggingArrow&&this.dragFromId&&this.dragToId&&this.options.onEventHandler("transition create",this.dragFromId,this.dragToId),this.linkLine.opacity=0,this.isDraggingArrow=!1,this.dragFromId=null,this.dragToId=null}},{key:"initArrow",value:function(){var t=this,e=new sving.Path("M479.046,283.925c-1.664-3.989-5.547-6.592-9.856-6.592H352.305V10.667C352.305,4.779,347.526,0,341.638,0H170.971 c-5.888,0-10.667,4.779-10.667,10.667v266.667H42.971c-4.309,0-8.192,2.603-9.856,6.571c-1.643,3.989-0.747,8.576,2.304,11.627 l212.8,213.504c2.005,2.005,4.715,3.136,7.552,3.136s5.547-1.131,7.552-3.115l213.419-213.504 C479.793,292.501,480.71,287.915,479.046,283.925z");e.scale=.03,e.rotation=180,e.setAttrs({fill:"white",stroke:"black","stroke-width":"15","pointer-events":"bounding-box"}),e.opacity=0,e.cursor="pointer",e.on("mousedown",(function(i){e.opacity=0,t.isDraggingArrow=!0,i.stopPropagation()})),this.arrow=e,this.rootGroup.add(e)}},{key:"initStage",value:function(){var t=this;this.stage=new sving.Stage(this.options.el,Math.max(1.3*this.size.width,window.innerWidth),Math.max(1.3*this.size.height,window.innerHeight)),this.rootGroup=new sving.Group,this.stage.add(this.rootGroup);var e=this.stage;e.on("click",(function(){t.unselectAll(),t.options.onStageClick&&t.options.onStageClick()})),this.stage=e,this.data.store&&(this.data.store.x&&(this.rootGroup.x=this.data.store.x),this.data.store.y&&(this.rootGroup.y=this.data.store.y))}},{key:"initConnectLine",value:function(){this.connectLine=new sving.Line(0,0,0,0),this.connectLine.opacity=0,this.connectLine.setAttrs({stroke:"black","stroke-dasharray":"4,4","stroke-width":1,"pointer-events":"none"}),this.rootGroup.add(this.connectLine)}},{key:"initNoteArrow",value:function(){var t=this,e=new sving.Path("M479.046,283.925c-1.664-3.989-5.547-6.592-9.856-6.592H352.305V10.667C352.305,4.779,347.526,0,341.638,0H170.971 c-5.888,0-10.667,4.779-10.667,10.667v266.667H42.971c-4.309,0-8.192,2.603-9.856,6.571c-1.643,3.989-0.747,8.576,2.304,11.627 l212.8,213.504c2.005,2.005,4.715,3.136,7.552,3.136s5.547-1.131,7.552-3.115l213.419-213.504 C479.793,292.501,480.71,287.915,479.046,283.925z");e.scale=.03,e.rotation=180,e.setAttrs({fill:"white",stroke:"black","stroke-width":"15","pointer-events":"bounding-box"}),e.opacity=0,e.cursor="pointer",e.on("mousedown",(function(i){t.isMouseDownOnNoteArrow=!0,e.opacity=0,t.clientRect=t.stage.el.getBoundingClientRect(),t._mouseMove=t.mouseMove.bind(t),t._mouseUp=t.mouseUp.bind(t),t.connectLine.opacity=1,document.addEventListener("mousemove",t._mouseMove),document.addEventListener("mouseup",t._mouseUp),i.stopPropagation()})),this.noteArrow=e,this.rootGroup.add(this.noteArrow)}},{key:"mouseMove",value:function(t){if(this.isMouseDownOnNoteArrow){for(var e in this.connectLine.setAttrs({x1:this.selectedNote.centerX,y1:this.selectedNote.centerY,x2:t.clientX-this.clientRect.left,y2:t.clientY-this.clientRect.top}),this.svingArrowMap)this.svingArrowMap[e].unTargetIt();this.overMsg&&this.overMsg.targetIt(),this.sourceNote=this.selectedNote}t.preventDefault()}},{key:"mouseUp",value:function(t){this.isMouseDownOnNoteArrow&&this.sourceNote&&this.overMsg&&(actionCenter.emit(Gr.CREATE_NOTE_CONN,this.sourceNote.id,this.overMsg.id),document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUp)),this.connectLine.opacity=0,this.isMouseDownOnNoteArrow=!1}},{key:"initLinkLine",value:function(){this.linkLine=new sving.Line(0,0,0,0),this.linkLine.el.style.pointerEvents="none",this.linkLine.setAttrs({stroke:"#111","stroke-dasharray":"5,5"}),this.rootGroup.add(this.linkLine)}},{key:"renderNote",value:function(){var t=this;this.noteGroupList=[],this.noteGroup&&this.noteGroup.clear(),this.noteConnGroup&&this.noteConnGroup.clear();var e=new sving.Group;this.noteGroup=e,this.noteConnGroup=new sving.Group,this.rootGroup.add(this.noteConnGroup),this.noteGroup.on("click",(function(t){t.stopPropagation()})),this.rootGroup.add(e);var i=this.data;i.noteList&&i.noteList.forEach((function(i){var o=i.id,n=new oc({id:o,x:i.x||100,y:i.y||100,width:i.width||100,height:i.height||100,text:i.text||"　　　　　",onClick:function(){t.selectNoteById(o)},onTextChange:function(e){t.unselectNote(),actionCenter.emit(Gr.MODIFY_NOTE_CONTENT,o,e)},onRemove:function(){t.options.onElementDeleted(o,"note")},onResizeEnd:function(){this.updateNoteSize(o,n.width,n.height)},onDragStart:function(){t.noteArrow.x=n.x+n.width+30,t.noteArrow.y=n.y+20},onDrag:function(e,i){t.noteArrow.x+=e,t.noteArrow.y+=i},onDragEnd:function(){actionCenter.emit(Gr.MOVE_NOTE,o,n.x,n.y)}});i.connectList&&i.connectList.forEach((function(e){var i=new sving.Line(0,0,0,0);i.setAttrs({stroke:"black","stroke-dasharray":"4,4","stroke-width":1});var o=t.svingNodeMap[e.targetId];o&&t.data.lifelineList.find((function(t){return t.id===o.linkData.from}))&&t.data.lifelineList.find((function(t){return t.id===o.linkData.to}))&&(o.isSelfArrow?i.setAttrs({x1:n.centerX,y1:n.centerY,x2:(o.x1+o.x2)/2+100,y2:(o.y1+o.y2)/2+110}):i.setAttrs({x1:n.centerX,y1:n.centerY,x2:(o.x1+o.x2)/2+40,y2:(o.y1+o.y2)/2+100})),t.noteConnGroup.add(i)})),n.noteData=i,e.add(n),t.noteGroupList.push(n)}))}},{key:"renderTransition",value:function(){var t=this,e=this.data;e.transitionList&&e.transitionList.forEach((function(e){t.createTransition(e)}))}},{key:"createStartState",value:function(t){var e=this,i=t.dataModel.comment||t.label.text,o=new gc({id:t.id,text:i,type:"state",fontSize:t.fontSize,shapeColor:t.shapeColor,fontColor:t.fontColor,height:t.height,width:t.width,onClick:function(t,i){e.selectElementById(i),t.stopPropagation()},onMouseOut:function(){e.mouseOverGroup=null},onMouseOver:function(){e.mouseOverGroup=o,e.isDraggingArrow||(e.dragFromId=o.id,e.arrow.opacity=1,e.arrow.x=o.x+o.width/2+20,e.arrow.y=o.y+5)},onTextChange:function(t,i){e.options.onActorLabelChanged(t,i)}});for(var n in o.onDragStart((function(){e.startX=t.position.x,e.startY=t.position.y})),o.onDrag((function(i,n){o.x<0&&(o.x=0),o.y<0&&(o.y=0),e.fitSvingTransition(t.id,i,n)})),o.onDragEnd((function(){e.options.onEventHandler("element position changed",t.id,e.svingNodeMap[t.id].x,e.svingNodeMap[t.id].y,e.startX,e.startY),e.options.onEventHandler("data changed",e.data)})),o.x=t.position.x,o.y=t.position.y,o.on("contextmenu",(function(i){e.options.onElementContextMenu(t,i),i.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){e.options.onElementDeleted(t.id,t.type)}}],x:i.clientX,y:i.clientY,minWidth:214})})),o.baseData=t,t.svingNode=o,this.svingNodeGroup.add(o),o.onDragStart((function(i){e.selectElementById(t.id)})),o.onDrag((function(e,i,n){o.x+=e,o.y+=i,o.y<40&&(o.y=40),o.x<40&&(o.x=40),t.position.x=o.x,t.position.y=o.y,n.preventDefault()})),this.svingNodeMap[t.id]=o,this.svingNodeMap)this.svingNodeMap[n].from!==t.id&&this.svingNodeMap[n].to!==t.id||(this.svingNodeMap[n].opacity=1)}},{key:"fitTransitionBoxChanging",value:function(t,e,i,o,n,a,s,r,c){var l=this,d=this.data.transitionList.filter((function(e){return e.fromStateId===t}));d.forEach((function(t){var d=t.from.x,u=t.from.y,h=(d-a)/r*o+e,f=(u-s)/c*n+i;l.svingNodeMap[t.id].updateFromPoint(h,f)})),d=this.data.transitionList.filter((function(e){return e.toStateId===t})),d.forEach((function(t){var d=t.to.x,u=t.to.y,h=(d-a)/r*o+e,f=(u-s)/c*n+i;l.svingNodeMap[t.id].updateToPoint(h,f)}))}},{key:"fitTransitionBoxChange",value:function(t,e,i,o,n,a,s,r,c){var l=this,d=this.data.transitionList.filter((function(e){return e.fromStateId===t}));d.forEach((function(t){var d=t.from.x,u=t.from.y,h=(d-a)/r*o+e,f=(u-s)/c*n+i;t.from.x=h,t.from.y=f,l.svingNodeMap[t.id].updateFromPoint(h,f)})),d=this.data.transitionList.filter((function(e){return e.toStateId===t})),d.forEach((function(t){var d=t.to.x,u=t.to.y,h=(d-a)/r*o+e,f=(u-s)/c*n+i;t.to.x=h,t.to.y=f,l.svingNodeMap[t.id].updateToPoint(h,f)}));var u=this.data.statementList.find((function(e){return e.id===t}));u.width=o,u.height=n,d=this.data.transitionList.filter((function(e){return e.fromStateId===t&&e.fromStateId===e.toStateId})),d.forEach((function(t){l.fixSelfTransition(t)})),this.options.onEventHandler("data changed",this.data)}},{key:"createState",value:function(t){var e=this,i="".concat(t.dataModel.comment,"[").concat(t.dataModel.value,"]"),o=new Yc({id:t.id,text:i,type:"state",fontSize:t.fontSize,shapeColor:t.shapeColor,fontColor:t.fontColor,height:t.height,width:t.width,dataModel:t.dataModel,onClick:function(t,i){e.selectElementById(i),t.stopPropagation()},onMouseOut:function(){e.mouseOverGroup=null},onMouseOver:function(){e.mouseOverGroup=o,e.isDraggingArrow||(e.dragFromId=o.id,e.arrow.opacity=1,e.arrow.x=o.x+o.width+20,e.arrow.y=o.y+20)},onTextChange:function(t,i){e.options.onActorLabelChanged(t,i)},onDragStart:function(i,o,n){e.startX=t.position.x,e.startY=t.position.y},onDrag:function(i,n,a){o.x<0&&(o.x=0),o.y<0&&(o.y=0),e.fitSvingTransition(t.id,n,a)},onDragEnd:function(){e.options.onEventHandler("element position changed",t.id,e.svingNodeMap[t.id].x,e.svingNodeMap[t.id].y,e.startX,e.startY),e.options.onEventHandler("data changed",e.data)},onBeforeBoxChange:function(t,i,o,n,a){e.startX=i,e.startY=o,e.startWidth=n,e.startHeight=a},onBoxChanging:function(t,i,o,n,a){e.fitTransitionBoxChanging(t,i,o,n,a,e.startX,e.startY,e.startWidth,e.startHeight)},onBoxChanged:function(t,i,o,n,a){e.stateStore.actionCenter.emit(Gr.MODIFY_STATE_RECT,t,i,o,n,a,e.startX,e.startY,e.startWidth,e.startHeight),e.stateStore.callback("data changed",e.stateStore.baseData)}});for(var n in o.x=t.position.x,o.y=t.position.y,o.on("dblclick",(function(){e.options.onElementDblClick()})),o.on("contextmenu",(function(i){i.clientX,i.clientY;e.options.onElementContextMenu(t,i),i.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){e.options.onElementDeleted(t.id,t.type)}}],x:i.clientX,y:i.clientY,minWidth:214})})),o.baseData=t,t.svingNode=o,this.svingNodeGroup.add(o),o.onDragStart((function(i){e.selectElementById(t.id)})),this.svingNodeMap[t.id]=o,this.svingNodeMap)this.svingNodeMap[n].from!==t.id&&this.svingNodeMap[n].to!==t.id||(this.svingNodeMap[n].opacity=1)}},{key:"createEndState",value:function(t){var e=this,i=t.dataModel.comment||t.label.text,o=new Qc({id:t.id,text:i,type:"state",fontSize:t.fontSize,shapeColor:t.shapeColor,fontColor:t.fontColor,height:t.height,width:t.width,onClick:function(t,i){e.selectElementById(i),t.stopPropagation()},onMouseOut:function(){e.mouseOverGroup=null},onMouseOver:function(){e.mouseOverGroup=o,e.isDraggingArrow||(e.dragFromId=o.id,e.arrow.opacity=1,e.arrow.x=o.x+o.width/2+20,e.arrow.y=o.y+5)},onTextChange:function(t,i){e.options.onActorLabelChanged(t,i)}});for(var n in o.onDragStart((function(){e.startX=t.position.x,e.startY=t.position.y})),o.onDrag((function(i,n){o.x<0&&(o.x=0),o.y<0&&(o.y=0),e.fitSvingTransition(t.id,i,n)})),o.onDragEnd((function(){e.options.onEventHandler("element position changed",t.id,e.svingNodeMap[t.id].x,e.svingNodeMap[t.id].y,e.startX,e.startY),e.options.onEventHandler("data changed",e.data)})),o.x=t.position.x,o.y=t.position.y,o.on("contextmenu",(function(i){e.options.onElementContextMenu(t,i),i.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){e.options.onElementDeleted(t.id,t.type)}}],x:i.clientX,y:i.clientY,minWidth:214})})),o.baseData=t,t.svingNode=o,this.svingNodeGroup.add(o),o.onDragStart((function(i){e.selectElementById(t.id)})),o.onDrag((function(e,i,n){o.x+=e,o.y+=i,o.y<40&&(o.y=40),o.x<40&&(o.x=40),t.position.x=o.x,t.position.y=o.y,n.preventDefault()})),this.svingNodeMap[t.id]=o,this.svingNodeMap)this.svingNodeMap[n].from!==t.id&&this.svingNodeMap[n].to!==t.id||(this.svingNodeMap[n].opacity=1)}},{key:"renderState",value:function(){var t=this,e=this.data;e.statementList&&e.statementList.forEach((function(e,i){switch(e.type||(e.type=e.itemShape),e.type){case"start":t.createStartState(e);break;case"rect":t.createState(e);break;case"end":t.createEndState(e);break}}))}},{key:"getDataContentSize",value:function(){var t=0,e=0;return this.data.statementList.forEach((function(i){t=Math.max(t,i.position.x),e=Math.max(e,i.position.y)})),{width:t,height:e}}},{key:"recycle",value:function(){this.stage.clear(),this.stage.el.parentNode.removeChild(this.stage.el)}},{key:"reverseTransition",value:function(t){var e=this.data.transitionList.find((function(e){return e.id===t})),i=e.from;e.from=e.to,e.to=i,this.svingNodeMap[t].reverse(),this.options.onDataChanged(this.data)}}]),t}(),$c=i("7618");function Kc(t){return"[object Array]"===Object.prototype.toString.call(t)}function qc(t){return null!==t&&"object"===Object($c["a"])(t)&&!Array.isArray(t)}function tl(t,e,i){return i||(i={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=Object($c["a"])(t)&&"object"!=Object($c["a"])(e)?i.strict?t===e:t==e:el(t,e,i))}function el(t,e,i){var o,n;if(il(t)||il(e))return!1;if(t.prototype!==e.prototype)return!1;try{Object.keys(t),Object.keys(e)}catch(a){return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),o=ka.length-1;o>=0;o--)if(ka[o]!=kb[o])return!1;for(o=ka.length-1;o>=0;o--)if(n=ka[o],!tl(t[n],e[n],i))return!1;return Object($c["a"])(t)===Object($c["a"])(e)}function il(t){return null===t||void 0===t}function ol(t,e,i){var o;if("function"===typeof e)o=e;else{qc(e)&&(i=e,e=[]),i=i||{},"undefined"===typeof i.strict&&(i.strict=!0),e=[].concat(e).filter(Boolean);var n=e.length;o=0===n?function(t,e){return tl(t,e,i)}:function(t,o){var a=-1;while(++a<n){var s=e[a],r=void 0,c=void 0;if(Kc(s)?(r=nl(t,s),c=nl(o,s)):(r=t[s],c=o[s]),!tl(r,c,i))return!1}return!0}}var a=[],s=t.length,r=-1;while(++r<s){var c=!1,l=a.length,d=-1;while(++d<l)o(t[r],a[d][0])&&(a[d].push(t[r]),c=!0);c||a.push([t[r]])}return a}function nl(t,e){var i=t;return e.forEach((function(t,e){i=i[t]})),i}var al=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-quickBar-3rbxS",style:"left:"+t.x+"px;top:"+t.y+"px;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"字体颜色",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",{on:{click:t.changeFontColor}},[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT7mlrBpY29uL+Wtl+iJskAzeDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSLmlrBpY29uL+Wtl+iJsiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZD0iTTEzLjA3NSw1LjUgTDE4LDE5IEwxNi41MDgsMTkgTDExLjk5OTk4NTYsNi42NDAxMjc2MSBMNy40OTEsMTkgTDYsMTkgTDEwLjkyMyw1LjUgTDEzLjA3NSw1LjUgWiIgaWQ9IuW9oueKtue7k+WQiCIgZmlsbD0iIzQ2NEQ1QSI+PC9wYXRoPgogICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUiIGZpbGw9IiM0NjRENUEiIHg9IjcuOTY2MDA2MjgiIHk9IjEzLjciIHdpZHRoPSI4IiBoZWlnaHQ9IjEuMyI+PC9yZWN0PgogICAgPC9nPgo8L3N2Zz4="}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.latestColor+";"})]),i("img",{ref:"fontArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleFontColorPicker}})])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"图形填充色",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",{on:{click:t.changeShapeColor}},[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT50b29sYmFyX2ZpbGwgY29sb3I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0idG9vbGJhcl9maWxsLWNvbG9yIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAiPgogICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlIiBzdHJva2U9IiM5Nzk3OTciIGZpbGw9IiNEOEQ4RDgiIG9wYWNpdHk9IjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTkuNzUsMTMgTDIwLjgzNDU0MDgsMTUgQzIxLjA1NTcyMzgsMTUuNDEwMzEwMSAyMS4wNTUxMTQ1LDE1LjkxMjE1NiAyMC44MzI5MzYsMTYuMzIxODc1MiBDMjAuNjEwNzU3NCwxNi43MzE1OTQzIDIwLjE5OTYyNCwxNi45ODkwNDI0IDE5Ljc1LDE3IEMxOS4zMDAzNzYsMTYuOTg5MDQyNCAxOC44ODkyNDI2LDE2LjczMTU5NDMgMTguNjY3MDY0LDE2LjMyMTg3NTIgQzE4LjQ0NDg4NTUsMTUuOTEyMTU2IDE4LjQ0NDI3NjIsMTUuNDEwMzEwMSAxOC42NjU0NTkyLDE1IEwxOS43NSwxMyBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNDY0RDVBIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xOC44NTc5NjY5LDExLjMxNDIwMzMgQzE5LjA0NzM0NDQsMTEuNTAzNTgwOCAxOS4wNDczNDQ0LDExLjgxMDYyMjUgMTguODU3OTY2OSwxMiBMMTIsMTguODU3OTY2OSBDMTEuODEwNjIyNSwxOS4wNDczNDQ0IDExLjUwMzU4MDgsMTkuMDQ3MzQ0NCAxMS4zMTQyMDMzLDE4Ljg1Nzk2NjkgTDUuMTQyMDMzMTQsMTIuNjg1Nzk2NyBDNC45NTI2NTU2MiwxMi40OTY0MTkyIDQuOTUyNjU1NjIsMTIuMTg5Mzc3NSA1LjE0MjAzMzE0LDEyIEwxMiw1LjE0MjAzMzE0IEMxMi4xODkzNzc1LDQuOTUyNjU1NjIgMTIuNDk2NDE5Miw0Ljk1MjY1NTYyIDEyLjY4NTc5NjcsNS4xNDIwMzMxNCBMMTguODU3OTY2OSwxMS4zMTQyMDMzIFogTTE3LjQxNzc5MzgsMTEuNjU3MTAxNyBMMTIuMzQyODk4Myw2LjU4MjIwNjE4IEw2LjU4MjIwNjE4LDEyLjM0Mjg5ODMgTDExLjY1NzEwMTcsMTcuNDE3NzkzOCBMMTcuNDE3NzkzOCwxMS42NTcxMDE3IFoiIGlkPSLlvaLnirYiIGZpbGw9IiM0NjRENUEiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgICAgICA8cG9seWdvbiBpZD0i6Lev5b6ELTMiIGZpbGw9IiM0NjRENUEiIHBvaW50cz0iNiAxMyAxMS42NTkwMDMgMTcuOTcxNDU4MyAxNy4xMTU2MzQ4IDEzIj48L3BvbHlnb24+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.latestColor+";"})]),i("img",{ref:"shapeArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleShapeColorPicker}})])])],1)])]),i("div",{staticClass:"dui-divider dui-divider-vertical",staticStyle:{"vertical-align":"middle","background-color":"rgba(0, 0, 0, 0.08)",margin:"0px 10px"}}),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"增大字号",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|up"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5Yqg5aSnQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPliqDlpKciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUuMDAwMDAwLCA0LjAwMDAwMCkiIGZpbGw9IiM0NjRENUEiPgogICAgICAgICAgICA8cGF0aCBkPSJNNi42MDAxMDQyNiwwLjM2IEwxMiwxNC4zNiBMMTAuNjAxOTMzMSwxNC4zNiBMOS4wOTMsMTAuMzQ5IEwyLjg3MSwxMC4zNDkgTDEuMzUyNTgyNDcsMTQuMzYgTDAsMTQuMzYgTDUuMjgwNDc5NDcsMC4zNiBMNi42MDAxMDQyNiwwLjM2IFogTTUuOTkzMTg0ODMsMi4xMDYxODExNyBMMy4zNDUsOS4wOTkgTDguNjIzLDkuMDk5IEw1Ljk5MzE4NDgzLDIuMTA2MTgxMTcgWiIgaWQ9IlBhdGgtOOWkjeWItiI+PC9wYXRoPgogICAgICAgICAgICA8ZyBpZD0i57yW57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMS4wMDAwMDAsIDAuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIwIiB5PSIyIiB3aWR0aD0iNSIgaGVpZ2h0PSIxLjI1Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIxLjg2OTMyMzczIiB5PSIwLjEzMDM3MTA5NCIgd2lkdGg9IjEuMjUiIGhlaWdodD0iNSI+PC9yZWN0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}})])])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(-1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"减小字号",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|down"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5YeP5bCPQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPlh4/lsI8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtOCI+CiAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGXlpIfku70tNSIgb3BhY2l0eT0iMC4yNDY3NjgwNDMiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTEuNjAwMTA0Myw0LjM2IEwxNywxOC4zNiBMMTUuNjAxOTMzMSwxOC4zNiBMMTQuMDkzLDE0LjM0OSBMNy44NzEsMTQuMzQ5IEw2LjM1MjU4MjQ3LDE4LjM2IEw1LDE4LjM2IEwxMC4yODA0Nzk1LDQuMzYgTDExLjYwMDEwNDMsNC4zNiBaIE0xMC45OTMxODQ4LDYuMTA2MTgxMTcgTDguMzQ1LDEzLjA5OSBMMTMuNjIzLDEzLjA5OSBMMTAuOTkzMTg0OCw2LjEwNjE4MTE3IFoiIGlkPSJQYXRoLTjlpI3liLblpIfku70iIGZpbGw9IiM0NjRENUEiPjwvcGF0aD4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iIzQ2NEQ1QSIgeD0iMTYiIHk9IjYiIHdpZHRoPSI1IiBoZWlnaHQ9IjEuMjUiPjwvcmVjdD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="}})])])])],1)])])])},sl=[],rl=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-palette-panel-3DIVh",style:"display: flex;left:"+t.x+"px;top:"+t.y+"px;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"palette"},[i("div",{staticStyle:{"padding-left":"2px"}},[i("div",{staticClass:"palette-color-grid"},[i("div",t._l(t.standardColors,(function(e){return i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box inner-box-border",style:"background-color:"+e.color+" ;"})])})),0)]),i("div",{staticStyle:{height:"8px"}}),i("div",{staticClass:"palette-color-grid"},t._l(t.presetColors,(function(e){return i("div",t._l(e,(function(e){return i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e.color+" ;"})])})),0)})),0),i("span",{staticClass:"palette-text-font",staticStyle:{"margin-top":"10px","padding-left":"12px","padding-bottom":"10px"}},[t._v("最近使用")]),i("div",{staticClass:"palette-color-grid"},[i("div",[t._l(t.historyColors,(function(e){return t.historyColors.length>0?i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e+" ;"})]):t._e()})),t._l([1,1,1,1,1,1,1,1,1],(function(e){return 0===t.historyColors.length?i("div",{staticClass:"color-box-no-hover",staticStyle:{"margin-left":"-2px","margin-top":"-1px"}},[i("div",{staticClass:"inner-box inner-box-border",staticStyle:{"background-color":"transparent"}})]):t._e()}))],2)])]),t._m(0),i("ul",{staticClass:"palette-list"},[i("li",{staticClass:"list-item list-item-sub",on:{mouseenter:t.showPicker,mouseleave:t.hidePicker}},[i("img",{staticClass:"list-item-img",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUzLjEgKDcyNjMxKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT7oh6rlrprkuYnpopzoibJpY29uPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IuiHquWumuS5ieminOiJsmljb24iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxyZWN0IGlkPSLnn6nlvaItY29weS0xMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ij48L3JlY3Q+CiAgICAgICAgPHBhdGggZD0iTTExLjYsOCBDMTEuMDY2ODQ2Myw4IDEwLjYsNy41MzI2NzQzMiAxMC42LDcuMDAwMzEyNjcgQzEwLjYsNi40NjY2ODQzIDExLjA2NjgzMDMsNiAxMS42LDYgQzEyLjEzMzE2OTcsNiAxMi42LDYuNDY3MzI1NjggMTIuNiw3LjAwMDMxMjY3IEMxMi42LDcuNTMyMDQ4OTcgMTIuMTMzMTY5Nyw4IDExLjYsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOS44MDAzMTI2Nyw1LjQgQzkuMjY2Njg0Myw1LjQgOC44LDQuOTMzMTY5NzMgOC44LDQuNCBDOC44LDMuODY2ODMwMjcgOS4yNjczMjU2OCwzLjQgOS44MDAzMTI2NywzLjQgQzEwLjMzMzMxNTcsMy40IDEwLjgsMy44NjY4MzAyNyAxMC44LDQuNCBDMTAuOCw0LjkzMzE2OTczIDEwLjMzMjY5MDMsNS40IDkuODAwMzEyNjcsNS40IFoiIGlkPSLot6/lvoQiIGZpbGw9IiM1QzVDNUMiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgIDxwYXRoIGQ9Ik02LjM5OTk5MTk4LDUuNCBDNS44NjU1NjY4OCw1LjQgNS40LDQuOTMzMTY5NzMgNS40LDQuNCBDNS40LDMuODY2ODMwMjcgNS44NjU1NjY4OCwzLjQgNi4zOTk5OTE5OCwzLjQgQzYuOTMzMTY1OTksMy40IDcuNCwzLjg2NjgzMDI3IDcuNCw0LjQgQzcuNCw0LjkzMzE2OTczIDYuOTMzMTY1OTksNS40IDYuMzk5OTkxOTgsNS40IEw2LjM5OTk5MTk4LDUuNCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNNC4zOTk2OTUzNSw4IEMzLjg2NjA3MTI2LDggMy40LDcuNTMyNjc0MzIgMy40LDcuMDAwMzEyNjcgQzMuNCw2LjQ2NjY4NDMgMy44NjYwNTUyMiw2IDQuMzk5Njc5MzEsNiBDNC45MzMzMDM0LDYgNS40LDYuNDY3MzI1NjggNS40LDcuMDAwMzEyNjcgQzUuNCw3LjUzMjA0ODk3IDQuOTMyNjc4MDYsOCA0LjM5OTY3OTMxLDggTDQuMzk5Njk1MzUsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOCwxLjUxNTc5MiBMNy45OTc5MzQ2NCwxLjUxNTc4NzczIEM2LjI3NjU5MjQ1LDEuNTA4Njc3MyA0LjYyMzY5ODUsMi4xODkzMzIyNiAzLjQwNjUxNTM4LDMuNDA2NTE1MzggQzIuMTg5MzMyMjYsNC42MjM2OTg1IDEuNTA4Njc3Myw2LjI3NjU5MjQ1IDEuNTE1NzkyLDggQzEuNTE1NzkyLDExLjYwMzQwNyA0LjM5NjU5MzA0LDE0LjQ4NDIwOCA4LDE0LjQ4NDIwOCBDOC4zNDQ5MjgzMiwxNC40ODQyMDggOC42NjM3OTIsMTQuMTY0OTI5IDguNjYzNzkyLDEzLjgyMDQxNiBDOC42NjM3OTIsMTMuNjIxMTM1IDguNjI1OTEzOTcsMTMuNTIyMDgyMSA4LjQ0MDU5MzI4LDEzLjMyMzgyIEM4LjE1NjA5Njg4LDEyLjkwMjM3NTEgOC4wNDMyOTMzMywxMi42NTgyNjg2IDguMDQzMjkzMzMsMTIuMjY4NDY5MyBDOC4wNDMyOTMzMywxMS4zNzA5NjM4IDguODEwNTc5NjUsMTAuNjA0NjU4NyA5LjcwNzA4NTMzLDEwLjYwNDY1ODcgTDExLjEwMzkxMiwxMC42MDQ2NTg3IEMxMy4wMDEyNjc3LDEwLjYwNDY1ODcgMTQuNDg0MjA4LDkuMTIxMTQzNjQgMTQuNDg0MjA4LDcuMjIzNjUzMzMgQzE0LjQ4NDIwOCw0LjA4NjM3MTgzIDExLjYwMzI5OTcsMS41MTU3OTIgOCwxLjUxNTc5MiBaIE04LjAwMTAzMjY4LDAuNTE1NzkyMDcxIEM4LjAwMTM3NjksMC41MTU3OTM0NDYgOC4wMDE3MjExMywwLjUxNTc5NDg0NCA4LjAwMjA2NTM2LDAuNTE1Nzk2MjY2IEw4LDAuNTE1NzkyIEM4LjAwMDM0NDI0LDAuNTE1NzkyIDguMDAwNjg4NDcsMC41MTU3OTIwMjEgOC4wMDEwMzI3LDAuNTE1NzkyMDYyIFoiIGlkPSLot6/lvoQiIHN0cm9rZT0iIzVDNUM1QyIgZmlsbC1ydWxlPSJub256ZXJvIj48L3BhdGg+CiAgICA8L2c+Cjwvc3ZnPg=="}}),i("span",{staticClass:"palette-text-font list-item-text"},[t._v("自定义颜色")]),i("img",{staticClass:"list-item-arrow",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNHB4IiBoZWlnaHQ9IjZweCIgdmlld0JveD0iMCAwIDQgNiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTIuNSAoNjc0NjkpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPgogICAgPHRpdGxlPueureWktDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSJQYWdlLTMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIG9wYWNpdHk9IjAuNDAwMDAwMDA2Ij4KICAgICAgICA8cGF0aCBkPSJNMy45MzU4Mzk2NSwzLjEyMjkwMzMxIEwwLjM3Mzk1MzkzNiw1Ljk0OTA5MTc4IEMwLjI4ODQwNjgsNi4wMTY5Njk0MSAwLjE0OTcwNzQ4OCw2LjAxNjk2OTQxIDAuMDY0MTYwMzUyLDUuOTQ5MDkxNzggQzAuMDIzMDc5MTY4NSw1LjkxNjQ5NTggMCw1Ljg3MjI4NjE2IDAsNS44MjYxODg0OCBMMCwwLjE3MzgxMTUyMiBDMCwwLjA3NzgxODA2OSAwLjA5ODA3NTIyNCwwIDAuMjE5MDU3MTQ0LDAgQzAuMjc3MTU0NzExLDAgMC4zMzI4NzI3NTIsMC4wMTgzMTIyMzI4IDAuMzczOTUzOTM2LDAuMDUwOTA4MjE2MSBMMy45MzU4Mzk2NSwyLjg3NzA5NjY5IEM0LjAyMTM4Njc4LDIuOTQ0OTc0MzIgNC4wMjEzODY3OCwzLjA1NTAyNTY4IDMuOTM1ODM5NjUsMy4xMjI5MDMzMSBaIiBpZD0i566t5aS0IiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgIDwvZz4KPC9zdmc+"}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:t.showColorPicker,expression:"showColorPicker"}],staticClass:"chrome-picker",staticStyle:{padding:"10px 10px 0 10px"},attrs:{value:t.color},on:{input:t.updateValue}},[t._v(">")])],1)])])])},cl=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"line"})])}],ll={methods:{updateValue:function(t){this.$emit("custom-color-change",t.hex)},onColorChange:function(t){this.$emit("color-change",t)},showPicker:function(){this.showColorPicker=!0},hidePicker:function(){this.showColorPicker=!1}},props:{historyColors:Array,color:String,x:{type:Number,default:0},y:{type:Number,default:0}},data:function(){return{standardColors:[{color:"#FFFFFF"},{color:"#000000"},{color:"#FF0000"},{color:"#FF9900"},{color:"#FFFF00"},{color:"#98FA1C"},{color:"#6CDEFF"},{color:"#403ED6"},{color:"#ED41FD"}],presetColors:[[{color:"#E9E9E9"},{color:"#7B7B7B"},{color:"#FFC8B8"},{color:"#FFE1B2"},{color:"#FFF2CC"},{color:"#D9EAD3"},{color:"#DFF8FF"},{color:"#CFC7F4"},{color:"#FEE4FF"}],[{color:"#D9D9D9"},{color:"#5c5c5c"},{color:"#E99899"},{color:"#FFB84D"},{color:"#FFE59A"},{color:"#ACDB7E"},{color:"#85D4E6"},{color:"#8C7BE8"},{color:"#EE93F6"}],[{color:"#C4C4C4"},{color:"#333333"},{color:"#E06666"},{color:"#FB8D00"},{color:"#FFD966"},{color:"#87C120"},{color:"#4CC2EE"},{color:"#3F49B9"},{color:"#D041E1"}],[{color:"#9D9D9D"},{color:"#262626"},{color:"#CC0000"},{color:"#E75200"},{color:"#FFB700"},{color:"#678F00"},{color:"#0188FB"},{color:"#2741B1"},{color:"#A419D3"}]],showColorPicker:!1}},components:{"chrome-picker":W["Chrome"]}},dl=ll,ul=(i("b8a8"),Object(c["a"])(dl,rl,cl,!1,null,"58566b2f",null)),hl=ul.exports,fl=["onColorChange","onCustomColorChange"];function gl(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function pl(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?gl(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):gl(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var ml,yl=o["default"].extend(hl),vl=function(t,e){var i;return function(){var o=this,n=arguments;clearTimeout(i),i=setTimeout((function(){return t.apply(o,n)}),e)}};function wl(t){var e=t.onColorChange,i=t.onCustomColorChange,o=Object(Z["a"])(t,fl);ml=new yl({propsData:pl({},o)}),ml.$on("color-change",(function(t){e(t),xl()})),ml.$on("custom-color-change",vl(i,600)),ml.$mount(),document.body.appendChild(ml.$el)}function xl(){ml&&ml.$el&&ml.$el.parentNode&&ml.$el.parentNode.removeChild(ml.$el)}document.addEventListener("mousedown",(function(){xl()}));var Cl={props:{x:{type:Number,default:0},y:{type:Number,default:0},fontSizePx:{type:Number,default:14},latestColor:{type:String},historyColors:{type:Array}},methods:{changeShapeColor:function(){this.$emit("shape-color-change",this.latestColor)},changeFontColor:function(){this.$emit("font-color-change",this.latestColor)},onFontSizeChange:function(t){this.fontSizePx+=t,this.$emit("font-size-change",this.fontSizePx)},toggleFontColorPicker:function(t){var e=this;this.isShowShapeColorPicker=!1;var i=this.$refs.fontArrow.getBoundingClientRect();xl(),this.isShowFontColorPicker?xl():wl({color:"red",historyColors:this.historyColors,onColorChange:function(t){console.error(t),e.isShowFontColorPicker=!1,e.$emit("font-color-change",t)},onCustomColorChange:function(t){e.$emit("font-color-change",t)},x:i.left-40,y:i.top+32}),t.stopPropagation(),this.isShowFontColorPicker=!this.isShowFontColorPicker},toggleShapeColorPicker:function(t){var e=this;this.isShowFontColorPicker=!1;var i=this.$refs.shapeArrow.getBoundingClientRect();xl(),this.isShowShapeColorPicker?xl():wl({color:"red",historyColors:this.historyColors,onColorChange:function(t){console.error(t),e.isShowShapeColorPicker=!1,e.$emit("shape-color-change",t)},onCustomColorChange:function(t){console.log(t),e.$emit("shape-color-change",t)},x:i.left-40,y:i.top+32}),t.stopPropagation(),this.isShowShapeColorPicker=!this.isShowShapeColorPicker}},mounted:function(){this.isShowFontColorPicker=!1,this.isShowShapeColorPicker=!1}},bl=Cl,Il=(i("0013"),Object(c["a"])(bl,al,sl,!1,null,"d218bb36",null)),Ml=Il.exports,kl=["onFontColorChange","onShapeColorChange","onFontSizeChange"];function Sl(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Dl(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Sl(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Sl(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Nl,Al=o["default"].extend(Ml);function Ll(t){Tl();var e=t.onFontColorChange,i=t.onShapeColorChange,o=t.onFontSizeChange,n=Object(Z["a"])(t,kl);Nl=new Al({propsData:Dl({},n)}),Nl.$on("font-color-change",e),Nl.$on("shape-color-change",i),Nl.$on("font-size-change",o),Nl.$mount(),document.body.appendChild(Nl.$el)}function Tl(){Nl&&Nl.$el&&Nl.$el.parentNode&&Nl.$el.parentNode.removeChild(Nl.$el)}document.addEventListener("mousedown",(function(){Tl()}));var El=function(){function t(e){var i=this;Object(M["a"])(this,t),Object(m["a"])(this,"_onUseCaseMoved",(function(t,e){i.options.onUseCaseMoved(t,e),i.actionCenter.emit(Gr.MOVE_NODE,e.id,e.x,e.y,"useCase")})),Object(m["a"])(this,"_onActorMoved",(function(t,e){i.options.onActorMoved(t,e),i.actionCenter.emit(Gr.MOVE_NODE,e.id,e.x,e.y,"actor")})),Object(m["a"])(this,"_onTransitionCreate",(function(t,e){var o,n,a,s,r,c,l,d=Object(b["a"])(),u=i.svingDiagram.svingNodeMap[t],h=i.svingDiagram.svingNodeMap[e];t===e?(s={x:u.x+u.width,y:u.y+20},r={x:u.x+u.width,y:u.y+50},c={x:u.x+u.width+50,y:u.y+20},l={x:u.x+u.width+50,y:u.y+50}):(o={x:u.x+("rect"===u.type?u.width/2:0),y:u.y+("rect"===u.type?u.height/2:0)},n={x:h.x+("rect"===h.type?h.width/2:0),y:h.y+("rect"===h.type?h.height/2:0)},a=i._calcLinePointsV2(o.x,o.y,u.width,u.height,n.x,n.y,h.width,h.height),s={x:a.x1,y:a.y1},r={x:a.x2,y:a.y2},c=pc(s,r,.25),l=pc(s,r,.75)),i.actionCenter.emit(Gr.CREATE_TRANSITION,{ca:c,cb:l,itemType:"edge",dataModel:{actions:[],event:{comment:"",name:""},guard:{},sourceState:u.baseData.dataModel.name,targetState:h.baseData.dataModel.name},lineStyle:"direct",from:s,fromStateId:t,id:d,label:{position:{x:0,y:0},offset:{x:0,y:0},text:"状态流转"},to:r,toStateId:e}),i.options.onTransitionCreated&&i.options.onTransitionCreated(t,e)})),Object(m["a"])(this,"_onBoundaryLabelChange",(function(t,e){i.options.onBoundaryLabelChanged(t,e),i.actionCenter.emit(Gr.MODIFY_ELEMENT_LABEL,t,e)})),Object(m["a"])(this,"_onUseCaseLabelChange",(function(t,e){i.options.onUseCaseLabelChanged(t,e),i.actionCenter.emit(Gr.MODIFY_ELEMENT_LABEL,t,e)})),Object(m["a"])(this,"_onActorLabelChange",(function(t,e){i.options.onActorLabelChanged(t,e),i.actionCenter.emit(Gr.MODIFY_ELEMENT_LABEL,t,e)})),Object(m["a"])(this,"_onBoundaryBoxChange",(function(t,e,o,n,a){i.options.onBoundaryBoxChanged(t,e,o,n,a),i.actionCenter.emit(Gr.MODIFY_BOUNDARY_RECT,t,e,o,n,a)})),Object(m["a"])(this,"_onDeleteElement",(function(t,e){switch(e){case"rect":i.actionCenter.emit(Gr.DELETE_ELEMENT,t);break;case"start":i.actionCenter.emit(Gr.DELETE_ELEMENT,t);break;case"end":i.actionCenter.emit(Gr.DELETE_ELEMENT,t);break;case"transition":i.actionCenter.emit(Gr.DELETE_TRANSITION,t);break}})),Object(m["a"])(this,"_onElementContextMenu",(function(t,e){i.svingDiagram.selectElementById(t.id),Ll({x:e.clientX,y:e.clientY-40,fontSizePx:t.fontSize?parseInt(t.fontSize):14,fontColor:t.textColor,shapeColor:t.color,latestColor:i.state.historyColors[0],historyColors:i.state.historyColors,onFontSizeChange:function(e){"node"===t.itemType&&i.updateActorFontSize(t.id,e+"px"),"edge"===t.itemType&&i.updateTransionFontSize(t.id,e+"px")},onFontColorChange:function(e){"node"===t.itemType&&(i.updateActorFontColor(t.id,e),i.mergeHistoryColor(e)),"edge"===t.itemType&&(i.updateTransionFontColor(t.id,e),i.mergeHistoryColor(e))},onShapeColorChange:function(e){"node"===t.itemType&&(i.updateActorShapeColor(t.id,e),i.mergeHistoryColor(e)),"edge"===t.itemType&&(i.updateTransionShapeColor(t.id,e),i.mergeHistoryColor(e))}})})),Object(m["a"])(this,"onEventHandler",(function(t){for(var e,o,n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];switch(t){case"transition create":(e=i._onTransitionCreate).call.apply(e,[i].concat(a));break;case"element position changed":(o=i._onElementPositionChanged).call.apply(o,[i].concat(a));break}i.options.callback.apply(null,[t].concat(a))})),this.loadingInstance=null,this.options=e,this.actionCenter=new Vr(this),this.callback=e.callback,this.state={historyColors:["#faecd8","black"],saveMsg:"",diagramInfo:{name:"",type:"",createTime:"",modifyTime:"",creator:"",modifier:""},activeName:"base",selectedElementType:"",revision:[],currentRevisionId:"",currentRevision:null,currentStatePoType:3,commentData:[],rtx:"",isUndoDisabled:!0,isRedoDisabled:!0,isStartDisabled:!1,isEndDisabled:!1,addStateForm:{id:"",value:"",name:"",comment:"",entryActions:[],doActions:[],exitActions:[]},addTransitionForm:{id:"",sourceState:"",targetState:"",event:{comment:"",name:""},guard:{comment:"",name:""},actions:[]}},this.DiagramConfig=_r,this.diagramUUId=e.diagramUUId,this.comments=[],this.svingDiagram=null,this.mouseOverGroup=null,this.clientRect=null,this.selectedTransition=null,this.baseData={scopes:[],transitionList:[],statementList:[],useCases:[]},this.fragmentGroupList=[],this.svingArrowMap={},this.selectedActor=null,this.noteGroupList=[]}return Object(k["a"])(t,[{key:"showCommentForm",value:function(t,e,i){this.state.elementComment.show=!0,this.state.elementComment.left=t,this.state.elementComment.top=e,this.state.elementComment.content="",this.state.elementComment.subSystemId=i}},{key:"_calcLinePointsV2",value:function(t,e,i,o,n,a,s,r){var c=Sc(t,e,n,a,t-i/2,e-o/2,i,o,{}),l=Sc(t,e,n,a,n-s/2,a-r/2,s,r,{});if(c&&l)return{x1:c.x,y1:c.y,x2:l.x,y2:l.y}}},{key:"getBoundingClientRect",value:function(){return this.svingDiagram.stage.el.getBoundingClientRect()}},{key:"_onElementDblClick",value:function(){this.openRightPanel()}},{key:"_onDataChanged",value:function(){this.options.callback("data changed",this.baseData)}},{key:"updateStateButton",value:function(){var t=this;this.state.isStartDisabled=!1,this.state.isEndDisabled=!1,this.baseData.statementList.forEach((function(e){"start"===e.type&&(t.state.isStartDisabled=!0),"end"===e.type&&(t.state.isEndDisabled=!0)}))}},{key:"showTransition",value:function(t){var e=this,i=this.baseData.transitionList.filter((function(e){return e.fromStateId===t||e.toStateId===t}));i.forEach((function(t){e.svingDiagram.rootGroup.add(t.svingArrow)}))}},{key:"hideTransition",value:function(t){var e=this,i=this.baseData.transitionList.filter((function(e){return e.fromStateId===t||e.toStateId===t}));i.forEach((function(t){e.svingDiagram.rootGroup.remove(t.svingArrow)}))}},{key:"_onElementPositionChanged",value:function(t,e,i,o,n){this.actionCenter.emit(Gr.MOVE_NODE,t,e,i,o,n)}},{key:"updateData",value:function(t){var e=this;this.svingDiagram&&this.svingDiagram.stage&&this.svingDiagram.recycle(),t&&(t=Object.assign({statementList:[],transitionList:[]},t),this.svingDiagram=new Jc({data:t,stateStore:this,el:this.options.el,onElementDeleted:this._onDeleteElement,onElementContextMenu:this._onElementContextMenu,onElementDblClick:this._onElementDblClick.bind(this),onStageClick:function(){e.options.onStageClick,e.state.selectedElementType="diagram"},onEventHandler:this.onEventHandler,setSelectedElementType:function(t){e.state.selectedElementType=t}}),this.baseData=t,this.updateStateButton())}},{key:"updateDiagramSize",value:function(){var t=this.svingDiagram.getDataContentSize();this.svingDiagram.stage.el.setAttribute("width",Math.max(1.3*t.width,window.innerWidth)),this.svingDiagram.stage.el.setAttribute("height",Math.max(1.3*t.height,window.innerHeight))}},{key:"getTransitionDataById",value:function(t){return this.baseData.transitionList.find((function(e){return e.id===t}))}},{key:"getLifelineById",value:function(t){var e=this.baseData.statementList.find((function(e){return e.id===t}));return e||this.baseData.useCases.find((function(e){return e.id===t}))}},{key:"getFragmentById",value:function(t){return this.baseData.fragmentList.find((function(e){return e.id===t}))}},{key:"updateNoteContent",value:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));i.text=e,this.refreshData()}},{key:"addNoteConn",value:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));i.connectList||(i.connectList=[]),i.connectList.push({targetId:e}),this.refreshData()}},{key:"deleteNoteConn",value:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));if(i.connectList)for(var o=0,n=i.connectList.length;o<n;o++)i.connectList[o].targetId===e&&(i.connectList.splice(o,1),o--,n--);this.refreshData()}},{key:"updateNotePosition",value:function(t,e,i){var o=this.baseData.noteList.find((function(e){return e.id===t}));o.x=e,o.y=i,this.refreshData()}},{key:"updateNoteSize",value:function(t,e,i){var o=this.baseData.noteList.find((function(e){return e.id===t}));o.width=e,o.height=i,this.refreshData()}},{key:"updateMsgType",value:function(t,e){var i=this.baseData.msgList.find((function(e){return e.id===t}));i.type=e,this.refreshData()}},{key:"selectTransitionById",value:function(t){this.unselectAll(),this.selectedTransition=this.svingDiagram.svingNodeMap[t],this.selectedTransition.select(!0),this.svingDiagram.selectedId=t}},{key:"selectElementById",value:function(t){this.svingDiagram.selectElementById(t)}},{key:"getJSONData",value:function(){var t={statementList:[],transitionList:[]};return this.baseData.statementList.forEach((function(e){t.statementList.push({color:e.color,itemType:e.itemType,dataModel:e.dataModel,edges:e.edges,height:e.height,id:e.id,label:e.label,position:e.position,size:e.size,sourceAble:e.sourceAble,targetAble:e.targetAble,type:e.type,width:e.width})})),this.baseData.transitionList.forEach((function(e){t.transitionList.push({ca:e.ca,cb:e.cb,itemType:e.itemType,dataModel:e.dataModel,from:e.from,fromStateId:e.fromStateId,id:e.id,label:e.label,to:e.to,toStateId:e.toStateId,lineStyle:e.lineStyle})})),t}},{key:"getSvingElementById",value:function(t){for(var e in this.svingArrowMap)if(e===t)return this.svingArrowMap[e]}},{key:"selectNoteById",value:function(t){this.unselectAll();var e=this.noteGroupList.find((function(e){return e.noteData.id===t}));e.select(),this.selectedNote=e,this.state.selectedElementType="diagram",this.svingDiagram.noteArrow.opacity=1,this.svingDiagram.noteArrow.x=e.x+e.width+30,this.svingDiagram.noteArrow.y=e.y+20}},{key:"unselectNote",value:function(){var t=this;this.selectedNote&&(this.selectedNote=this.noteGroupList.find((function(e){return e.id===t.selectedNote.id})),this.selectedNote.unselect(),this.selectedNote=null),this.svingDiagram.noteArrow.opacity=0}},{key:"unselectAll",value:function(){this.svingDiagram.unselectAll()}},{key:"unselectLifeline",value:function(){this.selectedActor&&(this.selectedActor=this.svingDiagram.svingNodeMap[this.selectedActor.id],this.selectedActor.unselect(),this.selectedActor=null),this.svingDiagram.arrow.opacity=0}},{key:"unselectFragment",value:function(){var t=this;this.selectedFragment&&(this.selectedFragment=this.fragmentGroupList.find((function(e){return e.id===t.selectedFragment.id})),this.selectedFragment.unselect(),this.selectedFragment=null)}},{key:"unselectMsg",value:function(){this.selectedTransition&&(this.selectedTransition=this.svingDiagram.svingNodeMap[this.selectedTransition.id],this.selectedTransition.unselect())}},{key:"deleteMsg",value:function(t){for(var e=0,i=this.baseData.msgList.length;e<i;e++){var o=this.baseData.msgList[e];if(o.id===t){this.baseData.msgList.splice(e,1),delete this.svingArrowMap[t],this.selectedTransition=null;break}}this.refreshData(),this.state.selectedElementType="diagram"}},{key:"deleteFragment",value:function(t){for(var e=0,i=this.baseData.fragmentList.length;e<i;e++){var o=this.baseData.fragmentList[e];if(o.id===t){this.baseData.fragmentList.splice(e,1),this.fragmentGroupList.splice(this.fragmentGroupList.indexOf(this.selectedFragment),1),this.selectedFragment=null;break}}this.refreshData(),this.state.selectedElementType="diagram"}},{key:"createState",value:function(t){var e=0;this.baseData.statementList.forEach((function(t){"rect"===t.type&&(e=Math.max(t.dataModel.value,e))})),t.dataModel.value=e+1,t.dataModel.name="value"+t.dataModel.value,this.baseData.statementList.push(t),this.svingDiagram.createState(t),this.callback("data changed",this.baseData)}},{key:"createStartState",value:function(t){this.baseData.statementList.push(t),this.svingDiagram.createStartState(t),this.callback("data changed",this.baseData)}},{key:"createEndState",value:function(t){this.baseData.statementList.push(t),this.svingDiagram.createEndState(t),this.callback("data changed",this.baseData)}},{key:"createElement",value:function(t){switch(t.type){case"rect":this.createState(t);break;case"start":this.createStartState(t);break;case"end":this.createEndState(t);break}this.updateDiagramSize()}},{key:"deleteElement",value:function(t){var e=this.getDataById(t);switch(e.type){case"rect":this.deleteState(t);break;case"start":this.deleteState(t);break;case"end":this.deleteState(t);break}this.updateDiagramSize()}},{key:"clear",value:function(){this.baseData={lifelineList:[],msgList:[]},this.svingDiagram.stage&&this.refreshData(null,!0)}},{key:"selectPrevElement",value:function(){this.selectedTransition?this.selectTransitionById(this.selectedTransition.id):this.selectedNote?this.selectNoteById(this.selectedNote.id):this.selectedActor?this.selectLifelineById(this.selectedActor.id):this.selectedFragment&&this.selectFragmentById(this.selectedFragment.id)}},{key:"createTransition",value:function(t){this.baseData.transitionList.push(t),this.svingDiagram.createTransition(t),this.selectTransitionById(t.id),this.callback("data changed",this.baseData)}},{key:"addMsgByDragAction",value:function(){this.getSvingNodeById(this.svingDiagram.dragFromId).selectBorder.setAttrs({stroke:"#ccc"});var t=Object(b["a"])();return this.actionCenter.emit(Gr.CREATE_TRANSITION,{id:t,from:this.svingDiagram.dragFromId,to:this.svingDiagram.dragToId,text:"输入消息名",type:"sync"}),t}},{key:"getSvingNodeById",value:function(t){return this.svingDiagram.svingNodeMap[t]}},{key:"updateFragment",value:function(t){this.baseData.fragmentList.forEach((function(e){t.id===e.id&&(e.text=t.name,e.type=t.type)})),this.refreshData()}},{key:"updateState",value:function(t){var e=this;this.baseData.statementList.forEach((function(i){i.id===t.id&&(e.svingDiagram.svingNodeMap[i.id].update(t),e.selectElementById(t.id),e.options.callback("data changed",e.baseData))}))}},{key:"updateTransition",value:function(t){var e=this;this.baseData.transitionList.forEach((function(i){i.id===t.id&&(e.svingDiagram.svingNodeMap[i.id].update(t),e.selectElementById(t.id),e.options.callback("data changed",e.baseData))}))}},{key:"addNote",value:function(t){this.baseData.noteList||(this.baseData.noteList=[]),this.baseData.noteList.push(t),this.refreshData()}},{key:"deleteNote",value:function(t){for(var e=0,i=this.baseData.noteList.length;e<i;e++){var o=this.baseData.noteList[e];if(o.id===t){this.baseData.noteList.splice(e,1);break}}this.selectedNote=null,this.refreshData(),this.state.selectedElementType="diagram"}},{key:"getBound",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={top:1/0,left:1/0,bottom:-1/0,right:-1/0},i=document.querySelector(".sving-root").scrollLeft,o=Object.values(this.svingDiagram.svingNodeMap);return o.forEach((function(t){if(t.el){var o=t.el.getBoundingClientRect(),n=o.x,a=o.width,s=o.height;if(0===a&&0===s)return;var r=t.cay,c=void 0===r?1/0:r,l=t.cby,d=void 0===l?1/0:l,u=t.y1,h=void 0===u?1/0:u,f=t.y2,g=void 0===f?1/0:f,p="transition"===t.type?Math.min(c,d,h,g):t.y;e.top=Math.min(e.top,p),e.left=Math.min(e.left,n+i),e.bottom=Math.max(e.bottom,p+s),e.right=Math.max(e.right,n+i+a)}})),e.top===1/0&&(e.top=0),e.left===1/0&&(e.left=0),e.bottom===-1/0&&(e.bottom=0),e.right===-1/0&&(e.right=0),e.width=e.right-e.left,e.height=e.bottom-e.top,t&&(e.left=Math.max(0,e.left),e.top=Math.max(0,e.top),e.right=e.left+e.width,e.bottom=e.top+e.height),e}},{key:"getStageContentSize",value:function(){var t=document.querySelector(".sving-root").scrollLeft,e=100,i=100;return this.svingDiagram.stage.children.forEach((function(o){var n=o.el.getBoundingClientRect();e=Math.max(e,t+n.x+n.width),i=Math.max(i,t+n.y+n.height),o.children&&o.children.forEach((function(n){var a=n.el.getBoundingClientRect();e=Math.max(e,t+o.x+a.x+a.width),i=Math.max(i,t+o.y+a.y+a.height)}))})),{width:e,height:i}}},{key:"editLifelineName",value:function(t){var e=this.svingDiagram.svingNodeMap[t];this.svingDiagram.selectElementById(t),e.text.focusAndSelect()}},{key:"editFragmentName",value:function(t){this.svingDiagram.selectElementById(t),this.svingDiagram.svingNodeMap[t].text.focusAndSelect()}},{key:"editMsgName",value:function(t){var e=this.svingArrowMap[t];this.selectTransitionById(t),e.text.focusAndSelect()}},{key:"updateFragmentRect",value:function(t,e,i,o,n){var a=this.baseData.fragmentList.find((function(e){return e.id===t}));a.x=e,a.y=i,a.width=o,a.height=n,this.refreshData()}},{key:"updateActorPosition",value:function(t,e,i){this.svingDiagram.updateActorPosition(t,e,i),this.callback("data changed",this.baseData)}},{key:"updateUseCasePosition",value:function(t,e,i){this.svingDiagram.updateUseCasePosition(t,e,i),this.callback("data changed",this.baseData)}},{key:"getTypeById",value:function(t){return this.baseData.statementList.find((function(e){return e.id===t}))?"actor":this.baseData.useCases.find((function(e){return e.id===t}))?"useCase":this.baseData.transitionList.find((function(e){return e.id===t}))?"transition":this.baseData.scopes.find((function(e){return e.id===t}))?"boundary":void 0}},{key:"getDataById",value:function(t){var e=this.baseData.statementList.find((function(e){return e.id===t}));return e||(e=this.baseData.transitionList.find((function(e){return e.id===t})),e||void 0)}},{key:"createBoundary",value:function(t){this.baseData.scopes.push(t),this.svingDiagram.createBoundary(t),this.svingDiagram.selectElementById(t.id),this.callback("data changed",this.baseData)}},{key:"updateBoundaryLabel",value:function(t,e){this.svingDiagram.updateBoundaryLabel(t,e),this.callback("data changed",this.baseData)}},{key:"updateUseCaseLabel",value:function(t,e){this.svingDiagram.updateUseCaseLabel(t,e),this.callback("data changed",this.baseData)}},{key:"updateActorLabel",value:function(t,e){this.svingDiagram.updateActorLabel(t,e),this.callback("data changed",this.baseData)}},{key:"updateElementLabel",value:function(t,e){var i=this.getDataById(t);switch(i.itemType){case"actor":this.updateActorLabel(t,e);break;case"useCase":this.updateUseCaseLabel(t,e);break;default:this.updateBoundaryLabel(t,e);break}}},{key:"updateBoundaryBox",value:function(t,e,i,o,n){this.svingDiagram.updateBoundaryBox(t,e,i,o,n),this.callback("data changed",this.baseData)}},{key:"deleteBoundary",value:function(t){this.svingDiagram.deleteBoundary(t),this.callback("data changed",this.baseData)}},{key:"deleteState",value:function(t){this.svingDiagram.deleteState(t),this.callback("data changed",this.baseData)}},{key:"deleteTransition",value:function(t){this.svingDiagram.deleteTransition(t),this.callback("element deleted",t),this.callback("data changed",this.baseData)}},{key:"deleteElementById",value:function(t){var e=this.getTypeById(t);switch(e){case"actor":this.deleteActor(t);break;case"useCase":this.deleteUseCase(t);break;case"transition":this.deleteTransition(t);break;case"boundary":this.deleteBoundary(t);break}}},{key:"mergeHistoryColor",value:function(t){var e=this.state.historyColors;if(-1!==e.indexOf(t))for(var i=0,o=e.length;i<o;i++)if(e[i]===t){e.splice(i,1);break}e.unshift(t),e.length>9&&(e.length=9)}},{key:"updateTransionFontSize",value:function(t,e){this.baseData.transitionList.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.callback("data changed",this.baseData)}},{key:"updateTransionFontColor",value:function(t,e){this.baseData.transitionList.find((function(e){return e.id===t})).textColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.callback("data changed",this.baseData)}},{key:"updateTransionShapeColor",value:function(t,e){this.baseData.transitionList.find((function(e){return e.id===t})).color=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.callback("data changed",this.baseData)}},{key:"updateActorFontSize",value:function(t,e){this.baseData.statementList.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.callback("data changed",this.baseData)}},{key:"updateActorFontColor",value:function(t,e){this.baseData.statementList.find((function(e){return e.id===t})).fontColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.callback("data changed",this.baseData)}},{key:"updateActorShapeColor",value:function(t,e){this.baseData.statementList.find((function(e){return e.id===t})).shapeColor=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.callback("data changed",this.baseData)}},{key:"updateUseCaseFontSize",value:function(t,e){this.baseData.useCases.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.callback("data changed",this.baseData)}},{key:"updateUseCaseFontColor",value:function(t,e){this.baseData.useCases.find((function(e){return e.id===t})).fontColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.callback("data changed",this.baseData)}},{key:"updateUseCaseShapeColor",value:function(t,e){this.baseData.useCases.find((function(e){return e.id===t})).shapeColor=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.callback("data changed",this.baseData)}},{key:"updateBoundaryFontSize",value:function(t,e){this.baseData.scopes.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.callback("data changed",this.baseData)}},{key:"updateBoundaryFontColor",value:function(t,e){this.baseData.scopes.find((function(e){return e.id===t})).fontColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.callback("data changed",this.baseData)}},{key:"updateBoundaryShapeColor",value:function(t,e){this.baseData.scopes.find((function(e){return e.id===t})).shapeColor=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.callback("data changed",this.baseData)}},{key:"reverseTransition",value:function(t){this.svingDiagram.reverseTransition(t)}},{key:"updateDiagramInfo",value:function(t){Object.assign(this.state.diagramInfo,t)}},{key:"updatePropPanelActiveTabPane",value:function(t){this.state.activeName=t}},{key:"groupRevisionByDate",value:function(t){return t.forEach((function(t){t.date=(t.CreateTime+"").substr(0,8),t.distanceFromNow=(Date.now()-new Date(Ic(t.CreateTime,{source:"string"})))/864e5,t.distanceFromNow<1?0===Math.floor(24*t.distanceFromNow*60)?t.distanceFromNow=Math.floor(24*t.distanceFromNow*60*60)+1+"秒前":24*t.distanceFromNow*60<60?t.distanceFromNow=Math.floor(24*t.distanceFromNow*60)+"分钟前":t.distanceFromNow=Math.floor(24*t.distanceFromNow)+"小时前":t.distanceFromNow<7?t.distanceFromNow=Math.floor(t.distanceFromNow)+"天前":t.distanceFromNow<30?t.distanceFromNow=Math.floor(t.distanceFromNow/7)+"周前":t.distanceFromNow<365?t.distanceFromNow=Math.floor(t.distanceFromNow/30)+"月前":t.distanceFromNow=Math.floor(t.distanceFromNow/365)+"年前"})),ol(t,"date")}},{key:"getCommentById",value:function(t){var e=this.comments.filter((function(e){return e.systemId===t})),i=[];return e.forEach((function(t){var e=t.comments.filter((function(t){return""===t.replyDetailId}));e.forEach((function(e){e.id=e.detailId,e.avatar="https://dayu.oa.com/avatars/"+e.creator+"/profile.jpg?1448329396",e.reply=t.comments.filter((function(t){return t.replyDetailId===e.detailId})),e.toAvatar="http://ww4.sinaimg.cn/bmiddle/006DLFVFgy1ft0j2pddjuj30v90uvagf.jpg",e.reply.forEach((function(e){e.id=e.detailId,e.subSystemId=t.subSystemId,e.avatar="https://dayu.oa.com/avatars/"+e.creator+"/profile.jpg?1448329396"})),e.systemId=t.systemId,e.subSystemId=t.subSystemId,i.push(e)}))})),i.sort((function(t,e){return new Date(t.createTime)-new Date(e.createTime)}))}},{key:"showLoading",value:function(t){this.loadingInstance=y["Loading"].service({text:t})}},{key:"hideLoading",value:function(){this.loadingInstance.close()}},{key:"updateDiagram",value:function(){}}]),t}(),Ol=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-toolbar"},[i("el-tooltip",{attrs:{content:"撤销 Ctrl/⌘+Z",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isUndoDisabled},on:{click:t.undo}},[i("svg",{staticClass:"toolbar_undo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M8 8.25h6c2.761 0 5 1.989 5 4.75a5 5 0 01-5 5H7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M9 5.372V10.9a.2.2 0 01-.301.173L4.276 8.474a.2.2 0 01-.009-.339l4.423-2.93a.2.2 0 01.31.167z",fill:"currentColor"}})])])])]),i("el-tooltip",{attrs:{content:"重做 Ctrl/⌘+Y",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isRedoDisabled},on:{click:t.redo}},[i("svg",{staticClass:"toolbar_redo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M16 8.25h-6c-2.761 0-5 1.989-5 4.75a5 5 0 005 5h7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M15 5.372V10.9a.2.2 0 00.301.173l4.423-2.599a.2.2 0 00.009-.339l-4.423-2.93a.2.2 0 00-.31.167z",fill:"currentColor"}})])])])]),i("div",{staticClass:"diagram-toolbar-split"}),i("el-tooltip",{attrs:{content:"初始状态",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isStartDisabled},on:{click:function(e){return t.addObj("start")},mousedown:function(e){return t.dragStart(e,"start")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("ellipse",{attrs:{fill:"currentColor",rx:"350",ry:"350",stroke:"currentColor","stroke-width":"34",transform:"matrix(1,0,0,1,512,512)"}})])])]),i("el-tooltip",{attrs:{content:"状态节点",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("state")},mousedown:function(e){return t.dragStart(e,"state")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(9,0,0,9,330,200)"}},[i("rect",{attrs:{fill:"rgb(250, 236, 216)",height:"60",rx:"20",ry:"20",stroke:"black","stroke-width":"4",transform:"matrix(1,0,0,1,-23,8)",width:"90"}})])])])]),i("el-tooltip",{attrs:{content:"结束状态",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isEndDisabled},on:{click:function(e){return t.addObj("end")},mousedown:function(e){return t.dragStart(e,"end")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("ellipse",{attrs:{fill:"none",rx:"350",ry:"350",stroke:"currentColor","stroke-width":"34",transform:"matrix(1,0,0,1,512,512)"}}),i("ellipse",{attrs:{fill:"currentColor",rx:"175",ry:"175",stroke:"currentColor","stroke-width":"34",transform:"matrix(1,0,0,1,512,512)"}})])])]),i("div",{staticClass:"diagram-toolbar-split"}),i("el-tooltip",{staticClass:"item",attrs:{content:"下载PNG",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-download el-ui-icon",on:{click:t.downLoadPng}})]),i("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"item",attrs:{slot:"reference",content:"上传到 XWatt",effect:"light",placement:"bottom"},slot:"reference"},[i("i",{staticClass:"el-ui-icon el-icon-upload",on:{click:t.openMessageBox}})]),i("el-tooltip",{staticClass:"item",attrs:{content:"问题反馈",effect:"light",placement:"bottom"}},[i("el-link",{staticStyle:{position:"relative",top:"-2px","font-size":"1.2em"},attrs:{icon:"el-icon-question",href:"https://git.woa.com/td/xwatt-web/issues/new",target:"_blank"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"confluence_btn_group"},[i("el-button",{attrs:{plain:"",size:"mini",type:"info"},on:{click:t.onCancel}},[t._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)},jl=[],Pl={props:{diagramName:String,menus:Array},data:function(){var t=bc("tag");return{visible:!1,nameForm:{name:this.diagramName},isConfluence:t&&t.includes("iwiki"),layoutType:0,name:"XIDE",state:this.$parent.stateStore.state,xwattBaseUrl:"//xwatt.wxp.oa.com/node/ad-tools",saving:!1}},mounted:function(){var t=this;this.stateStore=this.$parent.stateStore,window.addEventListener("message",(function(e){var i=e.data.type,o=e.data.diagramType;"state"===o&&"xwatt_iframe:save_done"===i&&(t.saving=!1,t.stateStore.hideLoading(),t.$refs["nameForm"]&&t.$refs["nameForm"].resetFields())}))},methods:{undo:function(){this.state.isUndoDisabled||this.stateStore.actionCenter.undo()},redo:function(){this.state.isRedoDisabled||this.stateStore.actionCenter.redo()},downLoadPng:function(){document.querySelector("#downBtn").click()},dragStart:function(t,e,i){var o=this;"start"===e&&this.state.isStartDisabled||"end"===e&&this.state.isEndDisabled||(this._isMouseDown=!0,this.dupNode=t.currentTarget.cloneNode(!0),this.dupNode.style.position="fixed",this._preType=e,this._preTarget=t.currentTarget,this.dupNode.style.pointerEvents="none",document.body.appendChild(this.dupNode),document.addEventListener("mousemove",this._mouseMove),this._mouseUpWp=function(t){o._mouseUp(t,i)},document.addEventListener("mouseup",this._mouseUpWp),this._preX=t.clientX,this._preY=t.clientY)},_mouseMove:function(t){this._isMouseDown&&(this._preTarget.style.cursor="move",this.dupNode.style.left=t.pageX+"px",this.dupNode.style.top=t.pageY+"px")},_mouseUp:function(t,e){if(this._isMouseDown&&(Math.abs(t.clientX-this._preX)>10||Math.abs(t.clientY-this._preY)>10)&&(document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUpWp),this._preTarget.style.cursor="pointer",this._isInSVG(t.srcElement))){var i=this.stateStore.getBoundingClientRect();this.addObj(this._preType,e,t.clientX-i.left,t.clientY-i.top)}this._isMouseDown=!1,this.dupNode&&(document.body.removeChild(this.dupNode),this.dupNode=null)},addObj:function(t,e,i,o,n){if(!("start"===t&&this.state.isStartDisabled||"end"===t&&this.state.isEndDisabled)){var a,s=Object(b["a"])();switch(t){case"note":var r={id:Object(b["a"])(),text:"备注内容",width:100,height:100};"number"===typeof i&&(r.x=i,r.y=o),this.stateStore.actionCenter.emit(Gr.CREATE_NOTE,r);break;case"state":a={itemType:"node",color:"#FAECD8",dataModel:{comment:"状态",doActions:[],entryActions:[],exitActions:[],name:"value1",value:1},edges:[],height:100,id:s,label:{position:{x:0,y:0}},position:{x:642,y:291},size:15,sourceAble:!0,targetAble:!0,type:"rect",width:140};break;case"start":a={itemType:"node",color:"#FAECD8",id:s,dataModel:{comment:"初始状态",name:"Init"},height:10,label:{position:{x:0,y:0}},position:{x:642,y:291},type:"start",width:140};break;case"end":a={itemType:"node",color:"#FAECD8",id:s,dataModel:{comment:"结束状态",name:"End"},height:10,label:{position:{x:0,y:0}},position:{x:642,y:291},type:"end",width:140};break}a.position="number"===typeof i?{x:i,y:o}:{x:200+200*Math.random(),y:200+200*Math.random()},this.stateStore.actionCenter.emit(Gr.CREATE_ELEMENT,a,n)}},_isInSVG:function(t){return!!t&&("svg"===t.nodeName||this._isInSVG(t.parentNode))},help:function(){this.stateStore.state.selectedElementType="help",this.stateStore.openRightPanel()},onCancel:function(){window.parent.postMessage({type:"xwatt_iframe:close"},"*")},onSave:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){var e,i,o,n,a,s,r,c=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.stateStore.unselectAll(),e=30,i=this.stateStore.getBound(),i.width+=2*e,i.height+=2*e,this.stateStore.showLoading("保存中.."),o=document.createElement("canvas"),n=o.getContext("2d"),a=this.stateStore.svingDiagram.stage.el.cloneNode(!0),a.setAttribute("width",2*i.width),a.setAttribute("height",2*i.height),a.setAttribute("width",a.getAttribute("width")),a.setAttribute("height",a.getAttribute("height")),s=canvg.Canvg.fromString(n,a.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(e,'" y="-').concat(e,'" width="').concat(i.left+i.width,'" height="').concat(i.top+i.height,'" fill="white"/>')),{scaleWidth:2*a.getAttribute("width"),scaleHeight:2*a.getAttribute("height"),offsetX:-i.left+e,offsetY:-i.top+e}),t.next=16,s.render();case 16:r=this.stateStore.getJSONData(),r.diagramName=this.nameForm.name||this.diagramName,r.fromIwiki=!0,window.parent.postMessage({type:"xwatt_iframe:save",renderData:r,picData:o.toDataURL("image/png"),diagramType:"state",width:i.width},"*"),this.visible=!1,this.saving=!0,setTimeout((function(){c.saving&&(c.saving=!1,c.stateStore.hideLoading(),c.$message({type:"warning",message:"保存超时，请重试！"}))}),3e4),aegis.reportEvent({name:"状态图保存",ext1:"状态图",ext2:this.nameForm.name||this.diagramName}),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-save-state"});case 25:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleShow:function(){this.$refs["nameForm"].resetFields(),this.$refs["diagramNameInput"].focus()},upload2Xwatt:function(t){var e=this,i=this.stateStore.getJSONData();i.diagramName=t,i.fromIwiki=!0;var o={JSONData:JSON.stringify(i),name:t};store.showLoading(),Be()({url:"".concat(this.xwattBaseUrl,"/state/create"),method:"POST",data:o,withCredentials:!0}).then((function(t){var i=t.status,o=t.data;if(200!==i||0!==o.code)throw Error("[XWATT] Response With Code ".concat(o.code));console.log("[XWATT] Send to XWatt Success, ret:",o),e.$message({type:"success",message:"上传成功"})})).catch((function(t){console.error("[XWATT] Request XWATT Failed, err:",t),e.$message({type:"error",message:"上传失败，错误：".concat(t.message)})})).finally((function(){store.hideLoading()}))},openMessageBox:function(){var t=this;this.$prompt("请输入状态机名称","状态机上传至 XWATT",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){return null!==t&&""!==t},inputErrorMessage:"命名不能为空"}).then((function(e){var i=e.value;store.showLoading("上传中.."),t.upload2Xwatt(i),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-upload-state"})})).catch((function(){console.log("取消输入")}))}}},zl=Pl,Rl=(i("c788"),Object(c["a"])(zl,Ol,jl,!1,null,"71038bb2",null)),Bl=Rl.exports,Gl=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"props-panel",style:"width:"+(t.isClosed?0:300)+"px"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isClosed,expression:"!isClosed"}],staticClass:"props-panel-content"},["state"===t.state.selectedElementType?i("StatePropsPanel"):"transition"===t.state.selectedElementType?i("TransitionPropsPanel"):"gen-code"===t.state.selectedElementType?i("GenCodePanel"):i("HelpPanel")],1),i("div",{class:{"menu-unfoldbox":!0,closed:this.isClosed},on:{click:t.toggle}},[i("svg",{attrs:{"aria-hidden":"true","data-icon":"left","data-v-35e7d322":"",fill:"white",focusable:"false",height:"1em",viewBox:"64 64 896 896",width:"1em"}},[i("path",{attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z","data-v-35e7d322":""}})])])])},_l=[],Fl=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"状态信息"}},[i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("状态属性")]),i("div",{staticClass:"section-item",staticStyle:{padding:"10px 8px"}},[i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{attrs:{label:"中文名"}},[i("el-input",{attrs:{disabled:"rect"!==t.storeState.addStateForm.type},on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addStateForm.comment,callback:function(e){t.$set(t.storeState.addStateForm,"comment",e)},expression:"storeState.addStateForm.comment"}})],1),i("el-form-item",{attrs:{label:"英文名"}},[i("el-input",{attrs:{disabled:"rect"!==t.storeState.addStateForm.type},on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addStateForm.name,callback:function(e){t.$set(t.storeState.addStateForm,"name",e)},expression:"storeState.addStateForm.name"}})],1),"rect"===t.storeState.addStateForm.type?i("el-form-item",{attrs:{label:"状态值"}},[i("el-input-number",{attrs:{min:1},on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addStateForm.value,callback:function(e){t.$set(t.storeState.addStateForm,"value",e)},expression:"storeState.addStateForm.value"}})],1):t._e()],1)],1)]),"rect"===t.storeState.addStateForm.type?i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("进入活动[entry Action]")]),t._l(t.storeState.addStateForm.entryActions,(function(e,o){return i("div",{key:e.id,staticClass:"section-item"},[i("i",{staticClass:"el-icon-delete section-delete",on:{click:function(e){return t.delAction("entry",o)}}}),i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{attrs:{label:"中文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.comment,callback:function(i){t.$set(e,"comment",i)},expression:"action.comment"}})],1),i("el-form-item",{attrs:{label:"英文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"action.name"}})],1)],1)],1)})),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addAction("entry")}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:function(e){return t.addAction("entry")}}},[i("span",[t._v("添加活动")])])])],2):t._e(),"rect"===t.storeState.addStateForm.type?i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("内部活动[do Action]")]),t._l(t.storeState.addStateForm.doActions,(function(e,o){return i("div",{key:e.id,staticClass:"section-item"},[i("i",{staticClass:"el-icon-delete section-delete",on:{click:function(e){return t.delAction("do",o)}}}),i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{attrs:{label:"中文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.comment,callback:function(i){t.$set(e,"comment",i)},expression:"action.comment"}})],1),i("el-form-item",{attrs:{label:"英文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"action.name"}})],1)],1)],1)})),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addAction("do")}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:function(e){return t.addAction("do")}}},[i("span",[t._v("添加活动")])])])],2):t._e(),"rect"===t.storeState.addStateForm.type?i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("退出活动[exit Action]")]),t._l(t.storeState.addStateForm.exitActions,(function(e,o){return i("div",{key:e.id,staticClass:"section-item"},[i("i",{staticClass:"el-icon-delete section-delete",on:{click:function(e){return t.delAction("exit",o)}}}),i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{attrs:{label:"中文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.comment,callback:function(i){t.$set(e,"comment",i)},expression:"action.comment"}})],1),i("el-form-item",{attrs:{label:"英文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"action.name"}})],1)],1)],1)})),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addAction("exit")}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:function(e){return t.addAction("exit")}}},[i("span",[t._v("添加活动")])])])],2):t._e()])],1)},Ul=[],Zl={name:"StatePropsPanel",data:function(){return{storeState:window.store.state,options:[{value:"成功",label:"成功"},{value:"失败",label:"失败"}]}},methods:{onInputKeyUp:function(t){t.stopPropagation()},addAction:function(t){var e={id:Object(b["a"])(),elementType:"action",name:"",comment:""};this.storeState.addStateForm["".concat(t,"Actions")].push(e)},delAction:function(t,e){this.storeState.addStateForm["".concat(t,"Actions")].splice(e,1),this.ok()},reset:function(){this.storeState.addStateForm.id="",this.storeState.addStateForm.value="",this.storeState.addStateForm.name="",this.storeState.addStateForm.comment="",this.storeState.addStateForm.entryActions=[],this.storeState.addStateForm.doActions=[],this.storeState.addStateForm.exitActions=[]},ok:function(){window.store.actionCenter.emit(Gr.UPDATE_ELEMENT,this.storeState.addStateForm.id,this.storeState.addStateForm,"state")},querySearch:function(t,e){var i=[];window.store.baseData.statementList.forEach((function(t){"rect"===t.type&&(i.push.apply(i,Object(I["a"])(t.dataModel.entryActions)),i.push.apply(i,Object(I["a"])(t.dataModel.doActions)),i.push.apply(i,Object(I["a"])(t.dataModel.exitActions)))})),window.store.baseData.transitionList.forEach((function(t){i.push.apply(i,Object(I["a"])(t.dataModel.actions))}));var o=i.map((function(t){return{value:"".concat(t.comment," ").concat(t.name),action:t}}));e(o)},handleSelect:function(t,e){e.comment=t.action.comment,e.name=t.action.name,this.ok()}}},Yl=Zl,Hl=(i("16c7"),Object(c["a"])(Yl,Fl,Ul,!1,null,"30774ab2",null)),Vl=Hl.exports,Ql=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"流转信息"}},[i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("触发事件[event]")]),i("div",{staticClass:"section-item",staticStyle:{padding:"10px 8px"}},[i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:"中文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addTransitionForm.event.comment,callback:function(e){t.$set(t.storeState.addTransitionForm.event,"comment",e)},expression:"storeState.addTransitionForm.event.comment"}})],1),i("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"英文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addTransitionForm.event.name,callback:function(e){t.$set(t.storeState.addTransitionForm.event,"name",e)},expression:"storeState.addTransitionForm.event.name"}})],1)],1)],1)]),i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("触发条件[guard]")]),i("div",{staticClass:"section-item",staticStyle:{padding:"10px 8px"}},[i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:"中文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addTransitionForm.guard.comment,callback:function(e){t.$set(t.storeState.addTransitionForm.guard,"comment",e)},expression:"storeState.addTransitionForm.guard.comment"}})],1),i("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"英文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:t.storeState.addTransitionForm.guard.name,callback:function(e){t.$set(t.storeState.addTransitionForm.guard,"name",e)},expression:"storeState.addTransitionForm.guard.name"}})],1)],1)],1)]),i("div",{staticClass:"section"},[i("div",{staticClass:"section-title"},[t._v("状态流转后动作[action]")]),t._l(t.storeState.addTransitionForm.actions,(function(e,o){return i("div",{key:e.id,staticClass:"section-item"},[i("i",{staticClass:"el-icon-delete section-delete",on:{click:function(e){return t.delAction(o)}}}),i("el-form",{attrs:{"label-position":"left","label-width":"60px",size:"small"}},[i("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:"中文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.comment,callback:function(i){t.$set(e,"comment",i)},expression:"action.comment"}})],1),i("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"英文名"}},[i("el-input",{on:{change:t.ok},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onInputKeyUp.apply(null,arguments)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"action.name"}})],1)],1)],1)})),i("div",{staticClass:"add_item",attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addAction.apply(null,arguments)}}},[i("i",{staticClass:"add-action-button el-icon-circle-plus-outline",on:{click:t.addAction}},[i("span",[t._v("添加活动")])])])],2)])],1)},Wl=[],Xl={name:"TransitionPropsPanel",data:function(){return{storeState:window.store.state,options:[{value:"成功",label:"成功"},{value:"失败",label:"失败"}]}},methods:{onInputKeyUp:function(t){t.stopPropagation()},addAction:function(){var t={id:Object(b["a"])(),elementType:"action",name:"",comment:""};this.storeState.addTransitionForm.actions.push(t)},delAction:function(t){this.storeState.addTransitionForm.actions.splice(t,1),this.ok()},reset:function(){this.storeState.addTransitionForm.id="",this.storeState.addTransitionForm.sourceState="",this.storeState.addTransitionForm.targetState="",this.storeState.addTransitionForm.event={comment:"",name:""},this.storeState.addTransitionForm.guard={comment:"",name:""},this.storeState.addTransitionForm.actions=[]},ok:function(){window.store.actionCenter.emit(Gr.UPDATE_ELEMENT,this.storeState.addTransitionForm.id,this.storeState.addTransitionForm,"transition")},querySearch:function(t,e){var i=[];window.store.baseData.statementList.forEach((function(t){"rect"===t.type&&(i.push.apply(i,Object(I["a"])(t.dataModel.entryActions)),i.push.apply(i,Object(I["a"])(t.dataModel.doActions)),i.push.apply(i,Object(I["a"])(t.dataModel.exitActions)))})),window.store.baseData.transitionList.forEach((function(t){i.push.apply(i,Object(I["a"])(t.dataModel.actions))}));var o=i.map((function(t){return{value:"".concat(t.comment," ").concat(t.name),action:t}}));e(o)},handleSelect:function(t,e){e.comment=t.action.comment,e.name=t.action.name,this.ok()}}},Jl=Xl,$l=(i("6d09"),Object(c["a"])(Jl,Ql,Wl,!1,null,"2263b118",null)),Kl=$l.exports,ql=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-info"},[i("div",[i("el-tabs",{attrs:{type:"border-card"},model:{value:t.state.activeName,callback:function(e){t.$set(t.state,"activeName",e)},expression:"state.activeName"}},[i("el-tab-pane",{staticStyle:{padding:"10px"},attrs:{label:"基本信息",name:"base"}},[i("div",{staticClass:"diagram-info-base diagram-info-base-info"},[i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布宽度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v("1000")])]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布高度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v("1000")])])])])],1)],1)])},td=[],ed={data:function(){return{state:this.$parent.$parent.stateStore.state}},mounted:function(){this.stateStore=this.$parent.$parent.stateStore},methods:{selectComponent:function(t){this.stateStore.selectElementById(t)},formatTime:function(t){return Ic(t,{source:"string"})},save:function(){this.stateStore.refreshData()},clearUnUseMsg:function(t){for(var e=function(e,n){var a=t.msgList[e];t.lifelineList.find((function(t){return t.id===a.from}))&&t.lifelineList.find((function(t){return t.id===a.to}))||(t.msgList.splice(e,1),e--,n--),i=e,o=n},i=0,o=t.msgList.length;i<o;i++)e(i,o)},deleteDefaultColor:function(t){for(var e=0,i=t.lifelineList.length;e<i;e++){var o=t.lifelineList[e];"#faecd8"===o.color&&delete o.color}}},beforeDestroy:function(){}},id=ed,od=(i("2940"),Object(c["a"])(id,ql,td,!1,null,"3f0e5b1d",null)),nd=od.exports,ad=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"操作帮助"}},[i("ul",{staticClass:"help-list"},[i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么添加元素","https://wx.gtimg.com/resource/feuploader/202109/efa0c5018901e845b1d61278c149c81a_800x788.gif","500px")}}},[t._v("怎么添加元素")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么修改元素的颜色","https://wx.gtimg.com/resource/feuploader/202109/e90fab8c26df0cb953a90488bef5b4f4_1024x1009.gif","500px")}}},[t._v("怎么修改元素的颜色")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么编辑流转的位置","https://wx.gtimg.com/resource/feuploader/202109/04df72119316c5fac65694b091fae001_1024x1009.gif","500px")}}},[t._v("怎么编辑流转的位置")])],1)])])],1),i("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:t.width},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{src:this.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("学会了")])],1)]),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202106/82cbc62d516ec2ae5230bacbda5e1e15_1000x600.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202106/993ba40606b49a3aade5d665268842ba_1000x600.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202106/ecd962ffd9e62d478909bc200c1ea770_1000x600.gif"}})],1)},sd=[],rd={data:function(){return{title:"",dialogVisible:!1,gifUrl:"",width:"800px"}},methods:{showDialog:function(t,e,i){this.width=i,this.dialogVisible=!0,this.title=t,this.gifUrl=e}}},cd=rd,ld=(i("1197"),Object(c["a"])(cd,ad,sd,!1,null,"495c7144",null)),dd=ld.exports,ud=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-info"},[i("div",[i("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.onTabClick},model:{value:t.state.activeName,callback:function(e){t.$set(t.state,"activeName",e)},expression:"state.activeName"}},[i("el-tab-pane",{staticStyle:{padding:"10px"},attrs:{label:"代码预览",name:"base"}},[i("div",{staticClass:"diagram-info-base diagram-info-base-info"},[i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("语言")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-select",{attrs:{placeholder:"请选择",size:"mini"},model:{value:t.state.codeGen.lan,callback:function(e){t.$set(t.state.codeGen,"lan",e)},expression:"state.codeGen.lan"}},[i("el-option",{attrs:{label:"js",value:"js"}}),i("el-option",{attrs:{label:"ts",value:"ts"}}),i("el-option",{attrs:{label:"c++",value:"c++"}})],1)],1)]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("英文名")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-input",{staticStyle:{width:"177px"},attrs:{placeholder:"请输入英文名",size:"mini"},model:{value:t.state.codeGen.enName,callback:function(e){t.$set(t.state.codeGen,"enName",e)},expression:"state.codeGen.enName"}})],1)]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("中文名")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-input",{staticStyle:{width:"177px"},attrs:{placeholder:"请输入中文名",size:"mini"},model:{value:t.state.codeGen.cnName,callback:function(e){t.$set(t.state.codeGen,"cnName",e)},expression:"state.codeGen.cnName"}})],1)]),"c++"===t.state.codeGen.lan?i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("错误码前缀")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-input",{staticStyle:{width:"177px"},attrs:{placeholder:"请输入错误码前缀",size:"mini"},model:{value:t.state.codeGen.errorCodePrefix,callback:function(e){t.$set(t.state.codeGen,"errorCodePrefix",e)},expression:"state.codeGen.errorCodePrefix"}})],1)]):t._e(),i("div",{staticStyle:{"margin-left":"80px","margin-top":"10px"}},[i("el-button",{attrs:{disabled:t.state.codeGen.isGening,icon:"el-icon-refresh",plain:"",size:"mini",type:"primary"},on:{click:t.gen}},[t._v("生成")])],1)]),i("div",{staticStyle:{"margin-bottom":"100px"}},[i("div",{staticClass:"diagram-info-title",staticStyle:{"margin-top":"20px"}},[t._v("\n            合并推送\n\n            "),i("el-tooltip",{attrs:{content:"开发机如何配置？",placement:"bottom",effect:"light"}},[i("a",{attrs:{href:"http://xwatt.wxp.oa.com/#/user/setting",target:"_blank"}},[i("i",{staticClass:"el-icon-question"})])])],1),i("div",{staticClass:"diagram-info-base diagram-info-base-info"},[i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("开发机")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-input",{staticStyle:{width:"177px"},attrs:{placeholder:"请输入开发机ip",size:"mini"},model:{value:t.state.codeGen.ip,callback:function(e){t.$set(t.state.codeGen,"ip",e)},expression:"state.codeGen.ip"}})],1)]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("推送路径")]),i("div",{staticClass:"diagram-info-base-item-value"},[i("el-input",{staticStyle:{width:"177px"},attrs:{placeholder:"请输入路径",size:"mini"},model:{value:t.state.codeGen.path,callback:function(e){t.$set(t.state.codeGen,"path",e)},expression:"state.codeGen.path"}})],1)]),i("div",{staticStyle:{"margin-left":"80px","margin-top":"10px"}},[i("el-button",{attrs:{disabled:t.state.codeGen.isGening||t.state.codeGen.isGenError,icon:"el-icon-c-scale-to-original",plain:"",size:"mini",type:"primary"},on:{click:t.diff}},[t._v("对比")]),i("el-button",{attrs:{disabled:t.state.codeGen.isGening||!t.state.codeGen.isDiffMode||t.state.codeGen.isGenError,icon:"el-icon-position",plain:"",size:"mini",type:"primary"},on:{click:t.pushCode}},[t._v("推送")])],1)])])])],1)],1)])},hd=[],fd={data:function(){return{state:this.$parent.$parent.stateStore.state}},components:{},mounted:function(){this.stateStore=this.$parent.$parent.stateStore},methods:{onTabClick:function(){this.stateStore.syncServerComment()},gen:function(){this.state.codeGen.isGening=!0,this.stateStore.genCode()},diff:function(){this.state.codeGen.ip&&this.state.codeGen.path?this.state.codeGen.isDiffMode=!0:this.$notify({offset:235,message:"请填写开发机和路径",type:"warning"})},pushCode:function(){this.stateStore.pushCode()}},beforeDestroy:function(){}},gd=fd,pd=(i("bec7"),Object(c["a"])(gd,ud,hd,!1,null,"1cbeb53b",null)),md=pd.exports,yd={watch:{"state.selectedElementType":function(t){console.log("🚀 ~ file: props-panel.vue ~ line 41 ~ type",t)}},props:{menus:Array},components:{StatePropsPanel:Vl,TransitionPropsPanel:Kl,DiagramPropsPanel:nd,HelpPanel:dd,GenCodePanel:md},data:function(){return{state:this.$parent.stateStore.state,isClosed:!1}},methods:{toggle:function(){this.isClosed=!this.isClosed,this.$emit("toggle-panel",this.isClosed)}},mounted:function(){var t=this;this.stateStore=this.$parent.stateStore,this.stateStore.openRightPanel=function(){t.isClosed=!1,t.$emit("toggle-panel",t.isClosed)},this.stateStore.closeRightPanel=function(){t.isClosed=!0,t.$emit("toggle-panel",t.isClosed)}}},vd=yd,wd=(i("ca36"),Object(c["a"])(vd,Gl,_l,!1,null,"412814af",null)),xd=wd.exports,Cd={name:"StateDiagram",watch:{"state.elementComment.show":function(t){var e=this;t&&this.$nextTick((function(){e.$refs.commentInput.focus()}))},renderData:function(t){"state"===this.showType&&this.stateStore.updateData(t)}},components:{Toolbar:Bl,PropsPanel:xd},props:{diagramUUId:String,showType:String,renderData:Object},data:function(){return{isClosed:!!bc("projectId"),seqColor:"默认视图",saveMsg:"",activeName:"diagram",contentHeight:window.innerHeight-42,filterText:"",tabPosition:"bottom",state:{},guide:{title:"如何添加元素",dialogVisible:!1,width:"500px",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/efa0c5018901e845b1d61278c149c81a_800x788.gif"}}},beforeCreate:function(){var t=new El({el:"#sving-root",callback:function(){}});this.stateStore=t,this.state=t.state,window.store=t},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.contentHeight=window.innerHeight-42})),console.log("mounted"),this.stateStore.updateData(this.renderData),localStorage.getItem("__xwatt__iwiki__state__guide__")||(this.guide.dialogVisible=!0,localStorage.setItem("__xwatt__iwiki__state__guide__",!0))},computed:{diagramName:function(){return this.renderData.diagramName}},methods:{onTogglePanel:function(t){},onTabClick:function(){this.stateStore.state.selectedElementType=this.activeName,this.stateStore.unselectAll()},onScroll:function(t){},downLoadPng:function(){var t=this;this.stateStore.unselectAll();var e=30,i=this.stateStore.getBound();i.width+=2*e,i.height+=2*e,this.stateStore.showLoading("下载中..");var o=document.createElement("canvas"),n=o.getContext("2d"),a=this.stateStore.svingDiagram.stage.el.cloneNode(!0);a.setAttribute("width",i.width),a.setAttribute("height",i.height),a.setAttribute("width",2*a.getAttribute("width")),a.setAttribute("height",2*a.getAttribute("height"));var s=canvg.Canvg.fromString(n,a.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(e,'" y="-').concat(e,'" width="').concat(i.left+i.width,'" height="').concat(i.top+i.height,'" fill="white"/>')),{scaleWidth:2*a.getAttribute("width"),scaleHeight:2*a.getAttribute("height"),offsetX:-i.left+e,offsetY:-i.top+e});s.start(),setTimeout((function(){var e=document.createElement("a");e.href=o.toDataURL("image/png"),e.download=(t.stateStore.diagramUUId||"state-machine")+".png",e.click(),t.stateStore.hideLoading()}),1e3)},iwikiSave:function(){var t=this;this.stateStore.unselectAll();var e=this.stateStore.getStageContentSize();this.stateStore.showLoading("保存中..");var i=document.createElement("canvas"),o=i.getContext("2d"),n=this.stateStore.svingDiagram.stage.el.cloneNode(!0);n.setAttribute("width",e.width+10),n.setAttribute("height",e.height),n.setAttribute("width",n.getAttribute("width")),n.setAttribute("height",n.getAttribute("height"));var a=canvg.Canvg.fromString(o,n.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="100%" height="100%" fill="white"/>'),{scaleWidth:n.getAttribute("width"),scaleHeight:n.getAttribute("height")});a.start(),setTimeout((function(){var e=t.stateStore.getJSONData();window.parent.postMessage({type:"xwatt_iframe:save",renderData:e,picData:i.toDataURL("image/png")},"*"),t.stateStore.hideLoading()}),1e3)},filterNode:function(){},handleNodeClick:function(){},nodeExpand:function(){},nothingTodo:function(){},objOk:function(){},msgOk:function(){},cancel:function(){},onInputKeyUp:function(t){t.stopPropagation()},initSeq:function(t){var e=this,i=document.querySelector("#state-diagram");if(i.style.display="block",t){this.stateStore.baseData=t,this.stateStore.diagram&&this.stateStore.diagram.recycle(),this.stateStore.updateData(t);var o=new ClipboardJS(".share-btn");o.on("success",(function(t){console.info("Action:",t.action),console.info("Text:",t.text),console.info("Trigger:",t.trigger),t.clearSelection(),e.$message.closeAll(),e.$message({type:"success",dangerouslyUseHTMLString:!0,message:'复制分享链接成功  <br>  <a target="_blank" href="'.concat(t.text,'">').concat(t.text,"</a>"),showClose:!0,duration:0})})),o.on("error",(function(t){console.error("Action:",t.action),console.error("Trigger:",t.trigger)}))}},clearUnUseMsg:function(t){for(var e=function(e,n){var a=t.msgList[e];t.lifelineList.find((function(t){return t.id===a.from}))&&t.lifelineList.find((function(t){return t.id===a.to}))||(t.msgList.splice(e,1),e--,n--),i=e,o=n},i=0,o=t.msgList.length;i<o;i++)e(i,o)},deleteDefaultColor:function(t){for(var e=0,i=t.lifelineList.length;e<i;e++){var o=t.lifelineList[e];"#faecd8"===o.color&&delete o.color}}}},bd=Cd,Id=(i("cb85"),Object(c["a"])(bd,Rr,Br,!1,null,"eaae9d4e",null)),Md=Id.exports,kd={props:{diagramUUId:String,showType:String,renderData:Object},components:{StateDiagram:Md},mounted:function(){}},Sd=kd,Dd=Object(c["a"])(Sd,Pr,zr,!1,null,"2bdf5484",null),Nd=Dd.exports,Ad=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("UseCaseDiagram",{attrs:{diagramUUId:t.diagramUUId,showType:t.showType,renderData:t.renderData,subType:t.subType}})},Ld=[],Td=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"use-case-diagram"}},[i("Toolbar",{ref:"toolbar",attrs:{subType:t.subType,diagramName:t.diagramName}}),i("i",{staticClass:"el-icon-download toolbar-icon",staticStyle:{right:"60px",display:"none"},attrs:{id:"downBtn",title:"下载PNG"},on:{click:t.downLoadPng}},[i("span",[t._v("下载")])]),i("i",{staticClass:"el-icon-download toolbar-icon",staticStyle:{right:"160px",display:"none"},attrs:{id:"iwikiBtn",title:"保存到 iwiki"},on:{click:t.iwikiSave}},[i("span",[t._v("保存到 iwiki")])]),i("div",{staticClass:"seq-main"},[i("div",{staticClass:"seq-main-graph"},[i("div",{ref:"svingRoot",staticClass:"sving-root",style:"height:"+t.contentHeight+"px;background:white",attrs:{id:"uc-sving-root"}},[i("div",{staticClass:"save-msg"},[t._v(t._s(t.state.saveMsg))])])]),i("PropsPanel")],1),i("el-dialog",{attrs:{title:t.guide.title,visible:t.guide.dialogVisible,width:t.guide.width},on:{"update:visible":function(e){return t.$set(t.guide,"dialogVisible",e)}}},[i("img",{attrs:{src:t.guide.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.guide.dialogVisible=!1}}},[t._v("学会了")])],1)])],1)},Ed=[],Od=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-toolbar"},[i("el-tooltip",{attrs:{content:"撤销 Ctrl/⌘+Z",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isUndoDisabled},on:{click:t.undo}},[i("svg",{staticClass:"toolbar_undo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M8 8.25h6c2.761 0 5 1.989 5 4.75a5 5 0 01-5 5H7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M9 5.372V10.9a.2.2 0 01-.301.173L4.276 8.474a.2.2 0 01-.009-.339l4.423-2.93a.2.2 0 01.31.167z",fill:"currentColor"}})])])])]),i("el-tooltip",{attrs:{content:"重做 Ctrl/⌘+Y",effect:"light",placement:"bottom"}},[i("i",{class:{"is-disabled":t.state.isRedoDisabled},on:{click:t.redo}},[i("svg",{staticClass:"toolbar_redo",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M16 8.25h-6c-2.761 0-5 1.989-5 4.75a5 5 0 005 5h7",stroke:"currentColor","stroke-width":"1.25"}}),i("path",{attrs:{d:"M15 5.372V10.9a.2.2 0 00.301.173l4.423-2.599a.2.2 0 00.009-.339l-4.423-2.93a.2.2 0 00-.31.167z",fill:"currentColor"}})])])])]),i("div",{staticClass:"diagram-toolbar-split"}),3===t.subType?i("el-tooltip",{attrs:{content:"Actor",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("actor")},mousedown:function(e){return t.dragStart(e,"actor")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(14,0,0,14,500,200)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"7.5",ry:"7.5",stroke:"black","stroke-width":"3.5"}}),i("path",{attrs:{d:"M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343",stroke:"black","stroke-width":"3.5",transform:"matrix(1,0,0,1,-873,-1290)"}})])])])]):t._e(),3===t.subType?i("el-tooltip",{attrs:{content:"Use Case",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("useCase","system")},mousedown:function(e){return t.dragStart(e,"useCase","system")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,200,300)"}},[i("ellipse",{attrs:{fill:"#faecd8",rx:"44",ry:"24",stroke:"#353535","stroke-width":"4",transform:"matrix(1,0,0,1,34,22)"}})])])])]):t._e(),4===t.subType?i("el-tooltip",{attrs:{content:"Business Actor",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("actor","business")},mousedown:function(e){return t.dragStart(e,"actor","business")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(14,0,0,14,500,200)"}},[i("ellipse",{attrs:{fill:"rgb(250, 236, 216)",rx:"7.5",ry:"7.5",stroke:"black","stroke-width":"3.5"}}),i("path",{attrs:{d:"M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343",stroke:"black","stroke-width":"3.5",transform:"matrix(1,0,0,1,-873,-1290)"}})])])])]):t._e(),4===t.subType?i("el-tooltip",{attrs:{content:"Business Use Case",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("useCase","business")},mousedown:function(e){return t.dragStart(e,"useCase","business")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(10,0,0,10,200,300)"}},[i("ellipse",{attrs:{fill:"#faecd8",rx:"44",ry:"24",stroke:"#353535","stroke-width":"4",transform:"matrix(1,0,0,1,34,22)"}}),i("line",{attrs:{stroke:"#353535","stroke-width":"5",x1:"39",x2:"78",y1:"46",y2:"17"}})])])])]):t._e(),i("el-tooltip",{attrs:{content:"Boundary",effect:"light",placement:"bottom"}},[i("i",{on:{click:function(e){return t.addObj("fragment")},mousedown:function(e){return t.dragStart(e,"fragment")}}},[i("svg",{attrs:{"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"1.5em",viewBox:"0 0 1024 1024",width:"1.5em","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{transform:"matrix(1,0,0,1,50,50)"}},[i("rect",{attrs:{fill:"white",height:"750",stroke:"black","stroke-linejoin":"round","stroke-width":"28",transform:"matrix(1,0,0,1,89,90)",width:"750"}})])])])]),i("div",{staticClass:"diagram-toolbar-split"}),i("el-tooltip",{staticClass:"item",attrs:{content:"下载PNG",effect:"light",placement:"bottom"}},[i("i",{staticClass:"el-icon-download el-ui-icon",on:{click:t.downLoadPng}})]),i("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"item",attrs:{slot:"reference",content:"上传到 XWatt",effect:"light",placement:"bottom"},slot:"reference"},[i("i",{staticClass:"el-ui-icon el-icon-upload",on:{click:t.openMessageBox}})]),i("el-tooltip",{staticClass:"item",attrs:{content:"问题反馈",effect:"light",placement:"bottom"}},[i("el-link",{staticStyle:{position:"relative",top:"-2px","font-size":"1.2em"},attrs:{icon:"el-icon-question",href:"https://git.woa.com/td/xwatt-web/issues/new",target:"_blank"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isConfluence,expression:"isConfluence"}],staticClass:"confluence_btn_group"},[i("el-button",{attrs:{plain:"",size:"mini",type:"info"},on:{click:t.onCancel}},[t._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)},jd=[],Pd={ADD_ELEMENT:"add element",MODIFY_ELEMENT_LABEL:"modify element name",DELETE_ELEMENT:"delete element",MOVE_NODE:"move node",ADD_RELATION:"add relation",DELETE_RELATION:"delete relation",MODIFY_MSG_NAME:"modify msg name",MOVE_MSG:"move msg",ADD_BOUNDARY:"add boundary",DELETE_BOUNDARY:"delete boundary",MODIFY_BOUNDARY_RECT:"modify fragment rect",ADD_NOTE:"add note",DELETE_NOTE:"delete note",MODIFY_NOTE_CONTENT:"modify note content",MOVE_NOTE:"move note",ADD_NOTE_CONN:"add note conn",DELETE_NOTE_CONN:"delete note conn",ADD_ACTOR:"add actor",DELETE_ACTOR:"delete actor",DELETE_USECASE:"delete usecase",ADD_USECASE:"add usecase",REVERSE_RELATION:"reverse relation"},zd={FILL_COLOR:"#faecd8",STROKE_COLOR:"black"};function Rd(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=i.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function Bd(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.type,o=void 0===i?"long":i,n=e.source,a=void 0===n?"timestamp":n,s="";switch(a){default:case"timestamp":"number"===typeof t&&(t=new Date(t)),"string"===typeof t&&(t=new Date(Number(t))),s+=t.getFullYear()+"-",s+=Gd(t.getMonth()+1)+"-",s+=Gd(t.getDate()),s+=" ",s+=Gd(t.getHours())+":",s+=Gd(t.getMinutes())+":",s+=Gd(t.getSeconds());break;case"string":t=t.toString(),s+=t.slice(0,4)+"-",s+=t.slice(4,6)+"-",s+=t.slice(6,8),s+=" ",s+=t.slice(8,10)+":",s+=t.slice(10,12)+":",s+=t.slice(12,14);break}return"long"!==o&&(s=s.slice(0,10)),s}function Gd(t){return(t<10?"0":"")+t}function _d(t,e,i,o,n,a,s,r,c){var l=i-t,d=o-e,u=s-n,h=r-a,f=l*h-u*d;if(0!=f){var g=t-n,p=e-a,m=l*p-d*g;if(m<0!=f>0){var y=u*p-h*g;if(y<0!=f>0&&m>f!=f>0&&y>f!=f>0){var v=y/f;return c.x=t+v*l,c.y=e+v*d,c}}}}function Fd(t,e,i,o,n,a,s,r,c){var l=_d(t,e,i,o,n,a,n+s,a,c);return l||(l=_d(t,e,i,o,n,a,n,a+r,c),l||(l=_d(t,e,i,o,n,a+r,n+s,a+r,c),l||(l=_d(t,e,i,o,n+s,a,n+s,a+r,c),l||void 0)))}var Ud={props:{diagramName:String,menus:Array,subType:Number},data:function(){var t=Rd("tag");return{visible:!1,nameForm:{name:this.diagramName},isConfluence:t&&t.includes("iwiki"),layoutType:0,name:"XIDE",state:this.$parent.useCaseStore.state,xwattBaseUrl:"//xwatt.wxp.oa.com/node/ad-tools",saving:!1}},mounted:function(){var t=this;this.useCaseStore=this.$parent.useCaseStore,window.addEventListener("message",(function(e){var i=e.data.type,o=e.data.diagramType;"uc"===o&&"xwatt_iframe:save_done"===i&&(t.saving=!1,t.useCaseStore.hideLoading(),t.$refs["nameForm"]&&t.$refs["nameForm"].resetFields())}))},methods:{undo:function(){this.state.isUndoDisabled||this.useCaseStore.actionCenter.undo()},redo:function(){this.state.isRedoDisabled||this.useCaseStore.actionCenter.redo()},share:function(){document.querySelector("#shareBtn").click()},downLoadPng:function(){document.querySelector("#downBtn").click()},dragStart:function(t,e,i){var o=this;this._isMouseDown=!0,this.dupNode=t.currentTarget.cloneNode(!0),this.dupNode.style.position="fixed",this._preType=e,this._preTarget=t.currentTarget,this.dupNode.style.pointerEvents="none",document.body.appendChild(this.dupNode),document.addEventListener("mousemove",this._mouseMove),this._mouseUpWp=function(t){o._mouseUp(t,i)},document.addEventListener("mouseup",this._mouseUpWp),this._preX=t.clientX,this._preY=t.clientY},_mouseMove:function(t){this._isMouseDown&&(this._preTarget.style.cursor="move",this.dupNode.style.left=t.pageX+"px",this.dupNode.style.top=t.pageY+"px")},_mouseUp:function(t,e){if(this._isMouseDown&&(Math.abs(t.clientX-this._preX)>10||Math.abs(t.clientY-this._preY)>10)&&(document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUpWp),this._preTarget.style.cursor="pointer",this._isInSVG(t.srcElement))){var i=this.useCaseStore.getBoundingClientRect();this.addObj(this._preType,e,t.clientX-i.left,t.clientY-i.top)}this._isMouseDown=!1,this.dupNode&&(document.body.removeChild(this.dupNode),this.dupNode=null)},addObj:function(t,e,i,o,n){var a=this;if(this.useCaseStore.state.currentX=i,this.useCaseStore.state.currentY=o,"fragment"===t){var s={id:Object(b["a"])(),text:"Boundary",itemType:"scope",position:{x:300,y:100},size:{width:400,height:500}};"number"===typeof i&&(s.position.x=i,s.position.y=o),this.useCaseStore.actionCenter.emit(Pd.ADD_BOUNDARY,s),setTimeout((function(){a.useCaseStore.editFragmentName(s.id)}),20)}else if("note"===t){var r={id:Object(b["a"])(),text:"备注内容",width:100,height:100};"number"===typeof i&&(r.x=i,r.y=o),this.useCaseStore.actionCenter.emit(Pd.ADD_NOTE,r)}else{var c=Object(b["a"])(),l={id:c,key:c,text:"actor"===t?"Actor":"Use Case",itemType:t,itemShape:e};l.position="number"===typeof i?{x:i,y:o}:{x:200+200*Math.random(),y:200+200*Math.random()},this.useCaseStore.actionCenter.emit(Pd.ADD_ELEMENT,l,n),setTimeout((function(){a.useCaseStore.editLifelineName(c)}),20)}},_isInSVG:function(t){return!!t&&("svg"===t.nodeName||this._isInSVG(t.parentNode))},help:function(){this.useCaseStore.state.selectedElementType="help",this.useCaseStore.openRightPanel()},onCancel:function(){window.parent.postMessage({type:"xwatt_iframe:close"},"*")},onSave:function(){var t=Object(C["a"])(regeneratorRuntime.mark((function t(){var e,i,o,n,a,s,r,c=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.useCaseStore.unSelectAll(),e=30,i=this.useCaseStore.getBound(),i.width+=2*e,i.height+=2*e,this.useCaseStore.showLoading("保存中.."),o=document.createElement("canvas"),n=o.getContext("2d"),a=this.useCaseStore.svingDiagram.stage.el.cloneNode(!0),a.setAttribute("width",2*i.width),a.setAttribute("height",2*i.height),a.setAttribute("width",a.getAttribute("width")),a.setAttribute("height",a.getAttribute("height")),s=canvg.Canvg.fromString(n,a.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(e,'" y="-').concat(e,'" width="').concat(i.left+i.width,'" height="').concat(i.top+i.height,'" fill="white"/>')),{scaleWidth:2*a.getAttribute("width"),scaleHeight:2*a.getAttribute("height"),offsetX:-i.left+e,offsetY:-i.top+e}),t.next=16,s.render();case 16:r=this.useCaseStore.getJSONData(),r.diagramName=this.nameForm.name||this.diagramName,r.fromIwiki=!0,r.subType=this.subType,window.parent.postMessage({type:"xwatt_iframe:save",renderData:r,picData:o.toDataURL("image/png"),diagramType:"uc",width:i.width},"*"),this.visible=!1,this.saving=!0,setTimeout((function(){c.saving&&(c.saving=!1,c.useCaseStore.hideLoading(),c.$message({type:"warning",message:"保存超时，请重试！"}))}),3e4),aegis.reportEvent({name:"用例图保存",ext1:3===this.subType?"系统用例图":4===this.subType?"业务用例图":"",ext2:this.nameForm.name||this.diagramName}),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-save-usecase"});case 26:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleShow:function(){this.$refs["nameForm"].resetFields(),this.$refs["diagramNameInput"].focus()},upload2Xwatt:function(t){var e=this,i=this.useCaseStore.getJSONData();i.diagramName=t,i.fromIwiki=!0;var o=3===this.subType?"system":"business";i.useCaseType=o,i.subType=this.subType;var n={JSONData:JSON.stringify(i),name:t,useCaseType:o};store.showLoading(),Be()({url:"".concat(this.xwattBaseUrl,"/usecase/create"),method:"POST",data:n,withCredentials:!0}).then((function(t){var i=t.status,o=t.data;if(200!==i||0!==o.code)throw Error("[XWATT] Response With Code ".concat(o.code));console.log("[XWATT] Send to XWatt Success, ret:",o),e.$message({type:"success",message:"上传成功"})})).catch((function(t){console.error("[XWATT] Request XWATT Failed, err:",t),e.$message({type:"error",message:"上传失败，错误：".concat(t.message)})})).finally((function(){store.hideLoading()}))},openMessageBox:function(){var t=this;this.$prompt("请输入用例图名称","用例图上传至 XWATT",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){return null!==t&&""!==t},inputErrorMessage:"命名不能为空"}).then((function(e){var i=e.value;store.showLoading("上传中.."),t.upload2Xwatt(i),reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"iwiki-upload-usecase"})})).catch((function(){console.log("取消输入")}))}}},Zd=Ud,Yd=(i("7fec"),Object(c["a"])(Zd,Od,jd,!1,null,"ccfbac64",null)),Hd=Yd.exports,Vd=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"props-panel",style:"width:"+(t.isClosed?0:300)+"px"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isClosed,expression:"!isClosed"}],staticClass:"props-panel-content"},[i("HelpPanel")],1),i("div",{class:{"menu-unfoldbox":!0,closed:this.isClosed},on:{click:t.toggle}},[i("svg",{attrs:{"aria-hidden":"true","data-icon":"left","data-v-35e7d322":"",fill:"white",focusable:"false",height:"1em",viewBox:"64 64 896 896",width:"1em"}},[i("path",{attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z","data-v-35e7d322":""}})])])])},Qd=[],Wd=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-info"},[i("div",[i("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.onTabClick},model:{value:t.state.activeName,callback:function(e){t.$set(t.state,"activeName",e)},expression:"state.activeName"}},[i("el-tab-pane",{staticStyle:{padding:"10px"},attrs:{label:"基本信息",name:"base"}},[i("div",{staticClass:"diagram-info-base"},[i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布宽度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v("1000")])]),i("div",{staticClass:"diagram-info-base-item"},[i("div",{staticClass:"diagram-info-base-item-prop"},[t._v("画布高度")]),i("div",{staticClass:"diagram-info-base-item-value"},[t._v("1000")])])])])],1)],1)])},Xd=[],Jd=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-palette-panel-3DIVh",style:"display: flex;left:"+t.x+"px;top:"+t.y+"px;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"palette"},[i("div",{staticStyle:{"padding-left":"2px"}},[i("div",{staticClass:"palette-color-grid"},[i("div",t._l(t.standardColors,(function(e){return i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box inner-box-border",style:"background-color:"+e.color+" ;"})])})),0)]),i("div",{staticStyle:{height:"8px"}}),i("div",{staticClass:"palette-color-grid"},t._l(t.presetColors,(function(e){return i("div",t._l(e,(function(e){return i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e.color)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e.color+" ;"})])})),0)})),0),i("span",{staticClass:"palette-text-font",staticStyle:{"margin-top":"10px","padding-left":"12px","padding-bottom":"10px"}},[t._v("最近使用")]),i("div",{staticClass:"palette-color-grid"},[i("div",[t._l(t.historyColors,(function(e){return t.historyColors.length>0?i("div",{staticClass:"color-box",staticStyle:{"margin-left":"-2px","margin-top":"-1px"},on:{click:function(i){return t.onColorChange(e)}}},[i("div",{staticClass:"inner-box",style:"background-color:"+e+" ;"})]):t._e()})),t._l([1,1,1,1,1,1,1,1,1],(function(e){return 0===t.historyColors.length?i("div",{staticClass:"color-box-no-hover",staticStyle:{"margin-left":"-2px","margin-top":"-1px"}},[i("div",{staticClass:"inner-box inner-box-border",staticStyle:{"background-color":"transparent"}})]):t._e()}))],2)])]),t._m(0),i("ul",{staticClass:"palette-list"},[i("li",{staticClass:"list-item list-item-sub",on:{mouseenter:t.showPicker,mouseleave:t.hidePicker}},[i("img",{staticClass:"list-item-img",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUzLjEgKDcyNjMxKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT7oh6rlrprkuYnpopzoibJpY29uPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IuiHquWumuS5ieminOiJsmljb24iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxyZWN0IGlkPSLnn6nlvaItY29weS0xMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ij48L3JlY3Q+CiAgICAgICAgPHBhdGggZD0iTTExLjYsOCBDMTEuMDY2ODQ2Myw4IDEwLjYsNy41MzI2NzQzMiAxMC42LDcuMDAwMzEyNjcgQzEwLjYsNi40NjY2ODQzIDExLjA2NjgzMDMsNiAxMS42LDYgQzEyLjEzMzE2OTcsNiAxMi42LDYuNDY3MzI1NjggMTIuNiw3LjAwMDMxMjY3IEMxMi42LDcuNTMyMDQ4OTcgMTIuMTMzMTY5Nyw4IDExLjYsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOS44MDAzMTI2Nyw1LjQgQzkuMjY2Njg0Myw1LjQgOC44LDQuOTMzMTY5NzMgOC44LDQuNCBDOC44LDMuODY2ODMwMjcgOS4yNjczMjU2OCwzLjQgOS44MDAzMTI2NywzLjQgQzEwLjMzMzMxNTcsMy40IDEwLjgsMy44NjY4MzAyNyAxMC44LDQuNCBDMTAuOCw0LjkzMzE2OTczIDEwLjMzMjY5MDMsNS40IDkuODAwMzEyNjcsNS40IFoiIGlkPSLot6/lvoQiIGZpbGw9IiM1QzVDNUMiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgIDxwYXRoIGQ9Ik02LjM5OTk5MTk4LDUuNCBDNS44NjU1NjY4OCw1LjQgNS40LDQuOTMzMTY5NzMgNS40LDQuNCBDNS40LDMuODY2ODMwMjcgNS44NjU1NjY4OCwzLjQgNi4zOTk5OTE5OCwzLjQgQzYuOTMzMTY1OTksMy40IDcuNCwzLjg2NjgzMDI3IDcuNCw0LjQgQzcuNCw0LjkzMzE2OTczIDYuOTMzMTY1OTksNS40IDYuMzk5OTkxOTgsNS40IEw2LjM5OTk5MTk4LDUuNCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNNC4zOTk2OTUzNSw4IEMzLjg2NjA3MTI2LDggMy40LDcuNTMyNjc0MzIgMy40LDcuMDAwMzEyNjcgQzMuNCw2LjQ2NjY4NDMgMy44NjYwNTUyMiw2IDQuMzk5Njc5MzEsNiBDNC45MzMzMDM0LDYgNS40LDYuNDY3MzI1NjggNS40LDcuMDAwMzEyNjcgQzUuNCw3LjUzMjA0ODk3IDQuOTMyNjc4MDYsOCA0LjM5OTY3OTMxLDggTDQuMzk5Njk1MzUsOCBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNUM1QzVDIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICA8cGF0aCBkPSJNOCwxLjUxNTc5MiBMNy45OTc5MzQ2NCwxLjUxNTc4NzczIEM2LjI3NjU5MjQ1LDEuNTA4Njc3MyA0LjYyMzY5ODUsMi4xODkzMzIyNiAzLjQwNjUxNTM4LDMuNDA2NTE1MzggQzIuMTg5MzMyMjYsNC42MjM2OTg1IDEuNTA4Njc3Myw2LjI3NjU5MjQ1IDEuNTE1NzkyLDggQzEuNTE1NzkyLDExLjYwMzQwNyA0LjM5NjU5MzA0LDE0LjQ4NDIwOCA4LDE0LjQ4NDIwOCBDOC4zNDQ5MjgzMiwxNC40ODQyMDggOC42NjM3OTIsMTQuMTY0OTI5IDguNjYzNzkyLDEzLjgyMDQxNiBDOC42NjM3OTIsMTMuNjIxMTM1IDguNjI1OTEzOTcsMTMuNTIyMDgyMSA4LjQ0MDU5MzI4LDEzLjMyMzgyIEM4LjE1NjA5Njg4LDEyLjkwMjM3NTEgOC4wNDMyOTMzMywxMi42NTgyNjg2IDguMDQzMjkzMzMsMTIuMjY4NDY5MyBDOC4wNDMyOTMzMywxMS4zNzA5NjM4IDguODEwNTc5NjUsMTAuNjA0NjU4NyA5LjcwNzA4NTMzLDEwLjYwNDY1ODcgTDExLjEwMzkxMiwxMC42MDQ2NTg3IEMxMy4wMDEyNjc3LDEwLjYwNDY1ODcgMTQuNDg0MjA4LDkuMTIxMTQzNjQgMTQuNDg0MjA4LDcuMjIzNjUzMzMgQzE0LjQ4NDIwOCw0LjA4NjM3MTgzIDExLjYwMzI5OTcsMS41MTU3OTIgOCwxLjUxNTc5MiBaIE04LjAwMTAzMjY4LDAuNTE1NzkyMDcxIEM4LjAwMTM3NjksMC41MTU3OTM0NDYgOC4wMDE3MjExMywwLjUxNTc5NDg0NCA4LjAwMjA2NTM2LDAuNTE1Nzk2MjY2IEw4LDAuNTE1NzkyIEM4LjAwMDM0NDI0LDAuNTE1NzkyIDguMDAwNjg4NDcsMC41MTU3OTIwMjEgOC4wMDEwMzI3LDAuNTE1NzkyMDYyIFoiIGlkPSLot6/lvoQiIHN0cm9rZT0iIzVDNUM1QyIgZmlsbC1ydWxlPSJub256ZXJvIj48L3BhdGg+CiAgICA8L2c+Cjwvc3ZnPg=="}}),i("span",{staticClass:"palette-text-font list-item-text"},[t._v("自定义颜色")]),i("img",{staticClass:"list-item-arrow",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNHB4IiBoZWlnaHQ9IjZweCIgdmlld0JveD0iMCAwIDQgNiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTIuNSAoNjc0NjkpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPgogICAgPHRpdGxlPueureWktDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSJQYWdlLTMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIG9wYWNpdHk9IjAuNDAwMDAwMDA2Ij4KICAgICAgICA8cGF0aCBkPSJNMy45MzU4Mzk2NSwzLjEyMjkwMzMxIEwwLjM3Mzk1MzkzNiw1Ljk0OTA5MTc4IEMwLjI4ODQwNjgsNi4wMTY5Njk0MSAwLjE0OTcwNzQ4OCw2LjAxNjk2OTQxIDAuMDY0MTYwMzUyLDUuOTQ5MDkxNzggQzAuMDIzMDc5MTY4NSw1LjkxNjQ5NTggMCw1Ljg3MjI4NjE2IDAsNS44MjYxODg0OCBMMCwwLjE3MzgxMTUyMiBDMCwwLjA3NzgxODA2OSAwLjA5ODA3NTIyNCwwIDAuMjE5MDU3MTQ0LDAgQzAuMjc3MTU0NzExLDAgMC4zMzI4NzI3NTIsMC4wMTgzMTIyMzI4IDAuMzczOTUzOTM2LDAuMDUwOTA4MjE2MSBMMy45MzU4Mzk2NSwyLjg3NzA5NjY5IEM0LjAyMTM4Njc4LDIuOTQ0OTc0MzIgNC4wMjEzODY3OCwzLjA1NTAyNTY4IDMuOTM1ODM5NjUsMy4xMjI5MDMzMSBaIiBpZD0i566t5aS0IiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgIDwvZz4KPC9zdmc+"}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:t.showColorPicker,expression:"showColorPicker"}],staticClass:"chrome-picker",staticStyle:{padding:"10px 10px 0 10px"},attrs:{value:t.color},on:{input:t.updateValue}},[t._v(">")])],1)])])])},$d=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"line"})])}],Kd={methods:{updateValue:function(t){this.$emit("custom-color-change",t.hex)},onColorChange:function(t){this.$emit("color-change",t)},showPicker:function(){this.showColorPicker=!0},hidePicker:function(){this.showColorPicker=!1}},props:{historyColors:Array,color:String,x:{type:Number,default:0},y:{type:Number,default:0}},data:function(){return{standardColors:[{color:"#FFFFFF"},{color:"#000000"},{color:"#FF0000"},{color:"#FF9900"},{color:"#FFFF00"},{color:"#98FA1C"},{color:"#6CDEFF"},{color:"#403ED6"},{color:"#ED41FD"}],presetColors:[[{color:"#E9E9E9"},{color:"#7B7B7B"},{color:"#FFC8B8"},{color:"#FFE1B2"},{color:"#FFF2CC"},{color:"#D9EAD3"},{color:"#DFF8FF"},{color:"#CFC7F4"},{color:"#FEE4FF"}],[{color:"#D9D9D9"},{color:"#5c5c5c"},{color:"#E99899"},{color:"#FFB84D"},{color:"#FFE59A"},{color:"#ACDB7E"},{color:"#85D4E6"},{color:"#8C7BE8"},{color:"#EE93F6"}],[{color:"#C4C4C4"},{color:"#333333"},{color:"#E06666"},{color:"#FB8D00"},{color:"#FFD966"},{color:"#87C120"},{color:"#4CC2EE"},{color:"#3F49B9"},{color:"#D041E1"}],[{color:"#9D9D9D"},{color:"#262626"},{color:"#CC0000"},{color:"#E75200"},{color:"#FFB700"},{color:"#678F00"},{color:"#0188FB"},{color:"#2741B1"},{color:"#A419D3"}]],showColorPicker:!1}},components:{"chrome-picker":W["Chrome"]}},qd=Kd,tu=(i("a2b5"),Object(c["a"])(qd,Jd,$d,!1,null,"4945d8bc",null)),eu=tu.exports,iu={data:function(){return{state:this.$parent.$parent.useCaseStore.state}},components:{ColorPicker:eu,Comment:Comment},mounted:function(){this.useCaseStore=this.$parent.$parent.useCaseStore},methods:{removeComment:function(t){deleteComment({systemId:this.useCaseStore.diagramUUId,subSystemId:t.subSystemId,detailId:t.id,systemType:3})},like:function(t){likeComment({systemId:this.useCaseStore.diagramUUId,subSystemId:t.subSystemId,detailId:t.id,systemType:3})},selectComponent:function(t){this.useCaseStore.selectObjectById(t)},unlike:function(t){cancelLikeComment({systemId:this.useCaseStore.diagramUUId,subSystemId:t.subSystemId,detailId:t.id,systemType:3})},reply:function(t,e,i){var o=this,n=e,a="";0===e.indexOf("@")&&(n=e.split(" ")[1],a=e.split(" ")[0].replace("@","")),addComment({systemId:this.useCaseStore.diagramUUId,subSystemId:i,systemType:3,content:n,replyDetailId:t,replyTo:a}).then((function(){o.useCaseStore.syncServerComment()}))},formatTime:function(t){return Bd(t,{source:"string"})},save:function(){this.useCaseStore.refreshData()},clearUnUseMsg:function(t){for(var e=function(e,n){var a=t.msgList[e];t.lifelineList.find((function(t){return t.id===a.from}))&&t.lifelineList.find((function(t){return t.id===a.to}))||(t.msgList.splice(e,1),e--,n--),i=e,o=n},i=0,o=t.msgList.length;i<o;i++)e(i,o)},deleteDefaultColor:function(t){for(var e=0,i=t.lifelineList.length;e<i;e++){var o=t.lifelineList[e];"#faecd8"===o.color&&delete o.color}},closeRevision:function(){this.useCaseStore.closeRevision()},openRevision:function(t){this.useCaseStore.state.currentRevisionId=t.RevisionUUId,this.useCaseStore.state.currentRevision=t;try{var e=JSON.parse(t.ExtendJSONData);this.useCaseStore.DiagramConfig.FILL_COLOR=e.themeColor||"#faecd8",this.useCaseStore.state.historyColors[0]=this.useCaseStore.DiagramConfig.FILL_COLOR,this.useCaseStore.updateData(e)}catch(i){this.useCaseStore.updateData()}},onTabClick:function(){this.useCaseStore.syncServerComment()}},beforeDestroy:function(){}},ou=iu,nu=(i("117d"),Object(c["a"])(ou,Wd,Xd,!1,null,"a801fa30",null)),au=nu.exports,su=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"操作帮助"}},[i("ul",{staticClass:"help-list"},[i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么添加元素","https://wx.gtimg.com/resource/feuploader/202109/4b956f0a6f415832867fc6cbba43932f_1250x1232.gif","500px")}}},[t._v("怎么添加元素")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么修改元素名称","https://wx.gtimg.com/resource/feuploader/202109/337cd622a751fdb0716580272aa25197_1250x1232.gif","500px")}}},[t._v("怎么修改元素名称")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么编辑关系属性","https://wx.gtimg.com/resource/feuploader/202109/4295fce31a2b92fcfb48a2649645511f_1250x1232.gif","500px")}}},[t._v("怎么编辑关系属性")])],1),i("li",[i("el-link",{on:{click:function(e){return t.showDialog("怎么修改边界位置和大小","https://wx.gtimg.com/resource/feuploader/202109/5ee228453b982d8908ee84e9e121e327_1250x1232.gif","500px")}}},[t._v("怎么修改边界位置和大小")])],1)])])],1),i("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:t.width},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{src:this.gifUrl,width:"100%"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("学会了")])],1)]),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202105/422bd87e6ddc3d25ba8758451cdd9bed_721x629.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202105/2b82ed915d7bdd01c381d4f60020d023_754x620.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202105/0ad28f88a3a1d60497ff120a68f3d41f_754x620.gif"}}),i("img",{staticStyle:{display:"none"},attrs:{src:"https://wx.gtimg.com/resource/feuploader/202105/3df4f228d0bbd901f3f80cfa8bc3d096_754x620.gif"}})],1)},ru=[],cu={data:function(){return{title:"",dialogVisible:!1,gifUrl:"",width:"800px"}},methods:{showDialog:function(t,e,i){this.width=i,this.dialogVisible=!0,this.title=t,this.gifUrl=e}}},lu=cu,du=(i("8252"),Object(c["a"])(lu,su,ru,!1,null,"6f2581e1",null)),uu=du.exports,hu={props:{menus:Array},components:{DiagramPropsPanel:au,HelpPanel:uu},data:function(){return{state:this.$parent.useCaseStore.state,isClosed:!1}},methods:{toggle:function(){this.isClosed=!this.isClosed}},mounted:function(){var t=this;this.useCaseStore=this.$parent.useCaseStore,this.useCaseStore.openRightPanel=function(){t.isClosed=!1},this.useCaseStore.closeRightPanel=function(){t.isClosed=!0}}},fu=hu,gu=(i("386f"),Object(c["a"])(fu,Vd,Qd,!1,null,"01b87840",null)),pu=gu.exports,mu=function(){function t(){Object(M["a"])(this,t),this.undoStack=[],this.redoStack=[],this.undoIndex=0,this.redoIndex=0}return Object(k["a"])(t,[{key:"reset",value:function(){this.undoStack.length=0,this.redoStack.length=0,this.undoIndex=0,this.redoIndex=0}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}]),t}(),yu=function(){function t(e){var i=this;Object(M["a"])(this,t),this.undoRedo=new mu,this.useCaseStore=e,this.lockUndoRodoStack=!1,keyboardJS.bind(["command > z","ctrl > z"],(function(t){i.undo(),t.preventDefault()})),keyboardJS.bind(["ctrl + shift > z","command + shift > z","command > y","ctrl > y"],(function(t){i.redo(),t.preventDefault()})),keyboardJS.bind(["command > s","ctrl > s"],(function(t){t.preventDefault()}))}return Object(k["a"])(t,[{key:"emit",value:function(t){for(var e,i,o,n,a,s,r,c,l,d,u,h,f,g,p,m,y,v,w,x,C,b,I=arguments.length,M=new Array(I>1?I-1:0),k=1;k<I;k++)M[k-1]=arguments[k];switch(t){case Pd.REVERSE_RELATION:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.REVERSE_RELATION,payload:M}),this.updateUndoRedo(t,M)),(e=this.useCaseStore).reverseRelation.apply(e,M);break;case Pd.ADD_ELEMENT:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.DELETE_ELEMENT,payload:[M[0].id,M[1]]}),this.updateUndoRedo(t,M)),(i=this.useCaseStore).addElement.apply(i,M);break;case Pd.DELETE_ELEMENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var S=this.useCaseStore.getDataById(M[0]);this.undoRedo.undoStack.push({actionType:Pd.ADD_ELEMENT,payload:[S]}),this.updateUndoRedo(t,M)}(o=this.useCaseStore).deleteElement.apply(o,M);break;case Pd.DELETE_ACTOR:if(!this.lockUndoRodoStack){this.resetUndoRedo();var D=this.useCaseStore.baseData.actors.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.ADD_ELEMENT,payload:[D,M[1]]}),this.updateUndoRedo(t,M)}(n=this.useCaseStore).deleteActor.apply(n,M);break;case Pd.DELETE_USECASE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var N=this.useCaseStore.baseData.useCases.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.ADD_USECASE,payload:[N,M[1]]}),this.updateUndoRedo(t,M)}(a=this.useCaseStore).deleteUseCase.apply(a,M);break;case Pd.MODIFY_ELEMENT_LABEL:if(!this.lockUndoRodoStack){this.resetUndoRedo();var A=this.useCaseStore.getDataById(M[0]);this.undoRedo.undoStack.push({actionType:Pd.MODIFY_ELEMENT_LABEL,payload:[A.id,A.text]}),this.updateUndoRedo(t,M)}(s=this.useCaseStore).updateElementLabel.apply(s,M);break;case Pd.ADD_RELATION:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.DELETE_RELATION,payload:[M[0].id]}),this.updateUndoRedo(t,M)),(r=this.useCaseStore).createRelation.apply(r,M);break;case Pd.DELETE_RELATION:if(!this.lockUndoRodoStack){this.resetUndoRedo();var L=this.useCaseStore.baseData.lines.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.ADD_RELATION,payload:[L]}),this.updateUndoRedo(t,M)}(c=this.useCaseStore).deleteRelation.apply(c,M);break;case Pd.MODIFY_MSG_NAME:if(!this.lockUndoRodoStack){this.resetUndoRedo();var T=this.useCaseStore.baseData.msgList.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.MODIFY_MSG_NAME,payload:[T.id,T.text]}),this.updateUndoRedo(t,M)}(l=this.useCaseStore).updateMsgContentAndArgs.apply(l,M);break;case Pd.MOVE_NODE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var E=this.useCaseStore.getLifelineById(M[0]);this.undoRedo.undoStack.push({actionType:Pd.MOVE_NODE,payload:[E.id,M[3],M[4],E.position.x,E.position.y,E.itemType]}),this.updateUndoRedo(t,M)}switch(M[5]){case"useCase":(d=this.useCaseStore).updateUseCasePosition.apply(d,M);break;case"actor":(u=this.useCaseStore).updateActorPosition.apply(u,M)}break;case Pd.MOVE_MSG:if(!this.lockUndoRodoStack){this.resetUndoRedo();var O=this.useCaseStore.baseData.msgList.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.MOVE_MSG,payload:[O.id,O.time]}),this.updateUndoRedo(t,M)}(h=this.useCaseStore).updateArrowTime.apply(h,M);break;case Pd.ADD_BOUNDARY:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.DELETE_BOUNDARY,payload:[M[0].id,M[1]]}),this.updateUndoRedo(t,M)),(f=this.useCaseStore).createBoundary.apply(f,M);break;case Pd.DELETE_BOUNDARY:if(!this.lockUndoRodoStack){this.resetUndoRedo();var j=this.useCaseStore.baseData.scopes.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.ADD_BOUNDARY,payload:[j]}),this.updateUndoRedo(t,M)}(g=this.useCaseStore).deleteBoundary.apply(g,M);break;case Pd.MODIFY_BOUNDARY_RECT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var P=this.useCaseStore.baseData.scopes.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.MODIFY_BOUNDARY_RECT,payload:[P.id,P.position.x,P.position.y,P.size.width,P.size.height]}),this.updateUndoRedo(t,M)}(p=this.useCaseStore).updateBoundaryBox.apply(p,M);break;case Pd.CHANGE_LIFELINE_TYPE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var z=this.useCaseStore.baseData.lifelineList.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.CHANGE_LIFELINE_TYPE,payload:[z.id,z.type]}),this.updateUndoRedo(t,M)}(m=this.useCaseStore).changeLifelineType.apply(m,M);break;case Pd.ADD_NOTE:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.DELETE_NOTE,payload:[M[0].id]}),this.updateUndoRedo(t,M)),(y=this.useCaseStore).addNote.apply(y,M);break;case Pd.DELETE_NOTE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var R=this.useCaseStore.baseData.noteList.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.ADD_NOTE,payload:[R,M[1]]}),this.updateUndoRedo(t,M)}(v=this.useCaseStore).deleteNote.apply(v,M);break;case Pd.MOVE_NOTE:if(!this.lockUndoRodoStack){this.resetUndoRedo();var B=this.useCaseStore.baseData.noteList.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.MOVE_NOTE,payload:[B.id,B.x,B.y]}),this.updateUndoRedo(t,M)}(w=this.useCaseStore).updateNotePosition.apply(w,M);break;case Pd.MODIFY_NOTE_CONTENT:if(!this.lockUndoRodoStack){this.resetUndoRedo();var G=this.useCaseStore.baseData.noteList.find((function(t){return t.id===M[0]}));this.undoRedo.undoStack.push({actionType:Pd.MODIFY_NOTE_CONTENT,payload:[G.id,G.text]}),this.updateUndoRedo(t,M)}(x=this.useCaseStore).updateNoteContent.apply(x,M);break;case Pd.ADD_NOTE_CONN:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.DELETE_NOTE_CONN,payload:M}),this.updateUndoRedo(t,M)),(C=this.useCaseStore).addNoteConn.apply(C,M);break;case Pd.DELETE_NOTE_CONN:this.lockUndoRodoStack||(this.resetUndoRedo(),this.undoRedo.undoStack.push({actionType:Pd.ADD_NOTE_CONN,payload:M}),this.updateUndoRedo(t,M)),(b=this.useCaseStore).deleteNoteConn.apply(b,M);break}}},{key:"resetUndoRedo",value:function(){this.undoRedo.undoIndex+1<this.undoRedo.undoStack.length&&(this.undoRedo.undoStack.length=this.undoRedo.undoIndex+1,this.undoRedo.redoStack.length=this.undoRedo.undoStack.length)}},{key:"updateUndoRedo",value:function(t,e){this.undoRedo.redoStack.push({actionType:t,payload:e}),this.undoRedo.undoIndex=this.undoRedo.undoStack.length-1,this.undoRedo.redoStack.length=this.undoRedo.undoStack.length,this.undoRedo.redoIndex=this.undoRedo.undoIndex+1,this.updateButton()}},{key:"updateButton",value:function(){this.undoRedo.undoStack.length>0&&this.undoRedo.undoIndex>-1?this.useCaseStore.state.isUndoDisabled=!1:this.useCaseStore.state.isUndoDisabled=!0,this.undoRedo.redoStack.length>0&&this.undoRedo.redoIndex>-1&&this.undoRedo.redoIndex<this.undoRedo.redoStack.length?this.useCaseStore.state.isRedoDisabled=!1:this.useCaseStore.state.isRedoDisabled=!0}},{key:"undo",value:function(){if(!this.useCaseStore.state.isUndoDisabled){var t=this.undoRedo.undoStack[this.undoRedo.undoIndex];this.undoRedo.redoIndex=this.undoRedo.undoIndex,this.undoRedo.undoIndex--,this.lockUndoRodoStack=!0,this.emit.apply(this,[t.actionType].concat(Object(I["a"])(t.payload))),this.lockUndoRodoStack=!1,this.updateButton()}}},{key:"redo",value:function(){if(!this.useCaseStore.state.isRedoDisabled){var t=this.undoRedo.redoStack[this.undoRedo.redoIndex];this.undoRedo.redoIndex++,this.undoRedo.undoIndex++,this.lockUndoRodoStack=!0,this.emit.apply(this,[t.actionType].concat(Object(I["a"])(t.payload))),this.lockUndoRodoStack=!1,this.updateButton()}}}]),t}(),vu=yu;function wu(t){var e=xu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function xu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Cu=document.createElement("textarea");function bu(t){if(document.selection){var e=document.body.createTextRange();e.moveToElementText(t),e.select()}else if(window.getSelection){e=document.createRange();e.selectNodeContents(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)}}Cu.style.cssText="\n  outline: none;\n  border: 1px solid rgb(204, 204, 204);\n\nword-break:break-all;\n\n  background: white;\n  position: absolute;\n  background:white;",Cu.setAttribute("contenteditable","true"),Cu.addEventListener("focus",(function(){bu(Cu)})),document.body.appendChild(Cu),Cu.style.position="absolute",Cu.style.display="none";var Iu={onEnter:function(){},onBlur:function(){},text:""};Cu.addEventListener("keyup",(function(t){})),Cu.addEventListener("blur",(function(t){Cu.style.display="none",Iu.onBlur&&Iu.onBlur(Cu.value)}));var Mu=function(t){Object(L["a"])(i,t);var e=wu(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this);var n=t.width-t.padding.h-10,a=ku(t.text,"13px",n,2),s=new sving.MultilineText(a.map((function(t){return{text:t}})),t);return s.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize||"14px"}),s.x=t.padding.h/2,s.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",s.y=t.padding.v/2+10,s.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation(),Iu.onDblClick&&Iu.onDblClick()})),o.add(s),s.cursor="pointer",o.options=t,o.text=s,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;Iu.text=t.text,Iu.onEnter=t.onEnter,Iu.onBlur=t.onBlur,Iu.onDblClick=t.onDblClick,setTimeout((function(){Cu.focus(),Cu.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);Cu.style.width=t.width+"px",Cu.style.height=t.height+"px",Cu.value=this.options.text,Cu.style.display="block",Cu.style.left=e.left-10+"px",Cu.style.top=e.top-18+"px"}},{key:"updateText",value:function(t){var e=this.options.width-this.options.padding.h-10;this.options.text=t;var i=ku(t,"13px",e,2);this.text.update(i.map((function(t){return{text:t}}))),this.text.y=this.options.padding.v/2+10}}]),i}(sving.Group);function ku(t,e,i,o){var n=t.split(/[\r\n]/),a=[];return n.forEach((function(t,n){var s=Su(t,e,i,o);s.forEach((function(t){a.push(t)}))})),a}function Su(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;for(var s,r=t.split(""),c="",l="",d=[],u=0;u<r.length;u++)l=c+r[u],a.textContent=l,s=a.getBBox().width,s+2*o>i?(d.push(l),l="",c=""):c=l,u===r.length-1&&d.push(l);return document.body.removeChild(n),d}function Du(t){var e=Nu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Nu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Au=function(t){Object(L["a"])(i,t);var e=Du(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="note",o.width=t.width,o.height=t.height,o.id=t.id,o.frontPlane=new sving.Path("M0 0 L".concat(o.width-15," 0  L").concat(o.width," 15  L ").concat(o.width," ").concat(o.height," L 0 ").concat(o.height," Z")),o.frontIcon=new sving.Path("M".concat(o.width-15," 0  L").concat(o.width," 15  L ").concat(o.width-15," 15 Z")),o.frontIcon.setAttrs({stroke:"#303D4E",fill:"#eee","stroke-width":1,"stroke-linejoin":"round"}),o.frontPlane.setAttrs({stroke:"#303D4E",fill:"white","stroke-width":1,"stroke-linejoin":"round"}),o.selectGroup=new sving.Group,o.selectBorder=new sving.Rect(o.width,o.height),o.selectBorder.setAttrs({stroke:"#5AB3EC",fill:"transparent","stroke-width":2,"stroke-dasharray":"4,4"}),o.cursor="move",o.selectGroup.add(o.selectBorder);var n=new sving.Group;""===t.text.trim()&&(t.text="　　　　　");var a,s,r=new Mu({text:t.text,font:"13px Helvetica",fill:"black",padding:{h:10,v:10},width:o.width,height:o.height,textAnchor:"start",lineHeight:15,onBlur:function(e){o.updateText(e),t.onTextChange&&t.onTextChange(e)},onDblClick:function(){}});o.textContent=t.text,r.onDragStart((function(e){a=e.clientX,s=e.clientY,e.stopPropagation(),t.onDragStart&&t.onDragStart()})),r.onDrag((function(e,i,n){o.x+=e,o.y+=i,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,t.onDrag&&t.onDrag(e,i,Object(vt["a"])(o))})),r.onDragEnd((function(e){(Math.abs(e.clientX-a)>10||Math.abs(e.clientY-s)>10)&&t.onDragEnd&&t.onDragEnd()})),r.x=5,r.y=15;var c="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";return o.controlPoint=new sving.Img(c),o.controlPoint.setAttrs({width:18,height:18}),o.controlPoint.x=o.width-10,o.controlPoint.y=o.height-10,o.controlPoint.cursor="nwse-resize",o.controlPoint.onDrag((function(e,i){o.controlPoint.x+=e,o.controlPoint.y+=i,o.width+=e,o.height+=i,o.width<30&&(o.width=30),o.height<30&&(o.height=30),t.onResize&&t.onResize(o.width,o.height),o.resize(o.width,o.height)})),o.controlPoint.onDragEnd((function(){t.onResizeEnd&&t.onResizeEnd()})),o.selectGroup.add(o.controlPoint),o.cube=new sving.Group,o.cube.add(o.frontPlane),o.cube.add(o.frontIcon),n.add(o.cube),n.add(o.selectGroup),o.add(n),o.selectBorder.setAttrs({"pointer-events":"none"}),o.cube.onDrag((function(e,i){o.x+=e,o.y+=i,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,t.onDrag&&t.onDrag(e,i,Object(vt["a"])(o))})),o.cube.onDragStart((function(e){a=e.clientX,s=e.clientY,e.stopPropagation(),t.onDragStart&&t.onDragStart()})),o.cube.onDragEnd((function(e){(Math.abs(e.clientX-a)>10||Math.abs(e.clientY-s)>10)&&t.onDragEnd&&t.onDragEnd()})),o.cube.on("click",(function(e){t.onClick&&t.onClick(e),o.select(),e.stopPropagation()})),o.on("mousedown",(function(t){t.stopPropagation()})),o.cube.on("mousedown",(function(e){t.onMouseDown&&t.onMouseDown(e),e.stopPropagation()})),n.on("mouseover",(function(){t.onMouseOver&&t.onMouseOver()})),n.on("mouseout",(function(){t.onMouseOut&&t.onMouseOut()})),n.on("mouseup",(function(e){t.onMouseUp&&t.onMouseUp(e)})),n.add(r),o.x=t.x,o.y=t.y,o.selectGroup.opacity=0,o.editableText=r,o.centerX=o.x+o.width/2,o.centerY=o.y+o.height/2,o.on("contextmenu",(function(e){useCaseDiagram.selectNoteById(o.id),e.preventDefault(),t.onContextMenu&&t.onContextMenu(Object(vt["a"])(o)),window.contextMenu({items:[{label:"删除",onClick:function(){t.onRemove&&t.onRemove(Object(vt["a"])(o))}}],event:event,zIndex:1e3,minWidth:200})})),o}return Object(k["a"])(i,[{key:"updateText",value:function(t){this.textContent!==t&&(this.textContent=t,this.editableText.updateText(t))}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.controlPoint.x=this.width-10,this.controlPoint.y=this.height-10,this.centerX=this.x+this.width/2,this.centerY=this.y+this.height/2,this.selectBorder.setAttrs({width:this.width,height:this.height}),this.frontIcon.setAttrs({d:"M".concat(this.width-15," 0  L").concat(this.width," 15  L ").concat(this.width-15," 15 Z")}),this.frontPlane.setAttrs({d:"M0 0 L".concat(this.width-15," 0  L").concat(this.width," 15  L ").concat(this.width," ").concat(this.height," L 0 ").concat(this.height," Z")})}},{key:"select",value:function(){this.isSelected=!0,this.selectGroup.opacity=1}},{key:"toggleSelect",value:function(){0===this.selectGroup.opacity?this.select():this.unselect()}},{key:"unSelect",value:function(){this.isSelected=!1,this.selectGroup.opacity=0}}]),i}(sving.Group);var Lu=void 0;function Tu(t){var e=Eu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Eu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ou=document.createElement("textarea");Ou.setAttribute("rows",4),Ou.style.position="absolute",Ou.style.display="none",Ou.className="seq-mult-textarea",document.body.appendChild(Ou),Ou.addEventListener("keydown",(function(t){"Enter"==t.key&&t.preventDefault()}));var ju={onEnter:function(){},onBlur:function(){},text:""};Ou.addEventListener("keyup",(function(t){var e=t.ctrlKey||t.metaKey||t.altKey;if("Enter"==t.key&&e)return Ou.value=Ou.value+"\r\n",void t.preventDefault();"Enter"===t.key&&(Ou.style.display="none",Lu.text.textContent=Ou.value,ju.onEnter&&ju.onEnter(Ou.value),t.preventDefault()),"Escape"===t.key&&(Ou.style.display="none",Ou.value=ju.text),t.stopPropagation()})),Ou.addEventListener("blur",(function(t){Ou.style.display="none",ju.onBlur&&ju.onBlur(Ou.value)}));var Pu=function(t){Object(L["a"])(i,t);var e=Tu(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),t.fontSize=t.fontSize||"14px",t.textAnchor=t.textAnchor||"middle";var n=zu(t.text,t.fontSize,t.width,2);t.lineHeight=parseInt(t.fontSize);var a=new sving.MultilineText(n.map((function(t){return{text:t}})),t);return a.setAttrs({fill:t.fill,stroke:t.stroke,"font-size":t.fontSize,"text-anchor":t.textAnchor}),a.el.style.textShadow="white 2px 0 1px, white 0 2px 1px, white -2px 0 1px, white 0 -2px 1px",a.x=t.paddingH/2,t.y?a.y=t.y:(a.y=t.paddingV/2+5,n.length>1&&(a.y-=n.length/2*8)),a.on("dblclick",(function(t){o.focusAndSelect(),t.stopPropagation()})),o.add(a),a.cursor="pointer",o.options=t,o.text=a,o}return Object(k["a"])(i,[{key:"focusAndSelect",value:function(){var t=this.options;ju.text=t.text,ju.onEnter=t.onEnter,ju.onBlur=t.onBlur,setTimeout((function(){Ou.focus(),Ou.select()}),1);var e=this.text.el.getBoundingClientRect(this.text.el);Ou.style.width=e.width+40+"px",Ou.value=this.options.text,Ou.style.display="block",Ou.style.left=e.left-20+"px",Ou.style.top=e.top+"px"}},{key:"updateText",value:function(t){""===t.trim()&&(t="　　　　　　"),this.options.text=t;var e=zu(t,this.options.fontSize,this.options.width,2);this.text.update(e.map((function(t){return{text:t}}))),this.text.y=this.options.paddingV/2+5}},{key:"updateFontColor",value:function(t){this.text.setAttrs({fill:t})}},{key:"updateFontSize",value:function(t){this.text.setAttrs({"font-size":t}),this.options.fontSize=t;var e=zu(this.options.text,t,this.options.width,2);this.text.options.lineHeight=parseInt(t),this.text.update(e.map((function(t){return{text:t}}))),this.text.y=this.options.paddingV/2+5}}]),i}(sving.Group);function zu(t,e,i,o){var n=t.split(/[\r\n]/),a=[];return n.forEach((function(t,n){var s=Ru(t,e,i,o);s.forEach((function(t){a.push(t)}))})),a}function Ru(t,e,i,o){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(n),n.setAttribute("width",0),n.setAttribute("height",0),n.style.position="fixed",n.style.bottom=0,n.style.right=0,n.style.pointerEvents="none";var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.style.fontSize=e,n.appendChild(a),a.textContent=t;for(var s,r=t.split(""),c="",l="",d=[],u=0;u<r.length;u++)l=c+r[u],a.textContent=l,s=a.getBBox().width,s+2*o>i?(d.push(l),l="",c=""):c=l,u===r.length-1&&d.push(l);return document.body.removeChild(n),d}function Bu(t){var e=Gu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Gu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var _u=function(t){Object(L["a"])(i,t);var e=Bu(i);function i(t){var o;if(Object(M["a"])(this,i),o=e.call(this),o.type="useCase",o.id=t.id,o.on("mouseover",(function(e){t.onMouseOver&&t.onMouseOver(e,Object(vt["a"])(o))})),o.on("mouseout",(function(e){t.onMouseOut&&t.onMouseOut(e,Object(vt["a"])(o))})),o.selectBorder=new sving.Rect(140,80),o.selectBorder.setAttrs({fill:"transparent",stroke:"transparent","stroke-width":2,"stroke-dasharray":"5,5"}),o.boxWidth=140,o.on("click",(function(e){t.onClick&&t.onClick(e,t.id),o.select()})),o.add(o.selectBorder),o.rect=new sving.Rect(0,0),o.rect.setAttrs({fill:t.shapeColor||zd.FILL_COLOR,stroke:zd.STROKE_COLOR,rx:80,ry:80,height:80,width:o.boxWidth}),o.rect.originX=o.boxWidth/2,o.rect.originY=40,o.add(o.rect),"business"===t.itemShape){var n=new sving.Line(70,0,0,40);n.setAttrs({stroke:zd.STROKE_COLOR}),o.add(n)}o.rect.cursor="move",t.text=t.text.replace(/[\b]/g,""),""===t.text.trim()&&(t.text="　　　　　");var a=new Pu({text:t.text,font:t.font,fill:t.fontColor||zd.STROKE_COLOR,fontSize:t.fontSize||"14px",paddingH:0,paddingV:0,width:120,textAnchor:"middle",onBlur:function(e){t.text!==e&&t.onTextChange(t.id,e)},onEnter:function(e){t.text!==e&&t.onTextChange(t.id,e)}});return o.add(a),o.text=a,o.width=o.boxWidth,o.selectBorder.x=-o.boxWidth/2,o.selectBorder.y=-40,o}return Object(k["a"])(i,[{key:"selectByOthers",value:function(){}},{key:"select",value:function(){this.isSelected=!0,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unSelect",value:function(){this.isSelected=!1,this.selectBorder.setAttrs({fill:"transparent",stroke:"transparent"})}},{key:"targetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}},{key:"updateText",value:function(t){this.text.updateText(t)}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.rect.setAttrs({fill:t})}}]),i}(sving.Group);function Fu(t){var e=Uu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Uu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Zu={stroke:"#303D4E"},Yu=function(t){Object(L["a"])(i,t);var e=Fu(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="relation";var n=t.onClick,a=t.id,s=t.x1,r=t.y1,c=t.x2,l=t.y2,d=t.textContent,u=t.arrow,h=t.color,f=t.textColor,g=t.from,p=t.to;o.id=a,o.from=g,o.to=p,o.line=new sving.Line(s,r,c,l),o.eventLine=new sving.Line(s,r,c,l),o.eventLine.setAttrs({fill:"none",stroke:h,"stroke-width":10,visibility:"hidden","pointer-events":"stroke"}),o.add(o.eventLine),o.asyncArrow=new sving.Path("M 4.88 23 L -2.12 26.5 L -0.37 23 L -2.12 19.5 Z"),o.asyncArrow.originX=6,o.asyncArrow.originY=23,o.cursor="pointer",o.line.setAttrs({stroke:h||Zu.stroke,"pointer-events":"none"}),o.add(o.line),o.selectBorder=new sving.Line(s,r,c,l),o.selectBorder.setAttrs({fill:"transparent",stroke:"#5AB3EC","stroke-width":2,"points-event":"none","stroke-dasharray":"5,5"}),o.selectBorder.opacity=0,o.add(o.selectBorder),o.asyncArrow.x=c,o.asyncArrow.y=l,o.add(o.asyncArrow),2===u&&(o.asyncArrow.opacity=0),o.asyncArrow.setAttrs({fill:h||Zu.stroke,stroke:h||Zu.stroke}),o.line.setAttrs({});var m=Math.atan2(l-r,c-s);o.asyncArrow.rotation=180*m/Math.PI;var y=new Pu({text:d.replace(/[\b]/g,""),font:"13px Helvetica",fill:f||Zu.stroke,paddingH:0,paddingV:0,textAnchor:"middle",onBlur:function(t){},onEnter:function(t){}});return o.add(y),o.x1=s,o.x2=c,o.y1=r,o.y2=l,o.text=y,y.x=s+(c-s)/2,y.y=r+(l-r)/2,o.selectHandlerList=[],o.unSelectHandlerList=[],o.selected=!1,o.on("click",(function(t){o.selected=!0,n&&n(t,o.id),o.select()})),o}return Object(k["a"])(i,[{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){this.selected=!0,this.selectBorder.opacity=1}},{key:"unSelect",value:function(){this.selected=!1,this.selectBorder.opacity=0}},{key:"updatePosition",value:function(t){this.eventLine.setAttrs(t),this.selectBorder.setAttrs(t),this.line.setAttrs(t);var e=t.x1,i=t.x2,o=t.y1,n=t.y2;this.x1=e,this.x2=i,this.y1=o,this.y2=n,this.asyncArrow.x=i,this.asyncArrow.y=n;var a=Math.atan2(n-o,i-e);this.asyncArrow.rotation=180*a/Math.PI}},{key:"hideArrow",value:function(){this.asyncArrow.opacity=0}},{key:"showArrow",value:function(){this.asyncArrow.opacity=1}},{key:"reverse",value:function(){var t=this.x1,e=this.y1;this.x1=this.x2,this.y1=this.y2,this.x2=t,this.y2=e,this.asyncArrow.x=this.x2,this.asyncArrow.y=this.y2;var i=Math.atan2(this.y2-this.y1,this.x2-this.x1);this.asyncArrow.rotation=180*i/Math.PI}}]),i}(sving.Group);function Hu(t){var e=Vu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Vu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Qu=function(t){Object(L["a"])(i,t);var e=Hu(i);function i(t){var o;return Object(M["a"])(this,i),o=e.call(this),t=t||{},o.head=new sving.Ellipse(7.5,7.5),o.head.setAttrs({stroke:zd.STROKE_COLOR,fill:t.shapeColor||zd.FILL_COLOR}),o.body=new sving.Path("M 873 1298 L 873 1323 M 873 1303 L 858 1303 M 873 1303 L 888 1303 M 873 1323 L 858 1343 M 873 1323 L 888 1343"),o.head.x=-77,o.body.x=-950,o.body.y=-1290,o.body.setAttrs({stroke:zd.STROKE_COLOR}),o.add(o.head),o.add(o.body),o.scale=.9,t.isBus&&(o.line=new sving.Line(20,-2,11,7),o.line.x=-90,o.line.setAttrs({stroke:zd.STROKE_COLOR,fill:t.shapeColor||zd.FILL_COLOR}),o.add(o.line)),o}return Object(k["a"])(i,[{key:"setFillColor",value:function(t){this.head.setAttrs({fill:t})}},{key:"onSelect",value:function(t){this.selectHandlerList.push(t)}},{key:"onUnSelect",value:function(t){this.unSelectHandlerList.push(t)}},{key:"select",value:function(){var t=this;this.selected=!0,this.selectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=1}},{key:"unSelect",value:function(){var t=this;this.selected=!1,this.unSelectHandlerList.forEach((function(e){e.call(t)})),this.selectBorder.opacity=0}},{key:"updateXY",value:function(t){this.line.setAttrs(t),this.arrow.x=t.x2;var e=t.x1,i=t.x2,o=this.text,n=this.width;e>i?(this.arrow.rotation=180,this.arrow.y=this.y2-3.5+7,o.x=e-n/2-(e-i)/2,o.y=this.y1-3,this.arrow.x=i+10):(this.arrow.x=i-10,this.arrow.rotation=0,this.arrow.y=this.y2-3.5,o.x=e-n/2-(e-i)/2,o.y=this.y1-3)}}]),i}(sving.Group);function Wu(t){var e=Xu();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Xu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ju=function(t){Object(L["a"])(i,t);var e=Wu(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="actor",o.id=t.id,o.on("mouseover",(function(e){t.onMouseOver&&t.onMouseOver(e,Object(vt["a"])(o))})),o.on("mouseout",(function(e){t.onMouseOut&&t.onMouseOut(e,Object(vt["a"])(o))})),o.selectBorder=new sving.Rect(100,80),o.selectBorder.setAttrs({fill:"transparent",stroke:"transparent","stroke-width":2,"stroke-dasharray":"5,5"}),o.boxWidth=140,o.on("click",(function(e){t.onClick&&t.onClick(e,t.id),o.select()})),o.add(o.selectBorder);var n=t.paddingV||6;o.actor=new Qu(t),o.actor.y=-50,o.add(o.actor),o.actor.setAttr("pointer-events","bounding-box"),o.actor.cursor="move",t.text=t.text.replace(/[\b]/g,""),""===t.text.trim()&&(t.text="　　　　　");var a=new Pu({text:t.text,font:t.font,fill:t.fontColor||zd.STROKE_COLOR,fontSize:t.fontSize||"14px",width:80,paddingH:0,paddingV:n,textAnchor:"middle",onBlur:function(e){t.text!==e&&t.onTextChange(t.id,e)},onEnter:function(e){t.text!==e&&t.onTextChange(t.id,e)}});return o.add(a),o.text=a,o.width=o.boxWidth/2,o.selectBorder.setAttrs({width:o.width}),o.selectBorder.originX=35,o.selectBorder.originY=35,o.actor.x=o.width,o.actor.y+=25,a.y+=30,o}return Object(k["a"])(i,[{key:"selectByOthers",value:function(){}},{key:"select",value:function(){this.isSelected=!0,this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unSelect",value:function(){this.isSelected=!1,this.selectBorder.setAttrs({fill:"transparent",stroke:"transparent"})}},{key:"targetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"#5AB3EC"})}},{key:"unTargetIt",value:function(){this.selectBorder.setAttrs({fill:"white",stroke:"transparent"})}},{key:"updateText",value:function(t){this.text.updateText(t)}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.actor.head.setAttrs({fill:t})}}]),i}(sving.Group);function $u(t){var e=Ku();return function(){var i,o=Object(E["a"])(t);if(e){var n=Object(E["a"])(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return Object(T["a"])(this,i)}}function Ku(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}window.SvingActor=Ju;var qu=function(t){Object(L["a"])(i,t);var e=$u(i);function i(t){var o;Object(M["a"])(this,i),o=e.call(this),o.type="boundary",o.id=t.id,o.on("click",(function(e){t.onClick&&t.onClick(e,o.id)})),o.rect=new sving.Rect(t.width,t.height),o.rect.setAttrs({fill:"rgba(236,245,255, 0.3)",stroke:zd.STROKE_COLOR,rx:4,ry:4}),o.add(o.rect),o.eventRect=new sving.Rect(t.width,t.height),o.eventRect.setAttrs({fill:"none",stroke:"black","stroke-width":9,visibility:"hidden","pointer-events":"fill"}),o.eventRect.onDrag((function(t,e,i){o.x+=t,o.y+=e,i.preventDefault()})),o.eventRect.onDragStart((function(){o._prevX=o.x,o._prevY=o.y})),o.eventRect.onDragEnd((function(t,e){o._prevX===o.x&&o._prevY===o.y||o.options.onBoxChanged(o.id,o.x,o.y,o.width,o.height)})),o.eventRect.cursor="move",o.add(o.eventRect),o.rect.el.style.pointerEvents="none";var n=new Pu({text:t.text?t.text:"",font:"15px Helvetica",fill:t.textColor||zd.STROKE_COLOR,paddingH:10,paddingV:25,width:t.width,fontSize:t.fontSize||"14px",textAnchor:"middle",onBlur:function(e){t.onTextChange&&t.onTextChange(t.id,e)},onEnter:function(e){t.onTextChange&&t.onTextChange(t.id,e)}});n.cursor="move",o.width=t.width,o.height=t.height,o.add(n),o.selectBorder=new sving.Rect(t.width,t.height),o.selectBorder.setAttrs({fill:"transparent",stroke:"#ccc","stroke-width":2,"stroke-dasharray":"5,5"}),o.selectBorder.opacity=0,o.selectBorder.el.style.pointerEvents="none",o.add(o.selectBorder);var a="data: image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZlcnNpb249IjEuMSI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjUiIHN0cm9rZT0iI2ZmZiIgZmlsbD0iIzI5YjZmMiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+";return o.controlPointA=new sving.Img(a),o.controlPointB=new sving.Img(a),o.controlPointC=new sving.Img(a),o.controlPointD=new sving.Img(a),o.controlPointA.cursor="move",o.controlPointB.cursor="move",o.controlPointC.cursor="nwse-resize",o.controlPointD.cursor="move",o.controlPointA.originX=9,o.controlPointA.originY=9,o.controlPointB.originX=9,o.controlPointB.originY=9,o.controlPointC.originX=9,o.controlPointC.originY=9,o.controlPointD.originX=9,o.controlPointD.originY=9,o.controlPointA.opacity=0,o.controlPointB.opacity=0,o.controlPointC.opacity=0,o.controlPointD.opacity=0,o.add(o.controlPointA),o.add(o.controlPointB),o.add(o.controlPointC),o.add(o.controlPointD),o.controlPointC.onDrag((function(t,e){o.controlPointC.x<o.controlPointA.x+150?o.controlPointC.x=o.controlPointA.x+150:o.controlPointC.y<o.controlPointA.y+100?o.controlPointC.y=o.controlPointA.y+100:(o.controlPointC.x+=t,o.controlPointC.y+=e),o.controlPointB.x=o.controlPointC.x,o.controlPointD.y=o.controlPointC.y,o.updateBox(o.x,o.y,o.controlPointC.x-o.controlPointA.x,o.controlPointC.y-o.controlPointA.y)})),o.controlPointC.onDragEnd((function(){o.options.onBoxChanged(o.id,o.x,o.y,o.width,o.height)})),o.text=n,n.x=t.width/2,o.controlPointB.x=t.width,o.controlPointC.x=t.width,o.controlPointC.y=t.height,o.controlPointD.y=t.height,o.options=t,o}return Object(k["a"])(i,[{key:"updateBox",value:function(t,e,i,o){this.rect.setAttrs({width:i,height:o}),this.selectBorder.setAttrs({width:i,height:o}),this.eventRect.setAttrs({width:i,height:o}),this.x=t,this.y=e,this.width=i,this.height=o,this.controlPointC.x=i,this.controlPointC.y=o,this.text.x=i/2}},{key:"select",value:function(){this.selectBorder.opacity=1,this.selectBorder.setAttrs({fill:"transparent",stroke:"#5AB3EC"}),this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=1,this.controlPointD.opacity=0}},{key:"unSelect",value:function(){this.selectBorder.opacity=0,this.controlPointA.opacity=0,this.controlPointB.opacity=0,this.controlPointC.opacity=0,this.controlPointD.opacity=0}},{key:"updateText",value:function(t){this.text.updateText(t)}},{key:"updateFontColor",value:function(t){this.text.updateFontColor(t)}},{key:"updateFontSize",value:function(t){this.text.updateFontSize(t)}},{key:"updateShapeColor",value:function(t){this.actor.head.setAttrs({fill:t})}}]),i}(sving.Group);window.SvingBoundary=qu;var th=function(){function t(e){var i=this;Object(M["a"])(this,t),this.data=e.data,this.actionCenter=e.actionCenter,this.size=this.getDataContentSize(),this.options=e,this.svingNodeMap={},setTimeout((function(){i.initStage(),i.bindEvent(),i.init()}),100)}return Object(k["a"])(t,[{key:"recycle",value:function(){this.stage.clear(),this.stage.el.parentNode.removeChild(this.stage.el)}},{key:"init",value:function(){this.initFragmentGroup(),this.initNodeGroup(),this.initLinkLine(),this.initConnectLine(),this.initNoteArrow(),this.initArrow(),this.renderActor(),this.renderUseCase(),this.renderMsg(),this.renderBoundary()}},{key:"createActor",value:function(t){var e,i,o=this,n=t.text,a=new Ju({id:t.id,text:n,type:"Actor",fontSize:t.fontSize,shapeColor:t.shapeColor,fontColor:t.fontColor,isBus:"business"===t.itemShape,onClick:function(t,e){o.selectElementById(e),t.stopPropagation()},onMouseOut:function(){o.mouseOverGroup=null},onMouseOver:function(){o.mouseOverGroup=a,o.isDraggingArrow||(o.dragFromId=a.id,o.arrow.opacity=1,o.arrow.x=a.x+a.width/2,o.arrow.y=a.y)},onTextChange:function(t,e){o.options.onActorLabelChanged(t,e)}});for(var s in a.x=t.position.x,a.y=t.position.y,a.on("dblclick",(function(){o.options.onElementDblClick()})),a.on("contextmenu",(function(e){o.options.onElementContextMenu(t,e),e.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){o.options.onElementDeleted(t.id,"actor")}}],x:e.clientX,y:e.clientY,minWidth:214})})),a.baseData=t,t.svingNode=a,this.svingNodeGroup.add(a),a.onDragStart((function(n){e=a.x,i=a.y,o.selectElementById(t.id)})),a.onDrag((function(e,i,n){a.x+=e,a.y+=i,a.y<40&&(a.y=40),a.x<40&&(a.x=40),t.position.x=a.x,t.position.y=a.y,o._fitRelation(t),n.preventDefault()})),a.onDragEnd((function(t){o.options.onActorMoved(t,a,e,i)})),this.svingNodeMap[t.id]=a,this.svingNodeMap)this.svingNodeMap[s].from!==t.id&&this.svingNodeMap[s].to!==t.id||(this.svingNodeMap[s].opacity=1)}},{key:"createUseCase",value:function(t){var e,i,o=this,n=new _u({id:t.id,text:t.text,fontSize:t.fontSize,shapeColor:t.shapeColor,fontColor:t.fontColor,itemShape:t.itemShape,onClick:function(t,e){o.selectElementById(e),t.stopPropagation()},onMouseOut:function(){o.mouseOverGroup=null},onMouseOver:function(){o.mouseOverGroup=n,o.isDraggingArrow||(o.dragFromId=n.id,o.arrow.opacity=1,o.arrow.x=n.x+n.width/2+20,o.arrow.y=n.y)},onTextChange:function(t,e){o.options.onUseCaseLabelChanged(t,e)}});for(var a in n.x=t.position.x,n.y=t.position.y,n.on("contextmenu",(function(e){o.options.onElementContextMenu(t,e),e.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){o.options.onElementDeleted(t.id,"useCase")}}],x:e.clientX,y:e.clientY,minWidth:214})})),n.baseData=t,this.svingNodeGroup.add(n),n.onDragStart((function(a){e=n.x,i=n.y,o.selectElementById(t.id)})),n.onDrag((function(e,i,a){n.x+=e,n.y+=i,n.x<70&&(n.x=70),n.y<40&&(n.y=40),t.position.x=n.x,t.position.y=n.y,o._fitRelation(t),a.preventDefault()})),n.onDragEnd((function(t){o.options.onUseCaseMoved(t,n,e,i)})),t.svingNode=n,n.baseData=t,this.svingNodeMap[t.id]=n,this.svingNodeMap)this.svingNodeMap[a].from!==t.id&&this.svingNodeMap[a].to!==t.id||(this.svingNodeMap[a].opacity=1)}},{key:"_calcLinePointsV2",value:function(t,e,i,o,n,a,s,r){var c=Fd(t,e,n,a,t-i/2,e-o/2,i,o,{}),l=Fd(t,e,n,a,n-s/2,a-r/2,s,r,{});if(c&&l)return{x1:c.x,y1:c.y,x2:l.x,y2:l.y}}},{key:"reverseRelation",value:function(t){var e=this.data.lines.find((function(e){return e.id===t})),i=e.from;e.from=e.to,e.to=i,this.svingNodeMap[t].reverse()}},{key:"hideRelationArrow",value:function(t){var e=this.data.lines.find((function(e){return e.id===t}));e.arrow=2,this.svingNodeMap[t].hideArrow()}},{key:"showRelationArrow",value:function(t){var e=this.data.lines.find((function(e){return e.id===t}));e.arrow=1,this.svingNodeMap[t].showArrow()}},{key:"createRelation",value:function(t){var e=this,i=this.data,o=i.actors.find((function(e){return e.id===t.from}));o||(o=i.useCases.find((function(e){return e.id===t.from})));var n=i.actors.find((function(e){return e.id===t.to}));if(n||(n=i.useCases.find((function(e){return e.id===t.to}))),o&&n){var a,s="actor"===o.itemType?70:140,r=80,c="actor"===n.itemType?70:140,l=80,d=this._calcLinePointsV2(o.position.x,o.position.y,s,r,n.position.x,n.position.y,c,l),u=t.text;if(t.from!==t.to){a=new Yu({id:t.id,from:t.from,to:t.to,x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,textContent:u||"",type:t.type,arrow:t.arrow,color:t.arrowColor,textColor:t.textColor,fontSize:t.fontSize,onMouseOver:function(){e.overMsg=a},onMouseOut:function(){e.overMsg=null},onClick:function(t,i){e.selectElementById(i),t.stopPropagation()}}),a.linkData=t,a.cursor="pointer";var h=function(){e.selectElementById(t.id)};a.on("dblclick",(function(){e.options.onElementDblClick()}));var f=t.id;a.on("contextmenu",(function(i){h(),e.selectElementById(f),i.preventDefault();i.clientX,i.clientY;window.contextMenu({items:[{label:1===t.arrow?"隐藏箭头":"显示箭头",onClick:function(){2===t.arrow?e.showRelationArrow(f):e.hideRelationArrow(f)},divided:!0},{icon:t.isNewMessageGroup?"el-icon-check":"",label:"箭头反转",onClick:function(){e.actionCenter.emit(Pd.REVERSE_RELATION,f)},divided:!0},{label:"删除",onClick:function(){e.options.onElementDeleted(f,"relation")}}],x:i.clientX,y:i.clientY,minWidth:214})})),this.svingNodeGroup.add(a),t.svingArrow=a,this.svingNodeMap[f]=a}}}},{key:"createBoundary",value:function(t){var e=this,i=new qu({id:t.id,text:t.text,type:t.type,width:t.size.width,height:t.size.height,fontSize:t.fontSize,textColor:t.textColor,fillColor:t.color,onBoxChanged:function(t,i,o,n,a){e.options.onBoundaryBoxChanged(t,i,o,n,a)},onTextChange:function(t,i){e.options.onBoundaryLabelChanged(t,i)},onClick:function(t,i){e.selectElementById(i),t.stopPropagation()}}),o=function(){};i.on("click",(function(){o()})),i.on("dblclick",(function(){e.options.onElementDblClick()})),i.on("contextmenu",(function(i){o(),i.preventDefault(),window.contextMenu({items:[{label:"删除",onClick:function(){e.options.onElementDeleted(t.id,"boundary")}}],x:i.clientX,y:i.clientY,minWidth:214})})),i.x=t.position.x,i.y=t.position.y,this.fragmentSving.add(i),this.svingNodeMap[t.id]=i}},{key:"deleteActor",value:function(t){var e=this.data.actors.find((function(e){return e.id===t}));this.data.actors.splice(this.data.actors.indexOf(e),1),this._resetByDelete(t)}},{key:"deleteUseCase",value:function(t){var e=this.data.useCases.find((function(e){return e.id===t}));this.data.useCases.splice(this.data.useCases.indexOf(e),1),this._resetByDelete(t)}},{key:"_resetByDelete",value:function(t){var e=this.svingNodeMap[t];for(var i in e.destroy(),delete this.svingNodeMap[t],this.unSelectAll(),this.svingNodeMap)this.svingNodeMap[i].from!==t&&this.svingNodeMap[i].to!==t||(this.svingNodeMap[i].opacity=0)}},{key:"deleteRelation",value:function(t){var e=this.data.lines.find((function(e){return e.id===t}));this.data.lines.splice(this.data.lines.indexOf(e),1),this.svingNodeMap[t].destroy(),delete this.svingNodeMap[t],this.unSelectAll()}},{key:"deleteBoundary",value:function(t){var e=this.data.scopes.find((function(e){return e.id===t}));this.data.scopes.splice(this.data.scopes.indexOf(e),1),this.svingNodeMap[t].destroy(),delete this.svingNodeMap[t],this.unSelectAll()}},{key:"updateActorPosition",value:function(t,e,i){this.svingNodeMap[t].x=e,this.svingNodeMap[t].y=i;var o=this.getActorDataById(t);o.position.x=e,o.position.y=i,this._fitRelation(o)}},{key:"_fitRelation",value:function(t){var e=this,i=this.data.lines.filter((function(e){return e.from===t.id||e.to===t.id}));i.forEach((function(t){e.updateRelationPosition(t.id)}))}},{key:"getDataById",value:function(t){var e=this.data.actors.find((function(e){return e.id===t}));return e||(e=this.data.useCases.find((function(e){return e.id===t})),e||(e=this.data.lines.find((function(e){return e.id===t})),e||(e=this.data.scopes.find((function(e){return e.id===t})),e||void 0)))}},{key:"updateRelationPosition",value:function(t){var e=this.svingNodeMap[t];if(e){var i=this.data.lines.find((function(e){return e.id===t})),o=this.getDataById(i.from),n=this.getDataById(i.to);if(o&&n){var a="actor"===o.itemType?70:140,s=80,r="actor"===n.itemType?70:140,c=80,l=this._calcLinePointsV2(o.position.x,o.position.y,a,s,n.position.x,n.position.y,r,c);e.updatePosition(l)}}}},{key:"updateUseCasePosition",value:function(t,e,i){this.svingNodeMap[t].x=e,this.svingNodeMap[t].y=i;var o=this.getUseCaseDataById(t);o.position.x=e,o.position.y=i,this._fitRelation(o)}},{key:"getActorDataById",value:function(t){return this.data.actors.find((function(e){return e.id===t}))}},{key:"getUseCaseDataById",value:function(t){return this.data.useCases.find((function(e){return e.id===t}))}},{key:"unSelectAll",value:function(){for(var t in this.selectedId=null,this.arrow.opacity=0,this.svingNodeMap)this.svingNodeMap[t].unSelect()}},{key:"selectElementById",value:function(t){this.selectedId=t;var e=this.svingNodeMap[t];for(var i in"boundary"!==e.type&&"relation"!==e.type&&(this.arrow.opacity=1,this.arrow.x=e.x+e.width/2+("actor"===e.type?0:20),this.arrow.y=e.y),this.svingNodeMap)i===t?this.svingNodeMap[t].select():this.svingNodeMap[i].unSelect()}},{key:"updateBoundaryBox",value:function(t,e,i,o,n){var a=this.data.scopes.find((function(e){return e.id===t}));a.position.x=e,a.position.y=i,a.size.width=o,a.size.height=n,this.svingNodeMap[t].updateBox(e,i,o,n)}},{key:"updateActorLabel",value:function(t,e){var i=this.data.actors.find((function(e){return e.id===t}));i.text=e,this.svingNodeMap[t].updateText(e)}},{key:"updateUseCaseLabel",value:function(t,e){var i=this.data.useCases.find((function(e){return e.id===t}));i.text=e,this.svingNodeMap[t].updateText(e)}},{key:"updateBoundaryLabel",value:function(t,e){var i=this.data.scopes.find((function(e){return e.id===t}));i.text=e,this.svingNodeMap[t].updateText(e)}},{key:"updateRelationLabel",value:function(){}},{key:"updateRelationType",value:function(){}},{key:"updateRelationDirection",value:function(){}},{key:"initFragmentGroup",value:function(){if(this.fragmentSving)this.fragmentSving.clear();else{var t=new sving.Group;this.stage.add(t),t.on("click",(function(t){t.stopPropagation()})),this.fragmentSving=t}}},{key:"initNodeGroup",value:function(){this.svingNodeGroup=new sving.Group,this.stage.add(this.svingNodeGroup),this.svingNodeGroup.on("click",(function(t){t.stopPropagation()}))}},{key:"bindEvent",value:function(){var t=this;this.onStageMouseUp=this.onStageMouseUp.bind(this),this.stage.el.addEventListener("mouseup",this.onStageMouseUp),window.addEventListener("keyup",(function(e){if(8===e.keyCode||46===e.keyCode){var i=t.selectedId;i&&t.options.onElementDeleted(i,t.svingNodeMap[i].type)}})),window.addEventListener("mousemove",(function(e){if(t.clientRect=t.stage.el.getBoundingClientRect(),t.isDraggingArrow){var i=t.svingNodeMap[t.dragFromId];t.linkLine.opacity=1,t.linkLine.setAttrs({x1:i.x,y1:i.y,x2:e.pageX-t.clientRect.left,y2:e.pageY-t.clientRect.top}),t.mouseOverLifeline(t.mouseOverGroup),e.preventDefault()}}))}},{key:"mouseOverLifeline",value:function(t,e){if(t)for(var i in this.dragToId=t.id,this.svingNodeMap){var o=this.svingNodeMap[i];o.isSelected||(i===this.dragToId?o.targetIt&&o.targetIt(e):o.unTargetIt&&o.unTargetIt())}else for(var n in this.dragToId=null,this.svingNodeMap){var a=this.svingNodeMap[n];a.isSelected||a.unTargetIt&&a.unTargetIt()}}},{key:"onStageMouseUp",value:function(t){this.isDraggingArrow&&this.dragFromId&&this.dragToId&&this.dragFromId!==this.dragToId&&this.options.onRelationCreated(this.dragFromId,this.dragToId),this.linkLine.opacity=0,this.isDraggingArrow=!1,this.dragFromId=null,this.dragToId=null}},{key:"initArrow",value:function(){var t=this,e=new sving.Path("M479.046,283.925c-1.664-3.989-5.547-6.592-9.856-6.592H352.305V10.667C352.305,4.779,347.526,0,341.638,0H170.971 c-5.888,0-10.667,4.779-10.667,10.667v266.667H42.971c-4.309,0-8.192,2.603-9.856,6.571c-1.643,3.989-0.747,8.576,2.304,11.627 l212.8,213.504c2.005,2.005,4.715,3.136,7.552,3.136s5.547-1.131,7.552-3.115l213.419-213.504 C479.793,292.501,480.71,287.915,479.046,283.925z");e.scale=.03,e.rotation=180,e.setAttrs({fill:"white",stroke:"black","stroke-width":"15","pointer-events":"bounding-box"}),e.opacity=0,e.cursor="pointer",e.on("mousedown",(function(i){e.opacity=0,t.isDraggingArrow=!0,t.svingNodeMap[t.dragFromId].selectBorder.setAttrs({stroke:"#5AB3EC"}),i.stopPropagation()})),this.arrow=e,this.stage.add(e)}},{key:"initStage",value:function(){var t=this;this.stage=new sving.Stage(this.options.el,Math.max(1.3*this.size.width,window.innerWidth),Math.max(1.3*this.size.height,window.innerHeight));var e=this.stage;e.on("click",(function(){t.unSelectAll(),t.options.onStageClick&&t.options.onStageClick()})),this.stage=e}},{key:"initConnectLine",value:function(){this.connectLine=new sving.Line(0,0,0,0),this.connectLine.opacity=0,this.connectLine.setAttrs({stroke:"black","stroke-dasharray":"4,4","stroke-width":1,"pointer-events":"none"}),this.stage.add(this.connectLine)}},{key:"initNoteArrow",value:function(){var t=this,e=new sving.Path("M479.046,283.925c-1.664-3.989-5.547-6.592-9.856-6.592H352.305V10.667C352.305,4.779,347.526,0,341.638,0H170.971 c-5.888,0-10.667,4.779-10.667,10.667v266.667H42.971c-4.309,0-8.192,2.603-9.856,6.571c-1.643,3.989-0.747,8.576,2.304,11.627 l212.8,213.504c2.005,2.005,4.715,3.136,7.552,3.136s5.547-1.131,7.552-3.115l213.419-213.504 C479.793,292.501,480.71,287.915,479.046,283.925z");e.scale=.03,e.rotation=180,e.setAttrs({fill:"white",stroke:"black","stroke-width":"15","pointer-events":"bounding-box"}),e.opacity=0,e.cursor="pointer",e.on("mousedown",(function(i){t.isMouseDownOnNoteArrow=!0,e.opacity=0,t.clientRect=t.stage.el.getBoundingClientRect(),t._mouseMove=t.mouseMove.bind(t),t._mouseUp=t.mouseUp.bind(t),t.connectLine.opacity=1,document.addEventListener("mousemove",t._mouseMove),document.addEventListener("mouseup",t._mouseUp),i.stopPropagation()})),this.noteArrow=e,this.stage.add(this.noteArrow)}},{key:"mouseMove",value:function(t){if(this.isMouseDownOnNoteArrow){for(var e in this.connectLine.setAttrs({x1:this.selectedNote.centerX,y1:this.selectedNote.centerY,x2:t.clientX-this.clientRect.left,y2:t.clientY-this.clientRect.top}),this.svingArrowMap)this.svingArrowMap[e].unTargetIt();this.overMsg&&this.overMsg.targetIt(),this.sourceNote=this.selectedNote}t.preventDefault()}},{key:"mouseUp",value:function(t){this.isMouseDownOnNoteArrow&&this.sourceNote&&this.overMsg&&(actionCenter.emit(Pd.ADD_NOTE_CONN,this.sourceNote.id,this.overMsg.id),document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUp)),this.connectLine.opacity=0,this.isMouseDownOnNoteArrow=!1}},{key:"initLinkLine",value:function(){this.linkLine=new sving.Line(0,0,0,0),this.linkLine.el.style.pointerEvents="none",this.linkLine.setAttrs({stroke:"#111","stroke-dasharray":"5,5"}),this.stage.add(this.linkLine)}},{key:"renderNote",value:function(){var t=this;this.noteGroupList=[],this.noteGroup&&this.noteGroup.clear(),this.noteConnGroup&&this.noteConnGroup.clear();var e=new sving.Group;this.noteGroup=e,this.noteConnGroup=new sving.Group,this.stage.add(this.noteConnGroup),this.noteGroup.on("click",(function(t){t.stopPropagation()})),this.stage.add(e);var i=this.data;i.noteList&&i.noteList.forEach((function(i){var o=i.id,n=new Au({id:o,x:i.x||100,y:i.y||100,width:i.width||100,height:i.height||100,text:i.text||"　　　　　",onClick:function(){t.selectNoteById(o)},onTextChange:function(e){t.unSelectNote(),actionCenter.emit(Pd.MODIFY_NOTE_CONTENT,o,e)},onRemove:function(){t.options.onElementDeleted(o,"note")},onResizeEnd:function(){this.updateNoteSize(o,n.width,n.height)},onDragStart:function(){t.noteArrow.x=n.x+n.width+30,t.noteArrow.y=n.y+20},onDrag:function(e,i){t.noteArrow.x+=e,t.noteArrow.y+=i},onDragEnd:function(){actionCenter.emit(Pd.MOVE_NOTE,o,n.x,n.y)}});i.connectList&&i.connectList.forEach((function(e){var i=new sving.Line(0,0,0,0);i.setAttrs({stroke:"black","stroke-dasharray":"4,4","stroke-width":1});var o=t.svingNodeMap[e.targetId];o&&t.data.lifelineList.find((function(t){return t.id===o.linkData.from}))&&t.data.lifelineList.find((function(t){return t.id===o.linkData.to}))&&(o.isSelfArrow?i.setAttrs({x1:n.centerX,y1:n.centerY,x2:(o.x1+o.x2)/2+100,y2:(o.y1+o.y2)/2+110}):i.setAttrs({x1:n.centerX,y1:n.centerY,x2:(o.x1+o.x2)/2+40,y2:(o.y1+o.y2)/2+100})),t.noteConnGroup.add(i)})),n.noteData=i,e.add(n),t.noteGroupList.push(n)}))}},{key:"renderMsg",value:function(){var t=this,e=this.data;e.lines&&e.lines.forEach((function(e){t.createRelation(e)}))}},{key:"renderBoundary",value:function(){var t=this,e=this.data;this.fragmentGroupList=[],e.scopes&&e.scopes.forEach((function(e,i){t.createBoundary(e)}))}},{key:"renderUseCase",value:function(){var t=this;this.data.useCases&&this.data.useCases.forEach((function(e){t.createUseCase(e)}))}},{key:"renderActor",value:function(){var t=this,e=this.data;e.actors&&e.actors.forEach((function(e,i){t.createActor(e)}))}},{key:"getDataContentSize",value:function(){var t=0,e=0;return this.data.actors.forEach((function(i){t=Math.max(t,i.position.x),e=Math.max(e,i.position.y)})),this.data.scopes.forEach((function(i){t=Math.max(t,i.position.x+i.size.width),e=Math.max(e,i.position.y+i.size.height)})),this.data.useCases.forEach((function(i){t=Math.max(t,i.position.x),e=Math.max(e,i.position.y)})),{width:t,height:e}}}]),t}();function eh(t){return"[object Array]"===Object.prototype.toString.call(t)}function ih(t){return null!==t&&"object"===Object($c["a"])(t)&&!Array.isArray(t)}function oh(t,e,i){return i||(i={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=Object($c["a"])(t)&&"object"!=Object($c["a"])(e)?i.strict?t===e:t==e:nh(t,e,i))}function nh(t,e,i){var o,n;if(ah(t)||ah(e))return!1;if(t.prototype!==e.prototype)return!1;try{Object.keys(t),Object.keys(e)}catch(a){return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),o=ka.length-1;o>=0;o--)if(ka[o]!=kb[o])return!1;for(o=ka.length-1;o>=0;o--)if(n=ka[o],!oh(t[n],e[n],i))return!1;return Object($c["a"])(t)===Object($c["a"])(e)}function ah(t){return null===t||void 0===t}function sh(t,e,i){var o;if("function"===typeof e)o=e;else{ih(e)&&(i=e,e=[]),i=i||{},"undefined"===typeof i.strict&&(i.strict=!0),e=[].concat(e).filter(Boolean);var n=e.length;o=0===n?function(t,e){return oh(t,e,i)}:function(t,o){var a=-1;while(++a<n){var s=e[a],r=void 0,c=void 0;if(eh(s)?(r=rh(t,s),c=rh(o,s)):(r=t[s],c=o[s]),!oh(r,c,i))return!1}return!0}}var a=[],s=t.length,r=-1;while(++r<s){var c=!1,l=a.length,d=-1;while(++d<l)o(t[r],a[d][0])&&(a[d].push(t[r]),c=!0);c||a.push([t[r]])}return a}function rh(t,e){var i=t;return e.forEach((function(t,e){i=i[t]})),i}var ch=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-quickBar-3rbxS",style:"left:"+t.x+"px;top:"+t.y+"px;",on:{mousedown:function(t){return t.stopPropagation()}}},[i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"字体颜色",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",{on:{click:t.changeFontColor}},[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT7mlrBpY29uL+Wtl+iJskAzeDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSLmlrBpY29uL+Wtl+iJsiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZD0iTTEzLjA3NSw1LjUgTDE4LDE5IEwxNi41MDgsMTkgTDExLjk5OTk4NTYsNi42NDAxMjc2MSBMNy40OTEsMTkgTDYsMTkgTDEwLjkyMyw1LjUgTDEzLjA3NSw1LjUgWiIgaWQ9IuW9oueKtue7k+WQiCIgZmlsbD0iIzQ2NEQ1QSI+PC9wYXRoPgogICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUiIGZpbGw9IiM0NjRENUEiIHg9IjcuOTY2MDA2MjgiIHk9IjEzLjciIHdpZHRoPSI4IiBoZWlnaHQ9IjEuMyI+PC9yZWN0PgogICAgPC9nPgo8L3N2Zz4="}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.latestColor+";"})]),i("img",{ref:"fontArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleFontColorPicker}})])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper"},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"图形填充色",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ index-selected-1Un3S",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-foreColor"}},[i("div",{on:{click:t.changeShapeColor}},[i("img",{staticClass:"index-icon-1GKGg index-hover-2RsJQ",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT50b29sYmFyX2ZpbGwgY29sb3I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0idG9vbGJhcl9maWxsLWNvbG9yIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAiPgogICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlIiBzdHJva2U9IiM5Nzk3OTciIGZpbGw9IiNEOEQ4RDgiIG9wYWNpdHk9IjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTkuNzUsMTMgTDIwLjgzNDU0MDgsMTUgQzIxLjA1NTcyMzgsMTUuNDEwMzEwMSAyMS4wNTUxMTQ1LDE1LjkxMjE1NiAyMC44MzI5MzYsMTYuMzIxODc1MiBDMjAuNjEwNzU3NCwxNi43MzE1OTQzIDIwLjE5OTYyNCwxNi45ODkwNDI0IDE5Ljc1LDE3IEMxOS4zMDAzNzYsMTYuOTg5MDQyNCAxOC44ODkyNDI2LDE2LjczMTU5NDMgMTguNjY3MDY0LDE2LjMyMTg3NTIgQzE4LjQ0NDg4NTUsMTUuOTEyMTU2IDE4LjQ0NDI3NjIsMTUuNDEwMzEwMSAxOC42NjU0NTkyLDE1IEwxOS43NSwxMyBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjNDY0RDVBIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xOC44NTc5NjY5LDExLjMxNDIwMzMgQzE5LjA0NzM0NDQsMTEuNTAzNTgwOCAxOS4wNDczNDQ0LDExLjgxMDYyMjUgMTguODU3OTY2OSwxMiBMMTIsMTguODU3OTY2OSBDMTEuODEwNjIyNSwxOS4wNDczNDQ0IDExLjUwMzU4MDgsMTkuMDQ3MzQ0NCAxMS4zMTQyMDMzLDE4Ljg1Nzk2NjkgTDUuMTQyMDMzMTQsMTIuNjg1Nzk2NyBDNC45NTI2NTU2MiwxMi40OTY0MTkyIDQuOTUyNjU1NjIsMTIuMTg5Mzc3NSA1LjE0MjAzMzE0LDEyIEwxMiw1LjE0MjAzMzE0IEMxMi4xODkzNzc1LDQuOTUyNjU1NjIgMTIuNDk2NDE5Miw0Ljk1MjY1NTYyIDEyLjY4NTc5NjcsNS4xNDIwMzMxNCBMMTguODU3OTY2OSwxMS4zMTQyMDMzIFogTTE3LjQxNzc5MzgsMTEuNjU3MTAxNyBMMTIuMzQyODk4Myw2LjU4MjIwNjE4IEw2LjU4MjIwNjE4LDEyLjM0Mjg5ODMgTDExLjY1NzEwMTcsMTcuNDE3NzkzOCBMMTcuNDE3NzkzOCwxMS42NTcxMDE3IFoiIGlkPSLlvaLnirYiIGZpbGw9IiM0NjRENUEiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgICAgICA8cG9seWdvbiBpZD0i6Lev5b6ELTMiIGZpbGw9IiM0NjRENUEiIHBvaW50cz0iNiAxMyAxMS42NTkwMDMgMTcuOTcxNDU4MyAxNy4xMTU2MzQ4IDEzIj48L3BvbHlnb24+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}}),i("div",{staticClass:"index-colorContainer-2iTbC",style:"background-color:"+t.latestColor+";"})]),i("img",{ref:"shapeArrow",staticClass:"index-dropIcon-1nzdv index-hover-2RsJQ",attrs:{id:"quick-setting-model13-toolbar-dropdown-foreColor",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTBweCIgaGVpZ2h0PSIxMHB4IiB2aWV3Qm94PSIwIDAgMTAgMTAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL0ljb24v5bel5YW35qCP5LiL5ouJ566t5aS0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIyIDMgOCAzIDUuMDExNzAwNTIgNyI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Il/lm77moIcvSWNvbi/lt6XlhbfmoI/kuIvmi4nnrq3lpLQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICA8L21hc2s+CiAgICAgICAgPHVzZSBpZD0iUmVjdGFuZ2xlLUNvcHkiIGZpbGw9IiM4MTg2OEYiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgPC9nPgo8L3N2Zz4="},on:{click:t.toggleShapeColorPicker}})])])],1)])]),i("div",{staticClass:"dui-divider dui-divider-vertical",staticStyle:{"vertical-align":"middle","background-color":"rgba(0, 0, 0, 0.08)",margin:"0px 10px"}}),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"增大字号",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|up"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5Yqg5aSnQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPliqDlpKciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUuMDAwMDAwLCA0LjAwMDAwMCkiIGZpbGw9IiM0NjRENUEiPgogICAgICAgICAgICA8cGF0aCBkPSJNNi42MDAxMDQyNiwwLjM2IEwxMiwxNC4zNiBMMTAuNjAxOTMzMSwxNC4zNiBMOS4wOTMsMTAuMzQ5IEwyLjg3MSwxMC4zNDkgTDEuMzUyNTgyNDcsMTQuMzYgTDAsMTQuMzYgTDUuMjgwNDc5NDcsMC4zNiBMNi42MDAxMDQyNiwwLjM2IFogTTUuOTkzMTg0ODMsMi4xMDYxODExNyBMMy4zNDUsOS4wOTkgTDguNjIzLDkuMDk5IEw1Ljk5MzE4NDgzLDIuMTA2MTgxMTcgWiIgaWQ9IlBhdGgtOOWkjeWItiI+PC9wYXRoPgogICAgICAgICAgICA8ZyBpZD0i57yW57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMS4wMDAwMDAsIDAuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIwIiB5PSIyIiB3aWR0aD0iNSIgaGVpZ2h0PSIxLjI1Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIxLjg2OTMyMzczIiB5PSIwLjEzMDM3MTA5NCIgd2lkdGg9IjEuMjUiIGhlaWdodD0iNSI+PC9yZWN0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="}})])])])],1)])]),i("div",{staticClass:"dui-trigger dui-tooltip dui-tooltip-wrapper",on:{click:function(e){return t.onFontSizeChange(-1)}}},[i("div",[i("div",[i("el-tooltip",{attrs:{content:"减小字号",effect:"light",placement:"bottom"}},[i("div",{staticClass:"index-item-Crpfu index-hover-2RsJQ",staticStyle:{display:"inline-flex"},attrs:{id:"quick-setting-model13-toolbar-plugin|adjustFontSize|down"}},[i("div",[i("img",{staticClass:"index-icon-1GKGg",attrs:{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5f5Zu+5qCHL+W3peWFt+agjy8wNF/lubvnga/niYcv5a2X5L2T5YeP5bCPQDN4PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Il/lm77moIcv5bel5YW35qCPLzA0X+W5u+eBr+eJhy/lrZfkvZPlh4/lsI8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtOCI+CiAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGXlpIfku70tNSIgb3BhY2l0eT0iMC4yNDY3NjgwNDMiIHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMTEuNjAwMTA0Myw0LjM2IEwxNywxOC4zNiBMMTUuNjAxOTMzMSwxOC4zNiBMMTQuMDkzLDE0LjM0OSBMNy44NzEsMTQuMzQ5IEw2LjM1MjU4MjQ3LDE4LjM2IEw1LDE4LjM2IEwxMC4yODA0Nzk1LDQuMzYgTDExLjYwMDEwNDMsNC4zNiBaIE0xMC45OTMxODQ4LDYuMTA2MTgxMTcgTDguMzQ1LDEzLjA5OSBMMTMuNjIzLDEzLjA5OSBMMTAuOTkzMTg0OCw2LjEwNjE4MTE3IFoiIGlkPSJQYXRoLTjlpI3liLblpIfku70iIGZpbGw9IiM0NjRENUEiPjwvcGF0aD4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iIzQ2NEQ1QSIgeD0iMTYiIHk9IjYiIHdpZHRoPSI1IiBoZWlnaHQ9IjEuMjUiPjwvcmVjdD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="}})])])])],1)])])])},lh=[],dh=["onColorChange","onCustomColorChange"];function uh(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function hh(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?uh(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):uh(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var fh,gh=o["default"].extend(eu),ph=function(t,e){var i;return function(){var o=this,n=arguments;clearTimeout(i),i=setTimeout((function(){return t.apply(o,n)}),e)}};function mh(t){var e=t.onColorChange,i=t.onCustomColorChange,o=Object(Z["a"])(t,dh);fh=new gh({propsData:hh({},o)}),fh.$on("color-change",(function(t){e(t),yh()})),fh.$on("custom-color-change",ph(i,600)),fh.$mount(),document.body.appendChild(fh.$el)}function yh(){fh&&fh.$el&&fh.$el.parentNode&&fh.$el.parentNode.removeChild(fh.$el)}document.addEventListener("mousedown",(function(){yh()}));var vh={props:{x:{type:Number,default:0},y:{type:Number,default:0},fontSizePx:{type:Number,default:14},latestColor:{type:String},historyColors:{type:Array}},methods:{changeShapeColor:function(){this.$emit("shape-color-change",this.latestColor)},changeFontColor:function(){this.$emit("font-color-change",this.latestColor)},onFontSizeChange:function(t){this.fontSizePx+=t,this.$emit("font-size-change",this.fontSizePx)},toggleFontColorPicker:function(t){var e=this;this.isShowShapeColorPicker=!1;var i=this.$refs.fontArrow.getBoundingClientRect();yh(),this.isShowFontColorPicker?yh():mh({color:"red",historyColors:this.historyColors,onColorChange:function(t){console.error(t),e.isShowFontColorPicker=!1,e.$emit("font-color-change",t)},onCustomColorChange:function(t){e.$emit("font-color-change",t)},x:i.left-40,y:i.top+32}),t.stopPropagation(),this.isShowFontColorPicker=!this.isShowFontColorPicker},toggleShapeColorPicker:function(t){var e=this;this.isShowFontColorPicker=!1;var i=this.$refs.shapeArrow.getBoundingClientRect();yh(),this.isShowShapeColorPicker?yh():mh({color:"red",historyColors:this.historyColors,onColorChange:function(t){console.error(t),e.isShowShapeColorPicker=!1,e.$emit("shape-color-change",t)},onCustomColorChange:function(t){console.log(t),e.$emit("shape-color-change",t)},x:i.left-40,y:i.top+32}),t.stopPropagation(),this.isShowShapeColorPicker=!this.isShowShapeColorPicker}},mounted:function(){this.isShowFontColorPicker=!1,this.isShowShapeColorPicker=!1}},wh=vh,xh=(i("8355"),Object(c["a"])(wh,ch,lh,!1,null,"104eec58",null)),Ch=xh.exports,bh=["onFontColorChange","onShapeColorChange","onFontSizeChange"];function Ih(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function Mh(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ih(Object(i),!0).forEach((function(e){Object(m["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ih(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var kh,Sh=o["default"].extend(Ch);function Dh(t){Nh();var e=t.onFontColorChange,i=t.onShapeColorChange,o=t.onFontSizeChange,n=Object(Z["a"])(t,bh);kh=new Sh({propsData:Mh({},n)}),kh.$on("font-color-change",e),kh.$on("shape-color-change",i),kh.$on("font-size-change",o),kh.$mount(),document.body.appendChild(kh.$el)}function Nh(){kh&&kh.$el&&kh.$el.parentNode&&kh.$el.parentNode.removeChild(kh.$el)}document.addEventListener("mousedown",(function(){Nh()}));var Ah=function(){function t(e){var i=this;Object(M["a"])(this,t),Object(m["a"])(this,"_onUseCaseMoved",(function(t,e,o,n){i.options.onUseCaseMoved(t,e),i.actionCenter.emit(Pd.MOVE_NODE,e.id,e.x,e.y,o,n,"useCase")})),Object(m["a"])(this,"_onActorMoved",(function(t,e,o,n){i.options.onActorMoved(t,e),i.actionCenter.emit(Pd.MOVE_NODE,e.id,e.x,e.y,o,n,"actor")})),Object(m["a"])(this,"_onCreateRelation",(function(t,e){i.options.onRelationCreated(t,e);var o=Object(b["a"])();i.actionCenter.emit(Pd.ADD_RELATION,{id:o,from:t,to:e,arrow:1,itemType:"line",text:""})})),Object(m["a"])(this,"_onBoundaryLabelChange",(function(t,e){i.options.onBoundaryLabelChanged(t,e),i.actionCenter.emit(Pd.MODIFY_ELEMENT_LABEL,t,e)})),Object(m["a"])(this,"_onUseCaseLabelChange",(function(t,e){i.options.onUseCaseLabelChanged(t,e),i.actionCenter.emit(Pd.MODIFY_ELEMENT_LABEL,t,e)})),Object(m["a"])(this,"_onActorLabelChange",(function(t,e){i.options.onActorLabelChanged(t,e),i.actionCenter.emit(Pd.MODIFY_ELEMENT_LABEL,t,e)})),Object(m["a"])(this,"_onBoundaryBoxChange",(function(t,e,o,n,a){i.options.onBoundaryBoxChanged(t,e,o,n,a),i.actionCenter.emit(Pd.MODIFY_BOUNDARY_RECT,t,e,o,n,a)})),Object(m["a"])(this,"_onDeleteElement",(function(t,e){switch(i.options.onElementDeleted(t,e),e){case"actor":i.actionCenter.emit(Pd.DELETE_ACTOR,t);break;case"useCase":i.actionCenter.emit(Pd.DELETE_USECASE,t);break;case"relation":i.actionCenter.emit(Pd.DELETE_RELATION,t);break;case"boundary":i.actionCenter.emit(Pd.DELETE_BOUNDARY,t);break;case"note":i.actionCenter.emit(Pd.DELETE_NOTE,t);break}})),Object(m["a"])(this,"_onElementContextMenu",(function(t,e){i.svingDiagram.selectElementById(t.id),Dh({x:e.clientX,y:e.clientY-40,fontSizePx:t.fontSize?parseInt(t.fontSize):14,fontColor:t.textColor,shapeColor:t.color,latestColor:i.state.historyColors[0],historyColors:i.state.historyColors,onFontSizeChange:function(e){i.updateFontSize(t,e+"px")},onFontColorChange:function(e){i.updateFontColor(t,e),i.mergeHistoryColor(e)},onShapeColorChange:function(e){i.updateShapeColor(t,e),i.mergeHistoryColor(e)}})})),this.loadingInstance=null,this.options=e,this.actionCenter=new vu(this),this.state={historyColors:["#faecd8","black"],saveMsg:"",diagramInfo:{name:"",type:"",createTime:"",modifyTime:"",creator:"",modifier:""},activeName:"base",selectedElementType:"",revision:[],currentRevisionId:"",currentRevision:null,currentSeqType:3,commentData:[],rtx:"",isUndoDisabled:!0,isRedoDisabled:!0,elementComment:{show:!1,left:10,top:10,content:"",subSystemId:""}},this.DiagramConfig=zd,this.diagramUUId="",this.comments=[],this.svingDiagram=null,this.mouseOverGroup=null,this.clientRect=null,this.selectedRelation=null,this.baseData={scopes:[],lines:[],actors:[],useCases:[]},this.fragmentGroupList=[],this.svingArrowMap={},this.selectedActor=null,this.noteGroupList=[],this.updateData(this.options.data)}return Object(k["a"])(t,[{key:"showCommentForm",value:function(t,e,i){this.state.elementComment.show=!0,this.state.elementComment.left=t,this.state.elementComment.top=e,this.state.elementComment.content="",this.state.elementComment.subSystemId=i}},{key:"getBoundingClientRect",value:function(){return this.svingDiagram.stage.el.getBoundingClientRect()}},{key:"_onElementDblClick",value:function(){this.openRightPanel()}},{key:"_onDataChanged",value:function(){}},{key:"updateData",value:function(t){this.svingDiagram&&this.svingDiagram.stage&&this.svingDiagram.recycle(),t&&(t=Object.assign({scopes:[],lines:[],actors:[],useCases:[]},t),this.svingDiagram=new th({data:t,actionCenter:this.actionCenter,el:this.options.el,onUseCaseMoved:this._onUseCaseMoved,onActorMoved:this._onActorMoved,onRelationCreated:this._onCreateRelation,onBoundaryLabelChanged:this._onBoundaryLabelChange,onUseCaseLabelChanged:this._onUseCaseLabelChange,onActorLabelChanged:this._onActorLabelChange,onBoundaryBoxChanged:this._onBoundaryBoxChange,onElementDeleted:this._onDeleteElement,onElementContextMenu:this._onElementContextMenu,onElementDblClick:this._onElementDblClick,onStageClick:this.options.onStageClick}),this.baseData=t,console.log(this.baseData)),console.log(t)}},{key:"updateDiagramSize",value:function(){var t=this.svingDiagram.getDataContentSize();this.svingDiagram.stage.el.setAttribute("width",Math.max(1.3*t.width,window.innerWidth)),console.error(t),this.svingDiagram.stage.el.setAttribute("height",Math.max(1.3*t.height,window.innerHeight))}},{key:"getRelationDataById",value:function(t){return this.baseData.lines.find((function(e){return e.id===t}))}},{key:"getLifelineById",value:function(t){var e=this.baseData.actors.find((function(e){return e.id===t}));return e||this.baseData.useCases.find((function(e){return e.id===t}))}},{key:"getFragmentById",value:function(t){return this.baseData.fragmentList.find((function(e){return e.id===t}))}},{key:"updateNoteContent",value:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));i.text=e,this.refreshData()}},{key:"addNoteConn",value:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));i.connectList||(i.connectList=[]),i.connectList.push({targetId:e}),this.refreshData()}},{key:"deleteNoteConn",value:function(t,e){var i=this.baseData.noteList.find((function(e){return e.id===t}));if(i.connectList)for(var o=0,n=i.connectList.length;o<n;o++)i.connectList[o].targetId===e&&(i.connectList.splice(o,1),o--,n--);this.refreshData()}},{key:"updateNotePosition",value:function(t,e,i){var o=this.baseData.noteList.find((function(e){return e.id===t}));o.x=e,o.y=i,this.refreshData()}},{key:"updateNoteSize",value:function(t,e,i){var o=this.baseData.noteList.find((function(e){return e.id===t}));o.width=e,o.height=i,this.refreshData()}},{key:"updateMsgType",value:function(t,e){var i=this.baseData.msgList.find((function(e){return e.id===t}));i.type=e,this.refreshData()}},{key:"selectRelationById",value:function(t){this.unSelectAll(),this.selectedRelation=this.svingDiagram.svingNodeMap[t],this.selectedRelation.select(!0),this.svingDiagram.selectedId=t}},{key:"selectObjectById",value:function(t){var e=this.getRelationDataById(t);e?this.selectRelationById(t):(e=this.getLifelineById(t),e?this.selectLifelineById(t):(e=this.getFragmentById(t),e&&this.selectFragmentById(t)))}},{key:"getJSONData",value:function(){var t=this.baseData,e={actors:[],lines:[],offset:t.offset,scopes:[],useCaseType:t.useCaseType,useCases:[]};return t.scopes.forEach((function(t){e.scopes.push({elementId:t.elementId,id:t.id,itemType:t.itemType,position:t.position,size:t.size,text:t.text,fontSize:t.fontSize,fontColor:t.fontColor,shapeColor:t.shapeColor})})),t.actors.forEach((function(t){e.actors.push({elementId:t.elementId,id:t.id,itemType:t.itemType,position:t.position,text:t.text,fontSize:t.fontSize,fontColor:t.fontColor,shapeColor:t.shapeColor})})),t.useCases.forEach((function(t){e.useCases.push({elementId:t.elementId,id:t.id,itemType:t.itemType,position:t.position,text:t.text,itemShape:t.itemShape,fontSize:t.fontSize,fontColor:t.fontColor,shapeColor:t.shapeColor})})),t.lines.forEach((function(t){e.lines.push({arrow:t.arrow,elementId:t.elementId,from:t.from,id:t.id,itemType:t.itemType,style:t.style,to:t.to})})),e}},{key:"getSvingElementById",value:function(t){for(var e in this.svingArrowMap)if(e===t)return this.svingArrowMap[e]}},{key:"selectNoteById",value:function(t){this.unSelectAll();var e=this.noteGroupList.find((function(e){return e.noteData.id===t}));e.select(),this.selectedNote=e,this.state.selectedElementType="diagram",this.svingDiagram.noteArrow.opacity=1,this.svingDiagram.noteArrow.x=e.x+e.width+30,this.svingDiagram.noteArrow.y=e.y+20}},{key:"unSelectNote",value:function(){var t=this;this.selectedNote&&(this.selectedNote=this.noteGroupList.find((function(e){return e.id===t.selectedNote.id})),this.selectedNote.unSelect(),this.selectedNote=null),this.svingDiagram.noteArrow.opacity=0}},{key:"unSelectAll",value:function(){this.svingDiagram.unSelectAll()}},{key:"unSelectLifeline",value:function(){this.selectedActor&&(this.selectedActor=this.svingDiagram.svingNodeMap[this.selectedActor.id],this.selectedActor.unSelect(),this.selectedActor=null),this.svingDiagram.arrow.opacity=0}},{key:"unSelectFragment",value:function(){var t=this;this.selectedFragment&&(this.selectedFragment=this.fragmentGroupList.find((function(e){return e.id===t.selectedFragment.id})),this.selectedFragment.unSelect(),this.selectedFragment=null)}},{key:"unSelectMsg",value:function(){this.selectedRelation&&(this.selectedRelation=this.svingDiagram.svingNodeMap[this.selectedRelation.id],this.selectedRelation.unSelect())}},{key:"deleteMsg",value:function(t){for(var e=0,i=this.baseData.msgList.length;e<i;e++){var o=this.baseData.msgList[e];if(o.id===t){this.baseData.msgList.splice(e,1),delete this.svingArrowMap[t],this.selectedRelation=null;break}}this.refreshData(),this.state.selectedElementType="diagram"}},{key:"deleteFragment",value:function(t){for(var e=0,i=this.baseData.fragmentList.length;e<i;e++){var o=this.baseData.fragmentList[e];if(o.id===t){this.baseData.fragmentList.splice(e,1),this.fragmentGroupList.splice(this.fragmentGroupList.indexOf(this.selectedFragment),1),this.selectedFragment=null;break}}this.refreshData(),this.state.selectedElementType="diagram"}},{key:"createActor",value:function(t){this.baseData.actors.push(t),this.svingDiagram.createActor(t),this.options.onDataChanged(this.baseData)}},{key:"createUseCase",value:function(t){this.baseData.useCases.push(t),this.svingDiagram.createUseCase(t),this.options.onDataChanged(this.baseData)}},{key:"addElement",value:function(t){switch(t.itemType){case"actor":this.createActor(t);break;case"useCase":this.createUseCase(t);break}this.updateDiagramSize()}},{key:"deleteElement",value:function(t){var e=this.getDataById(t);switch(e.itemType){case"actor":this.deleteActor(t);break;case"useCase":this.deleteUseCase(t);break}this.updateDiagramSize()}},{key:"clear",value:function(){this.baseData={lifelineList:[],msgList:[]},this.svingDiagram.stage&&this.refreshData(null,!0)}},{key:"selectPrevElement",value:function(){this.selectedRelation?this.selectRelationById(this.selectedRelation.id):this.selectedNote?this.selectNoteById(this.selectedNote.id):this.selectedActor?this.selectLifelineById(this.selectedActor.id):this.selectedFragment&&this.selectFragmentById(this.selectedFragment.id)}},{key:"createRelation",value:function(t){this.baseData.lines.push(t),this.svingDiagram.createRelation(t),this.selectRelationById(t.id),this.options.onDataChanged(this.baseData)}},{key:"addMsgByDragAction",value:function(){this.getSvingNodeById(this.svingDiagram.dragFromId).selectBorder.setAttrs({stroke:"#ccc"});var t=Object(b["a"])();return this.actionCenter.emit(Pd.ADD_RELATION,{id:t,from:this.svingDiagram.dragFromId,to:this.svingDiagram.dragToId,text:"输入消息名",type:"sync"}),t}},{key:"getSvingNodeById",value:function(t){return this.svingDiagram.svingNodeMap[t]}},{key:"updateFragment",value:function(t){this.baseData.fragmentList.forEach((function(e){t.id===e.id&&(e.text=t.name,e.type=t.type)})),this.refreshData()}},{key:"addNote",value:function(t){this.baseData.noteList||(this.baseData.noteList=[]),this.baseData.noteList.push(t),this.refreshData()}},{key:"deleteNote",value:function(t){for(var e=0,i=this.baseData.noteList.length;e<i;e++){var o=this.baseData.noteList[e];if(o.id===t){this.baseData.noteList.splice(e,1);break}}this.selectedNote=null,this.refreshData(),this.state.selectedElementType="diagram"}},{key:"getBound",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={top:1/0,left:1/0,bottom:-1/0,right:-1/0},i=document.querySelector(".sving-root").scrollLeft,o=Object.values(this.svingDiagram.svingNodeMap);return o.forEach((function(t){if(t.el){var o=t.el.getBoundingClientRect(),n=o.x,a=o.width,s=o.height,r=function(t){switch(t.type){case"actor":case"useCase":return t.y-40;case"relation":return Math.min(t.y1,t.y2);default:return t.y}},c=r(t);e.top=Math.min(e.top,c),e.left=Math.min(e.left,n+i),e.bottom=Math.max(e.bottom,c+s),e.right=Math.max(e.right,n+i+a)}})),e.top===1/0&&(e.top=0),e.left===1/0&&(e.left=0),e.bottom===-1/0&&(e.bottom=0),e.right===-1/0&&(e.right=0),e.width=e.right-e.left,e.height=e.bottom-e.top,t&&(e.left=Math.max(0,e.left),e.top=Math.max(0,e.top),e.right=e.left+e.width,e.bottom=e.top+e.height),e}},{key:"getStageContentSize",value:function(){var t=document.querySelector(".sving-root").scrollLeft,e=100,i=100;return this.svingDiagram.stage.children.forEach((function(o){var n=o.el.getBoundingClientRect();e=Math.max(e,t+n.x+n.width),i=Math.max(i,t+n.y+n.height),o.children&&o.children.forEach((function(n){var a=n.el.getBoundingClientRect();e=Math.max(e,t+o.x+a.x+a.width),i=Math.max(i,t+o.y+a.y+a.height)}))})),{width:e,height:i}}},{key:"editLifelineName",value:function(t){var e=this.svingDiagram.svingNodeMap[t];e.text.focusAndSelect()}},{key:"editFragmentName",value:function(t){this.svingDiagram.selectElementById(t),this.svingDiagram.svingNodeMap[t].text.focusAndSelect()}},{key:"editMsgName",value:function(t){var e=this.svingArrowMap[t];this.selectRelationById(t),e.text.focusAndSelect()}},{key:"updateFragmentRect",value:function(t,e,i,o,n){var a=this.baseData.fragmentList.find((function(e){return e.id===t}));a.x=e,a.y=i,a.width=o,a.height=n,this.refreshData()}},{key:"addNewObj",value:function(t,e,i,o){var n=this;if("SvingBoundary"===t){var a={id:Object(b["a"])(),text:"输入片段名",type:"alt"};"number"===typeof e&&(a.x=e,a.y=i),this.actionCenter.emit(Pd.ADD_BOUNDARY,a),setTimeout((function(){n.editFragmentName(a.id)}),20)}else if("Note"===t){var s={id:Object(b["a"])(),text:"备注内容",width:100,height:100};"number"===typeof e&&(s.x=e,s.y=i),this.actionCenter.emit(Pd.ADD_NOTE,s)}else{var r=Object(b["a"])(),c={id:r,key:r,text:t,type:t,duration:20};"number"===typeof e&&(c.x=e-100),this.actionCenter.emit(Pd.ADD_ELEMENT,c,o),setTimeout((function(){n.editLifelineName(r)}),20)}}},{key:"updateActorPosition",value:function(t,e,i){this.svingDiagram.updateActorPosition(t,e,i),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateUseCasePosition",value:function(t,e,i){this.svingDiagram.updateUseCasePosition(t,e,i),this.options.onDataChanged(this.svingDiagram.data)}},{key:"getTypeById",value:function(t){return this.baseData.actors.find((function(e){return e.id===t}))?"actor":this.baseData.useCases.find((function(e){return e.id===t}))?"useCase":this.baseData.lines.find((function(e){return e.id===t}))?"relation":this.baseData.scopes.find((function(e){return e.id===t}))?"boundary":void 0}},{key:"getDataById",value:function(t){var e=this.baseData.actors.find((function(e){return e.id===t}));return e||(e=this.baseData.useCases.find((function(e){return e.id===t})),e||(e=this.baseData.lines.find((function(e){return e.id===t})),e||(e=this.baseData.scopes.find((function(e){return e.id===t})),e||void 0)))}},{key:"createBoundary",value:function(t){this.baseData.scopes.push(t),this.svingDiagram.createBoundary(t),this.svingDiagram.selectElementById(t.id),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateBoundaryLabel",value:function(t,e){this.svingDiagram.updateBoundaryLabel(t,e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateUseCaseLabel",value:function(t,e){this.svingDiagram.updateUseCaseLabel(t,e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateActorLabel",value:function(t,e){this.svingDiagram.updateActorLabel(t,e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateElementLabel",value:function(t,e){var i=this.getDataById(t);switch(i.itemType){case"actor":this.updateActorLabel(t,e);break;case"useCase":this.updateUseCaseLabel(t,e);break;default:this.updateBoundaryLabel(t,e);break}}},{key:"updateBoundaryBox",value:function(t,e,i,o,n){this.svingDiagram.updateBoundaryBox(t,e,i,o,n),this.options.onDataChanged(this.svingDiagram.data)}},{key:"deleteBoundary",value:function(t){this.svingDiagram.deleteBoundary(t),this.options.onDataChanged(this.svingDiagram.data)}},{key:"deleteActor",value:function(t){this.svingDiagram.deleteActor(t),this.options.onDataChanged(this.svingDiagram.data)}},{key:"deleteUseCase",value:function(t){this.svingDiagram.deleteUseCase(t),this.options.onDataChanged(this.svingDiagram.data)}},{key:"deleteRelation",value:function(t){this.svingDiagram.deleteRelation(t),this.options.onDataChanged(this.svingDiagram.data)}},{key:"deleteElementById",value:function(t){var e=this.getTypeById(t);switch(e){case"actor":this.deleteActor(t);break;case"useCase":this.deleteUseCase(t);break;case"relation":this.deleteRelation(t);break;case"boundary":this.deleteBoundary(t);break}}},{key:"mergeHistoryColor",value:function(t){var e=this.state.historyColors;if(-1!==e.indexOf(t))for(var i=0,o=e.length;i<o;i++)if(e[i]===t){e.splice(i,1);break}e.unshift(t),e.length>9&&(e.length=9)}},{key:"updateActorFontSize",value:function(t,e){this.baseData.actors.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateActorFontColor",value:function(t,e){this.baseData.actors.find((function(e){return e.id===t})).fontColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateActorShapeColor",value:function(t,e){this.baseData.actors.find((function(e){return e.id===t})).shapeColor=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateUseCaseFontSize",value:function(t,e){this.baseData.useCases.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateUseCaseFontColor",value:function(t,e){this.baseData.useCases.find((function(e){return e.id===t})).fontColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateUseCaseShapeColor",value:function(t,e){this.baseData.useCases.find((function(e){return e.id===t})).shapeColor=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateBoundaryFontSize",value:function(t,e){this.baseData.scopes.find((function(e){return e.id===t})).fontSize=e,this.svingDiagram.svingNodeMap[t].updateFontSize(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateBoundaryFontColor",value:function(t,e){this.baseData.scopes.find((function(e){return e.id===t})).fontColor=e,this.svingDiagram.svingNodeMap[t].updateFontColor(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateBoundaryShapeColor",value:function(t,e){this.baseData.scopes.find((function(e){return e.id===t})).shapeColor=e,this.svingDiagram.svingNodeMap[t].updateShapeColor(e),this.options.onDataChanged(this.svingDiagram.data)}},{key:"updateFontSize",value:function(t,e){switch(t.itemType){case"actor":this.updateActorFontSize(t.id,e);break;case"useCase":this.updateUseCaseFontSize(t.id,e);break;case"boundary":this.updateBoundaryFontSize(t.id,e);break}}},{key:"updateFontColor",value:function(t,e){switch(t.itemType){case"actor":this.updateActorFontColor(t.id,e);break;case"useCase":this.updateUseCaseFontColor(t.id,e);break;case"boundary":this.updateBoundaryFontColor(t.id,e);break}}},{key:"updateShapeColor",value:function(t,e){switch(t.itemType){case"actor":this.updateActorShapeColor(t.id,e);break;case"useCase":this.updateUseCaseShapeColor(t.id,e);break;case"boundary":this.updateBoundaryShapeColor(t.id,e);break}}},{key:"reverseRelation",value:function(t){this.svingDiagram.reverseRelation(t)}},{key:"updateDiagramInfo",value:function(t){Object.assign(this.state.diagramInfo,t)}},{key:"updatePropPanelActiveTabPane",value:function(t){this.state.activeName=t}},{key:"groupRevisionByDate",value:function(t){return t.forEach((function(t){t.date=(t.CreateTime+"").substr(0,8),t.distanceFromNow=(Date.now()-new Date(Bd(t.CreateTime,{source:"string"})))/864e5,t.distanceFromNow<1?0===Math.floor(24*t.distanceFromNow*60)?t.distanceFromNow=Math.floor(24*t.distanceFromNow*60*60)+1+"秒前":24*t.distanceFromNow*60<60?t.distanceFromNow=Math.floor(24*t.distanceFromNow*60)+"分钟前":t.distanceFromNow=Math.floor(24*t.distanceFromNow)+"小时前":t.distanceFromNow<7?t.distanceFromNow=Math.floor(t.distanceFromNow)+"天前":t.distanceFromNow<30?t.distanceFromNow=Math.floor(t.distanceFromNow/7)+"周前":t.distanceFromNow<365?t.distanceFromNow=Math.floor(t.distanceFromNow/30)+"月前":t.distanceFromNow=Math.floor(t.distanceFromNow/365)+"年前"})),sh(t,"date")}},{key:"syncServerComment",value:function(){var t=this;getCommentsBySystemId({systemId:this.diagramUUId,systemType:3}).then((function(e){t.comments=e.data,t.state.commentData=t.getCommentById(t.diagramUUId,"")}))}},{key:"getCommentById",value:function(t){var e=this.comments.filter((function(e){return e.systemId===t})),i=[];return e.forEach((function(t){var e=t.comments.filter((function(t){return""===t.replyDetailId}));e.forEach((function(e){e.id=e.detailId,e.avatar="https://dayu.oa.com/avatars/"+e.creator+"/profile.jpg?1448329396",e.reply=t.comments.filter((function(t){return t.replyDetailId===e.detailId})),e.toAvatar="http://ww4.sinaimg.cn/bmiddle/006DLFVFgy1ft0j2pddjuj30v90uvagf.jpg",e.reply.forEach((function(e){e.id=e.detailId,e.subSystemId=t.subSystemId,e.avatar="https://dayu.oa.com/avatars/"+e.creator+"/profile.jpg?1448329396"})),e.systemId=t.systemId,e.subSystemId=t.subSystemId,i.push(e)}))})),i.sort((function(t,e){return new Date(t.createTime)-new Date(e.createTime)}))}},{key:"showLoading",value:function(t){this.loadingInstance=y["Loading"].service({text:t})}},{key:"hideLoading",value:function(){this.loadingInstance.close()}},{key:"updateDiagram",value:function(){}}]),t}(),Lh={name:"UseCaseDiagram",watch:{"state.elementComment.show":function(t){var e=this;t&&this.$nextTick((function(){e.$refs.commentInput.focus()}))},renderData:function(t){"uc"===this.showType&&this.useCaseStore.updateData(t)}},components:{Toolbar:Hd,PropsPanel:pu},props:{diagramUUId:String,showType:String,renderData:Object,subType:Number},data:function(){return{state:this.useCaseStore.state,isClosed:!!Rd("projectId"),seqColor:"默认视图",saveMsg:"",contentHeight:window.innerHeight-42,filterText:"",tabPosition:"bottom",guide:{title:"怎么添加元素",dialogVisible:!1,width:"500px",gifUrl:"https://wx.gtimg.com/resource/feuploader/202109/4b956f0a6f415832867fc6cbba43932f_1250x1232.gif"}}},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.contentHeight=window.innerHeight-42})),console.log("mounted"),this.useCaseStore.showLoading(),this.useCaseStore.state.selectedElementType="diagram",this.initSeq(this.renderData),this.useCaseStore.actionCenter.undoRedo.reset(),setTimeout((function(){t.useCaseStore.hideLoading()}),300),localStorage.getItem("__xwatt__iwiki__uc__guide__")||(this.guide.dialogVisible=!0,localStorage.setItem("__xwatt__iwiki__uc__guide__",!0))},beforeCreate:function(){var t=new Ah({el:"#uc-sving-root",onUseCaseMoved:function(t,e){},onActorMoved:function(t,e){},onRelationCreated:function(t,e){},onBoundaryLabelChanged:function(t,e){},onUseCaseLabelChanged:function(t,e){},onActorLabelChanged:function(t,e){},onBoundaryBoxChanged:function(t,e,i,o,n){},onDataChanged:function(e){t.updateDiagramSize()},onStageClick:function(){t.state.selectedElementType="diagram"},onElementDeleted:function(t,e){}});this.useCaseStore=t,window.store=t},computed:{diagramName:function(){return this.renderData.diagramName}},methods:{downLoadPng:function(){this.useCaseStore.unSelectAll();var t=30,e=this.useCaseStore.getBound();e.width+=2*t,e.height+=2*t,A.a.showLoading("下载中..");var i=document.createElement("canvas"),o=i.getContext("2d"),n=this.useCaseStore.svingDiagram.stage.el.cloneNode(!0);n.setAttribute("width",e.width),n.setAttribute("height",e.height),n.setAttribute("width",2*n.getAttribute("width")),n.setAttribute("height",2*n.getAttribute("height"));var a=canvg.Canvg.fromString(o,n.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="-'.concat(t,'" y="-').concat(t,'" width="').concat(e.left+e.width,'" height="').concat(e.top+e.height,'" fill="white"/>')),{scaleWidth:2*n.getAttribute("width"),scaleHeight:2*n.getAttribute("height"),offsetX:-e.left+t,offsetY:-e.top+t});a.start(),setTimeout((function(){var t=document.createElement("a");t.href=i.toDataURL("image/png"),t.download="uc.png",t.click(),A.a.hideLoading()}),1e3)},iwikiSave:function(){var t=this;this.useCaseStore.unSelectAll();var e=this.useCaseStore.getStageContentSize();A.a.showLoading("保存中..");var i=document.createElement("canvas"),o=i.getContext("2d"),n=this.useCaseStore.svingDiagram.stage.el.cloneNode(!0);n.setAttribute("width",e.width+10),n.setAttribute("height",e.height),n.setAttribute("width",n.getAttribute("width")),n.setAttribute("height",n.getAttribute("height"));var a=canvg.Canvg.fromString(o,n.outerHTML.replace('xmlns:xlink="http://www.w3.org/1999/xlink">','xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="100%" height="100%" fill="white"/>'),{scaleWidth:n.getAttribute("width"),scaleHeight:n.getAttribute("height")});a.start(),setTimeout((function(){var e=t.useCaseStore.getJSONData();window.parent.postMessage({type:"xwatt_iframe:save",renderData:e,picData:i.toDataURL("image/png")},"*"),A.a.hideLoading()}),1e3)},filterNode:function(){},handleNodeClick:function(){},nodeExpand:function(){},nothingTodo:function(){},objOk:function(){},msgOk:function(){},cancel:function(){},onInputKeyUp:function(t){t.stopPropagation()},setToTop:function(t,e){e.stopPropagation(),t.SetToTop=1,this.options.mySeqDiagList.splice(this.options.mySeqDiagList.indexOf(t),1),this.options.mySeqDiagList.unshift(t),setSeqDiagTop(t.DiagramId)},cancelSetToTop:function(t,e){e.stopPropagation(),t.SetToTop=0,this.options.mySeqDiagList.splice(this.options.mySeqDiagList.indexOf(t),1),this.options.mySeqDiagList.push(t),cancelSeqDiagTop(t.DiagramId)},initSeq:function(t){var e=this;if(t){this.useCaseStore.baseData=t,this.useCaseStore.diagram&&this.useCaseStore.diagram.recycle(),this.useCaseStore.updateData(t);var i=new ClipboardJS(".share-btn");i.on("success",(function(t){console.info("Action:",t.action),console.info("Text:",t.text),console.info("Trigger:",t.trigger),t.clearSelection(),e.$message.closeAll(),e.$message({type:"success",dangerouslyUseHTMLString:!0,message:'复制分享链接成功  <br>  <a target="_blank" href="'.concat(t.text,'">').concat(t.text,"</a>"),showClose:!0,duration:0})})),i.on("error",(function(t){console.error("Action:",t.action),console.error("Trigger:",t.trigger)}))}},clearUnUseMsg:function(t){for(var e=function(e,n){var a=t.msgList[e];t.lifelineList.find((function(t){return t.id===a.from}))&&t.lifelineList.find((function(t){return t.id===a.to}))||(t.msgList.splice(e,1),e--,n--),i=e,o=n},i=0,o=t.msgList.length;i<o;i++)e(i,o)},deleteDefaultColor:function(t){for(var e=0,i=t.lifelineList.length;e<i;e++){var o=t.lifelineList[e];"#faecd8"===o.color&&delete o.color}}}},Th=Lh,Eh=(i("1f24"),Object(c["a"])(Th,Td,Ed,!1,null,"00c7e12e",null)),Oh=Eh.exports,jh={props:{diagramUUId:String,showType:String,renderData:Object,subType:Number},components:{UseCaseDiagram:Oh},mounted:function(){}},Ph=jh,zh=Object(c["a"])(Ph,Ad,Ld,!1,null,"0e1c9524",null),Rh=zh.exports,Bh={data:function(){return{renderData:{},subType:"",showType:"choose",dialogVisible:!0,diagrams:[{type:"seq",name:"序列图",thumbnail:"https://wx.gtimg.com/resource/feuploader/202104/790ac8ce8ac16579035ff0390972013e_237x237.png",options:["业务","分析","序列"]},{type:"class",name:"类图",thumbnail:"https://wx.gtimg.com/resource/feuploader/202104/92abcffc06c4b4c8b4ed1e04eca2d656_269x269.png",options:["类图"]},{type:"state",name:"状态图",thumbnail:"https://wx.gtimg.com/resource/feuploader/202104/2da3ebe7b6d6ea4c96d507c29991d29d_317x317.png",options:["状态图"]},{type:"uc",name:"用例图",thumbnail:"https://wx.gtimg.com/resource/feuploader/202104/64b81965deecb5b3f70786714a7d169a_255x255.png",options:["系统用例","业务用例"]}]}},components:{SeqDiagram:Oi,ClassDiagram:jr,StateDiagram:Nd,UcDiagram:Rh},mounted:function(){var t=this;window.addEventListener("message",(function(e){var i=e.data,o=i.type,n=i.renderData,a=void 0===n?{}:n,s=i.diagramType,r=void 0===s?"choose":s;switch(o){case"xwatt_iframe:init":t.renderData={},t.showType="choose",t.subType="";break;case"xwatt_iframe:init_diagram":t.renderData=a,t.showType=r,t.subType=a.subType;break}}),!1)},methods:{create:function(t,e){this.subType=e,this.showType=t,reportLog({app:"iwiki-modeler",url:location.href,actionType:4,actionName:"open-".concat(t)})},onCancel:function(){window.parent.postMessage({type:"xwatt_iframe:close"},"*"),this.showType="choose"},showOptions:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.$message({type:"info",message:"点击下方（ ".concat(e.join("、")," ）选择模型类型开始建模")})}}},Gh=Bh,_h=(i("6010"),Object(c["a"])(Gh,h,f,!1,null,"033fcbec",null)),Fh=_h.exports;o["default"].use(u["a"]);var Uh=new u["a"]({routes:[{path:"/",name:"ChooseDiagram",component:Fh}]});i("db4d"),i("f689");o["default"].use(In["a"]),o["default"].use(v.a),Uh.beforeEach((function(t,e,i){i()})),new o["default"]({router:Uh,el:"#app",render:function(t){return t(d)}})},"117d":function(t,e,i){"use strict";i("e841")},1197:function(t,e,i){"use strict";i("5d2d")},"13ad":function(t,e,i){"use strict";i("b54e")},1571:function(t,e,i){},"16c7":function(t,e,i){"use strict";i("9897")},"1cc3":function(t,e,i){"use strict";i("a655")},"1f24":function(t,e,i){"use strict";i("e687")},"1fb3":function(t,e,i){"use strict";i("50ee")},2093:function(t,e,i){},2110:function(t,e,i){"use strict";i("6e6e")},"22d5":function(t,e,i){},"26fb":function(t,e,i){},2807:function(t,e,i){"use strict";i("deef")},2940:function(t,e,i){"use strict";i("36d8")},"2f68":function(t,e,i){"use strict";i("c604")},"302a":function(t,e,i){},"320e":function(t,e,i){"use strict";i("0fc8")},"36d8":function(t,e,i){},"386f":function(t,e,i){"use strict";i("df11")},"3db3":function(t,e,i){"use strict";i("68ef")},"46e4":function(t,e,i){},"50ee":function(t,e,i){},"577e":function(t,e,i){"use strict";i("eb06")},"58ed":function(t,e,i){},"5d2d":function(t,e,i){},"5f95":function(t,e,i){"use strict";i("2093")},"5fcb":function(t,e,i){},6010:function(t,e,i){"use strict";i("7c71")},6425:function(t,e,i){},"677c":function(t,e,i){},"68ef":function(t,e,i){},"690b":function(t,e,i){"use strict";i("26fb")},"6c32":function(t,e,i){},"6d09":function(t,e,i){"use strict";i("8bbf")},"6d84":function(t,e,i){"use strict";i("85cc")},"6e6e":function(t,e,i){},7008:function(t,e,i){},"751f":function(t,e,i){"use strict";i("302a")},"7c71":function(t,e,i){},"7fec":function(t,e,i){"use strict";i("46e4")},8252:function(t,e,i){"use strict";i("dbb6")},8355:function(t,e,i){"use strict";i("d0d9")},"85cc":function(t,e,i){},"87be":function(t,e,i){"use strict";i("ccc3")},"8a41":function(t,e,i){"use strict";i("cf06")},"8bbf":function(t,e,i){},"95c6":function(t,e,i){"use strict";i("0f64")},"97ff":function(t,e,i){},9897:function(t,e,i){},"9a82":function(t,e,i){"use strict";i("eafd")},"9f3a":function(t,e,i){"use strict";i("b9c4")},a2b5:function(t,e,i){"use strict";i("b224")},a3bb:function(t,e,i){},a655:function(t,e,i){},b0ce:function(t,e,i){},b224:function(t,e,i){},b3bc:function(t,e,i){"use strict";i("bdb2")},b54e:function(t,e,i){},b54f:function(t,e,i){},b759:function(t,e,i){"use strict";i("b54f")},b8a8:function(t,e,i){"use strict";i("58ed")},b9c4:function(t,e,i){},bdb2:function(t,e,i){},bec7:function(t,e,i){"use strict";i("97ff")},c604:function(t,e,i){},c788:function(t,e,i){"use strict";i("677c")},c8d6:function(t,e,i){"use strict";i("6c32")},ca36:function(t,e,i){"use strict";i("0ef2")},cb85:function(t,e,i){"use strict";i("dea9")},ccc3:function(t,e,i){},ce53:function(t,e,i){"use strict";i("a3bb")},cf06:function(t,e,i){},d0d9:function(t,e,i){},d714:function(t,e,i){"use strict";i("d7c6")},d7c6:function(t,e,i){},dbb6:function(t,e,i){},dea9:function(t,e,i){},deef:function(t,e,i){},df11:function(t,e,i){},e1b6:function(t,e,i){"use strict";i("22d5")},e687:function(t,e,i){},e841:function(t,e,i){},ea89:function(t,e,i){},eafd:function(t,e,i){},eb06:function(t,e,i){},ed56:function(t,e,i){"use strict";i("6425")},ed88:function(t,e,i){"use strict";i("5fcb")},f22a:function(t,e,i){},f689:function(t,e,i){},f8f1:function(t,e,i){},fffb:function(t,e,i){"use strict";i("ea89")}});