# 1. 前言导入

在开始之前，相信有许多小伙伴，还在问正则是什么东西？是啊，对于初次听到的同学肯定对“正则”充满了问号。

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKDHVhdVkXnoXwhdpX776icFJxc0iaUAVZ4PHoZOxsS35Vlfo0zEt0FFibQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

正则表达式，又称正规表示式、正规表示法、正规表达式、规则表达式、常规表示法（英语：Regular Expression，在代码中常简写为regex、regexp或RE），计算机科学的一个概念。正则表达式使用单个字符串来描述、匹配一系列匹配某个句法规则的字符串。在很多文本编辑器里，正则表达式通常被用来检索、替换那些匹配某个模式的文本。

当然，艰涩难懂的概念很难让人理解它，甚至于还想收藏本文、然后关闭。其实正则你可以理解成一个文本处理工具，但是它非常强大。我们可以用它来校验数据的有效性，比如我们在平常注册账号或者填写表单的时候，但凡我们手机号出现错误，输入框就能及时提醒，这里就是利用了正则表达式进行校验；还有我们利用正则表达式可以快速从文本中提取需要内容，比如我们很常见的就是在网络爬虫中进行内容筛选和抓取；当然它还可以对符合规则的文本内容进行替换，比如Notepad++就是一个支持正则表达式的文本工具，我们可以轻松用它来把我们“千万级别”文中出现的指定内容进行替换，并且高效、快速、完全，妈妈再也不用担心我抄写作业了！

说到这里，可见正则表达式的重要性，那我们应该如何理解正则表达式呢？简单来说，它就是描述字符串的规则，最简单的正则就是匹配单个普通字符，例如我们在下面的例子中匹配字符o，这里就类似于我们平常常用的字符串查找是异曲同工的：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKJq5iaLnB6KSjskYwaEpKLC35ibWfBAVvq8FgU4hNNTQmNia5kic2UV3RXQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

有时候我们还想找出字符串中符合某种规则的文本，比如找出字符串中的所有数字，如果用普通方法，肯定需要进行很多次重复工作，但是利用正则表达式就不一样了：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bK7CibUyDFjZmlFKuU6Xl30EmOEErG1snFYtQnsFrsQBiaicUyvel5n6AGg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

   这里就出来一个知识点，我们在正则中利用“d”（digit）来表示0-9这10个数字，如果我们在“d”后面加上一些量词变成“d{4}”，这样就会表示匹配4位的数字，这里大概许多小伙伴就能举一反三了，比如匹配手机号“d{11}”等等。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKuTgMicvQjHW0EtdoefJ8f8zmyUhH1XfTrCR4kpmdhkib8qOEuH7hiaRJQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

   我们接下来看一下，正则表达式如何进行替换，这里使用的是https://regex101.com/网站提供的正则表达式测试：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKTqIQTVRjfAG85FGsYTej7qrSIuDRcibJx4N2Kt6UibicCb3hYdRoV9HiaA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

# 2. 元字符

接下来我们先介绍一下元字符。元字符对于正则表达式是一个非常重要的基础概念，它是一种代表特殊含义的专用字符，相当于正则表达式中有含义的“单词”，只有掌握这些“单词”，在了解一些基础的“语法”，就能看懂初步看懂较为复杂的正则表达式。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKpBziaWsIDHy6GbWuOlHAQaFa8AGPbCOLEshVlCyiblkzictLwibcnibLHCg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

​    我们首先了解看下基础和空白符，这里包含的内容在之前我们举过的例子中展示过，还记得怎么初步匹配手机号码？对了，用“/d{11}”就可以了。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKF6q5FoERRhuCCdWHZCeuX5Aw0iah1nUYl7JK02DOWLftiaHTNA3GN5ZA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

   这些都需要你牢牢去记住，尤其是大小写含义还不一样，千万不要写错，否则可能得到的答案和你想的大相径庭。



   我们往往并不是单独匹配一个字符，我们常常需要匹配一串字符，并且还对字符的内容有一定的期望，接下来我们来看一下量词和范围都有哪些内容：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKQXQ31UJ1GOd73kZL6GDuIhmQKfQfjnu2uReUCxf2oFIrH16IcwJvdA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

   看到这里，我们就可以对一个手机号进行更加合理的匹配或校验，因为之前我们写的“/d{11}”可以匹配到手机号，但不完全都是手机号，例如00000000000明显就不是手机号，所以我们利用量词和范围对手机号的正则表达式重新进行改写：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKmMZsC7faNb1yoyAgwPFTM9klfUVJ8ygNO6dwR8nch1bW3lPdk7wzug/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

我们可以看到，即便符合了手机号位数的数字也不会被匹配到，当然我们可以看到思维导图里面有许多同义替换，我们还可以这么写“1[^012]d{9}”、“1[3-9][0-9]{9}”等等。



有的时候，我们不仅需要匹配到我们想要的内容，并且所在的位置也必须是我们想要的，这时，我们就可以使用边界元字符来解决这个问题。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKXRVI82LiasYwb3VicupCf4mZK1r9O7ibDmObWDTsn1Ic2fG6cdgPp7nVw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKJkq5fva2iap1SkhEMaZASQicF83KrfmQEzdyqfp2IibybQhuewbIKTezQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

利用边界元字符我们可以从指定位置格式来匹配字符串，有效地过滤了许多不需要的信息，在这我们要对脱字符（^）和“A”进行一些区分，脱字符可以进行多行匹配，而\A只能匹配字符串开始的位置：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKhZqXcojzg1JuN7EtlLMY6ofRAvfRteJW50ibzjg3uf36I2XjFnAddpw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

# 3. 贪婪、子组与环视

看到这里，对于正则表达式你已经跨入了大门，接下来我们来讲一下正则中的贪婪与非贪婪。在正则表达式中表示次数的量词默认是贪婪的，也就是说它尽可能多的去匹配符合要求的内容。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKaIKR9EicWxZLY9gMnIpvI5bQpInQPdn9v0Epvhyzibg0qeNJJtIjvhQQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

   那越多结果不是越好吗？为什么还要将贪婪模式变成非贪婪模式呢？非也，比如下面的例子，我想匹配引号内的内容，但是贪婪匹配让我匹配成第一个左引号和最后一个右引号内的内容，这明显是不符合我们需要的，变成非贪婪匹配就会得到想要的内容。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bK8ydDLUmMz0UN3fEvJrvR40NZ1T1CT1jpLpYKmoOC8TpiapxnIJ1D7PA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)



   我们有的时候需要进行一些复杂的匹配，可能需要多个正则表达式一起协作才能完成，就是所谓的分治法。这里我们需要利用正则表达式的子组来解决实际问题。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKbN6GSubBpcUiaicOu0lXcNhSX45jQT1icHkJfQvuQxKdhlxJ25uqMIoYw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKfG9Ds0GiaiacDlwJbUMXibl87PIGdW4HibyQ8Biamt8ic1dibHt4wZiaBqtmRw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)



   我相信看这篇同学可能多少还对网络爬虫有一定了解，但是如何更加准确地匹配到指定标签的内容呢？这里我们就需要用到环视（Lookaround）：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bKEGnvmf8jIIqFBRMRuBQibcKSEfSlERDWGep76FO2V0nkzEoTvp3IgYQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

环视匹配的最终结果就是一个位置，匹配到的内容不保存到最终的匹配结果。这就好像要找某一个河南师大的门，它位于建设东路和牧野大道交叉口往北500米，我们根据这些线索就能确定这是河南师大的小东门，但我们只需要是什么门，结果并不包含这些找门的线索。所以环视的作用相当于对所在位置加了一个附加条件，只有满足这个条件，环视子表达式才能匹配成功。我们来看一个例子🌰来理解一下：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Hw3afgOEFJApuiaLibVKrof5oq0d2U25bK8ISDaKfd0I7PicIjePvmT5ftpBqOZhMtoq5h82xicLKKiccCDfXuibyjKA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

# 4. 分组

## 4.1 分组的使用场景

在书写正则表达式时，通常情况下，我们有两种场景会使用到分组。
一是：对一个子表达式进行重复；二是：想要获取到子表达式匹配到的内容。

### 4.1.1 对子表达式进行重复

如果需要重复单个字符，直接在字符后面加上限定符即可，例如 a+ 表示匹配1个或一个以上的a，a?表示匹配0个或1个a。
但是我们如果要对多个字符进行重复的话，就需要用到 分组 。
比如：(ab){3} 表示 ab 字符重复3次

正则中常用的限定符如下:

| **表达式**        | **说明**                             |
| ----------------- | ------------------------------------ |
| *X* ?             | *X* ，一次或一次也没有               |
| *X* *             | *X* ，零次或多次                     |
| *X* +             | *X* ，一次或多次                     |
| *X* { *n* }       | *X* ，恰好 *n* 次                    |
| *X* { *n* ,}      | *X* ，至少 *n* 次                    |
| *X* { *n* , *m* } | *X* ，至少 *n* 次，但是不超过 *m* 次 |

获取到子表达式匹配到的内容

### 4.1.2 获取到子表达式匹配到的内容

比如表达式: [a-z]*\d*[a-z]*，它表示a-z的字符重复0到多次，后面紧跟0到多个数字，后面再跟上多个a-z的字符。
显然，字符串 abcd324232efg 是满足匹配的串。那么，如果我们只想要获取到匹配串中数字 324232 后面的串 efg 呢？

这时，就可以通过分组的方式来改写正则表达式: [a-z]*\d*([a-z]*)。这样，我们就可以通过获取第 1 个分组匹配到的内容来达到目的。

## 4.2 分组的使用方法

正则中通过小括号`“()”`来指定需要重复的子表达式，然后再加上限定符对这个子表达式进行重复。

例如：(abc)? 表示0个或1个abc 。
一组括号里面的表达式就表示一个分组 。

### 4.2.1 捕获组

分组可以分为两种形式，**捕获组**和**非捕获组**。

捕获组和非捕获组的区别就是：捕获组表示的分组会捕获文本（即:匹配字符），而非捕获组表示的分组不会捕获文本。

**捕获组可以通过从左到右计算其开括号来编号** 。
例如，在表达式 (A)(B(C)) 中，存在四个这样的组：

| 分组编号 | 分组编号对应的子表达式 |
| -------- | ---------------------- |
| **0**    | (A)(B(C))              |
| **1**    | (A)                    |
| **2**    | (B(C))                 |
| **3**    | (C)                    |

**注意：第0个分组始终代表整个表达式**

> 分组的序号可以通过 Back 引用（反向引用） 在表达式中使用，也可以在匹配操作完成后从匹配器检索出分组匹配到的内容。
> 反向引用的知识将会在后续的文章中进行分析。

# 5. 小结

分组通常有两种使用场景：一是：对一个子表达式进行重复；二是：想要获取到子表达式匹配到的内容。

分组是通过 `()` 来表示的，它是通过从左到右计算其开括号来进行编号的。